import{_ as D,r as u,i as I,C as Y,b as r,e as s,f as m,g as w,t as d,F as C,p as F,k as g,m as k,j as y,q as B,o as i,z as L,B as Q}from"./index-DfPC7CVf.js";import{s as q}from"./simpleApi-BMx536i5.js";const O={name:"BooksManagerNew",setup(){const h=u([]),o=u(!1),b=u(""),e=u(!1),v=u(null),f=u(!1),t=u(""),c=u([]),_=u(!1),l=I({title:"",author:"",publishedDate:"",pageCount:null,isbn:"",rating:null,description:"",thumbnail:""}),p=async()=>{console.log("📚 [BooksManager] Loading books..."),o.value=!0,b.value="";try{const a=await B.getMedia();if(a.success)h.value=a.data.filter(n=>n.category==="buecher"||n.watchlistType==="buecher"||n.category==="watchlist"&&n.watchlistType==="buecher"),console.log("📚 [BooksManager] Books loaded:",h.value.length);else throw new Error(a.error||"Failed to load books")}catch(a){console.error("📚 [BooksManager] Error loading books:",a),b.value=a.message||"Failed to load books"}finally{o.value=!1}},E=async()=>{if(!t.value.trim()){c.value=[];return}console.log("📚 [BooksManager] Searching books:",t.value),_.value=!0;try{const a=await q.searchBooks(t.value,10);a.success?(c.value=a.data,console.log("📚 [BooksManager] Search results:",a.data.length)):(console.warn("📚 [BooksManager] Search failed:",a.error),c.value=[])}catch(a){console.error("📚 [BooksManager] Search error:",a),c.value=[]}finally{_.value=!1}},x=a=>{console.log("📚 [BooksManager] Book selected:",a.title),l.title=a.title,l.author=a.author,l.publishedDate=a.publishedDate||"",l.pageCount=a.pageCount||null,l.isbn=a.isbn||"",l.rating=a.averageRating||null,l.description=a.description||"",l.thumbnail=a.thumbnail||"",t.value="",c.value=[]},S=async()=>{console.log("📚 [BooksManager] Saving book:",l.title),f.value=!0;try{const a={title:l.title,author:l.author,category:"buecher",release:l.publishedDate||new Date().toISOString().split("T")[0],rating:l.rating||null,genre:"Book",platforms:"Book",description:l.description,path:l.thumbnail,isbn:l.isbn,pageCount:l.pageCount,watchlistType:"buecher"};let n;if(v.value?n=await B.updateMedia(v.value.id,a):n=await B.addMedia(a),n.success)console.log("📚 [BooksManager] Book saved successfully"),await p(),M();else throw new Error(n.error||"Failed to save book")}catch(a){console.error("📚 [BooksManager] Error saving book:",a),b.value=a.message||"Failed to save book"}finally{f.value=!1}},A=a=>{console.log("📚 [BooksManager] Editing book:",a.title),v.value=a,l.title=a.title||"",l.author=a.author||"",l.publishedDate=a.release||"",l.pageCount=a.pageCount||null,l.isbn=a.isbn||"",l.rating=a.rating||null,l.description=a.description||"",l.thumbnail=a.path||"",e.value=!0},N=async a=>{if(confirm("Are you sure you want to delete this book?")){console.log("📚 [BooksManager] Deleting book:",a),o.value=!0;try{const n=await B.deleteMedia(a);if(n.success)console.log("📚 [BooksManager] Book deleted successfully"),await p();else throw new Error(n.error||"Failed to delete book")}catch(n){console.error("📚 [BooksManager] Error deleting book:",n),b.value=n.message||"Failed to delete book"}finally{o.value=!1}}},R=()=>{p()},M=()=>{e.value=!1,v.value=null,t.value="",c.value=[],Object.keys(l).forEach(a=>{typeof l[a]=="string"?l[a]="":l[a]=null})},V=a=>{a.target.style.display="none"},U=a=>{if(!a)return"";const n=new Date(a).getFullYear();return isNaN(n)?a:n.toString()},T=a=>{if(!a)return"";const n=Math.round(a);return"★".repeat(n)+"☆".repeat(5-n)};return Y(()=>{p()}),{books:h,loading:o,error:b,showAddModal:e,editingBook:v,saving:f,searchQuery:t,searchResults:c,searching:_,bookForm:l,loadBooks:p,searchBooks:E,selectBook:x,saveBook:S,editBook:A,deleteBook:N,refreshBooks:R,closeModal:M,handleImageError:V,formatYear:U,formatRating:T}}},j={class:"books-manager"},P={class:"books-header"},z={class:"header-actions"},G=["disabled"],H=["disabled"],J={key:0,class:"loading-state"},K={key:1,class:"error-state"},W={key:2,class:"books-grid"},X=["onClick"],Z={class:"book-cover"},$=["src","alt"],oo={key:1,class:"no-cover"},so={class:"book-info"},eo={class:"book-title"},to={class:"book-author"},ao={class:"book-meta"},lo={key:0,class:"book-year"},no={key:1,class:"book-pages"},ro={key:0,class:"book-rating"},io={class:"stars"},co={class:"rating-text"},uo={class:"book-actions"},go=["onClick"],ko=["onClick"],bo={key:3,class:"empty-state"},vo={class:"modal-header"},mo={class:"modal-body"},ho={class:"search-section"},fo={class:"search-input-group"},po=["disabled"],yo=["disabled"],Bo={key:0,class:"search-results"},_o={class:"result-list"},Mo=["onClick"],wo={class:"result-cover"},Co=["src","alt"],Fo={key:1,class:"no-cover-small"},Do={class:"result-info"},Eo={key:0,class:"result-year"},xo={class:"manual-entry-section"},So={class:"form-row"},Ao={class:"form-group"},No={class:"form-group"},Ro={class:"form-row"},Vo={class:"form-group"},Uo={class:"form-group"},To={class:"form-row"},Io={class:"form-group"},Yo={class:"form-group"},Lo={class:"form-group"},Qo={class:"form-actions"},qo=["disabled"];function Oo(h,o,b,e,v,f){return i(),r("div",j,[s("div",P,[o[22]||(o[22]=s("h1",null,"📚 Books Library",-1)),s("div",z,[s("button",{onClick:o[0]||(o[0]=t=>e.showAddModal=!0),class:"add-book-btn",disabled:e.loading},[...o[20]||(o[20]=[s("span",{class:"btn-icon"},"+",-1),w(" Add Book ",-1)])],8,G),s("button",{onClick:o[1]||(o[1]=(...t)=>e.refreshBooks&&e.refreshBooks(...t)),class:"refresh-btn",disabled:e.loading},[...o[21]||(o[21]=[s("span",{class:"btn-icon"},"🔄",-1),w(" Refresh ",-1)])],8,H)])]),e.loading&&e.books.length===0?(i(),r("div",J,[...o[23]||(o[23]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading books...",-1)])])):e.error?(i(),r("div",K,[o[24]||(o[24]=s("div",{class:"error-icon"},"❌",-1)),o[25]||(o[25]=s("h3",null,"Error Loading Books",-1)),s("p",null,d(e.error),1),s("button",{onClick:o[2]||(o[2]=(...t)=>e.refreshBooks&&e.refreshBooks(...t)),class:"retry-btn"},"Try Again")])):e.books.length>0?(i(),r("div",W,[(i(!0),r(C,null,F(e.books,t=>(i(),r("div",{key:t.id,class:"book-card",onClick:c=>e.editBook(t)},[s("div",Z,[t.thumbnail?(i(),r("img",{key:0,src:t.thumbnail,alt:t.title,onError:o[3]||(o[3]=(...c)=>e.handleImageError&&e.handleImageError(...c))},null,40,$)):(i(),r("div",oo,[...o[26]||(o[26]=[s("span",{class:"book-icon"},"📚",-1)])]))]),s("div",so,[s("h3",eo,d(t.title),1),s("p",to,d(t.author),1),s("div",ao,[t.publishedDate?(i(),r("span",lo,d(e.formatYear(t.publishedDate)),1)):m("",!0),t.pageCount?(i(),r("span",no,d(t.pageCount)+" pages ",1)):m("",!0)]),t.averageRating?(i(),r("div",ro,[s("span",io,d(e.formatRating(t.averageRating)),1),s("span",co,d(t.averageRating)+"/5",1)])):m("",!0)]),s("div",uo,[s("button",{onClick:y(c=>e.editBook(t),["stop"]),class:"action-btn edit"}," ✏️ ",8,go),s("button",{onClick:y(c=>e.deleteBook(t.id),["stop"]),class:"action-btn delete"}," 🗑️ ",8,ko)])],8,X))),128))])):(i(),r("div",bo,[o[27]||(o[27]=s("div",{class:"empty-icon"},"📚",-1)),o[28]||(o[28]=s("h3",null,"No Books Yet",-1)),o[29]||(o[29]=s("p",null,"Start building your book collection by adding your first book!",-1)),s("button",{onClick:o[4]||(o[4]=t=>e.showAddModal=!0),class:"add-first-btn"}," Add Your First Book ")])),e.showAddModal||e.editingBook?(i(),r("div",{key:4,class:"modal-overlay",onClick:o[19]||(o[19]=(...t)=>e.closeModal&&e.closeModal(...t))},[s("div",{class:"modal-content",onClick:o[18]||(o[18]=y(()=>{},["stop"]))},[s("div",vo,[s("h2",null,d(e.editingBook?"Edit Book":"Add New Book"),1),s("button",{onClick:o[5]||(o[5]=(...t)=>e.closeModal&&e.closeModal(...t)),class:"close-btn"},"×")]),s("div",mo,[s("div",ho,[o[30]||(o[30]=s("h3",null,"Search for Book",-1)),s("div",fo,[g(s("input",{"onUpdate:modelValue":o[6]||(o[6]=t=>e.searchQuery=t),onInput:o[7]||(o[7]=(...t)=>e.searchBooks&&e.searchBooks(...t)),type:"text",placeholder:"Search for a book title...",class:"search-input",disabled:e.searching},null,40,po),[[k,e.searchQuery]]),s("button",{onClick:o[8]||(o[8]=(...t)=>e.searchBooks&&e.searchBooks(...t)),class:"search-btn",disabled:e.searching||!e.searchQuery.trim()},d((e.searching,"🔍")),9,yo)]),e.searchResults.length>0?(i(),r("div",Bo,[s("h4",null,"Search Results ("+d(e.searchResults.length)+")",1),s("div",_o,[(i(!0),r(C,null,F(e.searchResults,t=>(i(),r("div",{key:t.id,class:"result-item",onClick:c=>e.selectBook(t)},[s("div",wo,[t.thumbnail?(i(),r("img",{key:0,src:t.thumbnail,alt:t.title},null,8,Co)):(i(),r("div",Fo,"📚"))]),s("div",Do,[s("h4",null,d(t.title),1),s("p",null,d(t.author),1),t.publishedDate?(i(),r("p",Eo,d(e.formatYear(t.publishedDate)),1)):m("",!0)])],8,Mo))),128))])])):m("",!0)]),s("div",xo,[o[38]||(o[38]=s("h3",null,"Or Enter Manually",-1)),s("form",{onSubmit:o[17]||(o[17]=y((...t)=>e.saveBook&&e.saveBook(...t),["prevent"])),class:"book-form"},[s("div",So,[s("div",Ao,[o[31]||(o[31]=s("label",{for:"title"},"Title *",-1)),g(s("input",{id:"title","onUpdate:modelValue":o[9]||(o[9]=t=>e.bookForm.title=t),type:"text",required:"",class:"form-input"},null,512),[[k,e.bookForm.title]])]),s("div",No,[o[32]||(o[32]=s("label",{for:"author"},"Author *",-1)),g(s("input",{id:"author","onUpdate:modelValue":o[10]||(o[10]=t=>e.bookForm.author=t),type:"text",required:"",class:"form-input"},null,512),[[k,e.bookForm.author]])])]),s("div",Ro,[s("div",Vo,[o[33]||(o[33]=s("label",{for:"publishedDate"},"Published Date",-1)),g(s("input",{id:"publishedDate","onUpdate:modelValue":o[11]||(o[11]=t=>e.bookForm.publishedDate=t),type:"text",placeholder:"2023",class:"form-input"},null,512),[[k,e.bookForm.publishedDate]])]),s("div",Uo,[o[34]||(o[34]=s("label",{for:"pageCount"},"Pages",-1)),g(s("input",{id:"pageCount","onUpdate:modelValue":o[12]||(o[12]=t=>e.bookForm.pageCount=t),type:"number",class:"form-input"},null,512),[[k,e.bookForm.pageCount,void 0,{number:!0}]])])]),s("div",To,[s("div",Io,[o[35]||(o[35]=s("label",{for:"isbn"},"ISBN",-1)),g(s("input",{id:"isbn","onUpdate:modelValue":o[13]||(o[13]=t=>e.bookForm.isbn=t),type:"text",class:"form-input"},null,512),[[k,e.bookForm.isbn]])]),s("div",Yo,[o[36]||(o[36]=s("label",{for:"rating"},"Rating (1-5)",-1)),g(s("input",{id:"rating","onUpdate:modelValue":o[14]||(o[14]=t=>e.bookForm.rating=t),type:"number",min:"1",max:"5",step:"0.1",class:"form-input"},null,512),[[k,e.bookForm.rating,void 0,{number:!0}]])])]),s("div",Lo,[o[37]||(o[37]=s("label",{for:"description"},"Description",-1)),g(s("textarea",{id:"description","onUpdate:modelValue":o[15]||(o[15]=t=>e.bookForm.description=t),rows:"3",class:"form-textarea"},null,512),[[k,e.bookForm.description]])]),s("div",Qo,[s("button",{type:"button",onClick:o[16]||(o[16]=(...t)=>e.closeModal&&e.closeModal(...t)),class:"cancel-btn"}," Cancel "),s("button",{type:"submit",class:"save-btn",disabled:e.saving},d(e.saving?"Saving...":e.editingBook?"Update Book":"Add Book"),9,qo)])],32)])])])])):m("",!0)])}const jo=D(O,[["render",Oo],["__scopeId","data-v-0a47e8fa"]]),Po={name:"Books",components:{BooksManagerNew:jo}},zo={class:"books-page"};function Go(h,o,b,e,v,f){const t=Q("BooksManagerNew");return i(),r("div",zo,[L(t)])}const Ko=D(Po,[["render",Go],["__scopeId","data-v-776266d3"]]);export{Ko as default};
