import{G as ce,d as P,r as E,l as M,c as A,y as L,_ as V,b as S,e as o,t as w,o as b,D as _,f as ue,F as R,x as G,n as B,H as $,z as N,g as de}from"./index-Bk3ZaZcl.js";class ge{constructor(){this.isConnected={value:!1},this.listeners=new Map,this.pollingInterval=null,this.lastUpdate=null,this.pollingIntervalMs=2e4}getApiBaseUrl(){return ce.BASE_URL}connect(){if(this.pollingInterval)return;const a=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");!a||!c||(this.isConnected.value=!0,this.lastUpdate=new Date,this.pollingInterval=setInterval(()=>{this.checkForUpdates()},this.pollingIntervalMs))}async checkForUpdates(){try{const a=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");if(!a||!c)return;const p=this.getApiBaseUrl(),g=await fetch(`${p}/api/media`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!g.ok){if(g.status===401){this.disconnect();return}throw new Error(`HTTP error! status: ${g.status}`)}const k=await g.json();k&&k.length>0&&this.listeners.forEach((r,v)=>{try{r({type:"media_updated",items:k,count:k.length,timestamp:new Date().toISOString()})}catch{}}),this.lastUpdate=new Date}catch{}}addListener(a,c){this.listeners.set(a,c)}removeListener(a){this.listeners.delete(a)}disconnect(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null),this.isConnected.value=!1}destroy(){this.disconnect(),this.listeners.clear()}}const O=new ge,tt=P("media",()=>{const u=()=>{try{return localStorage.getItem("currentCategory")||"game"}catch(e){return console.error("Failed to load current category from localStorage:",e),"game"}},a=e=>{try{localStorage.setItem("currentCategory",e)}catch(t){console.error("Failed to save current category to localStorage:",t)}},c=()=>{try{return localStorage.getItem("searchQuery")||""}catch(e){return console.error("Failed to load search query from localStorage:",e),""}},p=e=>{try{localStorage.setItem("searchQuery",e)}catch(t){console.error("Failed to save search query to localStorage:",t)}},g=()=>{try{const e=localStorage.getItem("activeFilters");return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load active filters from localStorage:",e),[]}},k=e=>{try{localStorage.setItem("activeFilters",JSON.stringify(e))}catch(t){console.error("Failed to save active filters to localStorage:",t)}},r=E(f()),v=E(u()),i=E(c()),d=E(g()),F=E(!0),T=E(!1),h=E(null);M(v,e=>{a(e)},{immediate:!1}),M(i,e=>{p(e)},{immediate:!1}),M(d,e=>{k(e)},{immediate:!1,deep:!0});function f(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");if(!e||!t){const s=localStorage.getItem("mediaData");return s?JSON.parse(s):[]}return[]}catch(e){return console.error("Failed to load media from storage:",e),[]}}function I(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");(!e||!t)&&localStorage.setItem("mediaData",JSON.stringify(r.value))}catch(e){console.error("Failed to save media to storage:",e)}}const Q=A(()=>r.value.length),z=A(()=>{const e={};return r.value.forEach(t=>{const s=t.category||"unknown";e[s]=(e[s]||0)+1}),e}),J=A(()=>{let e=[...r.value];if(console.log("ðŸ” FILTER DEBUG: Total media items:",r.value.length),console.log("ðŸ” FILTER DEBUG: Current category:",v.value),console.log("ðŸ” FILTER DEBUG: Search query:",i.value),console.log("ðŸ” FILTER DEBUG: Active filters:",d.value),console.log("ðŸ” FILTER DEBUG: Filters enabled:",F.value),console.log("ðŸ” FILTER DEBUG: Raw media data:",r.value),v.value&&v.value!=="all"){const t=e.length;e=e.filter(s=>v.value==="watchlist"?s.category==="watchlist"||s.isNew===!0:(console.log("ðŸ” CATEGORY DEBUG: Item title:",s.title,"Item category:",s.category,"Current category:",v.value,"Match:",s.category===v.value),s.category===v.value)),console.log("ðŸ” FILTER DEBUG: After category filter:",e.length,"items (was",t,")"),e.length===0&&t>0&&(console.log("ðŸ” FALLBACK: No items match category, showing all items"),e=[...r.value])}if(i.value){const t=i.value.toLowerCase();e=e.filter(s=>{var l,n,m,U;return((l=s.title)==null?void 0:l.toLowerCase().includes(t))||((n=s.description)==null?void 0:n.toLowerCase().includes(t))||((m=s.genre)==null?void 0:m.toLowerCase().includes(t))||((U=s.platforms)==null?void 0:U.toLowerCase().includes(t))}),console.log("ðŸ” FILTER DEBUG: After search filter:",e.length,"items")}return F.value?(console.log("ðŸ” FILTER DEBUG: Applying active filters, count:",d.value.length),d.value.forEach(t=>{if(t.type==="platform"){const s=e.length;e=e.filter(l=>{var n;return(n=l.platforms)==null?void 0:n.toLowerCase().includes(t.value.toLowerCase())}),console.log("ðŸ” PLATFORM FILTER:",t.value,"Before:",s,"After:",e.length)}else if(t.type==="genre"){const s=e.length;e=e.filter(l=>{var n;return(n=l.genre)==null?void 0:n.toLowerCase().includes(t.value.toLowerCase())}),console.log("ðŸ” GENRE FILTER:",t.value,"Before:",s,"After:",e.length)}else if(t.type==="airing"){const s=e.length;t.value==="airing"?e=e.filter(l=>l.isAiring===!0):t.value==="finished"&&(e=e.filter(l=>l.isAiring===!1||l.isAiring===null)),console.log("ðŸ” AIRING FILTER:",t.value,"Before:",s,"After:",e.length)}})):console.log("ðŸ” FILTER DEBUG: Filters disabled, skipping active filters"),console.log("ðŸ” FILTER DEBUG: Final filtered result:",e.length,"items"),console.log("ðŸ” FILTER DEBUG: Final filtered items:",e),e}),q=A(()=>{const e=new Set;return r.value.forEach(t=>{t.platforms&&t.platforms.split(/[,;|&]/).map(l=>l.trim()).filter(l=>l.length>0).forEach(l=>e.add(l))}),Array.from(e).sort()}),j=A(()=>{const e=new Set;return r.value.forEach(t=>{t.genre&&t.genre.split(/[,;|&]/).map(l=>l.trim()).filter(l=>l.length>0).forEach(l=>e.add(l))}),Array.from(e).sort()});async function C(){var e,t;T.value=!0,h.value=null;try{const s=localStorage.getItem("authToken"),l=localStorage.getItem("currentUser");if(s&&l)try{const n=await L.getMedia();console.log("ðŸ” LOAD DEBUG: API returned data:",n),console.log("ðŸ” LOAD DEBUG: Data length:",n==null?void 0:n.length),console.log("ðŸ” LOAD DEBUG: First item:",n==null?void 0:n[0]),r.value=n||[],console.log("ðŸ” LOAD DEBUG: mediaData.value set to:",r.value)}catch(n){console.warn("API load failed for logged in user:",n),r.value=[]}else{const n=f();if(n.length>0)r.value=n;else{const m=await L.getMedia();r.value=m||[],I()}}}catch(s){h.value=((t=(e=s.response)==null?void 0:e.data)==null?void 0:t.message)||s.message||"Failed to load media data",console.error("Failed to load media:",s)}finally{T.value=!1}}function H(e){v.value=e}function K(e){i.value=e}function W(e){d.value.some(s=>s.type===e.type&&s.value===e.value)||d.value.push(e)}function Y(e){d.value=d.value.filter(t=>!(t.type===e.type&&t.value===e.value))}function X(){d.value=[]}function Z(){console.log("ðŸ”„ TOGGLE FILTERS: Before toggle, filtersEnabled =",F.value),F.value=!F.value,console.log("ðŸ”„ TOGGLE FILTERS: After toggle, filtersEnabled =",F.value)}async function ee(e,t=!1){var s,l,n;h.value=null;try{const m=localStorage.getItem("authToken"),U=localStorage.getItem("currentUser");if(m&&U)try{const y=await L.addMediaItem(e);if(!t)await C();else{const D={...y,__order:r.value.length};r.value.push(D)}return y}catch(y){if(((s=y.response)==null?void 0:s.status)===409&&((n=(l=y.response)==null?void 0:l.data)!=null&&n.duplicate)){const D=new Error(y.response.data.error||"Ein Eintrag mit diesem Titel und dieser Kategorie existiert bereits.");throw D.isDuplicate=!0,D}throw h.value=y.message||"Failed to add media item",console.error("API save failed for logged in user:",y),y}else{const y={id:Date.now(),...e,__order:r.value.length};return r.value.push(y),I(),y}}catch(m){throw m}}async function te(e,t){h.value=null;try{const s=localStorage.getItem("authToken"),l=localStorage.getItem("currentUser");if(s&&l)try{const n=await L.updateMediaItem(e,t);return await C(),n}catch(n){throw console.error("API update failed for logged in user:",n),n}else{const n=r.value.findIndex(m=>m.id===e);if(n!==-1)return r.value[n]={...r.value[n],...t},I(),r.value[n];throw new Error("Media item not found")}}catch(s){throw s.isDuplicate||(h.value=s.message||"Failed to update media item"),s}}async function ae(e){var t;try{const s=localStorage.getItem("authToken"),l=localStorage.getItem("currentUser");if(s&&l)try{return await L.deleteMediaItem(e),await C(),!0}catch(n){if(((t=n.response)==null?void 0:t.status)===404||n.isNotFound)return await C(),!0;throw console.error("API delete failed for logged in user:",n),n}else{const n=r.value.findIndex(m=>m.id===e);if(n!==-1)return r.value.splice(n,1),I(),!0;throw new Error("Media item not found")}}catch(s){throw h.value=s.message||"Failed to delete media item",s}}async function oe(e){try{const t=localStorage.getItem("authToken"),s=localStorage.getItem("currentUser");if(t&&s)try{const l=await L.batchAddMediaItems(e);return await C(),l}catch(l){throw console.error("API batch add failed for logged in user:",l),l}else{const l=e.map((n,m)=>({id:Date.now()+m,...n,__order:r.value.length+m}));return r.value.push(...l),I(),{success:!0,stats:{created:l.length,failed:0,errors:[]}}}}catch(t){throw h.value=t.message||"Failed to add media items",t}}async function se(e){try{const t=localStorage.getItem("authToken"),s=localStorage.getItem("currentUser");if(t&&s)try{return await L.batchDeleteMediaItems(e),await C(),!0}catch(l){if(l.silent)return console.log("Silent batch delete error (some items may not exist):",l.message),await C(),!0;throw console.error("API batch delete failed for logged in user:",l),l}else return r.value=r.value.filter(l=>!e.includes(l.id)),I(),!0}catch(t){throw t.silent||(h.value=t.message||"Failed to delete media items"),t}}async function le(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");e&&t?await L.saveMedia(r.value):I()}catch(e){console.error("Failed to save media:",e)}}function x(){h.value=null}function re(e){if(console.log("Processing real-time update:",e),e.type==="media_updated"&&e.items)e.items.forEach(t=>{const s=r.value.findIndex(l=>l.id===t.id);s!==-1?r.value[s]={...r.value[s],...t}:r.value.push(t)});else if(e.action==="created"||e.action==="updated"){const t=e.item,s=r.value.findIndex(l=>l.id===t.id);s!==-1?r.value[s]={...r.value[s],...t}:r.value.push(t)}else if(e.action==="deleted"){const t=r.value.findIndex(s=>s.id===e.id);t!==-1&&r.value.splice(t,1)}I()}function ne(){const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");if(!e||!t){console.log("Skipping realtime initialization - user not authenticated");return}try{O.addListener("media-store",re),O.connect()}catch(s){console.error("Failed to initialize realtime updates:",s)}}function ie(){O.removeListener("media-store")}return{mediaData:r,currentCategory:v,searchQuery:i,activeFilters:d,loading:T,error:h,totalItems:Q,categoryCounts:z,filteredMedia:J,platforms:q,genres:j,loadMedia:C,setCategory:H,setSearchQuery:K,addFilter:W,removeFilter:Y,clearFilters:X,toggleFilters:Z,filtersEnabled:F,addMediaItem:ee,updateMediaItem:te,deleteMediaItem:ae,batchAddMediaItems:oe,batchDeleteMediaItems:se,saveMedia:le,clearError:x,initializeRealtimeUpdates:ne,cleanupRealtimeUpdates:ie,resetMediaState:()=>{v.value="game",i.value="",d.value=[],localStorage.removeItem("currentCategory"),localStorage.removeItem("searchQuery"),localStorage.removeItem("activeFilters")}}}),at=P("sidebar",()=>{const u=()=>{try{const f=localStorage.getItem("sidebarState");if(f)return{collapsed:JSON.parse(f).collapsed||!1,mobileOpen:!1}}catch(f){console.error("Failed to load sidebar state from localStorage:",f)}return{collapsed:!1,mobileOpen:!1}},a=f=>{try{localStorage.setItem("sidebarState",JSON.stringify({collapsed:f.collapsed}))}catch(I){console.error("Failed to save sidebar state to localStorage:",I)}},c=u(),p=E(c.collapsed),g=E(c.mobileOpen);M(p,f=>{a({collapsed:f,mobileOpen:g.value})},{immediate:!1});const k=()=>{p.value=!p.value},r=()=>{g.value=!g.value},v=()=>{g.value=!1},i=f=>{p.value=f},d=f=>{g.value=f},F=()=>{p.value=!1,g.value=!1,localStorage.removeItem("sidebarState")},T=A(()=>p.value),h=A(()=>g.value);return{collapsed:p,mobileOpen:g,toggleSidebar:k,toggleMobileSidebar:r,closeMobileSidebar:v,setCollapsed:i,setMobileOpen:d,resetSidebarState:F,isCollapsed:T,isMobileOpen:h}}),ve={name:"VersionInfo",data(){return{version:"1.0.0"}}},fe={class:"version-info"},me={class:"version-label"};function he(u,a,c,p,g,k){return b(),S("div",fe,[o("span",me,"Build #"+w(g.version),1)])}const pe=V(ve,[["render",he],["__scopeId","data-v-2d54e3c7"]]),ye={name:"Sidebar",components:{VersionInfo:pe},props:{collapsed:{type:Boolean,default:!1},mobileOpen:{type:Boolean,default:!1},isLoggedIn:{type:Boolean,default:!1},userName:{type:String,default:""},currentCategory:{type:String,default:"watchlist"},categoryCounts:{type:Object,default:()=>({})},platforms:{type:Array,default:()=>[]},genres:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[{key:"game",name:"Games",icon:"ðŸŽ®"},{key:"series",name:"Series",icon:"ðŸ“º"},{key:"movie",name:"Movies",icon:"ðŸŽ¬"},{key:"buecher",name:"BÃ¼cher",icon:"ðŸ“š"},{key:"watchlist",name:"Watchlist",icon:"â¤ï¸"}]},filtersEnabled:{type:Boolean,default:!0}},emits:["toggle","setCategory","addItem","navigateToCalendar","navigateToProfile","togglePlatformFilter","toggleGenreFilter","toggleAiringFilter","clearFilters","toggleFilters","showLogin","showRegister","logout"],methods:{}},Ie={class:"sidebar-content"},Se={class:"sidebar-section"},be={class:"sidebar-nav"},ke=["onClick"],Fe={class:"nav-icon"},we={class:"nav-text"},Ee={class:"nav-count"},Ce=["onClick","title"],Le={key:0,class:"sidebar-section"},Ae={class:"filters-header"},Te={class:"filter-controls"},Ue=["title"],De={class:"toggle-icon"},Be={class:"toggle-text"},Me={class:"filter-section"},_e={class:"filter-group"},Re={class:"filter-checkboxes"},Ge=["value","onChange"],Oe={class:"option-text"},xe={class:"filter-group"},$e={class:"filter-checkboxes"},Ne=["value","onChange"],Pe={class:"option-text"},Ve={class:"filter-group"},Qe={class:"filter-checkboxes"},ze={class:"filter-option"},Je={class:"filter-option"},qe={class:"sidebar-section"},je={key:0,class:"auth-buttons"},He={key:1,class:"user-info"},Ke={class:"user-profile"},We={class:"profile-details"},Ye={class:"user-name"};function Xe(u,a,c,p,g,k){const r=N("router-link"),v=N("VersionInfo");return b(),S("aside",{id:"sidebar",class:B(["sidebar",{collapsed:c.collapsed,open:c.mobileOpen}])},[o("div",{class:"sidebar-header",onClick:a[0]||(a[0]=i=>u.$emit("toggle"))},[...a[10]||(a[10]=[o("h2",null,"Media Library",-1),o("button",{class:"sidebar-toggle"},"â˜°",-1)])]),o("div",Ie,[o("div",Se,[a[15]||(a[15]=o("h3",null,"Browse",-1)),o("nav",be,[(b(!0),S(R,null,G(c.categories,i=>(b(),S("div",{key:i.key,class:"nav-item"},[o("button",{class:B(["nav-btn",{active:c.currentCategory===i.key}]),onClick:d=>u.$emit("setCategory",i.key)},[o("span",Fe,w(i.icon),1),o("span",we,w(i.name),1),o("span",Ee,w(c.categoryCounts[i.key]||0),1)],10,ke),o("button",{class:"add-btn",onClick:d=>u.$emit("addItem",i.key),title:`Add ${i.name}`},[...a[11]||(a[11]=[o("span",{class:"add-icon"},"+",-1)])],8,Ce)]))),128)),o("button",{class:B(["nav-btn",{active:c.currentCategory==="statistics"}]),onClick:a[1]||(a[1]=i=>u.$emit("setCategory","statistics"))},[...a[12]||(a[12]=[o("span",{class:"nav-icon"},"ðŸ“Š",-1),o("span",{class:"nav-text"},"Statistics",-1)])],2),_(r,{to:"/calendar",class:"nav-btn"},{default:$(()=>[...a[13]||(a[13]=[o("span",{class:"nav-icon"},"ðŸ“…",-1),o("span",{class:"nav-text"},"Calendar",-1)])]),_:1}),_(r,{to:"/profile",class:"nav-btn"},{default:$(()=>[...a[14]||(a[14]=[o("span",{class:"nav-icon"},"ðŸ‘¤",-1),o("span",{class:"nav-text"},"Profile",-1)])]),_:1})])]),c.isLoggedIn?(b(),S("div",Le,[o("div",Ae,[a[17]||(a[17]=o("h3",null,"Filters",-1)),o("div",Te,[o("button",{class:"refresh-btn",onClick:a[2]||(a[2]=i=>u.$emit("clearFilters")),title:"Clear all filters"},[...a[16]||(a[16]=[o("span",{class:"refresh-icon"},"ðŸ”„",-1),o("span",{class:"refresh-text"},"Refresh",-1)])]),o("button",{class:B(["toggle-filters-btn",{active:c.filtersEnabled}]),onClick:a[3]||(a[3]=i=>u.$emit("toggleFilters")),title:c.filtersEnabled?"Disable all filters":"Enable all filters"},[o("span",De,w(c.filtersEnabled?"ðŸ”":"ðŸš«"),1),o("span",Be,w(c.filtersEnabled?"ON":"OFF"),1)],10,Ue)])]),o("div",Me,[o("div",_e,[a[19]||(a[19]=o("h4",null,"Platforms",-1)),o("div",Re,[(b(!0),S(R,null,G(c.platforms,i=>(b(),S("label",{key:i,class:"filter-option"},[o("input",{type:"checkbox",value:i,onChange:d=>u.$emit("togglePlatformFilter",i,d.target.checked)},null,40,Ge),a[18]||(a[18]=o("span",{class:"checkmark"},null,-1)),o("span",Oe,w(i),1)]))),128))])]),o("div",xe,[a[21]||(a[21]=o("h4",null,"Genres",-1)),o("div",$e,[(b(!0),S(R,null,G(c.genres,i=>(b(),S("label",{key:i,class:"filter-option"},[o("input",{type:"checkbox",value:i,onChange:d=>u.$emit("toggleGenreFilter",i,d.target.checked)},null,40,Ne),a[20]||(a[20]=o("span",{class:"checkmark"},null,-1)),o("span",Pe,w(i),1)]))),128))])]),o("div",Ve,[a[26]||(a[26]=o("h4",null,"Series Status",-1)),o("div",Qe,[o("label",ze,[o("input",{type:"checkbox",value:"airing",onChange:a[4]||(a[4]=i=>u.$emit("toggleAiringFilter","airing",i.target.checked))},null,32),a[22]||(a[22]=o("span",{class:"checkmark"},null,-1)),a[23]||(a[23]=o("span",{class:"option-text"},[o("span",{class:"airing-indicator"},"â—"),de(" Airing ")],-1))]),o("label",Je,[o("input",{type:"checkbox",value:"finished",onChange:a[5]||(a[5]=i=>u.$emit("toggleAiringFilter","finished",i.target.checked))},null,32),a[24]||(a[24]=o("span",{class:"checkmark"},null,-1)),a[25]||(a[25]=o("span",{class:"option-text"},"Finished",-1))])])])])])):ue("",!0),o("div",qe,[a[28]||(a[28]=o("h3",null,"Account",-1)),c.isLoggedIn?(b(),S("div",He,[o("div",Ke,[a[27]||(a[27]=o("div",{class:"profile-avatar"},[o("span",{class:"avatar-text"},"ðŸ‘¤")],-1)),o("div",We,[o("span",Ye,w(c.userName),1)]),o("button",{class:"account-btn",onClick:a[8]||(a[8]=i=>u.$emit("navigateToProfile"))},"âš™ï¸")]),o("button",{class:"auth-btn",onClick:a[9]||(a[9]=i=>u.$emit("logout"))},"Logout")])):(b(),S("div",je,[o("button",{class:"auth-btn",onClick:a[6]||(a[6]=i=>u.$emit("showLogin"))},"Login"),o("button",{class:"auth-btn",onClick:a[7]||(a[7]=i=>u.$emit("showRegister"))},"Register")]))])]),_(v)],2)}const ot=V(ye,[["render",Xe],["__scopeId","data-v-82f14bfe"]]);export{ot as S,at as a,tt as u};
