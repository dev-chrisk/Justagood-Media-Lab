import{G as le,d as V,r as C,l as E,c as M,y as w,_ as Q,b as S,e as s,t as F,o as I,D as U,f as ie,F as T,x as O,n as N,H as D,z as R,g as ce}from"./index-4nZ4Aoem.js";class ue{constructor(){this.isConnected={value:!1},this.listeners=new Map,this.pollingInterval=null,this.lastUpdate=null,this.pollingIntervalMs=2e4}getApiBaseUrl(){return le.BASE_URL}connect(){if(this.pollingInterval)return;const a=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");!a||!c||(this.isConnected.value=!0,this.lastUpdate=new Date,this.pollingInterval=setInterval(()=>{this.checkForUpdates()},this.pollingIntervalMs))}async checkForUpdates(){try{const a=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");if(!a||!c)return;const p=this.getApiBaseUrl(),g=await fetch(`${p}/api/media`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!g.ok){if(g.status===401){this.disconnect();return}throw new Error(`HTTP error! status: ${g.status}`)}const b=await g.json();b&&b.length>0&&this.listeners.forEach((n,h)=>{try{n({type:"media_updated",items:b,count:b.length,timestamp:new Date().toISOString()})}catch{}}),this.lastUpdate=new Date}catch{}}addListener(a,c){this.listeners.set(a,c)}removeListener(a){this.listeners.delete(a)}disconnect(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null),this.isConnected.value=!1}destroy(){this.disconnect(),this.listeners.clear()}}const P=new ue,We=V("media",()=>{const d=()=>{try{return localStorage.getItem("currentCategory")||"game"}catch(e){return console.error("Failed to load current category from localStorage:",e),"game"}},a=e=>{try{localStorage.setItem("currentCategory",e)}catch(t){console.error("Failed to save current category to localStorage:",t)}},c=()=>{try{return localStorage.getItem("searchQuery")||""}catch(e){return console.error("Failed to load search query from localStorage:",e),""}},p=e=>{try{localStorage.setItem("searchQuery",e)}catch(t){console.error("Failed to save search query to localStorage:",t)}},g=()=>{try{const e=localStorage.getItem("activeFilters");return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load active filters from localStorage:",e),[]}},b=e=>{try{localStorage.setItem("activeFilters",JSON.stringify(e))}catch(t){console.error("Failed to save active filters to localStorage:",t)}},n=C(_()),h=C(d()),l=C(c()),v=C(g()),A=C(!1),f=C(null);E(h,e=>{a(e)},{immediate:!1}),E(l,e=>{p(e)},{immediate:!1}),E(v,e=>{b(e)},{immediate:!1,deep:!0});function _(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");if(!e||!t){const o=localStorage.getItem("mediaData");return o?JSON.parse(o):[]}return[]}catch(e){return console.error("Failed to load media from storage:",e),[]}}function u(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");(!e||!t)&&localStorage.setItem("mediaData",JSON.stringify(n.value))}catch(e){console.error("Failed to save media to storage:",e)}}const L=M(()=>n.value.length),z=M(()=>{const e={};return n.value.forEach(t=>{const o=t.category||"unknown";e[o]=(e[o]||0)+1}),e}),G=M(()=>{let e=[...n.value];if(h.value&&h.value!=="all"&&(e=e.filter(t=>h.value==="watchlist"?t.category==="watchlist"||t.isNew===!0:t.category===h.value)),l.value){const t=l.value.toLowerCase();e=e.filter(o=>{var r,i,m,x;return((r=o.title)==null?void 0:r.toLowerCase().includes(t))||((i=o.description)==null?void 0:i.toLowerCase().includes(t))||((m=o.genre)==null?void 0:m.toLowerCase().includes(t))||((x=o.platforms)==null?void 0:x.toLowerCase().includes(t))})}return v.value.forEach(t=>{t.type==="platform"?e=e.filter(o=>{var r;return(r=o.platforms)==null?void 0:r.toLowerCase().includes(t.value.toLowerCase())}):t.type==="genre"?e=e.filter(o=>{var r;return(r=o.genre)==null?void 0:r.toLowerCase().includes(t.value.toLowerCase())}):t.type==="airing"&&(t.value==="airing"?e=e.filter(o=>o.isAiring===!0):t.value==="finished"&&(e=e.filter(o=>o.isAiring===!1||o.isAiring===null)))}),e}),J=M(()=>{const e=new Set;return n.value.forEach(t=>{t.platforms&&t.platforms.split(/[,;|&]/).map(r=>r.trim()).filter(r=>r.length>0).forEach(r=>e.add(r))}),Array.from(e).sort()}),j=M(()=>{const e=new Set;return n.value.forEach(t=>{t.genre&&t.genre.split(/[,;|&]/).map(r=>r.trim()).filter(r=>r.length>0).forEach(r=>e.add(r))}),Array.from(e).sort()});async function k(){var e,t;A.value=!0,f.value=null;try{const o=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(o&&r)try{const i=await w.getMedia();n.value=i||[]}catch(i){console.warn("API load failed for logged in user:",i),n.value=[]}else{const i=_();if(i.length>0)n.value=i;else{const m=await w.getMedia();n.value=m||[],u()}}}catch(o){f.value=((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.message)||o.message||"Failed to load media data",console.error("Failed to load media:",o)}finally{A.value=!1}}function q(e){h.value=e}function H(e){l.value=e}function W(e){v.value.some(o=>o.type===e.type&&o.value===e.value)||v.value.push(e)}function K(e){v.value=v.value.filter(t=>!(t.type===e.type&&t.value===e.value))}function X(){v.value=[]}async function Y(e,t=!1){var o,r,i;f.value=null;try{const m=localStorage.getItem("authToken"),x=localStorage.getItem("currentUser");if(m&&x)try{const y=await w.addMediaItem(e);if(!t)await k();else{const $={...y,__order:n.value.length};n.value.push($)}return y}catch(y){if(((o=y.response)==null?void 0:o.status)===409&&((i=(r=y.response)==null?void 0:r.data)!=null&&i.duplicate)){const $=new Error(y.response.data.error||"Ein Eintrag mit diesem Titel und dieser Kategorie existiert bereits.");throw $.isDuplicate=!0,$}throw f.value=y.message||"Failed to add media item",console.error("API save failed for logged in user:",y),y}else{const y={id:Date.now(),...e,__order:n.value.length};return n.value.push(y),u(),y}}catch(m){throw m}}async function Z(e,t){f.value=null;try{const o=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(o&&r)try{const i=await w.updateMediaItem(e,t);return await k(),i}catch(i){throw console.error("API update failed for logged in user:",i),i}else{const i=n.value.findIndex(m=>m.id===e);if(i!==-1)return n.value[i]={...n.value[i],...t},u(),n.value[i];throw new Error("Media item not found")}}catch(o){throw o.isDuplicate||(f.value=o.message||"Failed to update media item"),o}}async function ee(e){var t;try{const o=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(o&&r)try{return await w.deleteMediaItem(e),await k(),!0}catch(i){if(((t=i.response)==null?void 0:t.status)===404||i.isNotFound)return await k(),!0;throw console.error("API delete failed for logged in user:",i),i}else{const i=n.value.findIndex(m=>m.id===e);if(i!==-1)return n.value.splice(i,1),u(),!0;throw new Error("Media item not found")}}catch(o){throw f.value=o.message||"Failed to delete media item",o}}async function te(e){try{const t=localStorage.getItem("authToken"),o=localStorage.getItem("currentUser");if(t&&o)try{const r=await w.batchAddMediaItems(e);return await k(),r}catch(r){throw console.error("API batch add failed for logged in user:",r),r}else{const r=e.map((i,m)=>({id:Date.now()+m,...i,__order:n.value.length+m}));return n.value.push(...r),u(),{success:!0,stats:{created:r.length,failed:0,errors:[]}}}}catch(t){throw f.value=t.message||"Failed to add media items",t}}async function ae(e){try{const t=localStorage.getItem("authToken"),o=localStorage.getItem("currentUser");if(t&&o)try{return await w.batchDeleteMediaItems(e),await k(),!0}catch(r){if(r.silent)return console.log("Silent batch delete error (some items may not exist):",r.message),await k(),!0;throw console.error("API batch delete failed for logged in user:",r),r}else return n.value=n.value.filter(r=>!e.includes(r.id)),u(),!0}catch(t){throw t.silent||(f.value=t.message||"Failed to delete media items"),t}}async function se(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");e&&t?await w.saveMedia(n.value):u()}catch(e){console.error("Failed to save media:",e)}}function B(){f.value=null}function oe(e){if(console.log("Processing real-time update:",e),e.type==="media_updated"&&e.items)e.items.forEach(t=>{const o=n.value.findIndex(r=>r.id===t.id);o!==-1?n.value[o]={...n.value[o],...t}:n.value.push(t)});else if(e.action==="created"||e.action==="updated"){const t=e.item,o=n.value.findIndex(r=>r.id===t.id);o!==-1?n.value[o]={...n.value[o],...t}:n.value.push(t)}else if(e.action==="deleted"){const t=n.value.findIndex(o=>o.id===e.id);t!==-1&&n.value.splice(t,1)}u()}function re(){const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");if(!e||!t){console.log("Skipping realtime initialization - user not authenticated");return}try{P.addListener("media-store",oe),P.connect()}catch(o){console.error("Failed to initialize realtime updates:",o)}}function ne(){P.removeListener("media-store")}return{mediaData:n,currentCategory:h,searchQuery:l,activeFilters:v,loading:A,error:f,totalItems:L,categoryCounts:z,filteredMedia:G,platforms:J,genres:j,loadMedia:k,setCategory:q,setSearchQuery:H,addFilter:W,removeFilter:K,clearFilters:X,addMediaItem:Y,updateMediaItem:Z,deleteMediaItem:ee,batchAddMediaItems:te,batchDeleteMediaItems:ae,saveMedia:se,clearError:B,initializeRealtimeUpdates:re,cleanupRealtimeUpdates:ne,resetMediaState:()=>{h.value="game",l.value="",v.value=[],localStorage.removeItem("currentCategory"),localStorage.removeItem("searchQuery"),localStorage.removeItem("activeFilters")}}}),Ke=V("sidebar",()=>{const d=()=>{try{const u=localStorage.getItem("sidebarState");if(u)return{collapsed:JSON.parse(u).collapsed||!1,mobileOpen:!1}}catch(u){console.error("Failed to load sidebar state from localStorage:",u)}return{collapsed:!1,mobileOpen:!1}},a=u=>{try{localStorage.setItem("sidebarState",JSON.stringify({collapsed:u.collapsed}))}catch(L){console.error("Failed to save sidebar state to localStorage:",L)}},c=d(),p=C(c.collapsed),g=C(c.mobileOpen);E(p,u=>{a({collapsed:u,mobileOpen:g.value})},{immediate:!1});const b=()=>{p.value=!p.value},n=()=>{g.value=!g.value},h=()=>{g.value=!1},l=u=>{p.value=u},v=u=>{g.value=u},A=()=>{p.value=!1,g.value=!1,localStorage.removeItem("sidebarState")},f=M(()=>p.value),_=M(()=>g.value);return{collapsed:p,mobileOpen:g,toggleSidebar:b,toggleMobileSidebar:n,closeMobileSidebar:h,setCollapsed:l,setMobileOpen:v,resetSidebarState:A,isCollapsed:f,isMobileOpen:_}}),de={name:"VersionInfo",data(){return{version:"1.0.0"}}},ge={class:"version-info"},ve={class:"version-label"};function me(d,a,c,p,g,b){return I(),S("div",ge,[s("span",ve,"Build #"+F(g.version),1)])}const fe=Q(de,[["render",me],["__scopeId","data-v-2d54e3c7"]]),pe={name:"Sidebar",components:{VersionInfo:fe},props:{collapsed:{type:Boolean,default:!1},mobileOpen:{type:Boolean,default:!1},isLoggedIn:{type:Boolean,default:!1},userName:{type:String,default:""},currentCategory:{type:String,default:"watchlist"},categoryCounts:{type:Object,default:()=>({})},platforms:{type:Array,default:()=>[]},genres:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[{key:"game",name:"Games",icon:"🎮"},{key:"series",name:"Series",icon:"📺"},{key:"movie",name:"Movies",icon:"🎬"},{key:"buecher",name:"Bücher",icon:"📚"},{key:"watchlist",name:"Watchlist",icon:"❤️"}]}},emits:["toggle","setCategory","addItem","navigateToCalendar","navigateToProfile","togglePlatformFilter","toggleGenreFilter","toggleAiringFilter","clearFilters","showLogin","showRegister","logout"],methods:{}},he={class:"sidebar-content"},ye={class:"sidebar-section"},Se={class:"sidebar-nav"},Ie=["onClick"],be={class:"nav-icon"},ke={class:"nav-text"},we={class:"nav-count"},Ce=["onClick","title"],Fe={key:0,class:"sidebar-section"},Me={class:"filters-header"},Ae={class:"filter-section"},_e={class:"filter-group"},Le={class:"filter-checkboxes"},xe=["value","onChange"],$e={class:"option-text"},Ee={class:"filter-group"},Ue={class:"filter-checkboxes"},Te=["value","onChange"],Oe={class:"option-text"},Ne={class:"filter-group"},Pe={class:"filter-checkboxes"},Be={class:"filter-option"},De={class:"filter-option"},Re={class:"sidebar-section"},Ve={key:0,class:"auth-buttons"},Qe={key:1,class:"user-info"},ze={class:"user-profile"},Ge={class:"profile-details"},Je={class:"user-name"};function je(d,a,c,p,g,b){const n=R("router-link"),h=R("VersionInfo");return I(),S("aside",{id:"sidebar",class:N(["sidebar",{collapsed:c.collapsed,open:c.mobileOpen}])},[s("div",{class:"sidebar-header",onClick:a[0]||(a[0]=l=>d.$emit("toggle"))},[...a[9]||(a[9]=[s("h2",null,"Media Library",-1),s("button",{class:"sidebar-toggle"},"☰",-1)])]),s("div",he,[s("div",ye,[a[14]||(a[14]=s("h3",null,"Browse",-1)),s("nav",Se,[(I(!0),S(T,null,O(c.categories,l=>(I(),S("div",{key:l.key,class:"nav-item"},[s("button",{class:N(["nav-btn",{active:c.currentCategory===l.key}]),onClick:v=>d.$emit("setCategory",l.key)},[s("span",be,F(l.icon),1),s("span",ke,F(l.name),1),s("span",we,F(c.categoryCounts[l.key]||0),1)],10,Ie),s("button",{class:"add-btn",onClick:v=>d.$emit("addItem",l.key),title:`Add ${l.name}`},[...a[10]||(a[10]=[s("span",{class:"add-icon"},"+",-1)])],8,Ce)]))),128)),s("button",{class:N(["nav-btn",{active:c.currentCategory==="statistics"}]),onClick:a[1]||(a[1]=l=>d.$emit("setCategory","statistics"))},[...a[11]||(a[11]=[s("span",{class:"nav-icon"},"📊",-1),s("span",{class:"nav-text"},"Statistics",-1)])],2),U(n,{to:"/calendar",class:"nav-btn"},{default:D(()=>[...a[12]||(a[12]=[s("span",{class:"nav-icon"},"📅",-1),s("span",{class:"nav-text"},"Calendar",-1)])]),_:1}),U(n,{to:"/profile",class:"nav-btn"},{default:D(()=>[...a[13]||(a[13]=[s("span",{class:"nav-icon"},"👤",-1),s("span",{class:"nav-text"},"Profile",-1)])]),_:1})])]),c.isLoggedIn?(I(),S("div",Fe,[s("div",Me,[a[16]||(a[16]=s("h3",null,"Filters",-1)),s("button",{class:"refresh-btn",onClick:a[2]||(a[2]=l=>d.$emit("clearFilters")),title:"Clear all filters"},[...a[15]||(a[15]=[s("span",{class:"refresh-icon"},"🔄",-1),s("span",{class:"refresh-text"},"Refresh",-1)])])]),s("div",Ae,[s("div",_e,[a[18]||(a[18]=s("h4",null,"Platforms",-1)),s("div",Le,[(I(!0),S(T,null,O(c.platforms,l=>(I(),S("label",{key:l,class:"filter-option"},[s("input",{type:"checkbox",value:l,onChange:v=>d.$emit("togglePlatformFilter",l,v.target.checked)},null,40,xe),a[17]||(a[17]=s("span",{class:"checkmark"},null,-1)),s("span",$e,F(l),1)]))),128))])]),s("div",Ee,[a[20]||(a[20]=s("h4",null,"Genres",-1)),s("div",Ue,[(I(!0),S(T,null,O(c.genres,l=>(I(),S("label",{key:l,class:"filter-option"},[s("input",{type:"checkbox",value:l,onChange:v=>d.$emit("toggleGenreFilter",l,v.target.checked)},null,40,Te),a[19]||(a[19]=s("span",{class:"checkmark"},null,-1)),s("span",Oe,F(l),1)]))),128))])]),s("div",Ne,[a[25]||(a[25]=s("h4",null,"Series Status",-1)),s("div",Pe,[s("label",Be,[s("input",{type:"checkbox",value:"airing",onChange:a[3]||(a[3]=l=>d.$emit("toggleAiringFilter","airing",l.target.checked))},null,32),a[21]||(a[21]=s("span",{class:"checkmark"},null,-1)),a[22]||(a[22]=s("span",{class:"option-text"},[s("span",{class:"airing-indicator"},"●"),ce(" Airing ")],-1))]),s("label",De,[s("input",{type:"checkbox",value:"finished",onChange:a[4]||(a[4]=l=>d.$emit("toggleAiringFilter","finished",l.target.checked))},null,32),a[23]||(a[23]=s("span",{class:"checkmark"},null,-1)),a[24]||(a[24]=s("span",{class:"option-text"},"Finished",-1))])])])])])):ie("",!0),s("div",Re,[a[27]||(a[27]=s("h3",null,"Account",-1)),c.isLoggedIn?(I(),S("div",Qe,[s("div",ze,[a[26]||(a[26]=s("div",{class:"profile-avatar"},[s("span",{class:"avatar-text"},"👤")],-1)),s("div",Ge,[s("span",Je,F(c.userName),1)]),s("button",{class:"account-btn",onClick:a[7]||(a[7]=l=>d.$emit("navigateToProfile"))},"⚙️")]),s("button",{class:"auth-btn",onClick:a[8]||(a[8]=l=>d.$emit("logout"))},"Logout")])):(I(),S("div",Ve,[s("button",{class:"auth-btn",onClick:a[5]||(a[5]=l=>d.$emit("showLogin"))},"Login"),s("button",{class:"auth-btn",onClick:a[6]||(a[6]=l=>d.$emit("showRegister"))},"Register")]))])]),U(h)],2)}const Xe=Q(pe,[["render",je],["__scopeId","data-v-39b2a04a"]]);export{Xe as S,Ke as a,We as u};
