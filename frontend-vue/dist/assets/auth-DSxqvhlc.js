import{d as T,r as i,c as g}from"./index-DabYcaMb.js";import{a as v}from"./media-BdfAZ5Jo.js";const N=T("auth",()=>{const a=i(localStorage.getItem("authToken")||null),r=i(null),u=i(!1),l=i(null),h=g(()=>!!a.value&&!!r.value),y=g(()=>{var e;return((e=r.value)==null?void 0:e.name)||""}),k=g(()=>{var e;return((e=r.value)==null?void 0:e.email)||""});async function p(e,o){var n,c;u.value=!0,l.value=null;try{const t=await v.login(e,o);return a.value=t.token,r.value=t.user,localStorage.setItem("authToken",a.value),localStorage.setItem("currentUser",JSON.stringify(r.value)),{success:!0,user:t.user,token:t.token,duplicate_check:t.duplicate_check}}catch(t){return l.value=((c=(n=t.response)==null?void 0:n.data)==null?void 0:c.message)||t.message||"Login failed",{success:!1,error:l.value}}finally{u.value=!1}}async function S(e,o,n,c){var t,d;u.value=!0,l.value=null;try{const s=await v.register(e,o,n,c);return a.value=s.token,r.value=s.user,localStorage.setItem("authToken",a.value),localStorage.setItem("currentUser",JSON.stringify(r.value)),{success:!0}}catch(s){return l.value=((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.message)||s.message||"Registration failed",{success:!1,error:l.value}}finally{u.value=!1}}async function f(){try{a.value&&await v.logout(a.value)}catch(e){console.error("Logout API call failed:",e)}finally{a.value=null,r.value=null,localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),localStorage.removeItem("mediaData")}}async function m(){if(!a.value)return!1;try{const e=await v.validateToken(a.value);return r.value=e,!0}catch(e){return console.error("Token validation failed:",e),await f(),!1}}async function I(){const e=localStorage.getItem("currentUser");if(e)try{r.value=JSON.parse(e)}catch(o){console.error("Failed to parse saved user data:",o),await f();return}a.value&&await m()}function w(){l.value=null}return{token:a,user:r,loading:u,error:l,isLoggedIn:h,userName:y,userEmail:k,login:p,register:S,logout:f,validateToken:m,initializeAuth:I,clearError:w}});export{N as u};
