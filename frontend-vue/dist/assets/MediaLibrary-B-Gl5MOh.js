import{d as qe,r as I,u as Je,c as R,_ as j,a as d,b as o,e as p,t as g,n as $,f as re,o as n,g as Ye,w as ce,h as J,i as A,v as be,j as E,F as ue,k as me,l as Ze,m as je,p as $e,q as et,s as tt,x as X,y as ie,z as N,A as ot,B as at}from"./index-DabYcaMb.js";import{u as st}from"./auth-DSxqvhlc.js";import{u as He,m as de}from"./media-BdfAZ5Jo.js";import{u as Qe}from"./message-Bjjat4of.js";import{R as lt,L as nt,M as it,S as rt}from"./RegisterModal-Dg18U0pA.js";const Ke=qe("confirm",()=>{const l=I(!1),t=I("Confirm Action"),s=I(""),e=I(null);function u(c){return new Promise(i=>{t.value=c.title||"Confirm Action",s.value=c.message||"",l.value=!0,e.value=i})}function y(){e.value&&(e.value(!0),e.value=null),l.value=!1}function a(){e.value&&(e.value(!1),e.value=null),l.value=!1}return{show:l,title:t,message:s,showConfirm:u,confirm:y,cancel:a}}),Xe=qe("input",()=>{const l=I(!1),t=I("Input Required"),s=I(""),e=I(""),u=I("text"),y=I(""),a=I(null);function c(D){return new Promise(F=>{t.value=D.title||"Input Required",s.value=D.message||"",e.value=D.placeholder||"",u.value=D.inputType||"text",y.value=D.defaultValue||"",l.value=!0,a.value=F})}function i(D){a.value&&(a.value(D),a.value=null),l.value=!1}function z(){a.value&&(a.value(null),a.value=null),l.value=!1}return{show:l,title:t,message:s,placeholder:e,inputType:u,defaultValue:y,showInput:c,confirm:i,cancel:z}});function dt(){const l=Je(),t=st(),s=He(),e=Qe(),u=Ke(),y=Xe(),a=I(!1),c=I(!1),i=I(!1),z=I(!1),D=I(!1),F=I(!1),W=I(!1),O=I(!1),b=I(!1),w=I(null),k=()=>typeof window<"u"?window.innerWidth>768?8:3:8,h=I(k()),P=I("order_asc"),x=I(null),C=()=>{h.value=k()};typeof window<"u"&&window.addEventListener("resize",C);const ee=[{key:"game",name:"Games",icon:"🎮"},{key:"series",name:"Series",icon:"📺"},{key:"movie",name:"Movies",icon:"🎬"},{key:"watchlist",name:"Watchlist",icon:"❤️"}],Q=R(()=>{try{return t.isLoggedIn}catch(r){return console.error("Error accessing authStore.isLoggedIn:",r),!1}}),ge=R(()=>{try{return t.userName}catch(r){return console.error("Error accessing authStore.userName:",r),""}}),H=R(()=>{try{return s.currentCategory}catch(r){return console.error("Error accessing mediaStore.currentCategory:",r),"game"}}),fe=R({get:()=>{try{return s.searchQuery}catch(r){return console.error("Error accessing mediaStore.searchQuery:",r),""}},set:r=>{try{s.setSearchQuery(r)}catch(v){console.error("Error setting mediaStore.searchQuery:",v)}}}),te=R(()=>{try{return s.categoryCounts}catch(r){return console.error("Error accessing mediaStore.categoryCounts:",r),{}}}),f=R(()=>{try{return s.loading}catch(r){return console.error("Error accessing mediaStore.loading:",r),!1}}),m=R(()=>{try{return s.error}catch(r){return console.error("Error accessing mediaStore.error:",r),null}}),_=R(()=>{try{const r=[...s.filteredMedia||[]],[v,U]=P.value.split("_");return r.sort((S,T)=>{let B=S[v],M=T[v];return v==="order"?(B=S.__order||0,M=T.__order||0):v==="airing"&&(B=S.isAiring?1:0,M=T.isAiring?1:0),typeof B=="string"&&(B=B.toLowerCase(),M=M.toLowerCase()),U==="asc"?B>M?1:-1:B<M?1:-1})}catch(r){return console.error("Error in sortedMedia computed:",r),[]}}),L=R(()=>_.value),q=R(()=>{try{if(!s||!s.mediaData)return[];const r=new Set;return s.mediaData.forEach(v=>{v.platforms&&v.platforms.split(",").forEach(U=>r.add(U.trim()))}),Array.from(r).sort()}catch(r){return console.error("Error in platforms computed:",r),[]}}),V=R(()=>{try{if(!s||!s.mediaData)return[];const r=new Set;return s.mediaData.forEach(v=>{v.genre&&v.genre.split(",").forEach(U=>r.add(U.trim()))}),Array.from(r).sort()}catch(r){return console.error("Error in genres computed:",r),[]}}),G=()=>{a.value=!a.value},ve=()=>{c.value=!c.value},Z=()=>{c.value=!1},Se=r=>{s.setCategory(r),c.value=!1},ke=()=>{s.setSearchQuery("")},Ce=(r,v)=>{v?s.addFilter({type:"platform",value:r}):s.removeFilter({type:"platform",value:r})},Te=(r,v)=>{v?s.addFilter({type:"genre",value:r}):s.removeFilter({type:"genre",value:r})},_e=(r,v)=>{v?s.addFilter({type:"airing",value:r}):s.removeFilter({type:"airing",value:r})},xe=r=>{w.value=r,D.value=!0},ye=()=>{D.value=!1,w.value=null},Y=()=>{W.value=!1},Me=async r=>{try{const v=await s.batchAddMediaItems(r);if(v.success){const{created:U,failed:S}=v.stats;let T=`Successfully added ${U} items`;S>0&&(T+=` (${S} failed)`),e.showSuccess(T,"Bulk Add Successful")}Y()}catch(v){console.error("Bulk add failed:",v),e.showError("Failed to add items: "+(v.message||"Unknown error"),"Bulk Add Failed")}},pe=async r=>{w.value?await s.updateMediaItem(w.value.id,r):await s.addMediaItem(r),ye()},Ae=async r=>{await s.deleteMediaItem(r.id)},De=async()=>{await t.logout(),await oe()},oe=async()=>{try{await s.loadMedia()}catch(r){console.error("Error loading media:",r)}},Ue=()=>{F.value=!F.value},Re=()=>{if(F.value=!1,!Q.value){e.showWarning("Bitte loggen Sie sich ein, um neue Items hinzuzufügen.","Login erforderlich");return}w.value=null,D.value=!0},Fe=()=>{if(F.value=!1,!Q.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}W.value=!0},Pe=()=>{if(F.value=!1,!Q.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}O.value=!0},Ee=()=>{if(F.value=!1,!Q.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}e.showInfo("API Import feature coming soon!","Feature in Entwicklung")},Le=()=>{if(F.value=!1,!Q.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}he()},ae=r=>{const v=ee.find(U=>U.key===r);return v?v.name:r},Be=async()=>{const r=ae(H.value),v=te.value[H.value]||0;if(v===0){e.showInfo("No items to delete in this category.","Nothing to Delete");return}const U=`Are you sure you want to delete ALL ${v} items in "${r}"?

This action cannot be undone!`;if(await u.showConfirm({title:"Delete All Items",message:U}))try{const B=((s==null?void 0:s.mediaData)||[]).filter(M=>H.value==="watchlist"?M.category==="watchlist"||M.isNew===!0:M.category===H.value).map(M=>M.id);await s.batchDeleteMediaItems(B),await oe(),e.showSuccess(`Successfully deleted ${v} items from "${r}"`,"Items Deleted")}catch(T){console.error("Error deleting items:",T),e.showError("Error occurred while deleting items. Please try again.","Delete Failed")}},Ne=r=>{const v=r.split(`
`).map(M=>M.trim()).filter(M=>M.length>0);if(v.length===0){e.showWarning("Die TXT-Datei ist leer oder enthält keine gültigen Einträge.","Leere Datei");return}const S=s.filteredMedia.map(M=>M.title.toLowerCase().trim()),T=v.filter(M=>{const le=M.toLowerCase().trim();return!S.some(ne=>ne.includes(le)||le.includes(ne))}),B=v.filter(M=>{const le=M.toLowerCase().trim();return S.some(ne=>ne.includes(le)||le.includes(ne))});x.value={totalInFile:v.length,missingItems:T,existingItems:B,currentCategory:H.value,categoryName:ae(H.value)},O.value=!1,b.value=!0},Ve=()=>{x.value=null,b.value=!1},he=async()=>{const r=(s==null?void 0:s.mediaData)||[];if(r.length===0){e.showInfo("Keine Media Items zum Exportieren gefunden.","Nichts zu exportieren");return}const v=await y.showInput({title:"Export Format wählen",message:`1 = CSV
2 = JSON
3 = Beide

Geben Sie die Nummer ein:`,placeholder:"1",defaultValue:"1"});if(!v||!["1","2","3"].includes(v))return;const U=new Date().toISOString().split("T")[0];(v==="1"||v==="3")&&we(r,U),(v==="2"||v==="3")&&Ie(r,U),e.showSuccess(`Collection mit ${r.length} Items wurde erfolgreich exportiert!`,"Export erfolgreich")},we=(r,v)=>{const S=[["Titel","Kategorie","Release","Rating","Platforms","Genre","Spielzeit","Status","Beschreibung"].join(","),...r.map(T=>[`"${(T.title||"").replace(/"/g,'""')}"`,`"${(T.category||T.category_name||"Unbekannt").replace(/"/g,'""')}"`,`"${T.release||""}"`,`"${T.rating||""}"`,`"${(T.platforms||"").replace(/"/g,'""')}"`,`"${(T.genre||"").replace(/"/g,'""')}"`,`"${T.spielzeit||""}"`,`"${T.isAiring?"Airing":"Abgeschlossen"}"`,`"${(T.description||"").replace(/"/g,'""')}"`].join(","))].join(`
`);se(S,`media_collection_${v}.csv`,"text/csv;charset=utf-8;")},Ie=(r,v)=>{const U={exportDate:new Date().toISOString(),totalItems:r.length,categories:[...new Set(r.map(S=>S.category||S.category_name||"Unbekannt"))],items:r.map(S=>({id:S.id,title:S.title||"",category:S.category||S.category_name||"Unbekannt",release:S.release||"",rating:S.rating||null,platforms:S.platforms||"",genre:S.genre||"",spielzeit:S.spielzeit||null,status:S.isAiring?"Airing":"Abgeschlossen",description:S.description||"",isNew:S.isNew||!1,nextSeason:S.nextSeason||null,discovered:S.discovered||null}))};se(JSON.stringify(U,null,2),`media_collection_${v}.json`,"application/json;charset=utf-8;")},se=(r,v,U)=>{const S=new Blob([r],{type:U}),T=document.createElement("a"),B=URL.createObjectURL(S);T.setAttribute("href",B),T.setAttribute("download",v),T.style.visibility="hidden",document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(B)};return{sidebarCollapsed:a,mobileSidebarOpen:c,showLoginModal:i,showRegisterModal:z,showEditModal:D,showFloatingMenu:F,showBulkAddModal:W,showTxtImportModal:O,showTxtImportResults:b,editingItem:w,gridColumns:h,sortBy:P,categories:ee,txtImportResults:x,isLoggedIn:Q,userName:ge,currentCategory:H,searchQuery:fe,categoryCounts:te,loading:f,error:m,paginatedMedia:L,platforms:q,genres:V,toggleSidebar:G,toggleMobileSidebar:ve,closeMobileSidebar:Z,setCategory:Se,clearSearch:ke,togglePlatformFilter:Ce,toggleGenreFilter:Te,toggleAiringFilter:_e,editItem:xe,closeEditModal:ye,closeBulkAddModal:Y,handleBulkAddItems:Me,handleSaveItem:pe,handleDeleteItem:Ae,logout:De,loadMedia:oe,toggleFloatingMenu:Ue,addNewItem:Re,bulkAddItems:Fe,importFromTxt:Pe,importFromAPI:Ee,createCollection:Le,exportMediaCollection:he,exportAsCSV:we,exportAsJSON:Ie,downloadFile:se,deleteAllInCategory:Be,getCategoryDisplayName:ae,navigateToStatistics:()=>{l.push("/statistics")},navigateToCalendar:()=>{l.push("/calendar")},navigateToFeatures:()=>{l.push("/features")},navigateToProfile:()=>{l.push("/profile")},processTxtContent:Ne,closeTxtImportResults:Ve,cleanup:()=>{typeof window<"u"&&window.removeEventListener("resize",C)}}}const ct={name:"MediaItem",props:{item:{type:Object,required:!0}},emits:["edit"],computed:{showWatchlistTag(){return this.item.category==="watchlist"||this.item.isNew===!0},isWatchlistItem(){return this.item.category==="watchlist"||this.item.isNew===!0}},methods:{getImageUrl(l){return l?l.startsWith("http")||l.startsWith("/")?l:`/storage/${l}`:""},handleImageError(l){var t;l.target.style.display="none",(t=l.target.nextElementSibling)==null||t.classList.add("show")},formatDate(l){return l?new Date(l).toLocaleDateString():""},editItem(){this.$emit("edit",this.item)},getWatchlistReleaseStatus(){if(!this.item.release)return"";const l=new Date(this.item.release),t=new Date;t.setHours(0,0,0,0),l.setHours(0,0,0,0);const s=l.getTime()-t.getTime(),e=Math.ceil(s/(1e3*3600*24));if(e>0)return e===1?"Tomorrow!":e<=7?`${e} days left`:e<=30?`${e} days left`:`${Math.ceil(e/30)} months left`;if(e===0)return"Released today!";{const u=this.getTypeTagText().toLowerCase();return u==="game"?"Unplayed yet":u==="series"||u==="movie"?"Unwatched yet":"Unconsumed yet"}},getWatchlistReleaseStatusClass(){if(!this.item.release)return"";const l=new Date(this.item.release),t=new Date;t.setHours(0,0,0,0),l.setHours(0,0,0,0);const s=l.getTime()-t.getTime(),e=Math.ceil(s/(1e3*3600*24));return e>0?"countdown":e===0?"released-today":"unconsumed"},getTypeTagText(){var t,s,e;const l=this.item.watchlistType||this.item.watchlist_type;if(l)return l.charAt(0).toUpperCase()+l.slice(1);if(this.item.genre){const u=this.item.genre.toLowerCase();if(u.includes("game")||u.includes("gaming")||(t=this.item.platforms)!=null&&t.toLowerCase().includes("steam")||(s=this.item.platforms)!=null&&s.toLowerCase().includes("ps")||(e=this.item.platforms)!=null&&e.toLowerCase().includes("xbox"))return"Game";if(u.includes("series")||u.includes("tv")||u.includes("episode")||this.item.isAiring)return"Series";if(u.includes("movie")||u.includes("film")||u.includes("cinema"))return"Movie"}if(this.item.platforms){const u=this.item.platforms.toLowerCase();if(u.includes("steam")||u.includes("ps")||u.includes("xbox")||u.includes("nintendo")||u.includes("pc"))return"Game";if(u.includes("netflix")||u.includes("hulu")||u.includes("disney")||u.includes("hbo"))return"Series";if(u.includes("cinema")||u.includes("theater"))return"Movie"}return"Media"},getTypeTagClass(){return`type-${this.getTypeTagText().toLowerCase()}`},getNextSeasonCountdown(){if(!this.item.nextSeasonRelease)return"";const l=new Date(this.item.nextSeasonRelease),t=new Date;t.setHours(0,0,0,0),l.setHours(0,0,0,0);const s=l.getTime()-t.getTime(),e=Math.ceil(s/(1e3*3600*24));return e>0?e===1?"Tomorrow!":e<=7?`${e} days`:e<=30?`${e} days`:`${Math.ceil(e/30)} months`:e===0?"Today!":"Released"}}},ut={class:"media-image"},mt=["src","alt"],gt={key:1,class:"no-image"},ft={class:"media-info"},vt={class:"media-title"},yt={class:"media-meta"},pt={key:0,class:"media-release"},ht={key:1},wt={key:1,class:"media-rating"},It={key:0,class:"media-platforms"},bt={key:1,class:"media-genre"},St={key:2,class:"media-airing"},kt={key:0,class:"next-season"},Ct={key:1,class:"countdown"},Tt={key:3,class:"watchlist-type-tag"};function _t(l,t,s,e,u,y){return n(),d("div",{class:"media-item",onClick:t[1]||(t[1]=(...a)=>y.editItem&&y.editItem(...a))},[o("div",ut,[s.item.path?(n(),d("img",{key:0,src:y.getImageUrl(s.item.path),alt:s.item.title,onError:t[0]||(t[0]=(...a)=>y.handleImageError&&y.handleImageError(...a))},null,40,mt)):(n(),d("div",gt,[...t[2]||(t[2]=[o("span",{class:"no-image-icon"},"📁",-1)])]))]),o("div",ft,[o("h3",vt,g(s.item.title),1),o("div",yt,[s.item.release?(n(),d("span",pt,[y.isWatchlistItem&&s.item.release?(n(),d("span",{key:0,class:$(y.getWatchlistReleaseStatusClass())},g(y.getWatchlistReleaseStatus()),3)):(n(),d("span",ht,g(y.formatDate(s.item.release)),1))])):p("",!0),s.item.rating?(n(),d("span",wt,g("★".repeat(Math.max(0,Math.min(5,Math.floor(s.item.rating)))))+g("☆".repeat(Math.max(0,5-Math.max(0,Math.min(5,Math.floor(s.item.rating)))))),1)):p("",!0)]),s.item.platforms?(n(),d("div",It,g(s.item.platforms),1)):p("",!0),s.item.genre?(n(),d("div",bt,g(s.item.genre),1)):p("",!0),s.item.isAiring?(n(),d("div",St,[t[3]||(t[3]=o("span",{class:"airing-badge"},[o("span",{class:"airing-dot"}),re(" Airing ")],-1)),s.item.nextSeason?(n(),d("span",kt,"S"+g(s.item.nextSeason),1)):p("",!0),s.item.nextSeasonRelease?(n(),d("span",Ct,g(y.getNextSeasonCountdown()),1)):p("",!0)])):p("",!0),y.showWatchlistTag?(n(),d("div",Tt,[o("span",{class:$(["type-tag",y.getTypeTagClass()])},g(y.getTypeTagText()),3)])):p("",!0)]),t[4]||(t[4]=o("div",{class:"edit-indicator"},[o("span",{class:"edit-icon"},"✏️")],-1))])}const xt=j(ct,[["render",_t],["__scopeId","data-v-0b1df989"]]),Mt={name:"FloatingActionButton",props:{showMenu:{type:Boolean,default:!1},showDeleteAll:{type:Boolean,default:!1},categoryName:{type:String,default:""},itemCount:{type:Number,default:0}},emits:["toggleMenu","addNewItem","bulkAddItems","importFromTxt","importFromAPI","createCollection","deleteAllInCategory"]},At={class:"floating-actions"},Dt={class:"menu-text"},Ut={class:"item-count-badge"};function Rt(l,t,s,e,u,y){return n(),d("div",At,[o("div",{class:$(["floating-menu",{show:s.showMenu}])},[o("button",{class:"floating-menu-item",onClick:t[0]||(t[0]=a=>l.$emit("addNewItem"))},[...t[7]||(t[7]=[o("span",{class:"menu-icon"},"➕",-1),o("span",{class:"menu-text"},"Add Item",-1)])]),o("button",{class:"floating-menu-item",onClick:t[1]||(t[1]=a=>l.$emit("bulkAddItems"))},[...t[8]||(t[8]=[o("span",{class:"menu-icon"},"📦",-1),o("span",{class:"menu-text"},"Bulk Add",-1)])]),o("button",{class:"floating-menu-item",onClick:t[2]||(t[2]=a=>l.$emit("importFromTxt"))},[...t[9]||(t[9]=[o("span",{class:"menu-icon"},"📄",-1),o("span",{class:"menu-text"},"Import from TXT",-1)])]),o("button",{class:"floating-menu-item",onClick:t[3]||(t[3]=a=>l.$emit("importFromAPI"))},[...t[10]||(t[10]=[o("span",{class:"menu-icon"},"🌐",-1),o("span",{class:"menu-text"},"Import from API",-1)])]),o("button",{class:"floating-menu-item",onClick:t[4]||(t[4]=a=>l.$emit("createCollection"))},[...t[11]||(t[11]=[o("span",{class:"menu-icon"},"📚",-1),o("span",{class:"menu-text"},"Create Collection",-1)])]),s.showDeleteAll&&s.itemCount>0?(n(),d("button",{key:0,class:"floating-menu-item delete-all-item",onClick:t[5]||(t[5]=a=>l.$emit("deleteAllInCategory"))},[t[12]||(t[12]=o("span",{class:"menu-icon"},"🗑️",-1)),o("span",Dt,"Delete All "+g(s.categoryName),1),o("span",Ut,"("+g(s.itemCount)+")",1)])):p("",!0)],2),o("button",{class:"floating-add-btn",onClick:t[6]||(t[6]=a=>l.$emit("toggleMenu"))},g(s.showMenu?"✕":"+"),1)])}const Ft=j(Mt,[["render",Rt],["__scopeId","data-v-19731834"]]),Pt={name:"EditModal",props:{item:{type:Object,default:null},currentCategory:{type:String,default:"watchlist"}},emits:["close","save","delete"],setup(l,{emit:t}){const s=I(!1),e=I(""),u=I([]),y=I(null),a=I(null),c=I(""),i=Ye({category:"watchlist",title:"",release:"",rating:"",count:"",platforms:"",genre:"",link:"",path:"",discovered:"",spielzeit:"",isAiring:!1,nextSeason:"",nextSeasonRelease:"",imageUrl:"",watchlistType:""}),z=R(()=>!!l.item),D=R(()=>i.category==="game"),F=R(()=>i.category==="series"),W=R(()=>i.category==="watchlist");ce(()=>l.item,f=>{f?Object.keys(i).forEach(m=>{i[m]=f[m]||""}):Object.keys(i).forEach(m=>{m==="category"?i[m]=l.currentCategory||"watchlist":m==="release"?i[m]=new Date().toISOString().split("T")[0]:i[m]=""})},{immediate:!0}),ce(()=>l.currentCategory,f=>{!l.item&&f&&(i.category=f)});const O=async()=>{if(!i.title){e.value="Title is required";return}if(i.category==="watchlist"&&!i.watchlistType){e.value="Please select a type for watchlist items";return}if(i.category==="watchlist"&&!i.release){e.value="Release date is required for watchlist items";return}s.value=!0,e.value="";try{const f=await k(i.title,i.category);if(f&&f.isDuplicate){e.value=`Ein Eintrag mit dem Titel "${i.title}" und der Kategorie "${i.category}" existiert bereits.`,s.value=!1;return}const m={...i};c.value?(m.path=c.value,m.imageUrl=c.value):m.imageUrl&&m.imageUrl.trim()?m.path=m.imageUrl:(m.imageUrl=null,m.path=null),Object.keys(m).forEach(_=>{m[_]===""&&_!=="watchlistType"&&(m[_]=null)}),m.rating&&(m.rating=parseFloat(m.rating)),m.count&&(m.count=parseInt(m.count)),m.spielzeit&&(m.spielzeit=parseInt(m.spielzeit)),m.nextSeason&&(m.nextSeason=parseInt(m.nextSeason)),t("save",m)}catch(f){e.value=f.message||"Failed to save item"}finally{s.value=!1}},b=()=>{e.value="",t("close")},w=()=>{t("delete",l.item),b()},k=async(f,m)=>{try{const _=localStorage.getItem("authToken"),L=localStorage.getItem("currentUser");if(!_||!L)return{isDuplicate:!1};const q=l.item?l.item.id:null,V=await de.checkCategoryDuplicates(m);if(V.success&&V.duplicates){const G=V.duplicates.flat();return{isDuplicate:G.some(Z=>Z.title===f&&Z.id!==q),duplicates:G}}return{isDuplicate:!1}}catch(_){return console.error("Duplicate check failed:",_),{isDuplicate:!1}}};return{form:i,loading:s,error:e,apiResults:u,isEditing:z,isGame:D,isSeries:F,isWatchlist:W,imageUploadRef:a,uploadedImagePath:c,handleSave:O,closeModal:b,deleteItem:w,searchApi:async()=>{if(c.value){u.value=[];return}if(y.value&&clearTimeout(y.value),!i.title||i.title.length<3){u.value=[];return}y.value=setTimeout(async()=>{try{const f=i.category==="watchlist"?i.watchlistType:i.category;if(i.category==="watchlist"&&!i.watchlistType){u.value=[];return}const m=await de.searchApi(i.title,f,10);m&&m.length>0?u.value=m.map(_=>({title:_.title,release:_.release,genre:_.overview||"",platforms:_.platforms||"",link:_.link||"",imageUrl:_.image||"",rating:_.rating||"",apiSource:_.api_source||"",id:_.id||""})):u.value=[{title:`"${i.title}" - Keine Ergebnisse gefunden`,release:"",genre:"Bitte manuell ausfüllen",isPlaceholder:!0}]}catch(f){console.error("API search failed:",f),u.value=[{title:`"${i.title}" - API nicht verfügbar`,release:"",genre:"Bitte manuell ausfüllen",isPlaceholder:!0}]}},500)},selectApiResult:async f=>{if(f.isPlaceholder){u.value=[];return}i.title=f.title,f.release&&(i.release=f.release),f.platforms&&(i.platforms=f.platforms),f.genre&&(i.genre=f.genre),f.link&&(i.link=f.link),f.rating&&(i.rating=f.rating),f.imageUrl?(i.imageUrl=f.imageUrl,i.path=f.imageUrl):(i.imageUrl="",i.path=""),u.value=[]},formatDate:f=>f?new Date(f).toLocaleDateString():"",getReleasePreview:()=>{var q;if(!i.release)return"";const f=new Date(i.release),m=new Date;m.setHours(0,0,0,0),f.setHours(0,0,0,0);const _=f.getTime()-m.getTime(),L=Math.ceil(_/(1e3*3600*24));if(L>0)return L===1?"Tomorrow!":L<=7?`${L} days left`:L<=30?`${L} days left`:`${Math.ceil(L/30)} months left`;if(L===0)return"Released today!";{const V=((q=i.watchlistType)==null?void 0:q.toLowerCase())||"media";return V==="game"?"Unplayed yet":V==="series"||V==="movie"?"Unwatched yet":"Unconsumed yet"}},triggerImageUpload:()=>{var f;(f=a.value)==null||f.click()},handleImageUpload:async f=>{const m=f.target.files[0];if(m){if(!m.type.startsWith("image/")){e.value="Please select a valid image file";return}if(m.size>10*1024*1024){e.value="Image file too large. Maximum size is 10MB";return}s.value=!0,e.value="";try{const _=i.title.replace(/[^a-zA-Z0-9\s\-_\.]/g,"").trim()||"item",L=Date.now(),q=m.name.split(".").pop()||"jpg",V=`images_downloads/uploads/${_}_${L}.${q}`,G=await de.uploadImage(m,V);G.success?(c.value=G.saved,i.path=G.saved,i.imageUrl=G.saved):e.value=G.error||"Failed to upload image"}catch(_){e.value=_.message||"Failed to upload image"}finally{s.value=!1}}},getImagePreviewUrl:()=>c.value?`/storage/${c.value}`:i.imageUrl?i.imageUrl.startsWith("http")?i.imageUrl:`/storage/${i.imageUrl}`:"",handleImageError:f=>{console.warn("Image preview failed:",f.target.src),f.target.style.display="none"},clearImage:()=>{i.imageUrl="",i.path="",c.value="",a.value&&(a.value.value="")},removeUploadedImage:()=>{c.value="",i.imageUrl===c.value&&(i.imageUrl=""),i.path===c.value&&(i.path=""),a.value&&(a.value.value="")}}}},Et={class:"form-header"},Lt={class:"form-group category-group"},Bt={class:"form-group title-group"},Nt={class:"search-container"},Vt=["placeholder","disabled"],zt={key:0,class:"search-results"},Wt=["onClick"],Gt={class:"result-thumbnail"},Ot=["src","alt"],qt={key:1,class:"no-image"},jt={class:"result-content"},Ht={class:"result-title"},Qt={class:"result-meta"},Kt={key:0},Xt={key:1},Jt={key:2,class:"rating"},Yt={class:"form-row"},Zt={class:"form-group"},$t={for:"release"},eo={key:0,class:"required"},to=["required"],oo={key:0,class:"field-hint"},ao={key:1,class:"release-preview"},so={class:"form-group"},lo={class:"form-row"},no={class:"form-group"},io={class:"form-group"},ro={class:"form-row"},co={class:"form-group"},uo={class:"form-group"},mo={key:0,class:"form-row"},go={class:"form-group"},fo={key:0,class:"field-error"},vo={class:"form-row"},yo={class:"form-group"},po={class:"form-group"},ho={key:1,class:"form-row"},wo={class:"form-group"},Io={key:2,class:"form-row"},bo={class:"form-group"},So={key:0,class:"form-group"},ko={key:3,class:"form-row"},Co={class:"form-group"},To={class:"form-row"},_o={class:"form-group"},xo={class:"form-group"},Mo={class:"image-upload-container"},Ao=["disabled"],Do={key:0,class:"upload-success"},Uo={key:4,class:"form-row"},Ro={class:"form-group image-preview-group"},Fo={class:"image-preview"},Po=["src","alt"],Eo={key:5,class:"error-message"},Lo={class:"modal-buttons"},Bo=["disabled"],No=["disabled"],Vo=["disabled"],zo=["disabled"];function Wo(l,t,s,e,u,y){return n(),d("div",{class:"modal",onClick:t[27]||(t[27]=(...a)=>e.closeModal&&e.closeModal(...a))},[o("div",{class:"modal-content",onClick:t[26]||(t[26]=J(()=>{},["stop"]))},[o("h2",null,g(e.isEditing?"Edit Item":"Add Item"),1),o("form",{onSubmit:t[25]||(t[25]=J((...a)=>e.handleSave&&e.handleSave(...a),["prevent"]))},[o("div",Et,[o("div",Lt,[t[29]||(t[29]=o("label",{for:"category"},"Category:",-1)),A(o("select",{id:"category","onUpdate:modelValue":t[0]||(t[0]=a=>e.form.category=a),required:""},[...t[28]||(t[28]=[o("option",{value:"watchlist"},"Watchlist",-1),o("option",{value:"game"},"Game",-1),o("option",{value:"series"},"Series",-1),o("option",{value:"movie"},"Movie",-1)])],512),[[be,e.form.category]])]),o("div",Bt,[t[30]||(t[30]=o("label",{for:"title"},"Title:",-1)),o("div",Nt,[A(o("input",{type:"text",id:"title","onUpdate:modelValue":t[1]||(t[1]=a=>e.form.title=a),onInput:t[2]||(t[2]=(...a)=>e.searchApi&&e.searchApi(...a)),required:"",placeholder:e.isWatchlist?"Enter title (API search + manual input available)":"Enter title",disabled:e.loading},null,40,Vt),[[E,e.form.title]]),e.apiResults.length>0?(n(),d("div",zt,[(n(!0),d(ue,null,me(e.apiResults,a=>(n(),d("div",{key:a.title,class:"search-result-item",onClick:c=>e.selectApiResult(a)},[o("div",Gt,[a.imageUrl?(n(),d("img",{key:0,src:a.imageUrl,alt:a.title},null,8,Ot)):(n(),d("div",qt,[o("span",null,g(a.title.charAt(0).toUpperCase()),1)]))]),o("div",jt,[o("div",Ht,g(a.title),1),o("div",Qt,[a.release?(n(),d("span",Kt,g(e.formatDate(a.release)),1)):p("",!0),a.genre?(n(),d("span",Xt,g(a.genre),1)):p("",!0),a.rating?(n(),d("span",Jt,"⭐ "+g(a.rating),1)):p("",!0)])])],8,Wt))),128))])):p("",!0)])])]),o("div",Yt,[o("div",Zt,[o("label",$t,[re(g(e.isWatchlist?"Release Date:":"Release:")+" ",1),e.isWatchlist?(n(),d("span",eo,"*")):p("",!0)]),A(o("input",{type:"date",id:"release","onUpdate:modelValue":t[3]||(t[3]=a=>e.form.release=a),required:e.isWatchlist},null,8,to),[[E,e.form.release]]),e.isWatchlist?(n(),d("div",oo," 📅 Set the release date to track countdown or status ")):p("",!0),e.isWatchlist&&e.form.release?(n(),d("div",ao,[t[31]||(t[31]=o("strong",null,"Preview:",-1)),re(" "+g(e.getReleasePreview()),1)])):p("",!0)]),o("div",so,[t[32]||(t[32]=o("label",{for:"rating"},"Rating:",-1)),A(o("input",{type:"number",id:"rating","onUpdate:modelValue":t[4]||(t[4]=a=>e.form.rating=a),step:"0.1",min:"0",max:"10",placeholder:"0-10"},null,512),[[E,e.form.rating]])])]),o("div",lo,[o("div",no,[t[33]||(t[33]=o("label",{for:"views"},"Views:",-1)),A(o("input",{type:"number",id:"views","onUpdate:modelValue":t[5]||(t[5]=a=>e.form.count=a),min:"0",placeholder:"0"},null,512),[[E,e.form.count]])]),o("div",io,[t[34]||(t[34]=o("label",{for:"discovered"},"Discovered:",-1)),A(o("input",{type:"date",id:"discovered","onUpdate:modelValue":t[6]||(t[6]=a=>e.form.discovered=a)},null,512),[[E,e.form.discovered]])])]),o("div",ro,[o("div",co,[t[35]||(t[35]=o("label",{for:"platforms"},"Platforms:",-1)),A(o("input",{type:"text",id:"platforms","onUpdate:modelValue":t[7]||(t[7]=a=>e.form.platforms=a),placeholder:"PC, PS5, Xbox"},null,512),[[E,e.form.platforms]])]),o("div",uo,[t[36]||(t[36]=o("label",{for:"genre"},"Genre:",-1)),A(o("input",{type:"text",id:"genre","onUpdate:modelValue":t[8]||(t[8]=a=>e.form.genre=a),placeholder:"Action, Adventure, RPG"},null,512),[[E,e.form.genre]])])]),e.form.category==="watchlist"?(n(),d("div",mo,[o("div",go,[t[38]||(t[38]=o("label",{for:"watchlistType"},[re("Type: "),o("span",{class:"required"},"*")],-1)),A(o("select",{id:"watchlistType","onUpdate:modelValue":t[9]||(t[9]=a=>e.form.watchlistType=a)},[...t[37]||(t[37]=[o("option",{value:""},"Select Type",-1),o("option",{value:"game"},"Game",-1),o("option",{value:"series"},"Series",-1),o("option",{value:"movie"},"Movie",-1)])],512),[[be,e.form.watchlistType]]),e.form.category==="watchlist"&&!e.form.watchlistType?(n(),d("div",fo," Please select a type for watchlist items ")):p("",!0)])])):p("",!0),o("div",vo,[o("div",yo,[t[39]||(t[39]=o("label",{for:"link"},"Link:",-1)),A(o("input",{type:"url",id:"link","onUpdate:modelValue":t[10]||(t[10]=a=>e.form.link=a),placeholder:"https://..."},null,512),[[E,e.form.link]])]),o("div",po,[t[40]||(t[40]=o("label",{for:"path"},"Image Path:",-1)),A(o("input",{type:"text",id:"path","onUpdate:modelValue":t[11]||(t[11]=a=>e.form.path=a),placeholder:"images/movies/filename.jpg"},null,512),[[E,e.form.path]])])]),e.isGame?(n(),d("div",ho,[o("div",wo,[t[41]||(t[41]=o("label",{for:"playtime"},"Playtime (Minutes):",-1)),A(o("input",{type:"number",id:"playtime","onUpdate:modelValue":t[12]||(t[12]=a=>e.form.spielzeit=a),min:"0",placeholder:"0"},null,512),[[E,e.form.spielzeit]])])])):p("",!0),e.isSeries?(n(),d("div",Io,[o("div",bo,[t[43]||(t[43]=o("label",{for:"isAiring"},"Status:",-1)),A(o("select",{id:"isAiring","onUpdate:modelValue":t[13]||(t[13]=a=>e.form.isAiring=a)},[...t[42]||(t[42]=[o("option",{value:!1},"Finished",-1),o("option",{value:!0},"Airing",-1)])],512),[[be,e.form.isAiring]])]),e.form.isAiring?(n(),d("div",So,[t[44]||(t[44]=o("label",{for:"nextSeason"},"Next Season:",-1)),A(o("input",{type:"number",id:"nextSeason","onUpdate:modelValue":t[14]||(t[14]=a=>e.form.nextSeason=a),min:"1",placeholder:"1"},null,512),[[E,e.form.nextSeason]])])):p("",!0)])):p("",!0),e.form.isAiring?(n(),d("div",ko,[o("div",Co,[t[45]||(t[45]=o("label",{for:"nextSeasonRelease"},"Next Season Release:",-1)),A(o("input",{type:"date",id:"nextSeasonRelease","onUpdate:modelValue":t[15]||(t[15]=a=>e.form.nextSeasonRelease=a)},null,512),[[E,e.form.nextSeasonRelease]])])])):p("",!0),o("div",To,[o("div",_o,[t[46]||(t[46]=o("label",{for:"imageUrl"},"Image URL (optional):",-1)),A(o("input",{type:"text",id:"imageUrl","onUpdate:modelValue":t[16]||(t[16]=a=>e.form.imageUrl=a),placeholder:"https://... or leave empty for API images"},null,512),[[E,e.form.imageUrl]])]),o("div",xo,[t[47]||(t[47]=o("label",{for:"imageUpload"},"Upload Image:",-1)),o("div",Mo,[o("input",{type:"file",id:"imageUpload",ref:"imageUploadRef",onChange:t[17]||(t[17]=(...a)=>e.handleImageUpload&&e.handleImageUpload(...a)),accept:"image/*",style:{display:"none"}},null,544),o("button",{type:"button",onClick:t[18]||(t[18]=(...a)=>e.triggerImageUpload&&e.triggerImageUpload(...a)),class:"upload-btn",disabled:e.loading}," 📁 Choose Image ",8,Ao),e.uploadedImagePath?(n(),d("div",Do,[re(" ✅ Image uploaded: "+g(e.uploadedImagePath)+" ",1),o("button",{type:"button",onClick:t[19]||(t[19]=(...a)=>e.removeUploadedImage&&e.removeUploadedImage(...a)),class:"remove-uploaded-btn",title:"Remove uploaded image to enable API search"}," ✕ Remove ")])):p("",!0)])])]),e.form.imageUrl||e.uploadedImagePath?(n(),d("div",Uo,[o("div",Ro,[t[48]||(t[48]=o("label",null,"Image Preview:",-1)),o("div",Fo,[o("img",{src:e.getImagePreviewUrl(),alt:e.form.title,onError:t[20]||(t[20]=(...a)=>e.handleImageError&&e.handleImageError(...a))},null,40,Po),o("button",{type:"button",onClick:t[21]||(t[21]=(...a)=>e.clearImage&&e.clearImage(...a)),class:"clear-image-btn",title:"Remove image"}," ✕ ")])])])):p("",!0),e.error?(n(),d("div",Eo,g(e.error),1)):p("",!0),o("div",Lo,[o("button",{type:"submit",disabled:e.loading},g(e.loading?"Saving...":"Save"),9,Bo),o("button",{type:"button",onClick:t[22]||(t[22]=(...a)=>e.closeModal&&e.closeModal(...a)),disabled:e.loading}," Cancel ",8,No),e.isEditing?(n(),d("button",{key:0,type:"button",onClick:t[23]||(t[23]=(...a)=>e.deleteItem&&e.deleteItem(...a)),disabled:e.loading,class:"delete-btn"}," Delete ",8,Vo)):p("",!0),o("button",{type:"button",onClick:t[24]||(t[24]=(...a)=>e.handleSave&&e.handleSave(...a)),disabled:e.loading,class:"check-btn",title:"Add to list"}," ✓ ",8,zo)])],32)])])}const Go=j(Pt,[["render",Wo],["__scopeId","data-v-f538b026"]]),Oo={name:"BulkAddModal",props:{show:{type:Boolean,default:!1},currentCategory:{type:String,default:""}},emits:["close","save"],setup(l,{emit:t}){const s=I(!1),e=I(null),u=I(0),y=I([]),a=I(!1),c=I({category:"",itemsText:"",defaultRating:null,defaultPlatforms:"",defaultGenre:""}),i=R(()=>{if(!c.value.itemsText||!c.value.itemsText.trim())return[];const b=c.value.itemsText.split(`
`).map(w=>w.trim()).filter(w=>w.length>0).map(w=>{const k=w.split("|").map(h=>h.trim());return{searchTerm:k[0]||"",additionalInfo:k[1]||null}});return y.value&&y.value.length>0?b.map((w,k)=>{const h=y.value[k];return{searchTerm:w.searchTerm,additionalInfo:w.additionalInfo,title:(h==null?void 0:h.title)||w.searchTerm,apiData:h||null,hasApiData:!!h}}):b.map(w=>({searchTerm:w.searchTerm,additionalInfo:w.additionalInfo,title:w.searchTerm,apiData:null,hasApiData:!1}))}),z=R(()=>c.value.category&&c.value.itemsText.trim()&&i.value&&i.value.length>0&&!a.value),D=()=>{e.value=null,t("close")},F=async()=>{try{const b=localStorage.getItem("authToken"),w=localStorage.getItem("currentUser");if(!b||!w)return{hasDuplicates:!1,duplicates:[]};const k=await de.checkCategoryDuplicates(c.value.category);if(k.success&&k.duplicates){const h=k.duplicates.flat().map(C=>C.title.toLowerCase()),x=i.value.map(C=>C.title.toLowerCase()).filter(C=>h.includes(C));return{hasDuplicates:x.length>0,duplicates:x}}return{hasDuplicates:!1,duplicates:[]}}catch(b){return console.error("Bulk duplicate check failed:",b),{hasDuplicates:!1,duplicates:[]}}},W=async()=>{if(!(!c.value.category||!c.value.itemsText||!c.value.itemsText.trim())){a.value=!0,u.value=0,y.value=[],e.value=null;try{const b=c.value.itemsText.split(`
`).map(k=>k.trim()).filter(k=>k.length>0).map(k=>k.split("|")[0].trim()),w=[];for(let k=0;k<b.length;k++){const h=b[k];u.value=Math.round((k+1)/b.length*100);try{const P=await de.searchApi(h,c.value.category,1);if(P&&P.length>0){const x=P[0];w.push({title:x.title,release:x.release,rating:x.rating?Math.round(x.rating):null,platforms:x.platforms||c.value.defaultPlatforms,genre:x.genre||c.value.defaultGenre,link:x.link,path:x.image,external_id:x.id,api_source:x.api_source})}else w.push({title:h,release:null,rating:c.value.defaultRating,platforms:c.value.defaultPlatforms,genre:c.value.defaultGenre,link:null,path:null,external_id:null,api_source:null})}catch(P){console.warn(`Search failed for "${h}":`,P),w.push({title:h,release:null,rating:c.value.defaultRating,platforms:c.value.defaultPlatforms,genre:c.value.defaultGenre,link:null,path:null,external_id:null,api_source:null})}await new Promise(P=>setTimeout(P,200))}y.value=w||[]}catch(b){e.value="Failed to search API data: "+(b.message||"Unknown error"),console.error("API search error:",b)}finally{a.value=!1,u.value=100}}},O=async()=>{if(!(!z.value||!i.value)){s.value=!0,e.value=null;try{const b=await F();if(b.hasDuplicates){e.value=`Duplikate gefunden: ${b.duplicates.length} Einträge existieren bereits. Bitte überprüfen Sie die Liste.`,s.value=!1;return}const w=i.value.map(k=>{const h=k.apiData;return{title:k.title,category:c.value.category,release:(h==null?void 0:h.release)||null,rating:(h==null?void 0:h.rating)||c.value.defaultRating||null,platforms:(h==null?void 0:h.platforms)||c.value.defaultPlatforms||null,genre:(h==null?void 0:h.genre)||c.value.defaultGenre||null,link:(h==null?void 0:h.link)||null,path:(h==null?void 0:h.path)||null,external_id:(h==null?void 0:h.external_id)||null,count:0,is_airing:!1,spielzeit:0}});t("save",w),c.value={category:"",itemsText:"",defaultRating:null,defaultPlatforms:"",defaultGenre:""},y.value=[]}catch(b){e.value=b.message||"Failed to add items",console.error("Bulk add error:",b)}finally{s.value=!1}}};return ce([()=>c.value.category,()=>c.value.itemsText],([b,w])=>{b&&w&&w.trim()&&!a.value&&setTimeout(()=>{c.value.category===b&&c.value.itemsText===w&&!a.value&&W()},1e3)}),ce(()=>l.show,b=>{b&&l.currentCategory?c.value.category=l.currentCategory:b||(c.value={category:"",itemsText:"",defaultRating:null,defaultPlatforms:"",defaultGenre:""},y.value=[],e.value=null,a.value=!1,u.value=0)}),{loading:s,error:e,bulkData:c,previewItems:i,canSave:z,closeModal:D,searchApiData:W,saveBulkItems:O,isSearching:a,searchProgress:u}}},qo={class:"modal-header"},jo={class:"modal-body"},Ho={class:"bulk-add-form"},Qo={class:"form-group"},Ko={class:"form-group"},Xo={class:"form-group"},Jo={class:"form-group"},Yo={class:"form-group"},Zo={key:0,class:"search-progress"},$o={class:"progress-bar"},ea={class:"progress-text"},ta={key:1,class:"preview-section"},oa={class:"preview-list"},aa={class:"item-main"},sa={class:"item-title"},la={key:0,class:"api-badge"},na={key:1,class:"manual-badge"},ia={key:0,class:"item-info"},ra={key:1,class:"item-details"},da={key:0,class:"item-release"},ca={key:1,class:"item-rating"},ua={key:2,class:"item-genre"},ma={key:0,class:"preview-more"},ga={class:"modal-footer"},fa=["disabled"],va={key:0},ya={key:1},pa={key:2};function ha(l,t,s,e,u,y){return s.show?(n(),d("div",{key:0,class:"modal-overlay",onClick:t[9]||(t[9]=(...a)=>e.closeModal&&e.closeModal(...a))},[o("div",{class:"modal-content",onClick:t[8]||(t[8]=J(()=>{},["stop"]))},[o("div",qo,[t[10]||(t[10]=o("h2",null,"Bulk Add Items",-1)),o("button",{class:"close-btn",onClick:t[0]||(t[0]=(...a)=>e.closeModal&&e.closeModal(...a))},"✕")]),o("div",jo,[o("div",Ho,[o("div",Qo,[t[12]||(t[12]=o("label",{for:"category"},"Category *",-1)),A(o("select",{id:"category","onUpdate:modelValue":t[1]||(t[1]=a=>e.bulkData.category=a),required:""},[...t[11]||(t[11]=[Ze('<option value="" data-v-938dc2ad>Select Category</option><option value="game" data-v-938dc2ad>Game</option><option value="series" data-v-938dc2ad>Series</option><option value="movie" data-v-938dc2ad>Movie</option><option value="watchlist" data-v-938dc2ad>Watchlist</option>',5)])],512),[[be,e.bulkData.category]])]),o("div",Ko,[t[13]||(t[13]=o("label",{for:"items-text"},"Items (one per line) *",-1)),A(o("textarea",{id:"items-text","onUpdate:modelValue":t[2]||(t[2]=a=>e.bulkData.itemsText=a),placeholder:`Enter items one per line, for example:
The Witcher 3
Cyberpunk 2077
Red Dead Redemption 2`,rows:"10",required:""},null,512),[[E,e.bulkData.itemsText]]),t[14]||(t[14]=o("small",{class:"help-text"},"Enter one item per line. The system will automatically search the API for each title and use the official names, images, and details. You can add additional info using: Title | Additional Info",-1))]),o("div",Xo,[t[15]||(t[15]=o("label",{for:"default-rating"},"Default Rating",-1)),A(o("input",{id:"default-rating","onUpdate:modelValue":t[3]||(t[3]=a=>e.bulkData.defaultRating=a),type:"number",min:"0",max:"10",step:"0.1",placeholder:"Optional rating for all items"},null,512),[[E,e.bulkData.defaultRating,void 0,{number:!0}]])]),o("div",Jo,[t[16]||(t[16]=o("label",{for:"default-platforms"},"Default Platforms",-1)),A(o("input",{id:"default-platforms","onUpdate:modelValue":t[4]||(t[4]=a=>e.bulkData.defaultPlatforms=a),type:"text",placeholder:"e.g., PC, PS5, Xbox"},null,512),[[E,e.bulkData.defaultPlatforms]])]),o("div",Yo,[t[17]||(t[17]=o("label",{for:"default-genre"},"Default Genre",-1)),A(o("input",{id:"default-genre","onUpdate:modelValue":t[5]||(t[5]=a=>e.bulkData.defaultGenre=a),type:"text",placeholder:"e.g., Action, Adventure, RPG"},null,512),[[E,e.bulkData.defaultGenre]])])]),e.isSearching?(n(),d("div",Zo,[o("div",$o,[o("div",{class:"progress-fill",style:je({width:e.searchProgress+"%"})},null,4)]),o("span",ea,"Searching API for "+g(e.previewItems?e.previewItems.length:0)+" items... "+g(e.searchProgress)+"%",1)])):p("",!0),e.previewItems&&e.previewItems.length>0&&!e.isSearching?(n(),d("div",ta,[o("h3",null,"Preview ("+g(e.previewItems.length)+" items)",1),o("div",oa,[(n(!0),d(ue,null,me(e.previewItems.slice(0,10),(a,c)=>(n(),d("div",{key:c,class:$(["preview-item",{"has-api-data":a.hasApiData}])},[o("div",aa,[o("span",sa,g(a.title),1),a.hasApiData?(n(),d("span",la,"✓ API")):(n(),d("span",na,"Manual"))]),a.additionalInfo?(n(),d("div",ia," | "+g(a.additionalInfo),1)):p("",!0),a.apiData?(n(),d("div",ra,[a.apiData.release?(n(),d("small",da,g(a.apiData.release),1)):p("",!0),a.apiData.rating?(n(),d("small",ca,"⭐ "+g(a.apiData.rating),1)):p("",!0),a.apiData.genre?(n(),d("small",ua,g(a.apiData.genre),1)):p("",!0)])):p("",!0)],2))),128)),e.previewItems&&e.previewItems.length>10?(n(),d("div",ma," ... and "+g(e.previewItems.length-10)+" more items ",1)):p("",!0)])])):p("",!0)]),o("div",ga,[o("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=(...a)=>e.closeModal&&e.closeModal(...a))},"Cancel"),o("button",{class:"btn btn-primary",onClick:t[7]||(t[7]=(...a)=>e.saveBulkItems&&e.saveBulkItems(...a)),disabled:!e.canSave||e.loading},[e.loading?(n(),d("span",va,"Adding "+g(e.previewItems?e.previewItems.length:0)+" items...",1)):e.isSearching?(n(),d("span",ya,"Searching API...")):(n(),d("span",pa,"Add "+g(e.previewItems?e.previewItems.length:0)+" Items",1))],8,fa)])])])):p("",!0)}const wa=j(Oo,[["render",ha],["__scopeId","data-v-938dc2ad"]]),Ia={name:"TxtImportModal",props:{show:{type:Boolean,default:!1}},emits:["close","fileProcessed"],methods:{handleFileUpload(l){const t=l.target.files[0];if(!t)return;if(!t.name.toLowerCase().endsWith(".txt")){alert("Bitte wählen Sie eine .txt Datei aus.");return}const s=new FileReader;s.onload=e=>{const u=e.target.result;this.$emit("fileProcessed",u)},s.readAsText(t,"UTF-8")}}},ba={class:"file-upload-area"},Sa={class:"modal-buttons"};function ka(l,t,s,e,u,y){return s.show?(n(),d("div",{key:0,class:"modal",onClick:t[3]||(t[3]=a=>l.$emit("close"))},[o("div",{class:"modal-content",onClick:t[2]||(t[2]=J(()=>{},["stop"]))},[t[5]||(t[5]=o("h2",null,"📄 Import from TXT File",-1)),t[6]||(t[6]=o("p",null,"Wählen Sie eine .txt Datei mit einer Liste von Titeln aus, um zu prüfen, welche Items in der aktuellen Kategorie fehlen.",-1)),o("div",ba,[o("input",{type:"file",id:"txtFileInput",accept:".txt",onChange:t[0]||(t[0]=(...a)=>y.handleFileUpload&&y.handleFileUpload(...a)),style:{display:"none"}},null,32),t[4]||(t[4]=o("label",{for:"txtFileInput",class:"file-upload-label"},[o("span",{class:"upload-icon"},"📁"),o("span",{class:"upload-text"},"TXT-Datei auswählen"),o("span",{class:"upload-hint"},"Eine .txt Datei mit einer Liste von Titeln")],-1))]),o("div",Sa,[o("button",{type:"button",onClick:t[1]||(t[1]=a=>l.$emit("close"))}," Cancel ")])])])):p("",!0)}const Ca=j(Ia,[["render",ka],["__scopeId","data-v-d761bd17"]]),Ta={name:"TxtImportResultsModal",props:{show:{type:Boolean,default:!1},results:{type:Object,default:null}},emits:["close"]},_a={class:"results-summary"},xa={class:"summary-item"},Ma={class:"summary-value"},Aa={class:"summary-item"},Da={class:"summary-value"},Ua={class:"summary-item"},Ra={class:"summary-value existing"},Fa={class:"summary-item"},Pa={class:"summary-value missing"},Ea={key:0,class:"missing-items"},La={class:"items-list"},Ba={key:1,class:"existing-items"},Na={class:"items-list"},Va={class:"modal-buttons"};function za(l,t,s,e,u,y){return s.show&&s.results?(n(),d("div",{key:0,class:"modal",onClick:t[2]||(t[2]=a=>l.$emit("close"))},[o("div",{class:"modal-content results-modal",onClick:t[1]||(t[1]=J(()=>{},["stop"]))},[t[7]||(t[7]=o("h2",null,"📊 TXT Import Ergebnisse",-1)),o("div",_a,[o("div",xa,[t[3]||(t[3]=o("span",{class:"summary-label"},"Kategorie:",-1)),o("span",Ma,g(s.results.categoryName),1)]),o("div",Aa,[t[4]||(t[4]=o("span",{class:"summary-label"},"Titel in Datei:",-1)),o("span",Da,g(s.results.totalInFile),1)]),o("div",Ua,[t[5]||(t[5]=o("span",{class:"summary-label"},"Bereits vorhanden:",-1)),o("span",Ra,g(s.results.existingItems.length),1)]),o("div",Fa,[t[6]||(t[6]=o("span",{class:"summary-label"},"Fehlende Titel:",-1)),o("span",Pa,g(s.results.missingItems.length),1)])]),s.results.missingItems.length>0?(n(),d("div",Ea,[o("h3",null,"❌ Fehlende Titel ("+g(s.results.missingItems.length)+"):",1),o("div",La,[(n(!0),d(ue,null,me(s.results.missingItems,(a,c)=>(n(),d("div",{key:c,class:"missing-item"},g(a),1))),128))])])):p("",!0),s.results.existingItems.length>0?(n(),d("div",Ba,[o("h3",null,"✅ Bereits vorhanden ("+g(s.results.existingItems.length)+"):",1),o("div",Na,[(n(!0),d(ue,null,me(s.results.existingItems,(a,c)=>(n(),d("div",{key:c,class:"existing-item"},g(a),1))),128))])])):p("",!0),o("div",Va,[o("button",{type:"button",onClick:t[0]||(t[0]=a=>l.$emit("close"))}," Schließen ")])])])):p("",!0)}const Wa=j(Ta,[["render",za],["__scopeId","data-v-ec385b83"]]),Ga={name:"LoadingSpinner",props:{loading:{type:Boolean,default:!0},message:{type:String,default:"Loading..."}}},Oa={key:0,class:"loading-spinner"},qa={key:0};function ja(l,t,s,e,u,y){return s.loading?(n(),d("div",Oa,[t[0]||(t[0]=o("div",{class:"spinner"},null,-1)),s.message?(n(),d("p",qa,g(s.message),1)):p("",!0)])):p("",!0)}const Ha=j(Ga,[["render",ja],["__scopeId","data-v-b6e4a334"]]),Qa={name:"MessageBox",props:{show:{type:Boolean,default:!1},type:{type:String,default:"info",validator:l=>["success","error","warning","info"].includes(l)},title:{type:String,default:""},message:{type:String,required:!0},details:{type:String,default:""}},emits:["close"],setup(l,{emit:t}){const s=()=>{t("close")},e=R(()=>{switch(l.type){case"success":return"✅";case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"ℹ️"}}),u=R(()=>`message-${l.type}`);return{closeMessage:s,icon:e,messageType:u}}},Ka={class:"message-header"},Xa={class:"message-icon"},Ja={class:"message-title"},Ya={class:"message-body"},Za={key:0,class:"message-details"},$a={class:"message-footer"};function es(l,t,s,e,u,y){return s.show?(n(),d("div",{key:0,class:"message-overlay",onClick:t[3]||(t[3]=(...a)=>e.closeMessage&&e.closeMessage(...a))},[o("div",{class:$(["message-box",e.messageType]),onClick:t[2]||(t[2]=J(()=>{},["stop"]))},[o("div",Ka,[o("span",Xa,g(e.icon),1),o("h3",Ja,g(s.title),1),o("button",{class:"close-btn",onClick:t[0]||(t[0]=(...a)=>e.closeMessage&&e.closeMessage(...a))},"✕")]),o("div",Ya,[o("p",null,g(s.message),1),s.details?(n(),d("div",Za,[o("pre",null,g(s.details),1)])):p("",!0)]),o("div",$a,[o("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...a)=>e.closeMessage&&e.closeMessage(...a))},"OK")])],2)])):p("",!0)}const ts=j(Qa,[["render",es],["__scopeId","data-v-3ff2fc98"]]),os={name:"ConfirmDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Confirm Action"},message:{type:String,required:!0}},emits:["confirm","close"],setup(l,{emit:t}){const s=()=>{t("close")};return{closeDialog:s,confirmAction:()=>{t("confirm"),s()}}}},as={class:"confirm-header"},ss={class:"confirm-title"},ls={class:"confirm-body"},ns={class:"confirm-footer"};function is(l,t,s,e,u,y){return s.show?(n(),d("div",{key:0,class:"confirm-overlay",onClick:t[4]||(t[4]=(...a)=>e.closeDialog&&e.closeDialog(...a))},[o("div",{class:"confirm-dialog",onClick:t[3]||(t[3]=J(()=>{},["stop"]))},[o("div",as,[o("h3",ss,g(s.title),1),o("button",{class:"close-btn",onClick:t[0]||(t[0]=(...a)=>e.closeDialog&&e.closeDialog(...a))},"✕")]),o("div",ls,[o("p",null,g(s.message),1)]),o("div",ns,[o("button",{class:"btn btn-secondary",onClick:t[1]||(t[1]=(...a)=>e.closeDialog&&e.closeDialog(...a))},"Cancel"),o("button",{class:"btn btn-danger",onClick:t[2]||(t[2]=(...a)=>e.confirmAction&&e.confirmAction(...a))},"Confirm")])])])):p("",!0)}const rs=j(os,[["render",is],["__scopeId","data-v-a9f2748d"]]),ds={name:"InputDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Input Required"},message:{type:String,required:!0},placeholder:{type:String,default:""},inputType:{type:String,default:"text"},defaultValue:{type:String,default:""}},emits:["confirm","close"],setup(l,{emit:t}){const s=I(""),e=I(null),u=()=>{t("close")},y=()=>{t("confirm",s.value),u()};return ce(()=>l.show,async a=>{a&&(s.value=l.defaultValue,await tt(),e.value&&(e.value.focus(),e.value.select()))}),{inputValue:s,inputRef:e,closeDialog:u,confirmAction:y}}},cs={class:"input-header"},us={class:"input-title"},ms={class:"input-body"},gs={class:"input-message"},fs=["type","placeholder"],vs={class:"input-footer"};function ys(l,t,s,e,u,y){return s.show?(n(),d("div",{key:0,class:"input-overlay",onClick:t[6]||(t[6]=(...a)=>e.closeDialog&&e.closeDialog(...a))},[o("div",{class:"input-dialog",onClick:t[5]||(t[5]=J(()=>{},["stop"]))},[o("div",cs,[o("h3",us,g(s.title),1),o("button",{class:"close-btn",onClick:t[0]||(t[0]=(...a)=>e.closeDialog&&e.closeDialog(...a))},"✕")]),o("div",ms,[o("p",gs,g(s.message),1),A(o("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>e.inputValue=a),type:s.inputType,placeholder:s.placeholder,class:"input-field",onKeyup:t[2]||(t[2]=et((...a)=>e.confirmAction&&e.confirmAction(...a),["enter"])),ref:"inputRef"},null,40,fs),[[$e,e.inputValue]])]),o("div",vs,[o("button",{class:"btn btn-secondary",onClick:t[3]||(t[3]=(...a)=>e.closeDialog&&e.closeDialog(...a))},"Cancel"),o("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...a)=>e.confirmAction&&e.confirmAction(...a))},"OK")])])])):p("",!0)}const ps=j(ds,[["render",ys],["__scopeId","data-v-3ad0971c"]]),hs={name:"MediaLibrary",components:{MediaItem:xt,Sidebar:rt,MainHeader:it,FloatingActionButton:Ft,LoginModal:nt,RegisterModal:lt,EditModal:Go,BulkAddModal:wa,TxtImportModal:Ca,TxtImportResultsModal:Wa,LoadingSpinner:Ha,MessageBox:ts,ConfirmDialog:rs,InputDialog:ps},setup(){const l=He(),t=Qe(),s=Ke(),e=Xe(),{sidebarCollapsed:u,mobileSidebarOpen:y,showLoginModal:a,showRegisterModal:c,showEditModal:i,showFloatingMenu:z,showBulkAddModal:D,showTxtImportModal:F,showTxtImportResults:W,editingItem:O,gridColumns:b,sortBy:w,categories:k,txtImportResults:h,isLoggedIn:P,userName:x,currentCategory:C,searchQuery:ee,categoryCounts:Q,loading:ge,error:H,paginatedMedia:fe,platforms:te,genres:f,toggleSidebar:m,toggleMobileSidebar:_,closeMobileSidebar:L,setCategory:q,clearSearch:V,togglePlatformFilter:G,toggleGenreFilter:ve,toggleAiringFilter:Z,editItem:Se,closeEditModal:ke,closeBulkAddModal:Ce,handleBulkAddItems:Te,handleSaveItem:_e,handleDeleteItem:xe,logout:ye,loadMedia:Y,toggleFloatingMenu:Me,addNewItem:pe,bulkAddItems:Ae,importFromTxt:De,importFromAPI:oe,createCollection:Ue,exportMediaCollection:Re,exportAsCSV:Fe,exportAsJSON:Pe,downloadFile:Ee,deleteAllInCategory:Le,getCategoryDisplayName:ae,navigateToStatistics:Be,navigateToCalendar:Ne,navigateToFeatures:Ve,navigateToProfile:he,processTxtContent:we,closeTxtImportResults:Ie,cleanup:se}=dt(),ze=K=>{q(K),pe()},We=()=>{a.value=!1,c.value=!0},Ge=K=>{a.value=!1,Y()},Oe=()=>{c.value=!1,Y()};return ot(async()=>{try{if(await Y(),P.value)try{l.initializeRealtimeUpdates()}catch(K){console.error("Error initializing realtime updates:",K)}}catch(K){console.error("Error during initialization:",K)}}),at(()=>{if(P.value)try{l.cleanupRealtimeUpdates()}catch(K){console.error("Error cleaning up realtime updates:",K)}se()}),{sidebarCollapsed:u,mobileSidebarOpen:y,showLoginModal:a,showRegisterModal:c,showEditModal:i,showFloatingMenu:z,showBulkAddModal:D,showTxtImportModal:F,showTxtImportResults:W,editingItem:O,gridColumns:b,sortBy:w,categories:k,txtImportResults:h,isLoggedIn:P,userName:x,currentCategory:C,searchQuery:ee,categoryCounts:Q,loading:ge,error:H,paginatedMedia:fe,platforms:te,genres:f,toggleSidebar:m,toggleMobileSidebar:_,closeMobileSidebar:L,setCategory:q,clearSearch:V,navigateToStatistics:Be,navigateToCalendar:Ne,navigateToFeatures:Ve,navigateToProfile:he,addItemFromSidebar:ze,togglePlatformFilter:G,toggleGenreFilter:ve,toggleAiringFilter:Z,editItem:Se,switchToRegister:We,handleLoginSuccess:Ge,handleRegisterSuccess:Oe,closeEditModal:ke,closeBulkAddModal:Ce,handleBulkAddItems:Te,handleSaveItem:_e,handleDeleteItem:xe,logout:ye,loadMedia:Y,toggleFloatingMenu:Me,addNewItem:pe,bulkAddItems:Ae,importFromTxt:De,importFromAPI:oe,createCollection:Ue,exportMediaCollection:Re,exportAsCSV:Fe,exportAsJSON:Pe,downloadFile:Ee,deleteAllInCategory:Le,getCategoryDisplayName:ae,processTxtContent:we,closeTxtImportResults:Ie,messageStore:t,confirmStore:s,inputStore:e}}},ws={class:"vue-app"},Is={class:"main-content"},bs={class:"content-area"},Ss={key:1,class:"error"},ks={key:2};function Cs(l,t,s,e,u,y){const a=N("Sidebar"),c=N("MainHeader"),i=N("LoadingSpinner"),z=N("MediaItem"),D=N("LoginModal"),F=N("RegisterModal"),W=N("EditModal"),O=N("BulkAddModal"),b=N("TxtImportModal"),w=N("TxtImportResultsModal"),k=N("FloatingActionButton"),h=N("MessageBox"),P=N("ConfirmDialog"),x=N("InputDialog");return n(),d("div",ws,[o("div",{class:$(["mobile-overlay",{show:e.mobileSidebarOpen}]),onClick:t[0]||(t[0]=(...C)=>e.closeMobileSidebar&&e.closeMobileSidebar(...C))},null,2),X(a,{collapsed:e.sidebarCollapsed,"mobile-open":e.mobileSidebarOpen,"is-logged-in":e.isLoggedIn,"user-name":e.userName,"current-category":e.currentCategory,"category-counts":e.categoryCounts,platforms:e.platforms,genres:e.genres,categories:e.categories,onToggle:e.toggleSidebar,onSetCategory:e.setCategory,onNavigateToStatistics:e.navigateToStatistics,onNavigateToCalendar:e.navigateToCalendar,onNavigateToFeatures:e.navigateToFeatures,onNavigateToProfile:e.navigateToProfile,onTogglePlatformFilter:e.togglePlatformFilter,onToggleGenreFilter:e.toggleGenreFilter,onToggleAiringFilter:e.toggleAiringFilter,onAddItem:e.addItemFromSidebar,onShowLogin:t[1]||(t[1]=C=>e.showLoginModal=!0),onShowRegister:t[2]||(t[2]=C=>e.showRegisterModal=!0),onLogout:e.logout},null,8,["collapsed","mobile-open","is-logged-in","user-name","current-category","category-counts","platforms","genres","categories","onToggle","onSetCategory","onNavigateToStatistics","onNavigateToCalendar","onNavigateToFeatures","onNavigateToProfile","onTogglePlatformFilter","onToggleGenreFilter","onToggleAiringFilter","onAddItem","onLogout"]),o("div",Is,[X(c,{"search-query":e.searchQuery,"onUpdate:searchQuery":t[3]||(t[3]=C=>e.searchQuery=C),"grid-columns":e.gridColumns,"onUpdate:gridColumns":t[4]||(t[4]=C=>e.gridColumns=C),"sort-by":e.sortBy,"onUpdate:sortBy":t[5]||(t[5]=C=>e.sortBy=C),onToggleMobileSidebar:e.toggleMobileSidebar,onClearSearch:e.clearSearch},null,8,["search-query","grid-columns","sort-by","onToggleMobileSidebar","onClearSearch"]),o("main",bs,[e.loading?(n(),ie(i,{key:0,message:"Loading media data..."})):e.error?(n(),d("div",Ss,[o("p",null,g(e.error),1),o("button",{onClick:t[6]||(t[6]=(...C)=>e.loadMedia&&e.loadMedia(...C))},"Retry")])):(n(),d("div",ks,[o("div",{class:"grid",style:je({gridTemplateColumns:`repeat(${e.gridColumns}, 1fr)`})},[(n(!0),d(ue,null,me(e.paginatedMedia,C=>(n(),ie(z,{key:C.id,item:C,onEdit:e.editItem},null,8,["item","onEdit"]))),128))],4)]))])]),e.showLoginModal?(n(),ie(D,{key:0,onClose:t[7]||(t[7]=C=>e.showLoginModal=!1),onSuccess:e.handleLoginSuccess,onSwitchToRegister:e.switchToRegister},null,8,["onSuccess","onSwitchToRegister"])):p("",!0),e.showRegisterModal?(n(),ie(F,{key:1,onClose:t[8]||(t[8]=C=>e.showRegisterModal=!1),onSuccess:e.handleRegisterSuccess},null,8,["onSuccess"])):p("",!0),e.showEditModal?(n(),ie(W,{key:2,item:e.editingItem,"current-category":e.currentCategory,onClose:e.closeEditModal,onSave:e.handleSaveItem,onDelete:e.handleDeleteItem},null,8,["item","current-category","onClose","onSave","onDelete"])):p("",!0),X(O,{show:e.showBulkAddModal,"current-category":e.currentCategory,onClose:e.closeBulkAddModal,onSave:e.handleBulkAddItems},null,8,["show","current-category","onClose","onSave"]),X(b,{show:e.showTxtImportModal,onClose:t[9]||(t[9]=C=>e.showTxtImportModal=!1),onFileProcessed:e.processTxtContent},null,8,["show","onFileProcessed"]),X(w,{show:e.showTxtImportResults,results:e.txtImportResults,onClose:e.closeTxtImportResults},null,8,["show","results","onClose"]),X(k,{"show-menu":e.showFloatingMenu,"show-delete-all":e.isLoggedIn&&e.currentCategory!=="all"&&e.categoryCounts[e.currentCategory]>0,"category-name":e.getCategoryDisplayName(e.currentCategory),"item-count":e.categoryCounts[e.currentCategory]||0,onToggleMenu:e.toggleFloatingMenu,onAddNewItem:e.addNewItem,onBulkAddItems:e.bulkAddItems,onImportFromTxt:e.importFromTxt,onImportFromApi:e.importFromAPI,onCreateCollection:e.createCollection,onDeleteAllInCategory:e.deleteAllInCategory},null,8,["show-menu","show-delete-all","category-name","item-count","onToggleMenu","onAddNewItem","onBulkAddItems","onImportFromTxt","onImportFromApi","onCreateCollection","onDeleteAllInCategory"]),X(h,{show:e.messageStore.show,type:e.messageStore.type,title:e.messageStore.title,message:e.messageStore.message,details:e.messageStore.details,onClose:e.messageStore.closeMessage},null,8,["show","type","title","message","details","onClose"]),X(P,{show:e.confirmStore.show,title:e.confirmStore.title,message:e.confirmStore.message,onConfirm:e.confirmStore.confirm,onClose:e.confirmStore.cancel},null,8,["show","title","message","onConfirm","onClose"]),X(x,{show:e.inputStore.show,title:e.inputStore.title,message:e.inputStore.message,placeholder:e.inputStore.placeholder,"input-type":e.inputStore.inputType,"default-value":e.inputStore.defaultValue,onConfirm:e.inputStore.confirm,onClose:e.inputStore.cancel},null,8,["show","title","message","placeholder","input-type","default-value","onConfirm","onClose"])])}const Ds=j(hs,[["render",Cs],["__scopeId","data-v-3bc018de"]]);export{Ds as default};
