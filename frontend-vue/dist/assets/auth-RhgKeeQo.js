import{s as p,d as u,f as v}from"./index-z1QHRkF6.js";import{a as c}from"./media-B7xhEs5K.js";const A=p("auth",()=>{const a=u(localStorage.getItem("authToken")||null),l=u(null),n=u(!1),o=u(null),f=v(()=>!!a.value&&!!l.value),d=v(()=>{var e;return((e=l.value)==null?void 0:e.name)||""}),m=v(()=>{var e;return((e=l.value)==null?void 0:e.email)||""});async function h(e,t){n.value=!0,o.value=null;try{const r=await c.login(e,t);return a.value=r.token,l.value=r.user,localStorage.setItem("authToken",a.value),localStorage.setItem("currentUser",JSON.stringify(l.value)),{success:!0}}catch(r){return o.value=r.message||"Login failed",{success:!1,error:o.value}}finally{n.value=!1}}async function S(e,t,r,I){n.value=!0,o.value=null;try{const s=await c.register(e,t,r,I);return a.value=s.token,l.value=s.user,localStorage.setItem("authToken",a.value),localStorage.setItem("currentUser",JSON.stringify(l.value)),{success:!0}}catch(s){return o.value=s.message||"Registration failed",{success:!1,error:o.value}}finally{n.value=!1}}async function i(){try{a.value&&await c.logout(a.value)}catch(e){console.error("Logout API call failed:",e)}finally{a.value=null,l.value=null,localStorage.removeItem("authToken"),localStorage.removeItem("currentUser")}}async function g(){if(!a.value)return!1;try{const e=await c.validateToken(a.value);return l.value=e,!0}catch(e){return console.error("Token validation failed:",e),await i(),!1}}async function y(){console.log("Initializing auth..."),console.log("Token from localStorage:",a.value);const e=localStorage.getItem("currentUser");if(console.log("Saved user from localStorage:",e),e)try{l.value=JSON.parse(e),console.log("Parsed user:",l.value)}catch(t){console.error("Failed to parse saved user data:",t),await i();return}if(a.value){console.log("Validating token with server...");const t=await g();console.log("Token validation result:",t)}else console.log("No token found, user is not logged in");console.log("Auth initialization complete. isLoggedIn:",!!a.value&&!!l.value)}function k(){o.value=null}return{token:a,user:l,loading:n,error:o,isLoggedIn:f,userName:d,userEmail:m,login:h,register:S,logout:i,validateToken:g,initializeAuth:y,clearError:k}});export{A as u};
