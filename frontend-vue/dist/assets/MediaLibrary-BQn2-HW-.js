import{d as je,r as y,u as ot,a as Ze,c as V,_ as oe,b as m,e as s,t as f,f as p,n as Y,g as Se,h as ve,o as g,i as Oe,j as Xe,w as U,v as Ie,k as at,l as De,m as me,p as we,q as Ve,s as G,F as te,x as se,y as _e,z as X,A as it,B as nt,C as rt,D as ge,E as lt}from"./index-DL2gJxAr.js";import{u as He,a as Ye,S as dt}from"./Sidebar-D03Rc9sF.js";import{R as ct,L as ut,M as gt}from"./RegisterModal-3zn5QPOe.js";const $e=je("message",()=>{const i=y(!1),t=y("info"),o=y(""),e=y(""),n=y("");function c(C){t.value=C.type||"info",o.value=C.title||"",e.value=C.message||"",n.value=C.details||"",i.value=!0}function r(C,w="Success",R=""){c({type:"success",title:w,message:C,details:R})}function l(C,w="Error",R=""){c({type:"error",title:w,message:C,details:R})}function a(C,w="Warning",R=""){c({type:"warning",title:w,message:C,details:R})}function v(C,w="Info",R=""){c({type:"info",title:w,message:C,details:R})}function T(){i.value=!1,setTimeout(()=>{t.value="info",o.value="",e.value="",n.value=""},300)}return{show:i,type:t,title:o,message:e,details:n,showMessage:c,showSuccess:r,showError:l,showWarning:a,showInfo:v,closeMessage:T}}),et=je("confirm",()=>{const i=y(!1),t=y("Confirm Action"),o=y(""),e=y(null);function n(l){return new Promise(a=>{t.value=l.title||"Confirm Action",o.value=l.message||"",i.value=!0,e.value=a})}function c(){e.value&&(e.value(!0),e.value=null),i.value=!1}function r(){e.value&&(e.value(!1),e.value=null),i.value=!1}return{show:i,title:t,message:o,showConfirm:n,confirm:c,cancel:r}}),tt=je("input",()=>{const i=y(!1),t=y("Input Required"),o=y(""),e=y(""),n=y("text"),c=y(""),r=y(null);function l(T){return new Promise(C=>{t.value=T.title||"Input Required",o.value=T.message||"",e.value=T.placeholder||"",n.value=T.inputType||"text",c.value=T.defaultValue||"",i.value=!0,r.value=C})}function a(T){r.value&&(r.value(T),r.value=null),i.value=!1}function v(){r.value&&(r.value(null),r.value=null),i.value=!1}return{show:i,title:t,message:o,placeholder:e,inputType:n,defaultValue:c,showInput:l,confirm:a,cancel:v}});function mt(){const i=ot(),t=Ze(),o=He(),e=$e(),n=et(),c=tt(),r=y(!1),l=y(!1),a=y(!1),v=y(!1),T=y(!1),C=y(!1),w=y(!1),R=y(null),Q=()=>typeof window<"u"?window.innerWidth>768?8:3:8,$=y(Q()),F=y("order_asc"),ae=y(null),le=()=>{$.value=Q()};typeof window<"u"&&window.addEventListener("resize",le);const ie=[{key:"game",name:"Games",icon:"ðŸŽ®"},{key:"series",name:"Series",icon:"ðŸ“º"},{key:"movie",name:"Movies",icon:"ðŸŽ¬"},{key:"buecher",name:"BÃ¼cher",icon:"ðŸ“š"},{key:"watchlist",name:"Watchlist",icon:"â¤ï¸"}],O=V(()=>{try{return t.isLoggedIn}catch(h){return console.error("Error accessing authStore.isLoggedIn:",h),!1}}),z=V(()=>{try{return t.userName}catch(h){return console.error("Error accessing authStore.userName:",h),""}}),Z=V(()=>{try{return t.isAdmin}catch(h){return console.error("Error accessing authStore.isAdmin:",h),!1}}),H=V(()=>{try{return o.currentCategory}catch(h){return console.error("Error accessing mediaStore.currentCategory:",h),"game"}}),de=V({get:()=>{try{return o.searchQuery}catch(h){return console.error("Error accessing mediaStore.searchQuery:",h),""}},set:h=>{try{o.setSearchQuery(h)}catch(_){console.error("Error setting mediaStore.searchQuery:",_)}}}),b=V(()=>{try{return o.categoryCounts}catch(h){return console.error("Error accessing mediaStore.categoryCounts:",h),{}}}),L=V(()=>{try{return o.loading}catch(h){return console.error("Error accessing mediaStore.loading:",h),!1}}),ce=V(()=>{try{return o.error}catch(h){return console.error("Error accessing mediaStore.error:",h),null}}),fe=V(()=>{try{const h=[...o.filteredMedia||[]],[_,W]=F.value.split("_");return h.sort((x,M)=>{let q=x[_],E=M[_];return _==="order"?(q=x.__order||0,E=M.__order||0):_==="airing"?(q=x.isAiring?1:0,E=M.isAiring?1:0):_==="api_rating"?(q=x.api_rating||x.rating||0,E=M.api_rating||M.rating||0):_==="personal_rating"&&(q=x.personal_rating||0,E=M.personal_rating||0),typeof q=="string"&&(q=q.toLowerCase(),E=E.toLowerCase()),W==="asc"?q>E?1:-1:q<E?1:-1})}catch(h){return console.error("Error in sortedMedia computed:",h),[]}}),d=V(()=>fe.value),k=h=>{o.setCategory(h),Ye().closeMobileSidebar()},I=()=>{o.setSearchQuery("")},u=h=>{R.value=h,a.value=!0},A=()=>{a.value=!1,R.value=null},K=()=>{T.value=!1},ne=async h=>{console.log("handleBulkAddItems called but not used in new workflow")},ye=async h=>{R.value?await o.updateMediaItem(R.value.id,h):await o.addMediaItem(h),A()},ee=async h=>{var _;try{await o.deleteMediaItem(h.id)}catch(W){((_=W.response)==null?void 0:_.status)!==404&&!W.silent&&(console.error("Delete failed:",W),e.showError("Failed to delete item: "+(W.message||"Unknown error"),"Delete Failed"))}},S=async()=>{await t.logout(),await N()},N=async()=>{try{await o.loadMedia()}catch(h){console.error("Error loading media:",h)}},re=()=>{v.value=!v.value},Te=()=>{if(v.value=!1,!O.value){e.showWarning("Bitte loggen Sie sich ein, um neue Items hinzuzufÃ¼gen.","Login erforderlich");return}R.value=null,a.value=!0},P=()=>{if(v.value=!1,!O.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}T.value=!0},ue=()=>{if(v.value=!1,!O.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}C.value=!0},Ee=()=>{if(v.value=!1,!O.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}e.showInfo("API Import feature coming soon!","Feature in Entwicklung")},Fe=()=>{if(v.value=!1,!O.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}be()},Ce=h=>{if(!h)return"Unknown";const _=ie.find(W=>W.key===h);return _?_.name:h},Le=async()=>{const h=Ce(H.value),_=b.value[H.value]||0;if(_===0){e.showInfo("No items to delete in this category.","Nothing to Delete");return}const W=`Are you sure you want to delete ALL ${_} items in "${h}"?

This action cannot be undone!`;if(await n.showConfirm({title:"Delete All Items",message:W}))try{const q=((o==null?void 0:o.mediaData)||[]).filter(E=>H.value==="watchlist"?E.category==="watchlist"||E.isNew===!0:E.category===H.value).map(E=>E.id);await o.batchDeleteMediaItems(q),await N(),e.showSuccess(`Successfully deleted ${_} items from "${h}"`,"Items Deleted")}catch(M){console.error("Error deleting items:",M),M.silent?e.showSuccess(`Items deleted from "${h}" (some items may not have existed)`,"Items Deleted"):M.isNotFound?e.showWarning("Some items were not found and could not be deleted, but the operation completed.","Partial Success"):e.showError("Error occurred while deleting items. Please try again.","Delete Failed")}},Ne=h=>{const _=h.split(`
`).map(E=>E.trim()).filter(E=>E.length>0);if(_.length===0){e.showWarning("Die TXT-Datei ist leer oder enthÃ¤lt keine gÃ¼ltigen EintrÃ¤ge.","Leere Datei");return}const x=o.filteredMedia.map(E=>E.title.toLowerCase().trim()),M=_.filter(E=>{const pe=E.toLowerCase().trim();return!x.some(he=>he.includes(pe)||pe.includes(he))}),q=_.filter(E=>{const pe=E.toLowerCase().trim();return x.some(he=>he.includes(pe)||pe.includes(he))});ae.value={totalInFile:_.length,missingItems:M,existingItems:q,currentCategory:H.value,categoryName:Ce(H.value)},C.value=!1,w.value=!0},We=()=>{ae.value=null,w.value=!1},be=async()=>{const h=(o==null?void 0:o.mediaData)||[];if(h.length===0){e.showInfo("Keine Media Items zum Exportieren gefunden.","Nichts zu exportieren");return}const _=await c.showInput({title:"Export Format wÃ¤hlen",message:`1 = CSV
2 = JSON
3 = Beide

Geben Sie die Nummer ein:`,placeholder:"1",defaultValue:"1"});if(!_||!["1","2","3"].includes(_))return;const W=new Date().toISOString().split("T")[0];(_==="1"||_==="3")&&Me(h,W),(_==="2"||_==="3")&&Re(h,W),e.showSuccess(`Collection mit ${h.length} Items wurde erfolgreich exportiert!`,"Export erfolgreich")},Me=(h,_)=>{const x=[["Titel","Kategorie","Release","Rating","Platforms","Genre","Spielzeit","Status","Beschreibung"].join(","),...h.map(M=>[`"${(M.title||"").replace(/"/g,'""')}"`,`"${(M.category||M.category_name||"Unbekannt").replace(/"/g,'""')}"`,`"${M.release||""}"`,`"${M.rating||""}"`,`"${(M.platforms||"").replace(/"/g,'""')}"`,`"${(M.genre||"").replace(/"/g,'""')}"`,`"${M.spielzeit||""}"`,`"${M.isAiring?"Airing":"Abgeschlossen"}"`,`"${(M.description||"").replace(/"/g,'""')}"`].join(","))].join(`
`);Ae(x,`media_collection_${_}.csv`,"text/csv;charset=utf-8;")},Re=(h,_)=>{const W={exportDate:new Date().toISOString(),totalItems:h.length,categories:[...new Set(h.map(x=>x.category||x.category_name||"Unbekannt"))],items:h.map(x=>({id:x.id,title:x.title||"",category:x.category||x.category_name||"Unbekannt",release:x.release||"",rating:x.rating||null,platforms:x.platforms||"",genre:x.genre||"",spielzeit:x.spielzeit||null,status:x.isAiring?"Airing":"Abgeschlossen",description:x.description||"",isNew:x.isNew||!1,nextSeason:x.nextSeason||null,discovered:x.discovered||null}))};Ae(JSON.stringify(W,null,2),`media_collection_${_}.json`,"application/json;charset=utf-8;")},Ae=(h,_,W)=>{const x=new Blob([h],{type:W}),M=document.createElement("a"),q=URL.createObjectURL(x);M.setAttribute("href",q),M.setAttribute("download",_),M.style.visibility="hidden",document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(q)};return{showLoginModal:r,showRegisterModal:l,showEditModal:a,showFloatingMenu:v,showBulkAddModal:T,showTxtImportModal:C,showTxtImportResults:w,editingItem:R,gridColumns:$,sortBy:F,categories:ie,txtImportResults:ae,isLoggedIn:O,isAdmin:Z,userName:z,currentCategory:H,searchQuery:de,categoryCounts:b,loading:L,error:ce,paginatedMedia:d,setCategory:k,clearSearch:I,editItem:u,closeEditModal:A,closeBulkAddModal:K,handleBulkAddItems:ne,handleSaveItem:ye,handleDeleteItem:ee,logout:S,loadMedia:N,toggleFloatingMenu:re,addNewItem:Te,bulkAddItems:P,importFromTxt:ue,importFromAPI:Ee,createCollection:Fe,exportMediaCollection:be,exportAsCSV:Me,exportAsJSON:Re,downloadFile:Ae,deleteAllInCategory:Le,getCategoryDisplayName:Ce,navigateToCalendar:()=>{i.push("/calendar")},navigateToProfile:()=>{i.push("/profile")},navigateToAdmin:()=>{console.log("ðŸ”¥ navigateToAdmin function called!"),console.log("ðŸ”¥ Router object:",i),console.log("ðŸ”¥ Pushing to /admin...");try{i.push("/admin"),console.log("ðŸ”¥ Successfully navigated to /admin!")}catch(h){console.error("ðŸ”¥ Error navigating to admin:",h)}},processTxtContent:Ne,closeTxtImportResults:We,cleanup:()=>{typeof window<"u"&&window.removeEventListener("resize",le)},router:i}}const ft={name:"MediaItem",props:{item:{type:Object,required:!0}},emits:["edit"],computed:{showWatchlistTag(){return this.item.category==="watchlist"||this.item.isNew===!0},isWatchlistItem(){return this.item.category==="watchlist"||this.item.isNew===!0}},methods:{getImageUrl(i){return i?i.startsWith("http")?i.startsWith("http://")?i.replace("http://","https://"):i:i.startsWith("/")?i:`/storage/${i}`:""},handleImageError(i){var t;i.target.style.display="none",(t=i.target.nextElementSibling)==null||t.classList.add("show")},formatDate(i){return i?new Date(i).toLocaleDateString():""},editItem(){this.$emit("edit",this.item)},getWatchlistReleaseStatus(){if(!this.item.release)return"";const i=new Date(this.item.release),t=new Date;t.setHours(0,0,0,0),i.setHours(0,0,0,0);const o=i.getTime()-t.getTime(),e=Math.ceil(o/(1e3*3600*24));if(e>0)return e===1?"Tomorrow!":e<=7?`${e} days left`:e<=30?`${e} days left`:`${Math.ceil(e/30)} months left`;if(e===0)return"Released today!";{const n=this.getTypeTagText().toLowerCase();return n==="game"?"Unplayed yet":n==="series"||n==="movie"?"Unwatched yet":n==="buecher"?"Unread yet":"Unconsumed yet"}},getWatchlistReleaseStatusClass(){if(!this.item.release)return"";const i=new Date(this.item.release),t=new Date;t.setHours(0,0,0,0),i.setHours(0,0,0,0);const o=i.getTime()-t.getTime(),e=Math.ceil(o/(1e3*3600*24));return e>0?"countdown":e===0?"released-today":"unconsumed"},getTypeTagText(){var t,o,e;const i=this.item.watchlistType||this.item.watchlist_type;if(i)return i.charAt(0).toUpperCase()+i.slice(1);if(this.item.genre){const n=this.item.genre.toLowerCase();if(n.includes("game")||n.includes("gaming")||(t=this.item.platforms)!=null&&t.toLowerCase().includes("steam")||(o=this.item.platforms)!=null&&o.toLowerCase().includes("ps")||(e=this.item.platforms)!=null&&e.toLowerCase().includes("xbox"))return"Game";if(n.includes("series")||n.includes("tv")||n.includes("episode")||this.item.isAiring)return"Series";if(n.includes("movie")||n.includes("film")||n.includes("cinema"))return"Movie";if(n.includes("book")||n.includes("literature")||n.includes("novel")||n.includes("author"))return"BÃ¼cher"}if(this.item.platforms){const n=this.item.platforms.toLowerCase();if(n.includes("steam")||n.includes("ps")||n.includes("xbox")||n.includes("nintendo")||n.includes("pc"))return"Game";if(n.includes("netflix")||n.includes("hulu")||n.includes("disney")||n.includes("hbo"))return"Series";if(n.includes("cinema")||n.includes("theater"))return"Movie";if(n.includes("book")||n.includes("kindle")||n.includes("audible")||n.includes("author"))return"BÃ¼cher"}return"Media"},getTypeTagClass(){return`type-${this.getTypeTagText().toLowerCase()}`},getNextSeasonCountdown(){if(!this.item.nextSeasonRelease)return"";const i=new Date(this.item.nextSeasonRelease),t=new Date;t.setHours(0,0,0,0),i.setHours(0,0,0,0);const o=i.getTime()-t.getTime(),e=Math.ceil(o/(1e3*3600*24));return e>0?e===1?"Tomorrow!":e<=7?`${e} days`:e<=30?`${e} days`:`${Math.ceil(e/30)} months`:e===0?"Today!":"Released"},getCategoryClass(){var t;const i=(t=this.item.category)==null?void 0:t.toLowerCase();return i==="movies"||i==="movie"?"category-movies":i==="books"||i==="buecher"?"category-books":i==="series"||i==="tv"?"category-series":i==="games"||i==="game"?"category-games":"category-default"},getCategoryIcon(){var t;const i=(t=this.item.category)==null?void 0:t.toLowerCase();return i==="movies"||i==="movie"?"ðŸŽ¬":i==="books"||i==="buecher"?"ðŸ“š":i==="series"||i==="tv"?"ðŸ“º":i==="games"||i==="game"?"ðŸŽ®":"ðŸ“"},getCategoryStyle(){var t;const i=(t=this.item.category)==null?void 0:t.toLowerCase();if(i==="games"||i==="game"){const o=this.item.rating||0;return this.getGameStyleByRating(o)}return{}},getGameStyleByRating(i){return i>=4.5?{"--game-primary":"#ffd700","--game-secondary":"#ffed4e","--game-accent":"#ff6b35","--game-glow":"0 0 20px rgba(255, 215, 0, 0.6)","--game-border":"3px solid #ffd700"}:i>=4?{"--game-primary":"#00d4ff","--game-secondary":"#4a9eff","--game-accent":"#00ff88","--game-glow":"0 0 15px rgba(0, 212, 255, 0.5)","--game-border":"3px solid #00d4ff"}:i>=3.5?{"--game-primary":"#00ff88","--game-secondary":"#4caf50","--game-accent":"#8bc34a","--game-glow":"0 0 12px rgba(0, 255, 136, 0.4)","--game-border":"3px solid #00ff88"}:i>=3?{"--game-primary":"#ff9800","--game-secondary":"#ffc107","--game-accent":"#ff5722","--game-glow":"0 0 10px rgba(255, 152, 0, 0.3)","--game-border":"3px solid #ff9800"}:i>=2?{"--game-primary":"#ff5722","--game-secondary":"#f44336","--game-accent":"#d32f2f","--game-glow":"0 0 8px rgba(255, 87, 34, 0.3)","--game-border":"3px solid #ff5722"}:{"--game-primary":"#9e9e9e","--game-secondary":"#757575","--game-accent":"#616161","--game-glow":"0 0 5px rgba(158, 158, 158, 0.2)","--game-border":"3px solid #9e9e9e"}}}},pt={class:"media-image"},ht=["src","alt"],vt={key:1,class:"no-image"},yt={class:"no-image-icon"},bt={class:"media-info"},kt={class:"media-title"},wt={class:"media-meta"},St={key:0,class:"media-release"},_t={key:1},It={key:1,class:"media-rating"},Ct={key:0,class:"media-platforms"},At={key:1,class:"media-genre"},xt={key:2,class:"media-description"},Tt={key:3,class:"media-airing"},Mt={key:0,class:"next-season"},Rt={key:1,class:"countdown"},Pt={key:4,class:"watchlist-type-tag"};function Bt(i,t,o,e,n,c){return g(),m("div",{class:Y(["media-item",c.getCategoryClass()]),style:ve(c.getCategoryStyle()),onClick:t[1]||(t[1]=(...r)=>c.editItem&&c.editItem(...r))},[s("div",pt,[o.item.image_url||o.item.path?(g(),m("img",{key:0,src:c.getImageUrl(o.item.image_url||o.item.path),alt:o.item.title,onError:t[0]||(t[0]=(...r)=>c.handleImageError&&c.handleImageError(...r))},null,40,ht)):(g(),m("div",vt,[s("span",yt,f(c.getCategoryIcon()),1)]))]),s("div",bt,[s("h3",kt,f(o.item.title),1),s("div",wt,[o.item.release?(g(),m("span",St,[c.isWatchlistItem&&o.item.release?(g(),m("span",{key:0,class:Y(c.getWatchlistReleaseStatusClass())},f(c.getWatchlistReleaseStatus()),3)):(g(),m("span",_t,f(c.formatDate(o.item.release)),1))])):p("",!0),o.item.rating?(g(),m("span",It,f("â˜…".repeat(Math.max(0,Math.min(5,Math.floor(o.item.rating)))))+f("â˜†".repeat(Math.max(0,5-Math.max(0,Math.min(5,Math.floor(o.item.rating)))))),1)):p("",!0)]),o.item.platforms?(g(),m("div",Ct,f(o.item.platforms),1)):p("",!0),o.item.genre?(g(),m("div",At,f(o.item.genre),1)):p("",!0),o.item.description?(g(),m("div",xt,f(o.item.description),1)):p("",!0),o.item.isAiring?(g(),m("div",Tt,[t[2]||(t[2]=s("span",{class:"airing-badge"},[s("span",{class:"airing-dot"}),Se(" Airing ")],-1)),o.item.nextSeason?(g(),m("span",Mt,"S"+f(o.item.nextSeason),1)):p("",!0),o.item.nextSeasonRelease?(g(),m("span",Rt,f(c.getNextSeasonCountdown()),1)):p("",!0)])):p("",!0),c.showWatchlistTag?(g(),m("div",Pt,[s("span",{class:Y(["type-tag",c.getTypeTagClass()])},f(c.getTypeTagText()),3)])):p("",!0)]),t[3]||(t[3]=s("div",{class:"edit-indicator"},[s("span",{class:"edit-icon"},"âœï¸")],-1))],6)}const Ut=oe(ft,[["render",Bt],["__scopeId","data-v-7f8132ab"]]),Dt={name:"FloatingActionButton",props:{showMenu:{type:Boolean,default:!1},showDeleteAll:{type:Boolean,default:!1},categoryName:{type:String,default:""},itemCount:{type:Number,default:0}},emits:["toggleMenu","addNewItem","bulkAddItems","importFromTxt","importFromAPI","createCollection","deleteAllInCategory"]},Et={class:"floating-actions"},Ft={class:"menu-text"},Lt={class:"item-count-badge"};function Nt(i,t,o,e,n,c){return g(),m("div",Et,[s("div",{class:Y(["floating-menu",{show:o.showMenu}])},[s("button",{class:"floating-menu-item",onClick:t[0]||(t[0]=r=>i.$emit("addNewItem"))},[...t[7]||(t[7]=[s("span",{class:"menu-icon"},"âž•",-1),s("span",{class:"menu-text"},"Add Item",-1)])]),s("button",{class:"floating-menu-item",onClick:t[1]||(t[1]=r=>i.$emit("bulkAddItems"))},[...t[8]||(t[8]=[s("span",{class:"menu-icon"},"ðŸ“¦",-1),s("span",{class:"menu-text"},"Bulk Add",-1)])]),s("button",{class:"floating-menu-item",onClick:t[2]||(t[2]=r=>i.$emit("importFromTxt"))},[...t[9]||(t[9]=[s("span",{class:"menu-icon"},"ðŸ“„",-1),s("span",{class:"menu-text"},"Import from TXT",-1)])]),s("button",{class:"floating-menu-item",onClick:t[3]||(t[3]=r=>i.$emit("importFromAPI"))},[...t[10]||(t[10]=[s("span",{class:"menu-icon"},"ðŸŒ",-1),s("span",{class:"menu-text"},"Import from API",-1)])]),s("button",{class:"floating-menu-item",onClick:t[4]||(t[4]=r=>i.$emit("createCollection"))},[...t[11]||(t[11]=[s("span",{class:"menu-icon"},"ðŸ“š",-1),s("span",{class:"menu-text"},"Create Collection",-1)])]),o.showDeleteAll&&o.itemCount>0?(g(),m("button",{key:0,class:"floating-menu-item delete-all-item",onClick:t[5]||(t[5]=r=>i.$emit("deleteAllInCategory"))},[t[12]||(t[12]=s("span",{class:"menu-icon"},"ðŸ—‘ï¸",-1)),s("span",Ft,"Delete All "+f(o.categoryName),1),s("span",Lt,"("+f(o.itemCount)+")",1)])):p("",!0)],2),s("button",{class:"floating-add-btn",onClick:t[6]||(t[6]=r=>i.$emit("toggleMenu"))},f(o.showMenu?"âœ•":"+"),1)])}const Wt=oe(Dt,[["render",Nt],["__scopeId","data-v-19731834"]]),Qe="http://127.0.0.1:8000/api",Gt={async getConfig(){try{console.log("ðŸ“š Simple Google Books - Getting config...");const i=await fetch(`${Qe}/google-books-config`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const t=await i.json();return console.log("ðŸ“š Simple Google Books - Config loaded:",t),t}catch(i){throw console.error("ðŸ“š Simple Google Books - Config failed:",i),i}},async searchBooks(i,t=10){try{console.log("ðŸ“š Simple Google Books - Searching:",i);const o=await fetch(`${Qe}/google-books/search?q=${encodeURIComponent(i)}&maxResults=${t}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const e=await o.json();return console.log("ðŸ“š Simple Google Books - Search success:",e),e}catch(o){throw console.error("ðŸ“š Simple Google Books - Search failed:",o),o}}},Vt=!1,zt=!0,jt="production",Ot={production:{apiUrl:"https://teabubble.attrebi.ch",apiBaseUrl:"https://teabubble.attrebi.ch/api",googleBooksUrl:"https://teabubble.attrebi.ch/api/google-books",debug:!1}};function Ht(){return Ot.production}const Ue=Ht();Ue.debug&&console.log("ðŸ”§ [Environment] Configuration loaded:",{mode:jt,isDevelopment:Vt,isProduction:zt,apiUrl:Ue.apiUrl,apiBaseUrl:Ue.apiBaseUrl,googleBooksUrl:Ue.googleBooksUrl});class qt{constructor(){this.baseUrl="https://en.wikipedia.org/w/api.php",this.timeout=1e4,this.maxResults=10}async searchBooks(t,o=10){if(console.log("ðŸ“š [Wikipedia] Searching books:",{query:t,maxResults:o}),!t||typeof t!="string"||t.trim().length===0)return console.warn("ðŸ“š [Wikipedia] Invalid query provided"),{success:!1,error:"Search query is required",data:[]};try{const e=await this.searchPages(t,o);if(!e.success||e.data.length===0)return{success:!1,error:"No results found",data:[]};const n=await this.getPageDetails(e.data),c=this.filterAndFormatBookResults(n);return console.log("ðŸ“š [Wikipedia] Search completed:",{totalResults:n.length,bookResults:c.length}),{success:!0,data:c,source:"wikipedia"}}catch(e){return console.error("ðŸ“š [Wikipedia] Search failed:",e),{success:!1,error:`Search failed: ${e.message}`,data:[]}}}async searchPages(t,o){var n;const e=new URLSearchParams({action:"query",format:"json",list:"search",srsearch:`${t} book novel`,srnamespace:0,srlimit:o,srprop:"snippet|timestamp",origin:"*"});try{const c=await fetch(`${this.baseUrl}?${e}`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout)});if(!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);const r=await c.json();if(r.error)throw new Error(r.error.info||"Wikipedia API error");return{success:!0,data:(((n=r.query)==null?void 0:n.search)||[]).map(a=>({pageid:a.pageid,title:a.title,snippet:a.snippet,timestamp:a.timestamp}))}}catch(c){return console.error("ðŸ“š [Wikipedia] Page search failed:",c),{success:!1,error:c.message,data:[]}}}async getPageDetails(t){var n;if(!t||t.length===0)return[];const o=t.map(c=>c.pageid).join("|"),e=new URLSearchParams({action:"query",format:"json",pageids:o,prop:"extracts|pageimages|info",exintro:"true",explaintext:"true",exsectionformat:"plain",piprop:"thumbnail|original",pithumbsize:300,pilimit:1,inprop:"url",origin:"*"});try{const c=await fetch(`${this.baseUrl}?${e}`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout)});if(!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);const r=await c.json();if(r.error)throw new Error(r.error.info||"Wikipedia API error");const l=((n=r.query)==null?void 0:n.pages)||{};return Object.values(l).map(a=>{var v;return{pageid:a.pageid,title:a.title,extract:a.extract||"",thumbnail:((v=a.thumbnail)==null?void 0:v.source)||null,fullurl:a.fullurl||null,canonicalurl:a.canonicalurl||null}})}catch(c){return console.error("ðŸ“š [Wikipedia] Page details failed:",c),[]}}filterAndFormatBookResults(t){const o=["book","novel","fiction","non-fiction","author","published","publisher","isbn","literature","story","chapter","edition","written by","series","trilogy","saga","collection","anthology"];return t.filter(e=>{const n=(e.extract||"").toLowerCase(),c=(e.title||"").toLowerCase(),r=o.some(v=>n.includes(v)||c.includes(v)),a=["book","novel","story","tale","chronicles","saga","trilogy"].some(v=>c.includes(v));return r||a}).map(e=>{const n=e.extract||"",c=e.title||"",r=n.match(/written by[^,.\n]*?([A-Z][^,.\n]*?[A-Z][^,.\n]*?)(?:\s|\.|,|$)/i),l=n.match(/(\d{4})/),a=n.match(/(?:published by|publisher)\s+([^,.\n]+)/i);let v="";if(r&&(v=r[1].trim().replace(/^(British|American|German|French|Spanish|Italian)\s+(?:author|writer|novelist)?\s*/i,""),v.includes("author")||v.includes("writer"))){const C=v.match(/([A-Z][^,.\n]*?[A-Z][^,.\n]*?)(?:\s|\.|,|$)/);v=C?C[1].trim():v}if(!v){const T=n.match(/(?:by|author|written by)\s+([A-Z][^,.\n]*?[A-Z][^,.\n]*?)(?:\s|\.|,|$)/i);T&&(v=T[1].trim().replace(/^(British|American|German|French|Spanish|Italian)\s+(?:author|writer|novelist)?\s*/i,""))}return{id:`wikipedia_${e.pageid}`,title:c,author:v,description:n.substring(0,300)+(n.length>300?"...":""),publishedDate:l?l[1]:"",publisher:a?a[1].trim():"",imageUrl:e.thumbnail||null,link:e.fullurl||e.canonicalurl||"",apiSource:"wikipedia",snippet:n.substring(0,150)+(n.length>150?"...":""),categories:this.extractCategories(n)}}).slice(0,this.maxResults)}extractCategories(t){const o=[],e=t.toLowerCase();return e.includes("fiction")&&o.push("Fiction"),(e.includes("non-fiction")||e.includes("nonfiction"))&&o.push("Non-Fiction"),e.includes("novel")&&o.push("Novel"),e.includes("biography")&&o.push("Biography"),e.includes("history")&&o.push("History"),e.includes("science")&&o.push("Science"),e.includes("philosophy")&&o.push("Philosophy"),e.includes("poetry")&&o.push("Poetry"),e.includes("drama")&&o.push("Drama"),e.includes("mystery")&&o.push("Mystery"),e.includes("romance")&&o.push("Romance"),e.includes("fantasy")&&o.push("Fantasy"),(e.includes("science fiction")||e.includes("sci-fi"))&&o.push("Science Fiction"),e.includes("thriller")&&o.push("Thriller"),e.includes("horror")&&o.push("Horror"),o}async getBookById(t){var o,e;try{const n=new URLSearchParams({action:"query",format:"json",pageids:t,prop:"extracts|pageimages|info",exintro:"true",explaintext:"true",piprop:"thumbnail",pithumbsize:300,inprop:"url",origin:"*"}),c=await fetch(`${this.baseUrl}?${n}`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout)});if(!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);const r=await c.json(),l=Object.values(((o=r.query)==null?void 0:o.pages)||{})[0];if(!l)throw new Error("Page not found");return{success:!0,data:{id:`wikipedia_${l.pageid}`,title:l.title,description:l.extract||"",imageUrl:((e=l.thumbnail)==null?void 0:e.source)||null,link:l.fullurl||l.canonicalurl||"",apiSource:"wikipedia"}}}catch(n){return console.error("ðŸ“š [Wikipedia] Get book by ID failed:",n),{success:!1,error:n.message,data:null}}}}const Jt=new qt;class Kt{constructor(){this.wikipediaService=Jt,this.googleBooksService=Gt}getUserPreferences(){try{const t=localStorage.getItem("profileData");if(t){const o=JSON.parse(t);return{booksApiProvider:o.booksApiProvider||"wikipedia",enableGoogleBooksFallback:o.enableGoogleBooksFallback!==!1}}}catch(t){console.warn("Failed to load user preferences:",t)}return{booksApiProvider:"wikipedia",enableGoogleBooksFallback:!0}}async searchBooks(t,o=10){console.log("ðŸ“š [UnifiedBooks] Starting search:",{query:t,maxResults:o});const e=this.getUserPreferences();if(console.log("ðŸ“š [UnifiedBooks] User preferences:",e),!t||typeof t!="string"||t.trim().length===0)return{success:!1,error:"Search query is required",data:[]};try{let n=[],c="",r=!1;switch(e.booksApiProvider){case"wikipedia":n=await this.searchWithWikipediaFirst(t,o,e),c="wikipedia";break;case"google_books":n=await this.searchWithGoogleBooksFirst(t,o,e),c="google_books";break;case"both":n=await this.searchWithBothApis(t,o,e),c="both";break;default:n=await this.searchWithWikipediaFirst(t,o,e),c="wikipedia"}return console.log("ðŸ“š [UnifiedBooks] Search completed:",{totalResults:n.length,primarySource:c,fallbackUsed:r}),{success:!0,data:n,source:c,fallbackUsed:r}}catch(n){return console.error("ðŸ“š [UnifiedBooks] Search failed:",n),{success:!1,error:`Search failed: ${n.message}`,data:[]}}}async searchWithWikipediaFirst(t,o,e){console.log("ðŸ“š [UnifiedBooks] Searching Wikipedia first...");const n=await this.wikipediaService.searchBooks(t,o);if(n.success&&n.data.length>0)return console.log("ðŸ“š [UnifiedBooks] Wikipedia search successful:",n.data.length,"results"),n.data;if(e.enableGoogleBooksFallback){console.log("ðŸ“š [UnifiedBooks] Wikipedia failed, trying Google Books fallback...");const c=await this.googleBooksService.searchBooks(t,o);if(c.success&&c.data.length>0)return console.log("ðŸ“š [UnifiedBooks] Google Books fallback successful:",c.data.length,"results"),c.data}return console.log("ðŸ“š [UnifiedBooks] All searches failed"),[]}async searchWithGoogleBooksFirst(t,o,e){console.log("ðŸ“š [UnifiedBooks] Searching Google Books first...");const n=await this.googleBooksService.searchBooks(t,o);if(n.success&&n.data.length>0)return console.log("ðŸ“š [UnifiedBooks] Google Books search successful:",n.data.length,"results"),n.data;if(e.enableGoogleBooksFallback){console.log("ðŸ“š [UnifiedBooks] Google Books failed, trying Wikipedia fallback...");const c=await this.wikipediaService.searchBooks(t,o);if(c.success&&c.data.length>0)return console.log("ðŸ“š [UnifiedBooks] Wikipedia fallback successful:",c.data.length,"results"),c.data}return console.log("ðŸ“š [UnifiedBooks] All searches failed"),[]}async searchWithBothApis(t,o,e){console.log("ðŸ“š [UnifiedBooks] Searching both APIs...");const[n,c]=await Promise.allSettled([this.wikipediaService.searchBooks(t,Math.ceil(o/2)),this.googleBooksService.searchBooks(t,Math.ceil(o/2))]);let r=[];return n.status==="fulfilled"&&n.value.success&&(r=r.concat(n.value.data),console.log("ðŸ“š [UnifiedBooks] Wikipedia results:",n.value.data.length)),c.status==="fulfilled"&&c.value.success&&(r=r.concat(c.value.data),console.log("ðŸ“š [UnifiedBooks] Google Books results:",c.value.data.length)),r=this.removeDuplicateResults(r),r=r.slice(0,o),console.log("ðŸ“š [UnifiedBooks] Combined results:",r.length),r}removeDuplicateResults(t){const o=new Set,e=[];for(const n of t){const c=n.title.toLowerCase().replace(/[^\w\s]/g,"").trim();o.has(c)||(o.add(c),e.push(n))}return e}async getBookById(t){if(t.startsWith("wikipedia_")){const o=t.replace("wikipedia_","");return await this.wikipediaService.getBookById(o)}else return await this.googleBooksService.getBookById(t)}getApiStatus(){const t=this.getUserPreferences();return{primaryProvider:t.booksApiProvider,fallbackEnabled:t.enableGoogleBooksFallback,availableProviders:["wikipedia","google_books"],wikipediaAvailable:!0,googleBooksAvailable:!0}}}const ze=new Kt,Qt={name:"BooksApiControlPanel",props:{expanded:{type:Boolean,default:!1}},emits:["preferences-changed"],setup(i,{emit:t}){const o=y(i.expanded),e=y(!1),n=y(null),c=y("checking"),r=Oe({booksApiProvider:"wikipedia",enableGoogleBooksFallback:!0}),l=()=>{o.value=!o.value},a=()=>{try{const w=localStorage.getItem("profileData");if(w){const R=JSON.parse(w);r.booksApiProvider=R.booksApiProvider||"wikipedia",r.enableGoogleBooksFallback=R.enableGoogleBooksFallback!==!1}}catch(w){console.warn("Failed to load preferences:",w)}},v=()=>{try{const w=localStorage.getItem("profileData"),R=w?JSON.parse(w):{};R.booksApiProvider=r.booksApiProvider,R.enableGoogleBooksFallback=r.enableGoogleBooksFallback,localStorage.setItem("profileData",JSON.stringify(R)),t("preferences-changed",{...r}),console.log("ðŸ“š [ControlPanel] Preferences updated:",r)}catch(w){console.error("Failed to save preferences:",w)}},T=async()=>{e.value=!0,n.value=null;try{const w=await ze.searchBooks("Harry Potter",3);w.success&&w.data.length>0?n.value={success:!0,message:`âœ… Found ${w.data.length} results using ${w.source}`}:n.value={success:!1,message:`âŒ No results found: ${w.error||"Unknown error"}`}}catch(w){n.value={success:!1,message:`âŒ Test failed: ${w.message}`}}finally{e.value=!1}},C=async()=>{try{const w=await ze.getApiStatus();c.value=w.googleBooksAvailable?"available":"unavailable"}catch{c.value="unavailable"}};return Xe(()=>{a(),C()}),{isExpanded:o,localPreferences:r,testing:e,testResult:n,googleBooksStatus:c,toggleExpanded:l,updatePreferences:v,testSearch:T}}},Zt={class:"books-api-control-panel"},Xt={class:"control-header"},Yt={key:0,class:"control-content"},$t={class:"form-group"},es={class:"form-group"},ts={class:"checkbox-container"},ss={class:"api-status"},os={class:"status-item"},as={class:"search-preview"},is=["disabled"];function ns(i,t,o,e,n,c){return g(),m("div",Zt,[s("div",Xt,[t[6]||(t[6]=s("h4",null,"ðŸ“š Books API Settings",-1)),s("button",{class:Y(["toggle-btn",{expanded:e.isExpanded}]),onClick:t[0]||(t[0]=(...r)=>e.toggleExpanded&&e.toggleExpanded(...r))},f(e.isExpanded?"â–¼":"â–¶"),3)]),e.isExpanded?(g(),m("div",Yt,[s("div",$t,[t[8]||(t[8]=s("label",{for:"apiProvider"},"Primary API Provider:",-1)),U(s("select",{id:"apiProvider","onUpdate:modelValue":t[1]||(t[1]=r=>e.localPreferences.booksApiProvider=r),onChange:t[2]||(t[2]=(...r)=>e.updatePreferences&&e.updatePreferences(...r))},[...t[7]||(t[7]=[s("option",{value:"wikipedia"},"Wikipedia (Recommended)",-1),s("option",{value:"google_books"},"Google Books",-1),s("option",{value:"both"},"Both APIs",-1)])],544),[[Ie,e.localPreferences.booksApiProvider]]),t[9]||(t[9]=s("div",{class:"field-hint"}," Choose your primary source for book information ",-1))]),s("div",es,[s("div",ts,[U(s("input",{type:"checkbox",id:"enableFallback","onUpdate:modelValue":t[3]||(t[3]=r=>e.localPreferences.enableGoogleBooksFallback=r),onChange:t[4]||(t[4]=(...r)=>e.updatePreferences&&e.updatePreferences(...r))},null,544),[[at,e.localPreferences.enableGoogleBooksFallback]]),t[10]||(t[10]=s("label",{for:"enableFallback",class:"checkbox-label"}," Enable Google Books Fallback ",-1))]),t[11]||(t[11]=s("div",{class:"field-hint"}," Use Google Books when primary API fails ",-1))]),s("div",ss,[t[13]||(t[13]=s("div",{class:"status-item"},[s("span",{class:"status-label"},"Wikipedia:"),s("span",{class:"status-value available"},"âœ… Available")],-1)),s("div",os,[t[12]||(t[12]=s("span",{class:"status-label"},"Google Books:",-1)),s("span",{class:Y(["status-value",e.googleBooksStatus])},f(e.googleBooksStatus==="available"?"âœ… Available":"âš ï¸ Check API Key"),3)])]),s("div",as,[s("button",{class:"test-search-btn",onClick:t[5]||(t[5]=(...r)=>e.testSearch&&e.testSearch(...r)),disabled:e.testing},f(e.testing?"Testing...":"Test Search"),9,is),e.testResult?(g(),m("div",{key:0,class:Y(["test-result",e.testResult.success?"success":"error"])},f(e.testResult.message),3)):p("",!0)])])):p("",!0)])}const rs=oe(Qt,[["render",ns],["__scopeId","data-v-e996a693"]]),ls={name:"EditModal",components:{BooksApiControlPanel:rs},props:{item:{type:Object,default:null},currentCategory:{type:String,default:"watchlist"}},emits:["close","save","delete"],setup(i,{emit:t}){const o=y(!1),e=y(""),n=y([]),c=y(null),r=y(null),l=y(""),a=Oe({category:"watchlist",title:"",release:"",apiRating:"",personalRating:"",count:"",platforms:"",genre:"",description:"",link:"",path:"",discovered:"",spielzeit:"",isAiring:!1,nextSeason:"",nextSeasonRelease:"",imageUrl:"",watchlistType:"",imageCleared:!1}),v=V(()=>!!i.item),T=V(()=>a.category==="game"),C=V(()=>a.category==="series"),w=V(()=>a.category==="watchlist");De(()=>i.item,d=>{d?(console.log("EditModal - Loading item data:",d),console.log("EditModal - Item rating:",d.rating),console.log("EditModal - Item personal_rating:",d.personal_rating),Object.keys(a).forEach(k=>{a[k]=d[k]||""}),d.watchlist_type!==void 0&&(a.watchlistType=d.watchlist_type),d.is_airing!==void 0&&(a.isAiring=d.is_airing),d.next_season!==void 0&&(a.nextSeason=d.next_season),d.next_season_release!==void 0&&(a.nextSeasonRelease=d.next_season_release),d.api_rating!==void 0&&(a.apiRating=d.api_rating),d.personal_rating!==void 0&&(a.personalRating=d.personal_rating),d.description!==void 0&&(a.description=d.description),d.image_url!==void 0&&(a.imageUrl=d.image_url),d.path!==void 0&&(a.path=d.path),d.rating!==void 0&&!a.personalRating&&(a.personalRating=d.rating),console.log("EditModal - Form after initialization:"),console.log("EditModal - form.personalRating:",a.personalRating),console.log("EditModal - form.rating:",a.rating)):Object.keys(a).forEach(k=>{k==="category"?a[k]=i.currentCategory||"watchlist":k==="release"?a[k]=new Date().toISOString().split("T")[0]:a[k]=""})},{immediate:!0}),De(()=>i.currentCategory,d=>{!i.item&&d&&(a.category=d)});const R=async()=>{var d,k,I;if(!a.title){e.value="Title is required";return}if(a.category==="watchlist"&&!a.watchlistType){e.value="Please select a type for watchlist items";return}if(a.category==="watchlist"&&!a.release){e.value="Release date is required for watchlist items";return}o.value=!0,e.value="";try{const u={...a};Object.keys(u).forEach(A=>{u[A]===""&&A!=="watchlistType"&&A!=="imageUrl"&&A!=="path"&&(u[A]=null)}),l.value?(u.path=l.value,u.imageUrl=l.value):u.imageUrl&&u.imageUrl.trim()?u.path=u.imageUrl:v.value&&i.item?i.item.image_url?(u.imageUrl=i.item.image_url,u.path=i.item.path||i.item.image_url):i.item.path&&(u.path=i.item.path,u.imageUrl=i.item.path):(u.imageUrl=null,u.path=null),u.apiRating!==void 0&&u.apiRating!==null&&u.apiRating!==""&&(u.apiRating=parseFloat(u.apiRating)),u.personalRating!==void 0&&u.personalRating!==null&&u.personalRating!==""&&(u.personalRating=parseFloat(u.personalRating)),u.count!==void 0&&u.count!==null&&u.count!==""&&(u.count=parseInt(u.count)),u.spielzeit!==void 0&&u.spielzeit!==null&&u.spielzeit!==""&&(u.spielzeit=parseInt(u.spielzeit)),u.nextSeason!==void 0&&u.nextSeason!==null&&u.nextSeason!==""&&(u.nextSeason=parseInt(u.nextSeason)),u.watchlistType&&(u.watchlist_type=u.watchlistType,delete u.watchlistType),u.isAiring!==void 0&&(u.is_airing=u.isAiring,delete u.isAiring),u.nextSeason&&(u.next_season=u.nextSeason,delete u.nextSeason),u.nextSeasonRelease&&(u.next_season_release=u.nextSeasonRelease,delete u.nextSeasonRelease),u.personalRating!==void 0?(u.rating=u.personalRating,delete u.personalRating):u.apiRating!==void 0&&(u.rating=u.apiRating,delete u.apiRating),u.imageUrl&&(u.image_url=u.imageUrl,delete u.imageUrl),console.log("EditModal - Saving item data:",u),console.log("EditModal - personalRating value:",u.personalRating),console.log("EditModal - rating value:",u.rating),v.value&&i.item?await _e.updateMediaItem(i.item.id,u):await _e.addMediaItem(u),Q()}catch(u){u.isDuplicate||((d=u.response)==null?void 0:d.status)===409&&((I=(k=u.response)==null?void 0:k.data)!=null&&I.duplicate)?e.value="Ein Eintrag mit diesem Titel und dieser Kategorie existiert bereits. Bitte wÃ¤hlen Sie einen anderen Titel oder bearbeiten Sie den bestehenden Eintrag.":e.value=u.message||"Failed to save item"}finally{o.value=!1}},Q=()=>{e.value="",t("close")},$=()=>{t("delete",i.item),Q()},F=async()=>{if(l.value){n.value=[];return}if(c.value&&clearTimeout(c.value),!a.title||a.title.length<3){n.value=[];return}c.value=setTimeout(async()=>{try{console.log("ðŸ” EditModal API Search:",{title:a.title,category:a.category,watchlistType:a.watchlistType});const d=a.category==="watchlist"?a.watchlistType:a.category;if(a.category==="watchlist"&&!a.watchlistType){n.value=[];return}let k=[],I=[];if(d==="buecher"){console.log("ðŸ“š Searching Unified Books API for:",a.title);const u=await ze.searchBooks(a.title,10);u.success&&u.data?(console.log("ðŸ“š Unified Books API Success:",u.data.length,"results from",u.source),I=u.data.map(A=>({title:A.title,release:A.publishedDate?ie(A.publishedDate):"",genre:A.categories?A.categories.join(", "):"",platforms:A.author||"",link:A.link||"",imageUrl:A.imageUrl||"",rating:"",apiSource:A.apiSource||u.source,id:A.id,author:A.author,description:A.description,publisher:A.publisher,isbn10:A.isbn10,isbn13:A.isbn13})),console.log("ðŸ“š Formatted Unified Books results:",I)):console.warn("ðŸ“š Unified Books API failed:",u.error)}else console.log("ðŸŽ¬ Searching Media API for:",a.title,"category:",d),k=await _e.searchApi(a.title,d,10),k&&k.length>0&&(I=k.map(u=>({title:u.title,release:u.release,genre:u.genre||"",description:u.overview||"",platforms:u.platforms||"",link:u.link||"",imageUrl:u.image||"",rating:u.rating||"",apiSource:u.api_source||"",id:u.id||""})));I.length>0?(console.log("âœ… API Search Results:",I.length,"items found"),n.value=I):(console.log("âŒ No API results found"),n.value=[{title:`"${a.title}" - Keine Ergebnisse gefunden`,release:"",genre:"Bitte manuell ausfÃ¼llen",isPlaceholder:!0}])}catch(d){console.error("âŒ API search failed:",d),n.value=[{title:`"${a.title}" - API nicht verfÃ¼gbar`,release:"",genre:"Bitte manuell ausfÃ¼llen",isPlaceholder:!0}]}},500)},ae=async d=>{if(d.isPlaceholder){n.value=[];return}if(console.log("ðŸ“š Selecting API result:",{title:d.title,apiSource:d.apiSource,author:d.author}),a.title=d.title,d.release&&(a.release=d.release),d.platforms&&(a.platforms=d.platforms),d.genre&&(a.genre=d.genre),d.description&&(a.description=d.description),d.link&&(a.link=d.link),d.rating&&(a.apiRating=d.rating),(d.apiSource==="google_books"||d.apiSource==="wikipedia")&&(console.log("ðŸ“š Filling Books API data:",{apiSource:d.apiSource,author:d.author,description:d.description,publisher:d.publisher,isbn10:d.isbn10,isbn13:d.isbn13}),d.author&&(a.platforms=d.author),d.publisher)){const k=a.link||"";a.link=k||`Publisher: ${d.publisher}`}d.imageUrl?(a.imageUrl=d.imageUrl,a.path=d.imageUrl):(a.imageUrl="",a.path=""),n.value=[]},le=d=>d?new Date(d).toLocaleDateString():"",ie=d=>{if(!d)return"";let k;if(typeof d=="string"){if(/^\d{4}$/.test(d))return`${d}-01-01`;if(/^\d{4}-\d{2}$/.test(d))return`${d}-01`;if(/^\d{4}-\d{2}-\d{2}$/.test(d))return d;k=new Date(d)}else k=new Date(d);return isNaN(k.getTime())?(console.warn("ðŸ“š Invalid date format:",d),""):k.toISOString().split("T")[0]};return{form:a,loading:o,error:e,apiResults:n,isEditing:v,isGame:T,isSeries:C,isWatchlist:w,imageUploadRef:r,uploadedImagePath:l,handleSave:R,closeModal:Q,deleteItem:$,searchApi:F,selectApiResult:ae,formatDate:le,formatDateForInput:ie,ensureHttpsUrl:d=>d&&(d.startsWith("http://")?d.replace("http://","https://"):d),getReleasePreview:()=>{var A;if(!a.release)return"";const d=new Date(a.release),k=new Date;k.setHours(0,0,0,0),d.setHours(0,0,0,0);const I=d.getTime()-k.getTime(),u=Math.ceil(I/(1e3*3600*24));if(u>0)return u===1?"Tomorrow!":u<=7?`${u} days left`:u<=30?`${u} days left`:`${Math.ceil(u/30)} months left`;if(u===0)return"Released today!";{const K=((A=a.watchlistType)==null?void 0:A.toLowerCase())||"media";return K==="game"?"Unplayed yet":K==="series"||K==="movie"?"Unwatched yet":"Unconsumed yet"}},triggerImageUpload:()=>{var d;(d=r.value)==null||d.click()},handleImageUpload:async d=>{const k=d.target.files[0];if(k){if(!k.type.startsWith("image/")){e.value="Please select a valid image file";return}if(k.size>10*1024*1024){e.value="Image file too large. Maximum size is 10MB";return}o.value=!0,e.value="";try{const I=a.title.replace(/[^a-zA-Z0-9\s\-_\.]/g,"").trim()||"item",u=Date.now(),A=k.name.split(".").pop()||"jpg",K=`images_downloads/uploads/${I}_${u}.${A}`,ne=await _e.uploadImage(k,K);ne.success?(l.value=ne.saved,a.path=ne.saved,a.imageUrl=ne.saved):e.value=ne.error||"Failed to upload image"}catch(I){e.value=I.message||"Failed to upload image"}finally{o.value=!1}}},getImagePreviewUrl:()=>l.value?`/storage/${l.value}`:a.imageUrl?a.imageUrl.startsWith("http")?a.imageUrl:`/storage/${a.imageUrl}`:"",handleImageError:d=>{console.warn("Image preview failed:",d.target.src),d.target.style.display="none"},clearImage:()=>{a.imageUrl="",a.path="",l.value="",r.value&&(r.value.value="")},removeUploadedImage:()=>{l.value="",a.imageUrl===l.value&&(a.imageUrl=""),a.path===l.value&&(a.path=""),r.value&&(r.value.value="")},handlePreferencesChanged:d=>{console.log("ðŸ“š [EditModal] Preferences changed:",d),n.value=[]}}}},ds={class:"form-header"},cs={class:"form-group category-group"},us={class:"form-group title-group"},gs={class:"search-container"},ms=["placeholder","disabled"],fs={key:0,class:"search-results"},ps=["onClick"],hs={class:"result-thumbnail"},vs=["src","alt"],ys={key:1,class:"no-image"},bs={class:"result-content"},ks={class:"result-title"},ws={class:"result-meta"},Ss={key:0},_s={key:1},Is={key:2,class:"rating"},Cs={class:"form-row"},As={class:"form-group"},xs={for:"release"},Ts={key:0,class:"required"},Ms=["required"],Rs={key:0,class:"field-hint"},Ps={key:1,class:"release-preview"},Bs={class:"form-group"},Us={class:"form-group"},Ds={class:"form-row"},Es={class:"form-group"},Fs={class:"form-group"},Ls={class:"form-row"},Ns={class:"form-group"},Ws={class:"form-group"},Gs={class:"form-row"},Vs={class:"form-group full-width"},zs={key:0,class:"form-row"},js={class:"form-group"},Os={key:0,class:"field-error"},Hs={class:"form-row"},qs={class:"form-group"},Js={class:"form-group"},Ks={key:2,class:"form-row"},Qs={class:"form-group"},Zs={key:3,class:"form-row"},Xs={class:"form-group"},Ys={key:0,class:"form-group"},$s={key:4,class:"form-row"},eo={class:"form-group"},to={class:"form-row"},so={class:"form-group"},oo={class:"form-group"},ao={class:"image-upload-container"},io=["disabled"],no={key:0,class:"upload-success"},ro={key:5,class:"form-row"},lo={class:"form-group image-preview-group"},co={class:"image-preview"},uo=["src","alt"],go={key:6,class:"error-message"},mo={class:"modal-buttons"},fo=["disabled"],po=["disabled"],ho=["disabled"],vo=["disabled"];function yo(i,t,o,e,n,c){const r=X("BooksApiControlPanel");return g(),m("div",{class:"modal",onClick:t[29]||(t[29]=(...l)=>e.closeModal&&e.closeModal(...l))},[s("div",{class:"modal-content",onClick:t[28]||(t[28]=me(()=>{},["stop"]))},[s("h2",null,f(e.isEditing?"Edit Item":"Add Item"),1),s("form",{onSubmit:t[27]||(t[27]=me((...l)=>e.handleSave&&e.handleSave(...l),["prevent"]))},[s("div",ds,[s("div",cs,[t[31]||(t[31]=s("label",{for:"category"},"Category:",-1)),U(s("select",{id:"category","onUpdate:modelValue":t[0]||(t[0]=l=>e.form.category=l),required:""},[...t[30]||(t[30]=[Ve('<option value="watchlist" data-v-067059a7>Watchlist</option><option value="game" data-v-067059a7>Game</option><option value="series" data-v-067059a7>Series</option><option value="movie" data-v-067059a7>Movie</option><option value="buecher" data-v-067059a7>BÃ¼cher</option>',5)])],512),[[Ie,e.form.category]])]),s("div",us,[t[32]||(t[32]=s("label",{for:"title"},"Title:",-1)),s("div",gs,[U(s("input",{type:"text",id:"title","onUpdate:modelValue":t[1]||(t[1]=l=>e.form.title=l),onInput:t[2]||(t[2]=(...l)=>e.searchApi&&e.searchApi(...l)),required:"",placeholder:e.isWatchlist?"Enter title (API search + manual input available)":"Enter title",disabled:e.loading},null,40,ms),[[G,e.form.title]]),e.apiResults.length>0?(g(),m("div",fs,[(g(!0),m(te,null,se(e.apiResults,l=>(g(),m("div",{key:l.title,class:"search-result-item",onClick:a=>e.selectApiResult(l)},[s("div",hs,[l.imageUrl?(g(),m("img",{key:0,src:e.ensureHttpsUrl(l.imageUrl),alt:l.title},null,8,vs)):(g(),m("div",ys,[s("span",null,f(l.title.charAt(0).toUpperCase()),1)]))]),s("div",bs,[s("div",ks,f(l.title),1),s("div",ws,[l.release?(g(),m("span",Ss,f(e.formatDate(l.release)),1)):p("",!0),l.genre?(g(),m("span",_s,f(l.genre),1)):p("",!0),l.rating?(g(),m("span",Is,"â­ "+f(l.rating),1)):p("",!0)])])],8,ps))),128))])):p("",!0)])])]),s("div",Cs,[s("div",As,[s("label",xs,[Se(f(e.isWatchlist?"Release Date:":"Release:")+" ",1),e.isWatchlist?(g(),m("span",Ts,"*")):p("",!0)]),U(s("input",{type:"date",id:"release","onUpdate:modelValue":t[3]||(t[3]=l=>e.form.release=l),required:e.isWatchlist},null,8,Ms),[[G,e.form.release]]),e.isWatchlist?(g(),m("div",Rs," ðŸ“… Set the release date to track countdown or status ")):p("",!0),e.isWatchlist&&e.form.release?(g(),m("div",Ps,[t[33]||(t[33]=s("strong",null,"Preview:",-1)),Se(" "+f(e.getReleasePreview()),1)])):p("",!0)]),s("div",Bs,[t[34]||(t[34]=s("label",{for:"apiRating"},"API Rating:",-1)),U(s("input",{type:"number",id:"apiRating","onUpdate:modelValue":t[4]||(t[4]=l=>e.form.apiRating=l),step:"0.1",min:"0",max:"10",placeholder:"0-10",readonly:""},null,512),[[G,e.form.apiRating]]),t[35]||(t[35]=s("div",{class:"field-hint"},"From API - read only",-1))]),s("div",Us,[t[36]||(t[36]=s("label",{for:"personalRating"},"Personal Rating:",-1)),U(s("input",{type:"number",id:"personalRating","onUpdate:modelValue":t[5]||(t[5]=l=>e.form.personalRating=l),step:"0.1",min:"0",max:"10",placeholder:"0-10"},null,512),[[G,e.form.personalRating]]),t[37]||(t[37]=s("div",{class:"field-hint"},"Your personal rating",-1))])]),s("div",Ds,[s("div",Es,[t[38]||(t[38]=s("label",{for:"views"},"Views:",-1)),U(s("input",{type:"number",id:"views","onUpdate:modelValue":t[6]||(t[6]=l=>e.form.count=l),min:"0",placeholder:"0"},null,512),[[G,e.form.count]])]),s("div",Fs,[t[39]||(t[39]=s("label",{for:"discovered"},"Discovered:",-1)),U(s("input",{type:"date",id:"discovered","onUpdate:modelValue":t[7]||(t[7]=l=>e.form.discovered=l)},null,512),[[G,e.form.discovered]])])]),s("div",Ls,[s("div",Ns,[t[40]||(t[40]=s("label",{for:"platforms"},"Platforms:",-1)),U(s("input",{type:"text",id:"platforms","onUpdate:modelValue":t[8]||(t[8]=l=>e.form.platforms=l),placeholder:"PC, PS5, Xbox"},null,512),[[G,e.form.platforms]])]),s("div",Ws,[t[41]||(t[41]=s("label",{for:"genre"},"Genre:",-1)),U(s("input",{type:"text",id:"genre","onUpdate:modelValue":t[9]||(t[9]=l=>e.form.genre=l),placeholder:"Action, Adventure, RPG"},null,512),[[G,e.form.genre]])])]),s("div",Gs,[s("div",Vs,[t[42]||(t[42]=s("label",{for:"description"},"Description:",-1)),U(s("textarea",{id:"description","onUpdate:modelValue":t[10]||(t[10]=l=>e.form.description=l),placeholder:"Enter description...",rows:"3"},null,512),[[G,e.form.description]])])]),e.form.category==="watchlist"?(g(),m("div",zs,[s("div",js,[t[44]||(t[44]=s("label",{for:"watchlistType"},[Se("Type: "),s("span",{class:"required"},"*")],-1)),U(s("select",{id:"watchlistType","onUpdate:modelValue":t[11]||(t[11]=l=>e.form.watchlistType=l)},[...t[43]||(t[43]=[Ve('<option value="" data-v-067059a7>Select Type</option><option value="game" data-v-067059a7>Game</option><option value="series" data-v-067059a7>Series</option><option value="movie" data-v-067059a7>Movie</option><option value="buecher" data-v-067059a7>BÃ¼cher</option>',5)])],512),[[Ie,e.form.watchlistType]]),e.form.category==="watchlist"&&!e.form.watchlistType?(g(),m("div",Os," Please select a type for watchlist items ")):p("",!0)])])):p("",!0),e.form.category==="buecher"||e.form.watchlistType==="buecher"?(g(),we(r,{key:1,expanded:!1,onPreferencesChanged:e.handlePreferencesChanged},null,8,["onPreferencesChanged"])):p("",!0),s("div",Hs,[s("div",qs,[t[45]||(t[45]=s("label",{for:"link"},"Link:",-1)),U(s("input",{type:"url",id:"link","onUpdate:modelValue":t[12]||(t[12]=l=>e.form.link=l),placeholder:"https://..."},null,512),[[G,e.form.link]])]),s("div",Js,[t[46]||(t[46]=s("label",{for:"path"},"Image Path:",-1)),U(s("input",{type:"text",id:"path","onUpdate:modelValue":t[13]||(t[13]=l=>e.form.path=l),placeholder:"images/movies/filename.jpg"},null,512),[[G,e.form.path]])])]),e.isGame?(g(),m("div",Ks,[s("div",Qs,[t[47]||(t[47]=s("label",{for:"playtime"},"Playtime (Minutes):",-1)),U(s("input",{type:"number",id:"playtime","onUpdate:modelValue":t[14]||(t[14]=l=>e.form.spielzeit=l),min:"0",placeholder:"0"},null,512),[[G,e.form.spielzeit]])])])):p("",!0),e.isSeries?(g(),m("div",Zs,[s("div",Xs,[t[49]||(t[49]=s("label",{for:"isAiring"},"Status:",-1)),U(s("select",{id:"isAiring","onUpdate:modelValue":t[15]||(t[15]=l=>e.form.isAiring=l)},[...t[48]||(t[48]=[s("option",{value:!1},"Finished",-1),s("option",{value:!0},"Airing",-1)])],512),[[Ie,e.form.isAiring]])]),e.form.isAiring?(g(),m("div",Ys,[t[50]||(t[50]=s("label",{for:"nextSeason"},"Next Season:",-1)),U(s("input",{type:"number",id:"nextSeason","onUpdate:modelValue":t[16]||(t[16]=l=>e.form.nextSeason=l),min:"1",placeholder:"1"},null,512),[[G,e.form.nextSeason]])])):p("",!0)])):p("",!0),e.form.isAiring?(g(),m("div",$s,[s("div",eo,[t[51]||(t[51]=s("label",{for:"nextSeasonRelease"},"Next Season Release:",-1)),U(s("input",{type:"date",id:"nextSeasonRelease","onUpdate:modelValue":t[17]||(t[17]=l=>e.form.nextSeasonRelease=l)},null,512),[[G,e.form.nextSeasonRelease]])])])):p("",!0),s("div",to,[s("div",so,[t[52]||(t[52]=s("label",{for:"imageUrl"},"Image URL (optional):",-1)),U(s("input",{type:"text",id:"imageUrl","onUpdate:modelValue":t[18]||(t[18]=l=>e.form.imageUrl=l),placeholder:"https://... or leave empty for API images"},null,512),[[G,e.form.imageUrl]])]),s("div",oo,[t[53]||(t[53]=s("label",{for:"imageUpload"},"Upload Image:",-1)),s("div",ao,[s("input",{type:"file",id:"imageUpload",ref:"imageUploadRef",onChange:t[19]||(t[19]=(...l)=>e.handleImageUpload&&e.handleImageUpload(...l)),accept:"image/*",style:{display:"none"}},null,544),s("button",{type:"button",onClick:t[20]||(t[20]=(...l)=>e.triggerImageUpload&&e.triggerImageUpload(...l)),class:"upload-btn",disabled:e.loading}," ðŸ“ Choose Image ",8,io),e.uploadedImagePath?(g(),m("div",no,[Se(" âœ… Image uploaded: "+f(e.uploadedImagePath)+" ",1),s("button",{type:"button",onClick:t[21]||(t[21]=(...l)=>e.removeUploadedImage&&e.removeUploadedImage(...l)),class:"remove-uploaded-btn",title:"Remove uploaded image to enable API search"}," âœ• Remove ")])):p("",!0)])])]),e.form.imageUrl||e.uploadedImagePath?(g(),m("div",ro,[s("div",lo,[t[54]||(t[54]=s("label",null,"Image Preview:",-1)),s("div",co,[s("img",{src:e.getImagePreviewUrl(),alt:e.form.title,onError:t[22]||(t[22]=(...l)=>e.handleImageError&&e.handleImageError(...l))},null,40,uo),s("button",{type:"button",onClick:t[23]||(t[23]=(...l)=>e.clearImage&&e.clearImage(...l)),class:"clear-image-btn",title:"Remove image"}," âœ• ")])])])):p("",!0),e.error?(g(),m("div",go,f(e.error),1)):p("",!0),s("div",mo,[s("button",{type:"submit",disabled:e.loading},f(e.loading?"Saving...":"Save"),9,fo),s("button",{type:"button",onClick:t[24]||(t[24]=(...l)=>e.closeModal&&e.closeModal(...l)),disabled:e.loading}," Cancel ",8,po),e.isEditing?(g(),m("button",{key:0,type:"button",onClick:t[25]||(t[25]=(...l)=>e.deleteItem&&e.deleteItem(...l)),disabled:e.loading,class:"delete-btn"}," Delete ",8,ho)):p("",!0),s("button",{type:"button",onClick:t[26]||(t[26]=(...l)=>e.handleSave&&e.handleSave(...l)),disabled:e.loading,class:"check-btn",title:"Add to list"}," âœ“ ",8,vo)])],32)])])}const bo=oe(ls,[["render",yo],["__scopeId","data-v-067059a7"]]),ko={name:"BulkAddModal",props:{show:{type:Boolean,default:!1},currentCategory:{type:String,default:""}},emits:["close"],setup(i,{emit:t}){const o=He(),e=y(1),n=y(!1),c=y(!0),r=y(!1),l=y(0),a=y(0),v=y(0),T=y(0),C=y(null),w=y(""),R=y(""),Q=y([]),$=y([]),F=y({category:"",itemsText:"",defaultRating:null}),ae=V(()=>F.value.category&&F.value.itemsText.trim()&&!n.value),le=V(()=>{const d=ie().length;return d>0?Math.round(l.value/d*100):0}),ie=()=>!F.value.itemsText||!F.value.itemsText.trim()?[]:F.value.itemsText.split(`
`).map(d=>d.trim()).filter(d=>d.length>0).map(d=>{const k=d.split("|").map(I=>I.trim());return{searchTerm:k[0]||"",additionalInfo:k[1]||null}}),O=()=>{l.value=0,a.value=0,v.value=0,T.value=0,C.value=null,w.value="",R.value="",Q.value=[],$.value=[]},z=(d,k,I)=>{C.value=d,w.value=k,R.value=I},Z=(d,k,I="")=>{const u={searching:"Searching...",found:"Found",adding:"Adding...",added:"Added",skipped:"Skipped",error:"Error"}[k]||k;Q.value.push({title:d,status:k,statusText:u,message:I})},H=async()=>{var I,u,A;if(!ae.value)return;e.value=2,n.value=!0,c.value=!0,O();const d=ie();let k=0;try{let K=[];const ne=localStorage.getItem("authToken"),ye=localStorage.getItem("currentUser");if(ne&&ye)try{z({title:"Checking all items..."},"searching","Checking profile for duplicates..."),K=(await _e.checkExistingItems(d.map(S=>({title:S.searchTerm,category:F.value.category})))).existing_items||[],console.log(`ðŸ” Found ${K.length} existing items out of ${d.length} total`)}catch(ee){console.warn("Failed to check existing items, falling back to individual checks:",ee)}for(let ee=0;ee<d.length;ee++){const S=d[ee];l.value=ee+1,z({title:S.searchTerm,description:S.additionalInfo},"searching","Processing...");try{let N=!1;if(ne&&ye&&K.length>0?N=K.some(P=>P.title.toLowerCase().trim()===S.searchTerm.toLowerCase().trim()):N=(o.mediaData||[]).some(ue=>ue.title&&ue.title.toLowerCase().trim()===S.searchTerm.toLowerCase().trim()&&ue.category===F.value.category),N){console.log(`âœ… Found exact match in profile for "${S.searchTerm}"`),z({title:S.searchTerm},"skipped","Already exists in profile - skipped"),$.value.push({searchTerm:S.searchTerm,additionalInfo:S.additionalInfo,reason:"duplicate"}),v.value++,Z(S.searchTerm,"skipped","Already exists in profile - skipped");continue}z({title:S.searchTerm,description:S.additionalInfo},"searching","Searching API..."),Z(S.searchTerm,"searching","Searching API..."),console.log(`ðŸ” Searching API for: "${S.searchTerm}" in category: ${F.value.category}`);const re=await _e.searchApi(S.searchTerm,F.value.category,1);if(console.log(`ðŸ” Search results for "${S.searchTerm}":`,re),re&&re.length>0&&re[0]&&re[0].api_source&&re[0].image){const P=re[0];console.log(`âœ… Found real API data for "${S.searchTerm}":`,{title:P.title,api_source:P.api_source,has_image:!!P.image,has_genre:!!P.genre,has_release:!!P.release}),z({title:P.title,description:`Found: ${P.genre||"Unknown genre"} â€¢ ${P.release||"Unknown year"} â€¢ ${P.api_source}`},"found","Found in API with data"),Z(S.searchTerm,"found",`Found: ${P.title} (${P.api_source})`),z({title:P.title},"adding","Adding to library...");const ue={title:P.title,category:F.value.category,release:P.release||null,rating:P.rating?Math.round(P.rating):F.value.defaultRating||null,platforms:P.platforms||null,genre:P.genre||null,link:P.link||null,path:P.image||null,external_id:P.id||null,count:1,is_airing:!1,spielzeit:0,description:P.overview||S.additionalInfo||null};await o.addMediaItem(ue,!0),a.value++,z({title:P.title},"added","Successfully added with API data"),Z(S.searchTerm,"added",`Added: ${P.title} with API data`)}else console.log(`âŒ No real API data found for "${S.searchTerm}"`),z({title:S.searchTerm},"skipped","No API data found - will retry"),$.value.push({searchTerm:S.searchTerm,additionalInfo:S.additionalInfo,reason:"no_api_data"}),v.value++,Z(S.searchTerm,"skipped","No API data found - ready for retry")}catch(N){console.error(`Error processing "${S.searchTerm}":`,N),N.isDuplicate||((I=N.response)==null?void 0:I.status)===409&&((A=(u=N.response)==null?void 0:u.data)!=null&&A.duplicate)?(z({title:S.searchTerm},"skipped","Already exists - skipped"),v.value++,Z(S.searchTerm,"skipped","Item already exists in library")):(z({title:S.searchTerm},"error","Error occurred"),T.value++,Z(S.searchTerm,"error",N.message||"Unknown error"))}if(k++,k>=5){console.log("ðŸ”„ Reloading media data after 5 items...");try{await o.loadMedia(),k=0}catch(N){console.warn("Failed to reload media data:",N)}}if(!n.value)break;for(;r.value&&n.value;)await new Promise(N=>setTimeout(N,100));await new Promise(N=>setTimeout(N,1e3))}console.log("ðŸ”„ Final media data reload...");try{await o.loadMedia()}catch(ee){console.warn("Failed to reload media data at end:",ee)}e.value=3,z(null,"","")}catch(K){console.error("Bulk processing error:",K),T.value++}finally{n.value=!1,c.value=!1}},de=()=>{n.value=!1,c.value=!1,r.value=!1,e.value=1,O()},b=()=>{r.value=!0},L=()=>{r.value=!1},ce=()=>{const d=$.value.filter(I=>I.reason!=="duplicate");if(d.length===0){fe();return}const k=d.map(I=>I.additionalInfo?`${I.searchTerm} | ${I.additionalInfo}`:I.searchTerm).join(`
`);F.value.itemsText=k,l.value=0,a.value=0,T.value=0,C.value=null,w.value="",R.value="",Q.value=[],e.value=1},fe=()=>{e.value=1,n.value=!1,c.value=!0,O(),F.value={category:"",itemsText:"",defaultRating:null},t("close")};return De(()=>i.show,d=>{d&&i.currentCategory?F.value.category=i.currentCategory:d||fe()}),{currentStep:e,isProcessing:n,canCancel:c,isPaused:r,processedCount:l,addedCount:a,skippedCount:v,errorCount:T,currentItem:C,currentItemStatus:w,currentItemStatusText:R,processingResults:Q,skippedItems:$,bulkData:F,canStart:ae,progressPercentage:le,startProcessing:H,cancelProcessing:de,pauseProcessing:b,resumeProcessing:L,retrySkippedItems:ce,closeModal:fe}}},wo={class:"modal-header"},So={class:"modal-body"},_o={key:0,class:"step-container"},Io={class:"bulk-add-form"},Co={class:"form-group"},Ao={class:"form-group"},xo={class:"form-group"},To={key:1,class:"step-container"},Mo={class:"processing-container"},Ro={class:"progress-overview"},Po={class:"progress-stats"},Bo={class:"stat"},Uo={class:"stat-number"},Do={class:"stat"},Eo={class:"stat-number"},Fo={class:"stat"},Lo={class:"stat-number"},No={class:"stat"},Wo={class:"stat-number"},Go={class:"progress-bar"},Vo={class:"progress-text"},zo={class:"current-item"},jo={class:"current-item-header"},Oo={class:"current-item-title"},Ho={key:0,class:"paused-indicator"},qo={key:0,class:"current-item-description"},Jo={key:1,class:"api-data-indicator"},Ko={key:2,class:"no-api-indicator"},Qo={class:"results-list"},Zo={class:"result-header"},Xo={class:"result-title"},Yo={class:"result-status"},$o={key:0,class:"result-message"},ea={key:2,class:"step-container"},ta={class:"results-summary"},sa={class:"summary-stats"},oa={class:"summary-stat success"},aa={class:"stat-number"},ia={class:"summary-stat warning"},na={class:"stat-number"},ra={class:"summary-stat info"},la={class:"stat-number"},da={class:"summary-stat error"},ca={class:"stat-number"},ua={key:0,class:"retry-section"},ga={class:"retry-list"},ma=["onUpdate:modelValue","disabled"],fa={key:0,class:"retry-additional"},pa={key:1,class:"duplicate-badge"},ha={key:2,class:"retry-badge"},va={key:1,class:"detailed-results"},ya={class:"results-list"},ba={class:"result-header"},ka={class:"result-title"},wa={class:"result-status"},Sa={key:0,class:"result-message"},_a={class:"modal-footer"},Ia=["disabled"],Ca={key:2,class:"processing-controls"},Aa=["disabled"],xa=["disabled"],Ta={key:3,class:"footer-buttons"};function Ma(i,t,o,e,n,c){var r,l;return o.show?(g(),m("div",{key:0,class:"modal-overlay",onClick:t[12]||(t[12]=(...a)=>e.closeModal&&e.closeModal(...a))},[s("div",{class:"modal-content",onClick:t[11]||(t[11]=me(()=>{},["stop"]))},[s("div",wo,[t[13]||(t[13]=s("h2",null,"Bulk Add Items",-1)),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...a)=>e.closeModal&&e.closeModal(...a))},"âœ•")]),s("div",So,[e.currentStep===1?(g(),m("div",_o,[t[19]||(t[19]=s("div",{class:"step-header"},[s("div",{class:"step-number"},"1"),s("h3",null,"Enter Your List")],-1)),s("div",Io,[s("div",Co,[t[15]||(t[15]=s("label",{for:"category"},"Category *",-1)),U(s("select",{id:"category","onUpdate:modelValue":t[1]||(t[1]=a=>e.bulkData.category=a),required:""},[...t[14]||(t[14]=[Ve('<option value="" data-v-907252ed>Select Category</option><option value="game" data-v-907252ed>Game</option><option value="series" data-v-907252ed>Series</option><option value="movie" data-v-907252ed>Movie</option><option value="buecher" data-v-907252ed>BÃ¼cher</option><option value="watchlist" data-v-907252ed>Watchlist</option>',6)])],512),[[Ie,e.bulkData.category]])]),s("div",Ao,[t[16]||(t[16]=s("label",{for:"items-text"},"Items (one per line) *",-1)),U(s("textarea",{id:"items-text","onUpdate:modelValue":t[2]||(t[2]=a=>e.bulkData.itemsText=a),placeholder:`Enter items one per line, for example:
The Witcher 3
Cyberpunk 2077
Red Dead Redemption 2`,rows:"10",required:""},null,512),[[G,e.bulkData.itemsText]]),t[17]||(t[17]=s("small",{class:"help-text"},"Enter one item per line. The system will automatically search and add each item individually.",-1))]),s("div",xo,[t[18]||(t[18]=s("label",{for:"default-rating"},"Default Rating",-1)),U(s("input",{id:"default-rating","onUpdate:modelValue":t[3]||(t[3]=a=>e.bulkData.defaultRating=a),type:"number",min:"0",max:"10",step:"0.1",placeholder:"Optional rating for all items"},null,512),[[G,e.bulkData.defaultRating,void 0,{number:!0}]])])])])):p("",!0),e.currentStep===2?(g(),m("div",To,[t[24]||(t[24]=s("div",{class:"step-header"},[s("div",{class:"step-number"},"2"),s("h3",null,"Processing Items")],-1)),s("div",Mo,[s("div",Ro,[s("div",Po,[s("span",Bo,[s("span",Uo,f(e.processedCount),1),t[20]||(t[20]=s("span",{class:"stat-label"},"Processed",-1))]),s("span",Do,[s("span",Eo,f(e.addedCount),1),t[21]||(t[21]=s("span",{class:"stat-label"},"Added",-1))]),s("span",Fo,[s("span",Lo,f(e.skippedCount),1),t[22]||(t[22]=s("span",{class:"stat-label"},"Skipped",-1))]),s("span",No,[s("span",Wo,f(e.errorCount),1),t[23]||(t[23]=s("span",{class:"stat-label"},"Errors",-1))])]),s("div",Go,[s("div",{class:"progress-fill",style:ve({width:e.progressPercentage+"%"})},null,4)]),s("div",Vo,f(e.progressPercentage)+"% Complete",1)]),s("div",zo,[s("div",jo,[s("span",Oo,"Processing: "+f(((r=e.currentItem)==null?void 0:r.title)||"..."),1),s("span",{class:Y(["current-item-status",e.currentItemStatus])},[e.isPaused?(g(),m("span",Ho,"â¸ï¸ PAUSED - ")):p("",!0),Se(f(e.currentItemStatusText),1)],2)]),(l=e.currentItem)!=null&&l.description?(g(),m("div",qo,f(e.currentItem.description),1)):p("",!0),e.currentItemStatus==="found"?(g(),m("div",Jo," âœ… Real API data found with image and metadata ")):p("",!0),e.currentItemStatus==="skipped"?(g(),m("div",Ko," âŒ No API data found - will be retried ")):p("",!0)]),s("div",Qo,[(g(!0),m(te,null,se(e.processingResults,(a,v)=>(g(),m("div",{key:v,class:Y(["result-item",a.status])},[s("div",Zo,[s("span",Xo,f(a.title),1),s("span",Yo,f(a.statusText),1)]),a.message?(g(),m("div",$o,f(a.message),1)):p("",!0)],2))),128))])])])):p("",!0),e.currentStep===3?(g(),m("div",ea,[t[32]||(t[32]=s("div",{class:"step-header"},[s("div",{class:"step-number"},"3"),s("h3",null,"Results")],-1)),s("div",ta,[s("div",sa,[s("div",oa,[s("span",aa,f(e.addedCount),1),t[25]||(t[25]=s("span",{class:"stat-label"},"Successfully Added",-1))]),s("div",ia,[s("span",na,f(e.skippedItems.filter(a=>a.reason!=="duplicate").length),1),t[26]||(t[26]=s("span",{class:"stat-label"},"Not Found (Ready for Retry)",-1))]),s("div",ra,[s("span",la,f(e.skippedItems.filter(a=>a.reason==="duplicate").length),1),t[27]||(t[27]=s("span",{class:"stat-label"},"Already in Profile",-1))]),s("div",da,[s("span",ca,f(e.errorCount),1),t[28]||(t[28]=s("span",{class:"stat-label"},"Errors",-1))])]),e.skippedItems.length>0?(g(),m("div",ua,[t[29]||(t[29]=s("h4",null,"Items Ready for Retry",-1)),t[30]||(t[30]=s("p",{class:"retry-description"}," The following items can be edited and tried again: ",-1)),s("div",ga,[(g(!0),m(te,null,se(e.skippedItems,(a,v)=>(g(),m("div",{key:v,class:Y(["retry-item",{"duplicate-item":a.reason==="duplicate"}])},[U(s("input",{"onUpdate:modelValue":T=>a.searchTerm=T,class:"retry-input",placeholder:"Edit search term...",disabled:a.reason==="duplicate"},null,8,ma),[[G,a.searchTerm]]),a.additionalInfo?(g(),m("span",fa," | "+f(a.additionalInfo),1)):p("",!0),a.reason==="duplicate"?(g(),m("span",pa," Already in profile ")):(g(),m("span",ha," No API data "))],2))),128))])])):p("",!0),e.processingResults.length>0?(g(),m("div",va,[t[31]||(t[31]=s("h4",null,"Detailed Results",-1)),s("div",ya,[(g(!0),m(te,null,se(e.processingResults,(a,v)=>(g(),m("div",{key:v,class:Y(["result-item",a.status])},[s("div",ba,[s("span",ka,f(a.title),1),s("span",wa,f(a.statusText),1)]),a.message?(g(),m("div",Sa,f(a.message),1)):p("",!0)],2))),128))])])):p("",!0)])])):p("",!0)]),s("div",_a,[e.currentStep===1?(g(),m("button",{key:0,class:"btn btn-secondary",onClick:t[4]||(t[4]=(...a)=>e.closeModal&&e.closeModal(...a))}," Cancel ")):p("",!0),e.currentStep===1?(g(),m("button",{key:1,class:"btn btn-primary",onClick:t[5]||(t[5]=(...a)=>e.startProcessing&&e.startProcessing(...a)),disabled:!e.canStart}," Check All and Add ",8,Ia)):p("",!0),e.currentStep===2?(g(),m("div",Ca,[s("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=(...a)=>e.cancelProcessing&&e.cancelProcessing(...a)),disabled:!e.canCancel}," Cancel ",8,Aa),e.isPaused?p("",!0):(g(),m("button",{key:0,class:"btn btn-warning",onClick:t[7]||(t[7]=(...a)=>e.pauseProcessing&&e.pauseProcessing(...a)),disabled:!e.isProcessing}," Pause ",8,xa)),e.isPaused?(g(),m("button",{key:1,class:"btn btn-primary",onClick:t[8]||(t[8]=(...a)=>e.resumeProcessing&&e.resumeProcessing(...a))}," Resume ")):p("",!0)])):p("",!0),e.currentStep===3?(g(),m("div",Ta,[e.skippedItems.filter(a=>a.reason!=="duplicate").length>0?(g(),m("button",{key:0,class:"btn btn-warning",onClick:t[9]||(t[9]=(...a)=>e.retrySkippedItems&&e.retrySkippedItems(...a))}," Retry "+f(e.skippedItems.filter(a=>a.reason!=="duplicate").length)+" Items ",1)):p("",!0),s("button",{class:"btn btn-primary",onClick:t[10]||(t[10]=(...a)=>e.closeModal&&e.closeModal(...a))}," Done ")])):p("",!0)])])])):p("",!0)}const Ra=oe(ko,[["render",Ma],["__scopeId","data-v-907252ed"]]),Pa={name:"TxtImportModal",props:{show:{type:Boolean,default:!1}},emits:["close","fileProcessed"],methods:{handleFileUpload(i){const t=i.target.files[0];if(!t)return;if(!t.name.toLowerCase().endsWith(".txt")){alert("Bitte wÃ¤hlen Sie eine .txt Datei aus.");return}const o=new FileReader;o.onload=e=>{const n=e.target.result;this.$emit("fileProcessed",n)},o.readAsText(t,"UTF-8")}}},Ba={class:"file-upload-area"},Ua={class:"modal-buttons"};function Da(i,t,o,e,n,c){return o.show?(g(),m("div",{key:0,class:"modal",onClick:t[3]||(t[3]=r=>i.$emit("close"))},[s("div",{class:"modal-content",onClick:t[2]||(t[2]=me(()=>{},["stop"]))},[t[5]||(t[5]=s("h2",null,"ðŸ“„ Import from TXT File",-1)),t[6]||(t[6]=s("p",null,"WÃ¤hlen Sie eine .txt Datei mit einer Liste von Titeln aus, um zu prÃ¼fen, welche Items in der aktuellen Kategorie fehlen.",-1)),s("div",Ba,[s("input",{type:"file",id:"txtFileInput",accept:".txt",onChange:t[0]||(t[0]=(...r)=>c.handleFileUpload&&c.handleFileUpload(...r)),style:{display:"none"}},null,32),t[4]||(t[4]=s("label",{for:"txtFileInput",class:"file-upload-label"},[s("span",{class:"upload-icon"},"ðŸ“"),s("span",{class:"upload-text"},"TXT-Datei auswÃ¤hlen"),s("span",{class:"upload-hint"},"Eine .txt Datei mit einer Liste von Titeln")],-1))]),s("div",Ua,[s("button",{type:"button",onClick:t[1]||(t[1]=r=>i.$emit("close"))}," Cancel ")])])])):p("",!0)}const Ea=oe(Pa,[["render",Da],["__scopeId","data-v-d761bd17"]]),Fa={name:"TxtImportResultsModal",props:{show:{type:Boolean,default:!1},results:{type:Object,default:null}},emits:["close"]},La={class:"results-summary"},Na={class:"summary-item"},Wa={class:"summary-value"},Ga={class:"summary-item"},Va={class:"summary-value"},za={class:"summary-item"},ja={class:"summary-value existing"},Oa={class:"summary-item"},Ha={class:"summary-value missing"},qa={key:0,class:"missing-items"},Ja={class:"items-list"},Ka={key:1,class:"existing-items"},Qa={class:"items-list"},Za={class:"modal-buttons"};function Xa(i,t,o,e,n,c){return o.show&&o.results?(g(),m("div",{key:0,class:"modal",onClick:t[2]||(t[2]=r=>i.$emit("close"))},[s("div",{class:"modal-content results-modal",onClick:t[1]||(t[1]=me(()=>{},["stop"]))},[t[7]||(t[7]=s("h2",null,"ðŸ“Š TXT Import Ergebnisse",-1)),s("div",La,[s("div",Na,[t[3]||(t[3]=s("span",{class:"summary-label"},"Kategorie:",-1)),s("span",Wa,f(o.results.categoryName),1)]),s("div",Ga,[t[4]||(t[4]=s("span",{class:"summary-label"},"Titel in Datei:",-1)),s("span",Va,f(o.results.totalInFile),1)]),s("div",za,[t[5]||(t[5]=s("span",{class:"summary-label"},"Bereits vorhanden:",-1)),s("span",ja,f(o.results.existingItems.length),1)]),s("div",Oa,[t[6]||(t[6]=s("span",{class:"summary-label"},"Fehlende Titel:",-1)),s("span",Ha,f(o.results.missingItems.length),1)])]),o.results.missingItems.length>0?(g(),m("div",qa,[s("h3",null,"âŒ Fehlende Titel ("+f(o.results.missingItems.length)+"):",1),s("div",Ja,[(g(!0),m(te,null,se(o.results.missingItems,(r,l)=>(g(),m("div",{key:l,class:"missing-item"},f(r),1))),128))])])):p("",!0),o.results.existingItems.length>0?(g(),m("div",Ka,[s("h3",null,"âœ… Bereits vorhanden ("+f(o.results.existingItems.length)+"):",1),s("div",Qa,[(g(!0),m(te,null,se(o.results.existingItems,(r,l)=>(g(),m("div",{key:l,class:"existing-item"},f(r),1))),128))])])):p("",!0),s("div",Za,[s("button",{type:"button",onClick:t[0]||(t[0]=r=>i.$emit("close"))}," SchlieÃŸen ")])])])):p("",!0)}const Ya=oe(Fa,[["render",Xa],["__scopeId","data-v-ec385b83"]]),$a={name:"SimpleAddItem",setup(){const i=y(!1),t=y(null),o=Oe({title:"Test Game",category:"game",release:"2003-01-01",count:1});return{form:o,loading:i,result:t,addItem:async()=>{i.value=!0,t.value=null;try{const n=window.location.origin,c=await fetch(`${n}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:"admin@example.com",password:"admin123"})});if(!c.ok)throw new Error("Login failed");const l=(await c.json()).token,v=await(await fetch(`${n}/api/media`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(o)})).json();v.success?t.value={success:!0,message:`Success! Item added with ID: ${v.data.id}`}:t.value={success:!1,message:`Error: ${JSON.stringify(v)}`}}catch(n){t.value={success:!1,message:`Error: ${n.message}`}}finally{i.value=!1}}}}},ei={class:"simple-add-item"},ti=["disabled"];function si(i,t,o,e,n,c){return g(),m("div",ei,[t[10]||(t[10]=s("h3",null,"Simple Add Item Test",-1)),s("form",{onSubmit:t[4]||(t[4]=me((...r)=>e.addItem&&e.addItem(...r),["prevent"]))},[s("div",null,[t[5]||(t[5]=s("label",null,"Title:",-1)),U(s("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.title=r),type:"text",required:""},null,512),[[G,e.form.title]])]),s("div",null,[t[7]||(t[7]=s("label",null,"Category:",-1)),U(s("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.category=r)},[...t[6]||(t[6]=[s("option",{value:"game"},"Game",-1),s("option",{value:"movie"},"Movie",-1),s("option",{value:"series"},"Series",-1)])],512),[[Ie,e.form.category]])]),s("div",null,[t[8]||(t[8]=s("label",null,"Release:",-1)),U(s("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>e.form.release=r),type:"date"},null,512),[[G,e.form.release]])]),s("div",null,[t[9]||(t[9]=s("label",null,"Count:",-1)),U(s("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>e.form.count=r),type:"number",min:"0"},null,512),[[G,e.form.count]])]),s("button",{type:"submit",disabled:e.loading},f(e.loading?"Adding...":"Add Item"),9,ti)],32),e.result?(g(),m("div",{key:0,class:Y(["result",e.result.success?"success":"error"])},f(e.result.message),3)):p("",!0)])}const oi=oe($a,[["render",si],["__scopeId","data-v-642b91e0"]]),ai={name:"LoadingSpinner",props:{loading:{type:Boolean,default:!0},message:{type:String,default:"Loading..."}}},ii={key:0,class:"loading-spinner"},ni={key:0};function ri(i,t,o,e,n,c){return o.loading?(g(),m("div",ii,[t[0]||(t[0]=s("div",{class:"spinner"},null,-1)),o.message?(g(),m("p",ni,f(o.message),1)):p("",!0)])):p("",!0)}const li=oe(ai,[["render",ri],["__scopeId","data-v-4221b645"]]),di={name:"MessageBox",props:{show:{type:Boolean,default:!1},type:{type:String,default:"info",validator:i=>["success","error","warning","info"].includes(i)},title:{type:String,default:""},message:{type:String,required:!0},details:{type:String,default:""}},emits:["close"],setup(i,{emit:t}){const o=()=>{t("close")},e=V(()=>{switch(i.type){case"success":return"âœ…";case"error":return"âŒ";case"warning":return"âš ï¸";case"info":return"â„¹ï¸";default:return"â„¹ï¸"}}),n=V(()=>`message-${i.type}`);return{closeMessage:o,icon:e,messageType:n}}},ci={class:"message-header"},ui={class:"message-icon"},gi={class:"message-title"},mi={class:"message-body"},fi={key:0,class:"message-details"},pi={class:"message-footer"};function hi(i,t,o,e,n,c){return o.show?(g(),m("div",{key:0,class:"message-overlay",onClick:t[3]||(t[3]=(...r)=>e.closeMessage&&e.closeMessage(...r))},[s("div",{class:Y(["message-box",e.messageType]),onClick:t[2]||(t[2]=me(()=>{},["stop"]))},[s("div",ci,[s("span",ui,f(e.icon),1),s("h3",gi,f(o.title),1),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...r)=>e.closeMessage&&e.closeMessage(...r))},"âœ•")]),s("div",mi,[s("p",null,f(o.message),1),o.details?(g(),m("div",fi,[s("pre",null,f(o.details),1)])):p("",!0)]),s("div",pi,[s("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...r)=>e.closeMessage&&e.closeMessage(...r))},"OK")])],2)])):p("",!0)}const vi=oe(di,[["render",hi],["__scopeId","data-v-dd4ca1df"]]),yi={name:"ConfirmDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Confirm Action"},message:{type:String,required:!0}},emits:["confirm","close"],setup(i,{emit:t}){const o=()=>{t("close")};return{closeDialog:o,confirmAction:()=>{t("confirm"),o()}}}},bi={class:"confirm-header"},ki={class:"confirm-title"},wi={class:"confirm-body"},Si={class:"confirm-footer"};function _i(i,t,o,e,n,c){return o.show?(g(),m("div",{key:0,class:"confirm-overlay",onClick:t[4]||(t[4]=(...r)=>e.closeDialog&&e.closeDialog(...r))},[s("div",{class:"confirm-dialog",onClick:t[3]||(t[3]=me(()=>{},["stop"]))},[s("div",bi,[s("h3",ki,f(o.title),1),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...r)=>e.closeDialog&&e.closeDialog(...r))},"âœ•")]),s("div",wi,[s("p",null,f(o.message),1)]),s("div",Si,[s("button",{class:"btn btn-secondary",onClick:t[1]||(t[1]=(...r)=>e.closeDialog&&e.closeDialog(...r))},"Cancel"),s("button",{class:"btn btn-danger",onClick:t[2]||(t[2]=(...r)=>e.confirmAction&&e.confirmAction(...r))},"Confirm")])])])):p("",!0)}const Ii=oe(yi,[["render",_i],["__scopeId","data-v-fd570f57"]]),Ci={name:"InputDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Input Required"},message:{type:String,required:!0},placeholder:{type:String,default:""},inputType:{type:String,default:"text"},defaultValue:{type:String,default:""}},emits:["confirm","close"],setup(i,{emit:t}){const o=y(""),e=y(null),n=()=>{t("close")},c=()=>{t("confirm",o.value),n()};return De(()=>i.show,async r=>{r&&(o.value=i.defaultValue,await rt(),e.value&&(e.value.focus(),e.value.select()))}),{inputValue:o,inputRef:e,closeDialog:n,confirmAction:c}}},Ai={class:"input-header"},xi={class:"input-title"},Ti={class:"input-body"},Mi={class:"input-message"},Ri=["type","placeholder"],Pi={class:"input-footer"};function Bi(i,t,o,e,n,c){return o.show?(g(),m("div",{key:0,class:"input-overlay",onClick:t[6]||(t[6]=(...r)=>e.closeDialog&&e.closeDialog(...r))},[s("div",{class:"input-dialog",onClick:t[5]||(t[5]=me(()=>{},["stop"]))},[s("div",Ai,[s("h3",xi,f(o.title),1),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...r)=>e.closeDialog&&e.closeDialog(...r))},"âœ•")]),s("div",Ti,[s("p",Mi,f(o.message),1),U(s("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>e.inputValue=r),type:o.inputType,placeholder:o.placeholder,class:"input-field",onKeyup:t[2]||(t[2]=nt((...r)=>e.confirmAction&&e.confirmAction(...r),["enter"])),ref:"inputRef"},null,40,Ri),[[it,e.inputValue]])]),s("div",Pi,[s("button",{class:"btn btn-secondary",onClick:t[3]||(t[3]=(...r)=>e.closeDialog&&e.closeDialog(...r))},"Cancel"),s("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...r)=>e.confirmAction&&e.confirmAction(...r))},"OK")])])])):p("",!0)}const Ui=oe(Ci,[["render",Bi],["__scopeId","data-v-1353b47f"]]),Di={name:"MediaLibrary",components:{MediaItem:Ut,Sidebar:dt,MainHeader:gt,FloatingActionButton:Wt,LoginModal:ut,RegisterModal:ct,EditModal:bo,BulkAddModal:Ra,TxtImportModal:Ea,TxtImportResultsModal:Ya,SimpleAddItem:oi,LoadingSpinner:li,MessageBox:vi,ConfirmDialog:Ii,InputDialog:Ui},setup(){const i=He(),t=$e(),o=et(),e=tt(),n=Ze(),c=Ye();c||console.error("SidebarStore not properly initialized");const r=y(!1),l=y(null),{showLoginModal:a,showRegisterModal:v,showEditModal:T,showFloatingMenu:C,showBulkAddModal:w,showTxtImportModal:R,showTxtImportResults:Q,editingItem:$,gridColumns:F,sortBy:ae,categories:le,txtImportResults:ie,isLoggedIn:O,isAdmin:z,userName:Z,currentCategory:H,searchQuery:de,categoryCounts:b,loading:L,error:ce,paginatedMedia:fe,setCategory:d,clearSearch:k,editItem:I,closeEditModal:u,closeBulkAddModal:A,handleBulkAddItems:K,handleSaveItem:ne,handleDeleteItem:ye,logout:ee,loadMedia:S,toggleFloatingMenu:N,addNewItem:re,bulkAddItems:Te,importFromTxt:P,importFromAPI:ue,createCollection:Ee,exportMediaCollection:Fe,exportAsCSV:Ce,exportAsJSON:Le,downloadFile:Ne,deleteAllInCategory:We,getCategoryDisplayName:be,navigateToCalendar:Me,navigateToProfile:Re,processTxtContent:Ae,closeTxtImportResults:qe,cleanup:Je,router:Ge}=mt(),Ke=V(()=>{try{return be?be(H.value):H.value}catch(B){return console.error("Error getting category display name:",B),H.value||"Unknown"}}),h=V(()=>{const B=i.mediaData||[],j={totalItems:B.length,totalCollections:0,totalPlaytime:0,avgRating:0,categoryDistribution:{},ratingDistribution:{},platformDistribution:{},genreDistribution:{},recentActivity:[],airingSeries:[]};let Pe=0,xe=0;return B.forEach(D=>{const Be=D.category||"unknown";if(j.categoryDistribution[Be]=(j.categoryDistribution[Be]||0)+1,D.rating&&D.rating>0){const ke=Math.floor(D.rating);j.ratingDistribution[ke]=(j.ratingDistribution[ke]||0)+1,Pe+=D.rating,xe++}if(D.platforms&&D.category==="game"&&D.platforms.split(",").map(J=>J.trim()).filter(J=>J).forEach(J=>{j.platformDistribution[J]=(j.platformDistribution[J]||0)+1}),D.genre&&(D.category==="series"||D.category==="movie")&&D.genre.split(",").map(J=>J.trim()).filter(J=>J).forEach(J=>{j.genreDistribution[J]=(j.genreDistribution[J]||0)+1}),D.spielzeit&&D.spielzeit>0&&(j.totalPlaytime+=D.spielzeit),D.category==="series"&&D.isAiring===!0&&j.airingSeries.push({title:D.title,nextSeason:D.nextSeason,nextSeasonRelease:D.nextSeasonRelease}),D.discovered){const ke=new Date(D.discovered),J=new Date;J.setDate(J.getDate()-30),ke>=J&&j.recentActivity.push({title:D.title,category:D.category,discovered:D.discovered})}}),xe>0&&(j.avgRating=(Pe/xe).toFixed(1)),j.totalPlaytime=Math.round(j.totalPlaytime/60),j.recentActivity.sort((D,Be)=>new Date(Be.discovered)-new Date(D.discovered)),j}),_=B=>B?new Date(B).toLocaleDateString():"",W=B=>{const j=Math.max(0,Math.min(5,parseInt(B)||0)),Pe="â˜…".repeat(j),xe="â˜†".repeat(5-j);return Pe+xe},x=B=>{d(B),re()},M=()=>{a.value=!1,v.value=!0},q=()=>{a.value=!0},E=B=>{a.value=!1,S()},pe=()=>{v.value=!1,S()},he=async()=>{r.value=!0,l.value=null;try{console.log("ðŸ”§ Starting admin setup...");const B=await n.adminSetup();B.success?(console.log("âœ… Admin setup successful:",B),l.value={type:"success",text:`âœ… Admin created and logged in! User: ${B.user.name} (${B.user.email})`},await S(),setTimeout(()=>{l.value=null},5e3)):(console.log("â„¹ï¸ Admin already exists:",B),l.value={type:"info",text:`â„¹ï¸ ${B.message} (${B.admin_count} admin(s) exist)`},setTimeout(()=>{l.value=null},3e3))}catch(B){console.error("âŒ Admin setup failed:",B),l.value={type:"error",text:`âŒ Admin setup failed: ${B.message||"Unknown error"}`},setTimeout(()=>{l.value=null},5e3)}finally{r.value=!1}},st=()=>{console.log("ðŸ”¥ DEBUG: Direct admin navigation called!"),console.log("ðŸ”¥ DEBUG: Router object:",Ge);try{Ge.push("/admin"),console.log("ðŸ”¥ DEBUG: Successfully navigated to /admin!")}catch(B){console.error("ðŸ”¥ DEBUG: Error navigating to admin:",B)}};return Xe(async()=>{try{if(await S(),O.value)try{i.initializeRealtimeUpdates()}catch(B){console.error("Error initializing realtime updates:",B)}}catch(B){console.error("Error during initialization:",B)}}),lt(()=>{if(O.value)try{i.cleanupRealtimeUpdates()}catch(B){console.error("Error cleaning up realtime updates:",B)}Je()}),{showLoginModal:a,showRegisterModal:v,showEditModal:T,showFloatingMenu:C,showBulkAddModal:w,showTxtImportModal:R,showTxtImportResults:Q,editingItem:$,gridColumns:F,sortBy:ae,categories:le,txtImportResults:ie,adminSetupLoading:r,adminSetupMessage:l,isLoggedIn:O,isAdmin:z,userName:Z,currentCategory:H,currentCategoryDisplayName:Ke,searchQuery:de,categoryCounts:b,loading:L,error:ce,paginatedMedia:fe,setCategory:d,clearSearch:k,navigateToCalendar:Me,navigateToProfile:Re,addItemFromSidebar:x,editItem:I,switchToRegister:M,showAdminLogin:q,handleLoginSuccess:E,handleRegisterSuccess:pe,handleAdminSetup:he,debugNavigateToAdmin:st,closeEditModal:u,closeBulkAddModal:A,handleBulkAddItems:K,handleSaveItem:ne,handleDeleteItem:ye,logout:ee,loadMedia:S,toggleFloatingMenu:N,addNewItem:re,bulkAddItems:Te,importFromTxt:P,importFromAPI:ue,createCollection:Ee,exportMediaCollection:Fe,exportAsCSV:Ce,exportAsJSON:Le,downloadFile:Ne,deleteAllInCategory:We,getCategoryDisplayName:be,processTxtContent:Ae,closeTxtImportResults:qe,messageStore:t,confirmStore:o,inputStore:e,statistics:h,formatDate:_,getRatingStars:W,sidebarStore:c}}},Ei={class:"vue-app"},Fi={class:"main-content"},Li={class:"content-area"},Ni={key:1,class:"error"},Wi={key:2},Gi={key:0,class:"statistics-container"},Vi={class:"statistics-header"},zi={class:"refresh-controls"},ji={class:"statistics-content"},Oi={class:"stats-summary"},Hi={class:"summary-card"},qi={class:"summary-number"},Ji={class:"summary-card"},Ki={class:"summary-number"},Qi={class:"summary-card"},Zi={class:"summary-number"},Xi={class:"summary-card"},Yi={class:"summary-number"},$i={class:"chart-container"},en={class:"category-stats"},tn={class:"category-name"},sn={class:"category-bar"},on={class:"category-count"},an={class:"chart-container"},nn={class:"rating-stats"},rn={class:"rating-stars"},ln={class:"rating-bar"},dn={class:"rating-count"},cn={class:"chart-container"},un={class:"platform-stats"},gn={class:"platform-name"},mn={class:"platform-bar"},fn={class:"platform-count"},pn={class:"chart-container"},hn={class:"genre-stats"},vn={class:"genre-name"},yn={class:"genre-bar"},bn={class:"genre-count"},kn={class:"chart-container"},wn={class:"recent-activity"},Sn={class:"activity-title"},_n={class:"activity-category"},In={class:"activity-date"},Cn={class:"chart-container"},An={class:"airing-series"},xn={class:"airing-title"},Tn={class:"airing-next"},Mn={class:"airing-date"},Rn={key:0,class:"admin-setup-container"},Pn=["disabled"],Bn={key:0},Un={key:1};function Dn(i,t,o,e,n,c){var O,z,Z,H,de;const r=X("Sidebar"),l=X("MainHeader"),a=X("LoadingSpinner"),v=X("MediaItem"),T=X("LoginModal"),C=X("RegisterModal"),w=X("EditModal"),R=X("BulkAddModal"),Q=X("TxtImportModal"),$=X("TxtImportResultsModal"),F=X("FloatingActionButton"),ae=X("MessageBox"),le=X("ConfirmDialog"),ie=X("InputDialog");return g(),m("div",Ei,[s("div",{class:Y(["mobile-overlay",{show:(O=e.sidebarStore)==null?void 0:O.mobileOpen}]),onClick:t[0]||(t[0]=(...b)=>{var L,ce;return((L=e.sidebarStore)==null?void 0:L.closeMobileSidebar)&&((ce=e.sidebarStore)==null?void 0:ce.closeMobileSidebar(...b))})},null,2),ge(r,{collapsed:(z=e.sidebarStore)==null?void 0:z.collapsed,"mobile-open":(Z=e.sidebarStore)==null?void 0:Z.mobileOpen,"is-logged-in":e.isLoggedIn,"is-admin":e.isAdmin,"user-name":e.userName,"current-category":e.currentCategory,"category-counts":e.categoryCounts,categories:e.categories,onToggle:(H=e.sidebarStore)==null?void 0:H.toggleSidebar,onSetCategory:e.setCategory,onNavigateToCalendar:e.navigateToCalendar,onNavigateToProfile:e.navigateToProfile,onNavigateToAdmin:e.debugNavigateToAdmin,onAddItem:e.addItemFromSidebar,onShowLogin:t[1]||(t[1]=b=>e.showLoginModal=!0),onShowRegister:t[2]||(t[2]=b=>e.showRegisterModal=!0),onShowAdminLogin:e.showAdminLogin,onLogout:e.logout},null,8,["collapsed","mobile-open","is-logged-in","is-admin","user-name","current-category","category-counts","categories","onToggle","onSetCategory","onNavigateToCalendar","onNavigateToProfile","onNavigateToAdmin","onAddItem","onShowAdminLogin","onLogout"]),s("div",Fi,[ge(l,{"search-query":e.searchQuery,"onUpdate:searchQuery":t[3]||(t[3]=b=>e.searchQuery=b),"grid-columns":e.gridColumns,"onUpdate:gridColumns":t[4]||(t[4]=b=>e.gridColumns=b),"sort-by":e.sortBy,"onUpdate:sortBy":t[5]||(t[5]=b=>e.sortBy=b),onToggleMobileSidebar:(de=e.sidebarStore)==null?void 0:de.toggleMobileSidebar,onClearSearch:e.clearSearch},null,8,["search-query","grid-columns","sort-by","onToggleMobileSidebar","onClearSearch"]),s("main",Li,[e.loading?(g(),we(a,{key:0,message:"Loading media data..."})):e.error?(g(),m("div",Ni,[s("p",null,f(e.error),1),s("button",{onClick:t[6]||(t[6]=(...b)=>e.loadMedia&&e.loadMedia(...b))},"Retry")])):(g(),m("div",Wi,[e.currentCategory==="statistics"?(g(),m("div",Gi,[s("div",Vi,[t[12]||(t[12]=s("h1",null,"ðŸ“Š Media Library Statistics",-1)),t[13]||(t[13]=s("p",null,"Ãœbersicht Ã¼ber deine Media Collection",-1)),s("div",zi,[s("button",{class:"refresh-btn",onClick:t[7]||(t[7]=(...b)=>e.loadMedia&&e.loadMedia(...b))},"ðŸ”„ Refresh Statistics")])]),s("div",ji,[s("div",Oi,[s("div",Hi,[s("div",qi,f(e.statistics.totalItems),1),t[14]||(t[14]=s("div",{class:"summary-label"},"Total Items",-1))]),s("div",Ji,[s("div",Ki,f(e.statistics.totalCollections),1),t[15]||(t[15]=s("div",{class:"summary-label"},"Collections",-1))]),s("div",Qi,[s("div",Zi,f(e.statistics.totalPlaytime)+"h",1),t[16]||(t[16]=s("div",{class:"summary-label"},"Total Playtime",-1))]),s("div",Xi,[s("div",Yi,f(e.statistics.avgRating),1),t[17]||(t[17]=s("div",{class:"summary-label"},"Avg Rating",-1))])]),s("div",$i,[t[18]||(t[18]=s("h3",{class:"chart-title"},"ðŸ“ˆ Category Distribution",-1)),s("div",en,[(g(!0),m(te,null,se(e.statistics.categoryDistribution,(b,L)=>(g(),m("div",{key:L,class:"category-stat"},[s("div",tn,f(L),1),s("div",sn,[s("div",{class:"category-fill",style:ve({width:`${b/e.statistics.totalItems*100}%`})},null,4)]),s("div",on,f(b)+" ("+f((b/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",an,[t[19]||(t[19]=s("h3",{class:"chart-title"},"â­ Rating Distribution",-1)),s("div",nn,[(g(!0),m(te,null,se(e.statistics.ratingDistribution,(b,L)=>(g(),m("div",{key:L,class:"rating-stat"},[s("div",rn,f(e.getRatingStars(L)),1),s("div",ln,[s("div",{class:"rating-fill",style:ve({width:`${b/e.statistics.totalItems*100}%`})},null,4)]),s("div",dn,f(b)+" ("+f((b/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",cn,[t[20]||(t[20]=s("h3",{class:"chart-title"},"ðŸŽ® Platform Distribution",-1)),s("div",un,[(g(!0),m(te,null,se(e.statistics.platformDistribution,(b,L)=>(g(),m("div",{key:L,class:"platform-stat"},[s("div",gn,f(L),1),s("div",mn,[s("div",{class:"platform-fill",style:ve({width:`${b/e.statistics.totalItems*100}%`})},null,4)]),s("div",fn,f(b)+" ("+f((b/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",pn,[t[21]||(t[21]=s("h3",{class:"chart-title"},"ðŸŽ­ Top Genres",-1)),s("div",hn,[(g(!0),m(te,null,se(e.statistics.genreDistribution,(b,L)=>(g(),m("div",{key:L,class:"genre-stat"},[s("div",vn,f(L),1),s("div",yn,[s("div",{class:"genre-fill",style:ve({width:`${b/e.statistics.totalItems*100}%`})},null,4)]),s("div",bn,f(b)+" ("+f((b/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",kn,[t[22]||(t[22]=s("h3",{class:"chart-title"},"ðŸ“… Recent Activity",-1)),s("div",wn,[(g(!0),m(te,null,se(e.statistics.recentActivity,b=>(g(),m("div",{key:b.title,class:"activity-item"},[s("div",Sn,f(b.title),1),s("div",_n,f(b.category),1),s("div",In,f(e.formatDate(b.discovered)),1)]))),128))])]),s("div",Cn,[t[23]||(t[23]=s("h3",{class:"chart-title"},"ðŸ“º Currently Airing Series",-1)),s("div",An,[(g(!0),m(te,null,se(e.statistics.airingSeries,b=>(g(),m("div",{key:b.title,class:"airing-item"},[s("div",xn,f(b.title),1),s("div",Tn,"Next: Season "+f(b.nextSeason),1),s("div",Mn,f(b.nextSeasonRelease?e.formatDate(b.nextSeasonRelease):"TBA"),1)]))),128))])])])])):(g(),m("div",{key:1,class:"grid",style:ve({gridTemplateColumns:`repeat(${e.gridColumns}, 1fr)`})},[(g(!0),m(te,null,se(e.paginatedMedia,b=>(g(),we(v,{key:b.id,item:b,onEdit:e.editItem},null,8,["item","onEdit"]))),128))],4))]))])]),e.isLoggedIn?p("",!0):(g(),m("div",Rn,[s("button",{onClick:t[8]||(t[8]=(...b)=>e.handleAdminSetup&&e.handleAdminSetup(...b)),disabled:e.adminSetupLoading,class:"admin-setup-btn",title:"Setup Admin Account (Creates admin account with default password)"},[e.adminSetupLoading?(g(),m("span",Bn,"ðŸ”§ Setting up...")):(g(),m("span",Un,"ðŸ”§ Admin Setup"))],8,Pn),e.adminSetupMessage?(g(),m("div",{key:0,class:Y(["admin-setup-message",e.adminSetupMessage.type])},f(e.adminSetupMessage.text),3)):p("",!0)])),e.showLoginModal?(g(),we(T,{key:1,onClose:t[9]||(t[9]=b=>e.showLoginModal=!1),onSuccess:e.handleLoginSuccess,onSwitchToRegister:e.switchToRegister},null,8,["onSuccess","onSwitchToRegister"])):p("",!0),e.showRegisterModal?(g(),we(C,{key:2,onClose:t[10]||(t[10]=b=>e.showRegisterModal=!1),onSuccess:e.handleRegisterSuccess},null,8,["onSuccess"])):p("",!0),e.showEditModal?(g(),we(w,{key:3,item:e.editingItem,"current-category":e.currentCategory,onClose:e.closeEditModal,onSave:e.handleSaveItem,onDelete:e.handleDeleteItem},null,8,["item","current-category","onClose","onSave","onDelete"])):p("",!0),ge(R,{show:e.showBulkAddModal,"current-category":e.currentCategory,onClose:e.closeBulkAddModal},null,8,["show","current-category","onClose"]),ge(Q,{show:e.showTxtImportModal,onClose:t[11]||(t[11]=b=>e.showTxtImportModal=!1),onFileProcessed:e.processTxtContent},null,8,["show","onFileProcessed"]),ge($,{show:e.showTxtImportResults,results:e.txtImportResults,onClose:e.closeTxtImportResults},null,8,["show","results","onClose"]),ge(F,{"show-menu":e.showFloatingMenu,"show-delete-all":e.isLoggedIn&&e.currentCategory!=="all"&&e.categoryCounts[e.currentCategory]>0,"category-name":e.currentCategoryDisplayName,"item-count":e.categoryCounts[e.currentCategory]||0,onToggleMenu:e.toggleFloatingMenu,onAddNewItem:e.addNewItem,onBulkAddItems:e.bulkAddItems,onImportFromTxt:e.importFromTxt,onImportFromApi:e.importFromAPI,onCreateCollection:e.createCollection,onDeleteAllInCategory:e.deleteAllInCategory},null,8,["show-menu","show-delete-all","category-name","item-count","onToggleMenu","onAddNewItem","onBulkAddItems","onImportFromTxt","onImportFromApi","onCreateCollection","onDeleteAllInCategory"]),ge(ae,{show:e.messageStore.show,type:e.messageStore.type,title:e.messageStore.title,message:e.messageStore.message,details:e.messageStore.details,onClose:e.messageStore.closeMessage},null,8,["show","type","title","message","details","onClose"]),ge(le,{show:e.confirmStore.show,title:e.confirmStore.title,message:e.confirmStore.message,onConfirm:e.confirmStore.confirm,onClose:e.confirmStore.cancel},null,8,["show","title","message","onConfirm","onClose"]),ge(ie,{show:e.inputStore.show,title:e.inputStore.title,message:e.inputStore.message,placeholder:e.inputStore.placeholder,"input-type":e.inputStore.inputType,"default-value":e.inputStore.defaultValue,onConfirm:e.inputStore.confirm,onClose:e.inputStore.cancel},null,8,["show","title","message","placeholder","input-type","default-value","onConfirm","onClose"])])}const Nn=oe(Di,[["render",Dn],["__scopeId","data-v-678957e9"]]);export{Nn as default};
