import{d as Ke,r as b,u as lt,a as tt,c as W,_ as $,b as g,e as s,t as f,f as h,n as Q,g as ye,h as ue,o as u,i as Qe,j as st,w as U,v as be,k as dt,l as Be,m as ie,p as ve,q as He,s as V,F as X,x as Y,y as qe,z as J,A as ct,B as ut,C as gt,D as ae,E as mt}from"./index-DbcePGvj.js";import{u as Ze,a as ot,S as ft}from"./Sidebar-DVA2t99F.js";import{R as pt,L as ht,M as vt}from"./RegisterModal-DX4UcoM7.js";const at=Ke("message",()=>{const r=b(!1),t=b("info"),o=b(""),e=b(""),i=b("");function c(_){t.value=_.type||"info",o.value=_.title||"",e.value=_.message||"",i.value=_.details||"",r.value=!0}function n(_,S="Success",A=""){c({type:"success",title:S,message:_,details:A})}function l(_,S="Error",A=""){c({type:"error",title:S,message:_,details:A})}function a(_,S="Warning",A=""){c({type:"warning",title:S,message:_,details:A})}function k(_,S="Info",A=""){c({type:"info",title:S,message:_,details:A})}function C(){r.value=!1,setTimeout(()=>{t.value="info",o.value="",e.value="",i.value=""},300)}return{show:r,type:t,title:o,message:e,details:i,showMessage:c,showSuccess:n,showError:l,showWarning:a,showInfo:k,closeMessage:C}}),it=Ke("confirm",()=>{const r=b(!1),t=b("Confirm Action"),o=b(""),e=b(null);function i(l){return new Promise(a=>{t.value=l.title||"Confirm Action",o.value=l.message||"",r.value=!0,e.value=a})}function c(){e.value&&(e.value(!0),e.value=null),r.value=!1}function n(){e.value&&(e.value(!1),e.value=null),r.value=!1}return{show:r,title:t,message:o,showConfirm:i,confirm:c,cancel:n}}),nt=Ke("input",()=>{const r=b(!1),t=b("Input Required"),o=b(""),e=b(""),i=b("text"),c=b(""),n=b(null);function l(C){return new Promise(_=>{t.value=C.title||"Input Required",o.value=C.message||"",e.value=C.placeholder||"",i.value=C.inputType||"text",c.value=C.defaultValue||"",r.value=!0,n.value=_})}function a(C){n.value&&(n.value(C),n.value=null),r.value=!1}function k(){n.value&&(n.value(null),n.value=null),r.value=!1}return{show:r,title:t,message:o,placeholder:e,inputType:i,defaultValue:c,showInput:l,confirm:a,cancel:k}});function yt(){const r=lt(),t=tt(),o=Ze(),e=at(),i=it(),c=nt(),n=b(!1),l=b(!1),a=b(!1),k=b(!1),C=b(!1),_=b(!1),S=b(!1),A=b(null),K=()=>typeof window<"u"?window.innerWidth>768?8:3:8,Z=b(K()),G=b("order_asc"),ee=b(null),oe=()=>{Z.value=K()};typeof window<"u"&&window.addEventListener("resize",oe);const te=[{key:"game",name:"Games",icon:"🎮"},{key:"series",name:"Series",icon:"📺"},{key:"movie",name:"Movies",icon:"🎬"},{key:"buecher",name:"Bücher",icon:"📚"},{key:"watchlist",name:"Watchlist",icon:"❤️"}],v=W(()=>{try{return t.isLoggedIn}catch(p){return console.error("Error accessing authStore.isLoggedIn:",p),!1}}),E=W(()=>{try{return t.userName}catch(p){return console.error("Error accessing authStore.userName:",p),""}}),se=W(()=>{try{return t.isAdmin}catch(p){return console.error("Error accessing authStore.isAdmin:",p),!1}}),q=W(()=>{try{return o.currentCategory}catch(p){return console.error("Error accessing mediaStore.currentCategory:",p),"game"}}),ge=W({get:()=>{try{return o.searchQuery}catch(p){return console.error("Error accessing mediaStore.searchQuery:",p),""}},set:p=>{try{o.setSearchQuery(p)}catch(w){console.error("Error setting mediaStore.searchQuery:",w)}}}),ne=W(()=>{try{return o.categoryCounts}catch(p){return console.error("Error accessing mediaStore.categoryCounts:",p),{}}}),me=W(()=>{try{return o.loading}catch(p){return console.error("Error accessing mediaStore.loading:",p),!1}}),fe=W(()=>{try{return o.error}catch(p){return console.error("Error accessing mediaStore.error:",p),null}}),re=W(()=>{try{const p=[...o.filteredMedia||[]],[w,L]=G.value.split("_");return p.sort((I,x)=>{let O=I[w],F=x[w];return w==="order"?(O=I.__order||0,F=x.__order||0):w==="airing"?(O=I.isAiring?1:0,F=x.isAiring?1:0):w==="api_rating"?(O=I.api_rating||I.rating||0,F=x.api_rating||x.rating||0):w==="personal_rating"&&(O=I.personal_rating||0,F=x.personal_rating||0),typeof O=="string"&&(O=O.toLowerCase(),F=F.toLowerCase()),L==="asc"?O>F?1:-1:O<F?1:-1})}catch(p){return console.error("Error in sortedMedia computed:",p),[]}}),d=W(()=>re.value),y=W(()=>{try{if(!o||!o.mediaData)return[];const p=new Set;return o.mediaData.forEach(w=>{w.platforms&&w.platforms.split(",").forEach(L=>p.add(L.trim()))}),Array.from(p).sort()}catch(p){return console.error("Error in platforms computed:",p),[]}}),R=W(()=>{try{if(!o||!o.mediaData)return[];const p=new Set;return o.mediaData.forEach(w=>{w.genre&&w.genre.split(",").forEach(L=>p.add(L.trim()))}),Array.from(p).sort()}catch(p){return console.error("Error in genres computed:",p),[]}}),m=p=>{o.setCategory(p),ot().closeMobileSidebar()},T=()=>{o.setSearchQuery("")},j=(p,w)=>{w?o.addFilter({type:"platform",value:p}):o.removeFilter({type:"platform",value:p})},M=(p,w)=>{w?o.addFilter({type:"genre",value:p}):o.removeFilter({type:"genre",value:p})},N=(p,w)=>{w?o.addFilter({type:"airing",value:p}):o.removeFilter({type:"airing",value:p})},Ce=p=>{A.value=p,a.value=!0},B=()=>{a.value=!1,A.value=null},ke=()=>{C.value=!1},Ue=async p=>{console.log("handleBulkAddItems called but not used in new workflow")},De=async p=>{A.value?await o.updateMediaItem(A.value.id,p):await o.addMediaItem(p),B()},Fe=async p=>{var w;try{await o.deleteMediaItem(p.id)}catch(L){((w=L.response)==null?void 0:w.status)!==404&&!L.silent&&(console.error("Delete failed:",L),e.showError("Failed to delete item: "+(L.message||"Unknown error"),"Delete Failed"))}},le=async()=>{await t.logout(),await we()},we=async()=>{try{await o.loadMedia()}catch(p){console.error("Error loading media:",p)}},Ae=()=>{k.value=!k.value},Ee=()=>{if(k.value=!1,!v.value){e.showWarning("Bitte loggen Sie sich ein, um neue Items hinzuzufügen.","Login erforderlich");return}A.value=null,a.value=!0},Le=()=>{if(k.value=!1,!v.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}C.value=!0},Ne=()=>{if(k.value=!1,!v.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}_.value=!0},Ge=()=>{if(k.value=!1,!v.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}e.showInfo("API Import feature coming soon!","Feature in Entwicklung")},We=()=>{if(k.value=!1,!v.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}pe()},Se=p=>{if(!p)return"Unknown";const w=te.find(L=>L.key===p);return w?w.name:p},Ve=async()=>{const p=Se(q.value),w=ne.value[q.value]||0;if(w===0){e.showInfo("No items to delete in this category.","Nothing to Delete");return}const L=`Are you sure you want to delete ALL ${w} items in "${p}"?

This action cannot be undone!`;if(await i.showConfirm({title:"Delete All Items",message:L}))try{const O=((o==null?void 0:o.mediaData)||[]).filter(F=>q.value==="watchlist"?F.category==="watchlist"||F.isNew===!0:F.category===q.value).map(F=>F.id);await o.batchDeleteMediaItems(O),await we(),e.showSuccess(`Successfully deleted ${w} items from "${p}"`,"Items Deleted")}catch(x){console.error("Error deleting items:",x),e.showError("Error occurred while deleting items. Please try again.","Delete Failed")}},ze=p=>{const w=p.split(`
`).map(F=>F.trim()).filter(F=>F.length>0);if(w.length===0){e.showWarning("Die TXT-Datei ist leer oder enthält keine gültigen Einträge.","Leere Datei");return}const I=o.filteredMedia.map(F=>F.title.toLowerCase().trim()),x=w.filter(F=>{const de=F.toLowerCase().trim();return!I.some(ce=>ce.includes(de)||de.includes(ce))}),O=w.filter(F=>{const de=F.toLowerCase().trim();return I.some(ce=>ce.includes(de)||de.includes(ce))});ee.value={totalInFile:w.length,missingItems:x,existingItems:O,currentCategory:q.value,categoryName:Se(q.value)},_.value=!1,S.value=!0},je=()=>{ee.value=null,S.value=!1},pe=async()=>{const p=(o==null?void 0:o.mediaData)||[];if(p.length===0){e.showInfo("Keine Media Items zum Exportieren gefunden.","Nichts zu exportieren");return}const w=await c.showInput({title:"Export Format wählen",message:`1 = CSV
2 = JSON
3 = Beide

Geben Sie die Nummer ein:`,placeholder:"1",defaultValue:"1"});if(!w||!["1","2","3"].includes(w))return;const L=new Date().toISOString().split("T")[0];(w==="1"||w==="3")&&Te(p,L),(w==="2"||w==="3")&&xe(p,L),e.showSuccess(`Collection mit ${p.length} Items wurde erfolgreich exportiert!`,"Export erfolgreich")},Te=(p,w)=>{const I=[["Titel","Kategorie","Release","Rating","Platforms","Genre","Spielzeit","Status","Beschreibung"].join(","),...p.map(x=>[`"${(x.title||"").replace(/"/g,'""')}"`,`"${(x.category||x.category_name||"Unbekannt").replace(/"/g,'""')}"`,`"${x.release||""}"`,`"${x.rating||""}"`,`"${(x.platforms||"").replace(/"/g,'""')}"`,`"${(x.genre||"").replace(/"/g,'""')}"`,`"${x.spielzeit||""}"`,`"${x.isAiring?"Airing":"Abgeschlossen"}"`,`"${(x.description||"").replace(/"/g,'""')}"`].join(","))].join(`
`);_e(I,`media_collection_${w}.csv`,"text/csv;charset=utf-8;")},xe=(p,w)=>{const L={exportDate:new Date().toISOString(),totalItems:p.length,categories:[...new Set(p.map(I=>I.category||I.category_name||"Unbekannt"))],items:p.map(I=>({id:I.id,title:I.title||"",category:I.category||I.category_name||"Unbekannt",release:I.release||"",rating:I.rating||null,platforms:I.platforms||"",genre:I.genre||"",spielzeit:I.spielzeit||null,status:I.isAiring?"Airing":"Abgeschlossen",description:I.description||"",isNew:I.isNew||!1,nextSeason:I.nextSeason||null,discovered:I.discovered||null}))};_e(JSON.stringify(L,null,2),`media_collection_${w}.json`,"application/json;charset=utf-8;")},_e=(p,w,L)=>{const I=new Blob([p],{type:L}),x=document.createElement("a"),O=URL.createObjectURL(I);x.setAttribute("href",O),x.setAttribute("download",w),x.style.visibility="hidden",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(O)};return{showLoginModal:n,showRegisterModal:l,showEditModal:a,showFloatingMenu:k,showBulkAddModal:C,showTxtImportModal:_,showTxtImportResults:S,editingItem:A,gridColumns:Z,sortBy:G,categories:te,txtImportResults:ee,isLoggedIn:v,isAdmin:se,userName:E,currentCategory:q,searchQuery:ge,categoryCounts:ne,loading:me,error:fe,paginatedMedia:d,platforms:y,genres:R,setCategory:m,clearSearch:T,togglePlatformFilter:j,toggleGenreFilter:M,toggleAiringFilter:N,editItem:Ce,closeEditModal:B,closeBulkAddModal:ke,handleBulkAddItems:Ue,handleSaveItem:De,handleDeleteItem:Fe,logout:le,loadMedia:we,toggleFloatingMenu:Ae,addNewItem:Ee,bulkAddItems:Le,importFromTxt:Ne,importFromAPI:Ge,createCollection:We,exportMediaCollection:pe,exportAsCSV:Te,exportAsJSON:xe,downloadFile:_e,deleteAllInCategory:Ve,getCategoryDisplayName:Se,navigateToCalendar:()=>{r.push("/calendar")},navigateToProfile:()=>{r.push("/profile")},navigateToAdmin:()=>{console.log("🔥 navigateToAdmin function called!"),console.log("🔥 Router object:",r),console.log("🔥 Pushing to /admin...");try{r.push("/admin"),console.log("🔥 Successfully navigated to /admin!")}catch(p){console.error("🔥 Error navigating to admin:",p)}},processTxtContent:ze,closeTxtImportResults:je,cleanup:()=>{typeof window<"u"&&window.removeEventListener("resize",oe)},router:r}}const bt={name:"MediaItem",props:{item:{type:Object,required:!0}},emits:["edit"],computed:{showWatchlistTag(){return this.item.category==="watchlist"||this.item.isNew===!0},isWatchlistItem(){return this.item.category==="watchlist"||this.item.isNew===!0}},methods:{getImageUrl(r){return r?r.startsWith("http")?r.startsWith("http://")?r.replace("http://","https://"):r:r.startsWith("/")?r:`/storage/${r}`:""},handleImageError(r){var t;r.target.style.display="none",(t=r.target.nextElementSibling)==null||t.classList.add("show")},formatDate(r){return r?new Date(r).toLocaleDateString():""},editItem(){this.$emit("edit",this.item)},getWatchlistReleaseStatus(){if(!this.item.release)return"";const r=new Date(this.item.release),t=new Date;t.setHours(0,0,0,0),r.setHours(0,0,0,0);const o=r.getTime()-t.getTime(),e=Math.ceil(o/(1e3*3600*24));if(e>0)return e===1?"Tomorrow!":e<=7?`${e} days left`:e<=30?`${e} days left`:`${Math.ceil(e/30)} months left`;if(e===0)return"Released today!";{const i=this.getTypeTagText().toLowerCase();return i==="game"?"Unplayed yet":i==="series"||i==="movie"?"Unwatched yet":i==="buecher"?"Unread yet":"Unconsumed yet"}},getWatchlistReleaseStatusClass(){if(!this.item.release)return"";const r=new Date(this.item.release),t=new Date;t.setHours(0,0,0,0),r.setHours(0,0,0,0);const o=r.getTime()-t.getTime(),e=Math.ceil(o/(1e3*3600*24));return e>0?"countdown":e===0?"released-today":"unconsumed"},getTypeTagText(){var t,o,e;const r=this.item.watchlistType||this.item.watchlist_type;if(r)return r.charAt(0).toUpperCase()+r.slice(1);if(this.item.genre){const i=this.item.genre.toLowerCase();if(i.includes("game")||i.includes("gaming")||(t=this.item.platforms)!=null&&t.toLowerCase().includes("steam")||(o=this.item.platforms)!=null&&o.toLowerCase().includes("ps")||(e=this.item.platforms)!=null&&e.toLowerCase().includes("xbox"))return"Game";if(i.includes("series")||i.includes("tv")||i.includes("episode")||this.item.isAiring)return"Series";if(i.includes("movie")||i.includes("film")||i.includes("cinema"))return"Movie";if(i.includes("book")||i.includes("literature")||i.includes("novel")||i.includes("author"))return"Bücher"}if(this.item.platforms){const i=this.item.platforms.toLowerCase();if(i.includes("steam")||i.includes("ps")||i.includes("xbox")||i.includes("nintendo")||i.includes("pc"))return"Game";if(i.includes("netflix")||i.includes("hulu")||i.includes("disney")||i.includes("hbo"))return"Series";if(i.includes("cinema")||i.includes("theater"))return"Movie";if(i.includes("book")||i.includes("kindle")||i.includes("audible")||i.includes("author"))return"Bücher"}return"Media"},getTypeTagClass(){return`type-${this.getTypeTagText().toLowerCase()}`},getNextSeasonCountdown(){if(!this.item.nextSeasonRelease)return"";const r=new Date(this.item.nextSeasonRelease),t=new Date;t.setHours(0,0,0,0),r.setHours(0,0,0,0);const o=r.getTime()-t.getTime(),e=Math.ceil(o/(1e3*3600*24));return e>0?e===1?"Tomorrow!":e<=7?`${e} days`:e<=30?`${e} days`:`${Math.ceil(e/30)} months`:e===0?"Today!":"Released"},getCategoryClass(){var t;const r=(t=this.item.category)==null?void 0:t.toLowerCase();return r==="movies"||r==="movie"?"category-movies":r==="books"||r==="buecher"?"category-books":r==="series"||r==="tv"?"category-series":r==="games"||r==="game"?"category-games":"category-default"},getCategoryIcon(){var t;const r=(t=this.item.category)==null?void 0:t.toLowerCase();return r==="movies"||r==="movie"?"🎬":r==="books"||r==="buecher"?"📚":r==="series"||r==="tv"?"📺":r==="games"||r==="game"?"🎮":"📁"},getCategoryStyle(){var t;const r=(t=this.item.category)==null?void 0:t.toLowerCase();if(r==="games"||r==="game"){const o=this.item.rating||0;return this.getGameStyleByRating(o)}return{}},getGameStyleByRating(r){return r>=4.5?{"--game-primary":"#ffd700","--game-secondary":"#ffed4e","--game-accent":"#ff6b35","--game-glow":"0 0 20px rgba(255, 215, 0, 0.6)","--game-border":"3px solid #ffd700"}:r>=4?{"--game-primary":"#00d4ff","--game-secondary":"#4a9eff","--game-accent":"#00ff88","--game-glow":"0 0 15px rgba(0, 212, 255, 0.5)","--game-border":"3px solid #00d4ff"}:r>=3.5?{"--game-primary":"#00ff88","--game-secondary":"#4caf50","--game-accent":"#8bc34a","--game-glow":"0 0 12px rgba(0, 255, 136, 0.4)","--game-border":"3px solid #00ff88"}:r>=3?{"--game-primary":"#ff9800","--game-secondary":"#ffc107","--game-accent":"#ff5722","--game-glow":"0 0 10px rgba(255, 152, 0, 0.3)","--game-border":"3px solid #ff9800"}:r>=2?{"--game-primary":"#ff5722","--game-secondary":"#f44336","--game-accent":"#d32f2f","--game-glow":"0 0 8px rgba(255, 87, 34, 0.3)","--game-border":"3px solid #ff5722"}:{"--game-primary":"#9e9e9e","--game-secondary":"#757575","--game-accent":"#616161","--game-glow":"0 0 5px rgba(158, 158, 158, 0.2)","--game-border":"3px solid #9e9e9e"}}}},kt={class:"media-image"},wt=["src","alt"],St={key:1,class:"no-image"},_t={class:"no-image-icon"},It={class:"media-info"},Ct={class:"media-title"},At={class:"media-meta"},Tt={key:0,class:"media-release"},xt={key:1},Pt={key:1,class:"media-rating"},Mt={key:0,class:"media-platforms"},Rt={key:1,class:"media-genre"},Bt={key:2,class:"media-description"},Ut={key:3,class:"media-airing"},Dt={key:0,class:"next-season"},Ft={key:1,class:"countdown"},Et={key:4,class:"watchlist-type-tag"};function Lt(r,t,o,e,i,c){return u(),g("div",{class:Q(["media-item",c.getCategoryClass()]),style:ue(c.getCategoryStyle()),onClick:t[1]||(t[1]=(...n)=>c.editItem&&c.editItem(...n))},[s("div",kt,[o.item.path?(u(),g("img",{key:0,src:c.getImageUrl(o.item.path),alt:o.item.title,onError:t[0]||(t[0]=(...n)=>c.handleImageError&&c.handleImageError(...n))},null,40,wt)):(u(),g("div",St,[s("span",_t,f(c.getCategoryIcon()),1)]))]),s("div",It,[s("h3",Ct,f(o.item.title),1),s("div",At,[o.item.release?(u(),g("span",Tt,[c.isWatchlistItem&&o.item.release?(u(),g("span",{key:0,class:Q(c.getWatchlistReleaseStatusClass())},f(c.getWatchlistReleaseStatus()),3)):(u(),g("span",xt,f(c.formatDate(o.item.release)),1))])):h("",!0),o.item.rating?(u(),g("span",Pt,f("★".repeat(Math.max(0,Math.min(5,Math.floor(o.item.rating)))))+f("☆".repeat(Math.max(0,5-Math.max(0,Math.min(5,Math.floor(o.item.rating)))))),1)):h("",!0)]),o.item.platforms?(u(),g("div",Mt,f(o.item.platforms),1)):h("",!0),o.item.genre?(u(),g("div",Rt,f(o.item.genre),1)):h("",!0),o.item.description?(u(),g("div",Bt,f(o.item.description),1)):h("",!0),o.item.isAiring?(u(),g("div",Ut,[t[2]||(t[2]=s("span",{class:"airing-badge"},[s("span",{class:"airing-dot"}),ye(" Airing ")],-1)),o.item.nextSeason?(u(),g("span",Dt,"S"+f(o.item.nextSeason),1)):h("",!0),o.item.nextSeasonRelease?(u(),g("span",Ft,f(c.getNextSeasonCountdown()),1)):h("",!0)])):h("",!0),c.showWatchlistTag?(u(),g("div",Et,[s("span",{class:Q(["type-tag",c.getTypeTagClass()])},f(c.getTypeTagText()),3)])):h("",!0)]),t[3]||(t[3]=s("div",{class:"edit-indicator"},[s("span",{class:"edit-icon"},"✏️")],-1))],6)}const Nt=$(bt,[["render",Lt],["__scopeId","data-v-a0d9c4df"]]),Gt={name:"FloatingActionButton",props:{showMenu:{type:Boolean,default:!1},showDeleteAll:{type:Boolean,default:!1},categoryName:{type:String,default:""},itemCount:{type:Number,default:0}},emits:["toggleMenu","addNewItem","bulkAddItems","importFromTxt","importFromAPI","createCollection","deleteAllInCategory"]},Wt={class:"floating-actions"},Vt={class:"menu-text"},zt={class:"item-count-badge"};function jt(r,t,o,e,i,c){return u(),g("div",Wt,[s("div",{class:Q(["floating-menu",{show:o.showMenu}])},[s("button",{class:"floating-menu-item",onClick:t[0]||(t[0]=n=>r.$emit("addNewItem"))},[...t[7]||(t[7]=[s("span",{class:"menu-icon"},"➕",-1),s("span",{class:"menu-text"},"Add Item",-1)])]),s("button",{class:"floating-menu-item",onClick:t[1]||(t[1]=n=>r.$emit("bulkAddItems"))},[...t[8]||(t[8]=[s("span",{class:"menu-icon"},"📦",-1),s("span",{class:"menu-text"},"Bulk Add",-1)])]),s("button",{class:"floating-menu-item",onClick:t[2]||(t[2]=n=>r.$emit("importFromTxt"))},[...t[9]||(t[9]=[s("span",{class:"menu-icon"},"📄",-1),s("span",{class:"menu-text"},"Import from TXT",-1)])]),s("button",{class:"floating-menu-item",onClick:t[3]||(t[3]=n=>r.$emit("importFromAPI"))},[...t[10]||(t[10]=[s("span",{class:"menu-icon"},"🌐",-1),s("span",{class:"menu-text"},"Import from API",-1)])]),s("button",{class:"floating-menu-item",onClick:t[4]||(t[4]=n=>r.$emit("createCollection"))},[...t[11]||(t[11]=[s("span",{class:"menu-icon"},"📚",-1),s("span",{class:"menu-text"},"Create Collection",-1)])]),o.showDeleteAll&&o.itemCount>0?(u(),g("button",{key:0,class:"floating-menu-item delete-all-item",onClick:t[5]||(t[5]=n=>r.$emit("deleteAllInCategory"))},[t[12]||(t[12]=s("span",{class:"menu-icon"},"🗑️",-1)),s("span",Vt,"Delete All "+f(o.categoryName),1),s("span",zt,"("+f(o.itemCount)+")",1)])):h("",!0)],2),s("button",{class:"floating-add-btn",onClick:t[6]||(t[6]=n=>r.$emit("toggleMenu"))},f(o.showMenu?"✕":"+"),1)])}const Ot=$(Gt,[["render",jt],["__scopeId","data-v-19731834"]]),et="http://127.0.0.1:8000/api",Ht={async getConfig(){try{console.log("📚 Simple Google Books - Getting config...");const r=await fetch(`${et}/google-books-config`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const t=await r.json();return console.log("📚 Simple Google Books - Config loaded:",t),t}catch(r){throw console.error("📚 Simple Google Books - Config failed:",r),r}},async searchBooks(r,t=10){try{console.log("📚 Simple Google Books - Searching:",r);const o=await fetch(`${et}/google-books/search?q=${encodeURIComponent(r)}&maxResults=${t}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const e=await o.json();return console.log("📚 Simple Google Books - Search success:",e),e}catch(o){throw console.error("📚 Simple Google Books - Search failed:",o),o}}},qt=!1,Jt=!0,Kt="production",Qt={production:{apiUrl:"https://teabubble.attrebi.ch",apiBaseUrl:"https://teabubble.attrebi.ch/api",googleBooksUrl:"https://teabubble.attrebi.ch/api/google-books",debug:!1}};function Zt(){return Qt.production}const Re=Zt();Re.debug&&console.log("🔧 [Environment] Configuration loaded:",{mode:Kt,isDevelopment:qt,isProduction:Jt,apiUrl:Re.apiUrl,apiBaseUrl:Re.apiBaseUrl,googleBooksUrl:Re.googleBooksUrl});class Xt{constructor(){this.baseUrl="https://en.wikipedia.org/w/api.php",this.timeout=1e4,this.maxResults=10}async searchBooks(t,o=10){if(console.log("📚 [Wikipedia] Searching books:",{query:t,maxResults:o}),!t||typeof t!="string"||t.trim().length===0)return console.warn("📚 [Wikipedia] Invalid query provided"),{success:!1,error:"Search query is required",data:[]};try{const e=await this.searchPages(t,o);if(!e.success||e.data.length===0)return{success:!1,error:"No results found",data:[]};const i=await this.getPageDetails(e.data),c=this.filterAndFormatBookResults(i);return console.log("📚 [Wikipedia] Search completed:",{totalResults:i.length,bookResults:c.length}),{success:!0,data:c,source:"wikipedia"}}catch(e){return console.error("📚 [Wikipedia] Search failed:",e),{success:!1,error:`Search failed: ${e.message}`,data:[]}}}async searchPages(t,o){var i;const e=new URLSearchParams({action:"query",format:"json",list:"search",srsearch:`${t} book novel`,srnamespace:0,srlimit:o,srprop:"snippet|timestamp",origin:"*"});try{const c=await fetch(`${this.baseUrl}?${e}`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout)});if(!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);const n=await c.json();if(n.error)throw new Error(n.error.info||"Wikipedia API error");return{success:!0,data:(((i=n.query)==null?void 0:i.search)||[]).map(a=>({pageid:a.pageid,title:a.title,snippet:a.snippet,timestamp:a.timestamp}))}}catch(c){return console.error("📚 [Wikipedia] Page search failed:",c),{success:!1,error:c.message,data:[]}}}async getPageDetails(t){var i;if(!t||t.length===0)return[];const o=t.map(c=>c.pageid).join("|"),e=new URLSearchParams({action:"query",format:"json",pageids:o,prop:"extracts|pageimages|info",exintro:"true",explaintext:"true",exsectionformat:"plain",piprop:"thumbnail|original",pithumbsize:300,pilimit:1,inprop:"url",origin:"*"});try{const c=await fetch(`${this.baseUrl}?${e}`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout)});if(!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);const n=await c.json();if(n.error)throw new Error(n.error.info||"Wikipedia API error");const l=((i=n.query)==null?void 0:i.pages)||{};return Object.values(l).map(a=>{var k;return{pageid:a.pageid,title:a.title,extract:a.extract||"",thumbnail:((k=a.thumbnail)==null?void 0:k.source)||null,fullurl:a.fullurl||null,canonicalurl:a.canonicalurl||null}})}catch(c){return console.error("📚 [Wikipedia] Page details failed:",c),[]}}filterAndFormatBookResults(t){const o=["book","novel","fiction","non-fiction","author","published","publisher","isbn","literature","story","chapter","edition","written by","series","trilogy","saga","collection","anthology"];return t.filter(e=>{const i=(e.extract||"").toLowerCase(),c=(e.title||"").toLowerCase(),n=o.some(k=>i.includes(k)||c.includes(k)),a=["book","novel","story","tale","chronicles","saga","trilogy"].some(k=>c.includes(k));return n||a}).map(e=>{const i=e.extract||"",c=e.title||"",n=i.match(/written by[^,.\n]*?([A-Z][^,.\n]*?[A-Z][^,.\n]*?)(?:\s|\.|,|$)/i),l=i.match(/(\d{4})/),a=i.match(/(?:published by|publisher)\s+([^,.\n]+)/i);let k="";if(n&&(k=n[1].trim().replace(/^(British|American|German|French|Spanish|Italian)\s+(?:author|writer|novelist)?\s*/i,""),k.includes("author")||k.includes("writer"))){const _=k.match(/([A-Z][^,.\n]*?[A-Z][^,.\n]*?)(?:\s|\.|,|$)/);k=_?_[1].trim():k}if(!k){const C=i.match(/(?:by|author|written by)\s+([A-Z][^,.\n]*?[A-Z][^,.\n]*?)(?:\s|\.|,|$)/i);C&&(k=C[1].trim().replace(/^(British|American|German|French|Spanish|Italian)\s+(?:author|writer|novelist)?\s*/i,""))}return{id:`wikipedia_${e.pageid}`,title:c,author:k,description:i.substring(0,300)+(i.length>300?"...":""),publishedDate:l?l[1]:"",publisher:a?a[1].trim():"",imageUrl:e.thumbnail||null,link:e.fullurl||e.canonicalurl||"",apiSource:"wikipedia",snippet:i.substring(0,150)+(i.length>150?"...":""),categories:this.extractCategories(i)}}).slice(0,this.maxResults)}extractCategories(t){const o=[],e=t.toLowerCase();return e.includes("fiction")&&o.push("Fiction"),(e.includes("non-fiction")||e.includes("nonfiction"))&&o.push("Non-Fiction"),e.includes("novel")&&o.push("Novel"),e.includes("biography")&&o.push("Biography"),e.includes("history")&&o.push("History"),e.includes("science")&&o.push("Science"),e.includes("philosophy")&&o.push("Philosophy"),e.includes("poetry")&&o.push("Poetry"),e.includes("drama")&&o.push("Drama"),e.includes("mystery")&&o.push("Mystery"),e.includes("romance")&&o.push("Romance"),e.includes("fantasy")&&o.push("Fantasy"),(e.includes("science fiction")||e.includes("sci-fi"))&&o.push("Science Fiction"),e.includes("thriller")&&o.push("Thriller"),e.includes("horror")&&o.push("Horror"),o}async getBookById(t){var o,e;try{const i=new URLSearchParams({action:"query",format:"json",pageids:t,prop:"extracts|pageimages|info",exintro:"true",explaintext:"true",piprop:"thumbnail",pithumbsize:300,inprop:"url",origin:"*"}),c=await fetch(`${this.baseUrl}?${i}`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout)});if(!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);const n=await c.json(),l=Object.values(((o=n.query)==null?void 0:o.pages)||{})[0];if(!l)throw new Error("Page not found");return{success:!0,data:{id:`wikipedia_${l.pageid}`,title:l.title,description:l.extract||"",imageUrl:((e=l.thumbnail)==null?void 0:e.source)||null,link:l.fullurl||l.canonicalurl||"",apiSource:"wikipedia"}}}catch(i){return console.error("📚 [Wikipedia] Get book by ID failed:",i),{success:!1,error:i.message,data:null}}}}const Yt=new Xt;class $t{constructor(){this.wikipediaService=Yt,this.googleBooksService=Ht}getUserPreferences(){try{const t=localStorage.getItem("profileData");if(t){const o=JSON.parse(t);return{booksApiProvider:o.booksApiProvider||"wikipedia",enableGoogleBooksFallback:o.enableGoogleBooksFallback!==!1}}}catch(t){console.warn("Failed to load user preferences:",t)}return{booksApiProvider:"wikipedia",enableGoogleBooksFallback:!0}}async searchBooks(t,o=10){console.log("📚 [UnifiedBooks] Starting search:",{query:t,maxResults:o});const e=this.getUserPreferences();if(console.log("📚 [UnifiedBooks] User preferences:",e),!t||typeof t!="string"||t.trim().length===0)return{success:!1,error:"Search query is required",data:[]};try{let i=[],c="",n=!1;switch(e.booksApiProvider){case"wikipedia":i=await this.searchWithWikipediaFirst(t,o,e),c="wikipedia";break;case"google_books":i=await this.searchWithGoogleBooksFirst(t,o,e),c="google_books";break;case"both":i=await this.searchWithBothApis(t,o,e),c="both";break;default:i=await this.searchWithWikipediaFirst(t,o,e),c="wikipedia"}return console.log("📚 [UnifiedBooks] Search completed:",{totalResults:i.length,primarySource:c,fallbackUsed:n}),{success:!0,data:i,source:c,fallbackUsed:n}}catch(i){return console.error("📚 [UnifiedBooks] Search failed:",i),{success:!1,error:`Search failed: ${i.message}`,data:[]}}}async searchWithWikipediaFirst(t,o,e){console.log("📚 [UnifiedBooks] Searching Wikipedia first...");const i=await this.wikipediaService.searchBooks(t,o);if(i.success&&i.data.length>0)return console.log("📚 [UnifiedBooks] Wikipedia search successful:",i.data.length,"results"),i.data;if(e.enableGoogleBooksFallback){console.log("📚 [UnifiedBooks] Wikipedia failed, trying Google Books fallback...");const c=await this.googleBooksService.searchBooks(t,o);if(c.success&&c.data.length>0)return console.log("📚 [UnifiedBooks] Google Books fallback successful:",c.data.length,"results"),c.data}return console.log("📚 [UnifiedBooks] All searches failed"),[]}async searchWithGoogleBooksFirst(t,o,e){console.log("📚 [UnifiedBooks] Searching Google Books first...");const i=await this.googleBooksService.searchBooks(t,o);if(i.success&&i.data.length>0)return console.log("📚 [UnifiedBooks] Google Books search successful:",i.data.length,"results"),i.data;if(e.enableGoogleBooksFallback){console.log("📚 [UnifiedBooks] Google Books failed, trying Wikipedia fallback...");const c=await this.wikipediaService.searchBooks(t,o);if(c.success&&c.data.length>0)return console.log("📚 [UnifiedBooks] Wikipedia fallback successful:",c.data.length,"results"),c.data}return console.log("📚 [UnifiedBooks] All searches failed"),[]}async searchWithBothApis(t,o,e){console.log("📚 [UnifiedBooks] Searching both APIs...");const[i,c]=await Promise.allSettled([this.wikipediaService.searchBooks(t,Math.ceil(o/2)),this.googleBooksService.searchBooks(t,Math.ceil(o/2))]);let n=[];return i.status==="fulfilled"&&i.value.success&&(n=n.concat(i.value.data),console.log("📚 [UnifiedBooks] Wikipedia results:",i.value.data.length)),c.status==="fulfilled"&&c.value.success&&(n=n.concat(c.value.data),console.log("📚 [UnifiedBooks] Google Books results:",c.value.data.length)),n=this.removeDuplicateResults(n),n=n.slice(0,o),console.log("📚 [UnifiedBooks] Combined results:",n.length),n}removeDuplicateResults(t){const o=new Set,e=[];for(const i of t){const c=i.title.toLowerCase().replace(/[^\w\s]/g,"").trim();o.has(c)||(o.add(c),e.push(i))}return e}async getBookById(t){if(t.startsWith("wikipedia_")){const o=t.replace("wikipedia_","");return await this.wikipediaService.getBookById(o)}else return await this.googleBooksService.getBookById(t)}getApiStatus(){const t=this.getUserPreferences();return{primaryProvider:t.booksApiProvider,fallbackEnabled:t.enableGoogleBooksFallback,availableProviders:["wikipedia","google_books"],wikipediaAvailable:!0,googleBooksAvailable:!0}}}const Je=new $t,es={name:"BooksApiControlPanel",props:{expanded:{type:Boolean,default:!1}},emits:["preferences-changed"],setup(r,{emit:t}){const o=b(r.expanded),e=b(!1),i=b(null),c=b("checking"),n=Qe({booksApiProvider:"wikipedia",enableGoogleBooksFallback:!0}),l=()=>{o.value=!o.value},a=()=>{try{const S=localStorage.getItem("profileData");if(S){const A=JSON.parse(S);n.booksApiProvider=A.booksApiProvider||"wikipedia",n.enableGoogleBooksFallback=A.enableGoogleBooksFallback!==!1}}catch(S){console.warn("Failed to load preferences:",S)}},k=()=>{try{const S=localStorage.getItem("profileData"),A=S?JSON.parse(S):{};A.booksApiProvider=n.booksApiProvider,A.enableGoogleBooksFallback=n.enableGoogleBooksFallback,localStorage.setItem("profileData",JSON.stringify(A)),t("preferences-changed",{...n}),console.log("📚 [ControlPanel] Preferences updated:",n)}catch(S){console.error("Failed to save preferences:",S)}},C=async()=>{e.value=!0,i.value=null;try{const S=await Je.searchBooks("Harry Potter",3);S.success&&S.data.length>0?i.value={success:!0,message:`✅ Found ${S.data.length} results using ${S.source}`}:i.value={success:!1,message:`❌ No results found: ${S.error||"Unknown error"}`}}catch(S){i.value={success:!1,message:`❌ Test failed: ${S.message}`}}finally{e.value=!1}},_=async()=>{try{const S=await Je.getApiStatus();c.value=S.googleBooksAvailable?"available":"unavailable"}catch{c.value="unavailable"}};return st(()=>{a(),_()}),{isExpanded:o,localPreferences:n,testing:e,testResult:i,googleBooksStatus:c,toggleExpanded:l,updatePreferences:k,testSearch:C}}},ts={class:"books-api-control-panel"},ss={class:"control-header"},os={key:0,class:"control-content"},as={class:"form-group"},is={class:"form-group"},ns={class:"checkbox-container"},rs={class:"api-status"},ls={class:"status-item"},ds={class:"search-preview"},cs=["disabled"];function us(r,t,o,e,i,c){return u(),g("div",ts,[s("div",ss,[t[6]||(t[6]=s("h4",null,"📚 Books API Settings",-1)),s("button",{class:Q(["toggle-btn",{expanded:e.isExpanded}]),onClick:t[0]||(t[0]=(...n)=>e.toggleExpanded&&e.toggleExpanded(...n))},f(e.isExpanded?"▼":"▶"),3)]),e.isExpanded?(u(),g("div",os,[s("div",as,[t[8]||(t[8]=s("label",{for:"apiProvider"},"Primary API Provider:",-1)),U(s("select",{id:"apiProvider","onUpdate:modelValue":t[1]||(t[1]=n=>e.localPreferences.booksApiProvider=n),onChange:t[2]||(t[2]=(...n)=>e.updatePreferences&&e.updatePreferences(...n))},[...t[7]||(t[7]=[s("option",{value:"wikipedia"},"Wikipedia (Recommended)",-1),s("option",{value:"google_books"},"Google Books",-1),s("option",{value:"both"},"Both APIs",-1)])],544),[[be,e.localPreferences.booksApiProvider]]),t[9]||(t[9]=s("div",{class:"field-hint"}," Choose your primary source for book information ",-1))]),s("div",is,[s("div",ns,[U(s("input",{type:"checkbox",id:"enableFallback","onUpdate:modelValue":t[3]||(t[3]=n=>e.localPreferences.enableGoogleBooksFallback=n),onChange:t[4]||(t[4]=(...n)=>e.updatePreferences&&e.updatePreferences(...n))},null,544),[[dt,e.localPreferences.enableGoogleBooksFallback]]),t[10]||(t[10]=s("label",{for:"enableFallback",class:"checkbox-label"}," Enable Google Books Fallback ",-1))]),t[11]||(t[11]=s("div",{class:"field-hint"}," Use Google Books when primary API fails ",-1))]),s("div",rs,[t[13]||(t[13]=s("div",{class:"status-item"},[s("span",{class:"status-label"},"Wikipedia:"),s("span",{class:"status-value available"},"✅ Available")],-1)),s("div",ls,[t[12]||(t[12]=s("span",{class:"status-label"},"Google Books:",-1)),s("span",{class:Q(["status-value",e.googleBooksStatus])},f(e.googleBooksStatus==="available"?"✅ Available":"⚠️ Check API Key"),3)])]),s("div",ds,[s("button",{class:"test-search-btn",onClick:t[5]||(t[5]=(...n)=>e.testSearch&&e.testSearch(...n)),disabled:e.testing},f(e.testing?"Testing...":"Test Search"),9,cs),e.testResult?(u(),g("div",{key:0,class:Q(["test-result",e.testResult.success?"success":"error"])},f(e.testResult.message),3)):h("",!0)])])):h("",!0)])}const gs=$(es,[["render",us],["__scopeId","data-v-e996a693"]]),ms={name:"EditModal",components:{BooksApiControlPanel:gs},props:{item:{type:Object,default:null},currentCategory:{type:String,default:"watchlist"}},emits:["close","save","delete"],setup(r,{emit:t}){const o=b(!1),e=b(""),i=b([]),c=b(null),n=b(null),l=b(""),a=Qe({category:"watchlist",title:"",release:"",apiRating:"",personalRating:"",count:"",platforms:"",genre:"",link:"",path:"",discovered:"",spielzeit:"",isAiring:!1,nextSeason:"",nextSeasonRelease:"",imageUrl:"",watchlistType:"",imageCleared:!1}),k=W(()=>!!r.item),C=W(()=>a.category==="game"),_=W(()=>a.category==="series"),S=W(()=>a.category==="watchlist");Be(()=>r.item,d=>{d?(Object.keys(a).forEach(y=>{a[y]=d[y]||""}),d.watchlist_type!==void 0&&(a.watchlistType=d.watchlist_type),d.is_airing!==void 0&&(a.isAiring=d.is_airing),d.next_season!==void 0&&(a.nextSeason=d.next_season),d.next_season_release!==void 0&&(a.nextSeasonRelease=d.next_season_release),d.api_rating!==void 0&&(a.apiRating=d.api_rating),d.personal_rating!==void 0&&(a.personalRating=d.personal_rating),d.image_url!==void 0&&(a.imageUrl=d.image_url),d.rating!==void 0&&!a.personalRating&&(a.personalRating=d.rating)):Object.keys(a).forEach(y=>{y==="category"?a[y]=r.currentCategory||"watchlist":y==="release"?a[y]=new Date().toISOString().split("T")[0]:a[y]=""})},{immediate:!0}),Be(()=>r.currentCategory,d=>{!r.item&&d&&(a.category=d)});const A=async()=>{var d,y,R;if(!a.title){e.value="Title is required";return}if(a.category==="watchlist"&&!a.watchlistType){e.value="Please select a type for watchlist items";return}if(a.category==="watchlist"&&!a.release){e.value="Release date is required for watchlist items";return}o.value=!0,e.value="";try{const m={...a};l.value?(m.path=l.value,m.imageUrl=l.value):m.imageUrl&&m.imageUrl.trim()?m.path=m.imageUrl:(m.imageUrl=null,m.path=null),Object.keys(m).forEach(T=>{m[T]===""&&T!=="watchlistType"&&(m[T]=null)}),m.apiRating&&(m.apiRating=parseFloat(m.apiRating)),m.personalRating&&(m.personalRating=parseFloat(m.personalRating)),m.count&&(m.count=parseInt(m.count)),m.spielzeit&&(m.spielzeit=parseInt(m.spielzeit)),m.nextSeason&&(m.nextSeason=parseInt(m.nextSeason)),m.watchlistType&&(m.watchlist_type=m.watchlistType,delete m.watchlistType),m.isAiring!==void 0&&(m.is_airing=m.isAiring,delete m.isAiring),m.nextSeason&&(m.next_season=m.nextSeason,delete m.nextSeason),m.nextSeasonRelease&&(m.next_season_release=m.nextSeasonRelease,delete m.nextSeasonRelease),m.apiRating&&(m.api_rating=m.apiRating,delete m.apiRating),m.personalRating&&(m.personal_rating=m.personalRating,delete m.personalRating),m.imageUrl&&(m.image_url=m.imageUrl,delete m.imageUrl),t("save",m)}catch(m){m.isDuplicate||((d=m.response)==null?void 0:d.status)===409&&((R=(y=m.response)==null?void 0:y.data)!=null&&R.duplicate)?e.value="Ein Eintrag mit diesem Titel und dieser Kategorie existiert bereits. Bitte wählen Sie einen anderen Titel oder bearbeiten Sie den bestehenden Eintrag.":e.value=m.message||"Failed to save item"}finally{o.value=!1}},K=()=>{e.value="",t("close")},Z=()=>{t("delete",r.item),K()},G=async()=>{if(l.value){i.value=[];return}if(c.value&&clearTimeout(c.value),!a.title||a.title.length<3){i.value=[];return}c.value=setTimeout(async()=>{try{console.log("🔍 EditModal API Search:",{title:a.title,category:a.category,watchlistType:a.watchlistType});const d=a.category==="watchlist"?a.watchlistType:a.category;if(a.category==="watchlist"&&!a.watchlistType){i.value=[];return}let y=[],R=[];if(d==="buecher"){console.log("📚 Searching Unified Books API for:",a.title);const m=await Je.searchBooks(a.title,10);m.success&&m.data?(console.log("📚 Unified Books API Success:",m.data.length,"results from",m.source),R=m.data.map(T=>({title:T.title,release:T.publishedDate?te(T.publishedDate):"",genre:T.categories?T.categories.join(", "):"",platforms:T.author||"",link:T.link||"",imageUrl:T.imageUrl||"",rating:"",apiSource:T.apiSource||m.source,id:T.id,author:T.author,description:T.description,publisher:T.publisher,isbn10:T.isbn10,isbn13:T.isbn13})),console.log("📚 Formatted Unified Books results:",R)):console.warn("📚 Unified Books API failed:",m.error)}else console.log("🎬 Searching Media API for:",a.title,"category:",d),y=await qe.searchApi(a.title,d,10),y&&y.length>0&&(R=y.map(m=>({title:m.title,release:m.release,genre:m.overview||"",platforms:m.platforms||"",link:m.link||"",imageUrl:m.image||"",rating:m.rating||"",apiSource:m.api_source||"",id:m.id||""})));R.length>0?(console.log("✅ API Search Results:",R.length,"items found"),i.value=R):(console.log("❌ No API results found"),i.value=[{title:`"${a.title}" - Keine Ergebnisse gefunden`,release:"",genre:"Bitte manuell ausfüllen",isPlaceholder:!0}])}catch(d){console.error("❌ API search failed:",d),i.value=[{title:`"${a.title}" - API nicht verfügbar`,release:"",genre:"Bitte manuell ausfüllen",isPlaceholder:!0}]}},500)},ee=async d=>{if(d.isPlaceholder){i.value=[];return}if(console.log("📚 Selecting API result:",{title:d.title,apiSource:d.apiSource,author:d.author}),a.title=d.title,d.release&&(a.release=d.release),d.platforms&&(a.platforms=d.platforms),d.genre&&(a.genre=d.genre),d.link&&(a.link=d.link),d.rating&&(a.apiRating=d.rating),d.apiSource==="google_books"||d.apiSource==="wikipedia"){if(console.log("📚 Filling Books API data:",{apiSource:d.apiSource,author:d.author,description:d.description,publisher:d.publisher,isbn10:d.isbn10,isbn13:d.isbn13}),d.author&&(a.platforms=d.author),d.description){const y=a.genre||"";a.genre=y?`${y} | ${d.description.substring(0,100)}...`:d.description.substring(0,200)}if(d.publisher){const y=a.link||"";a.link=y||`Publisher: ${d.publisher}`}}d.imageUrl?(a.imageUrl=d.imageUrl,a.path=d.imageUrl):(a.imageUrl="",a.path=""),i.value=[]},oe=d=>d?new Date(d).toLocaleDateString():"",te=d=>{if(!d)return"";let y;if(typeof d=="string"){if(/^\d{4}$/.test(d))return`${d}-01-01`;if(/^\d{4}-\d{2}$/.test(d))return`${d}-01`;if(/^\d{4}-\d{2}-\d{2}$/.test(d))return d;y=new Date(d)}else y=new Date(d);return isNaN(y.getTime())?(console.warn("📚 Invalid date format:",d),""):y.toISOString().split("T")[0]};return{form:a,loading:o,error:e,apiResults:i,isEditing:k,isGame:C,isSeries:_,isWatchlist:S,imageUploadRef:n,uploadedImagePath:l,handleSave:A,closeModal:K,deleteItem:Z,searchApi:G,selectApiResult:ee,formatDate:oe,formatDateForInput:te,ensureHttpsUrl:d=>d&&(d.startsWith("http://")?d.replace("http://","https://"):d),getReleasePreview:()=>{var T;if(!a.release)return"";const d=new Date(a.release),y=new Date;y.setHours(0,0,0,0),d.setHours(0,0,0,0);const R=d.getTime()-y.getTime(),m=Math.ceil(R/(1e3*3600*24));if(m>0)return m===1?"Tomorrow!":m<=7?`${m} days left`:m<=30?`${m} days left`:`${Math.ceil(m/30)} months left`;if(m===0)return"Released today!";{const j=((T=a.watchlistType)==null?void 0:T.toLowerCase())||"media";return j==="game"?"Unplayed yet":j==="series"||j==="movie"?"Unwatched yet":"Unconsumed yet"}},triggerImageUpload:()=>{var d;(d=n.value)==null||d.click()},handleImageUpload:async d=>{const y=d.target.files[0];if(y){if(!y.type.startsWith("image/")){e.value="Please select a valid image file";return}if(y.size>10*1024*1024){e.value="Image file too large. Maximum size is 10MB";return}o.value=!0,e.value="";try{const R=a.title.replace(/[^a-zA-Z0-9\s\-_\.]/g,"").trim()||"item",m=Date.now(),T=y.name.split(".").pop()||"jpg",j=`images_downloads/uploads/${R}_${m}.${T}`,M=await qe.uploadImage(y,j);M.success?(l.value=M.saved,a.path=M.saved,a.imageUrl=M.saved):e.value=M.error||"Failed to upload image"}catch(R){e.value=R.message||"Failed to upload image"}finally{o.value=!1}}},getImagePreviewUrl:()=>l.value?`/storage/${l.value}`:a.imageUrl?a.imageUrl.startsWith("http")?a.imageUrl:`/storage/${a.imageUrl}`:"",handleImageError:d=>{console.warn("Image preview failed:",d.target.src),d.target.style.display="none"},clearImage:()=>{a.imageUrl="",a.path="",l.value="",n.value&&(n.value.value="")},removeUploadedImage:()=>{l.value="",a.imageUrl===l.value&&(a.imageUrl=""),a.path===l.value&&(a.path=""),n.value&&(n.value.value="")},handlePreferencesChanged:d=>{console.log("📚 [EditModal] Preferences changed:",d),i.value=[]}}}},fs={class:"form-header"},ps={class:"form-group category-group"},hs={class:"form-group title-group"},vs={class:"search-container"},ys=["placeholder","disabled"],bs={key:0,class:"search-results"},ks=["onClick"],ws={class:"result-thumbnail"},Ss=["src","alt"],_s={key:1,class:"no-image"},Is={class:"result-content"},Cs={class:"result-title"},As={class:"result-meta"},Ts={key:0},xs={key:1},Ps={key:2,class:"rating"},Ms={class:"form-row"},Rs={class:"form-group"},Bs={for:"release"},Us={key:0,class:"required"},Ds=["required"],Fs={key:0,class:"field-hint"},Es={key:1,class:"release-preview"},Ls={class:"form-group"},Ns={class:"form-group"},Gs={class:"form-row"},Ws={class:"form-group"},Vs={class:"form-group"},zs={class:"form-row"},js={class:"form-group"},Os={class:"form-group"},Hs={key:0,class:"form-row"},qs={class:"form-group"},Js={key:0,class:"field-error"},Ks={class:"form-row"},Qs={class:"form-group"},Zs={class:"form-group"},Xs={key:2,class:"form-row"},Ys={class:"form-group"},$s={key:3,class:"form-row"},eo={class:"form-group"},to={key:0,class:"form-group"},so={key:4,class:"form-row"},oo={class:"form-group"},ao={class:"form-row"},io={class:"form-group"},no={class:"form-group"},ro={class:"image-upload-container"},lo=["disabled"],co={key:0,class:"upload-success"},uo={key:5,class:"form-row"},go={class:"form-group image-preview-group"},mo={class:"image-preview"},fo=["src","alt"],po={key:6,class:"error-message"},ho={class:"modal-buttons"},vo=["disabled"],yo=["disabled"],bo=["disabled"],ko=["disabled"];function wo(r,t,o,e,i,c){const n=J("BooksApiControlPanel");return u(),g("div",{class:"modal",onClick:t[28]||(t[28]=(...l)=>e.closeModal&&e.closeModal(...l))},[s("div",{class:"modal-content",onClick:t[27]||(t[27]=ie(()=>{},["stop"]))},[s("h2",null,f(e.isEditing?"Edit Item":"Add Item"),1),s("form",{onSubmit:t[26]||(t[26]=ie((...l)=>e.handleSave&&e.handleSave(...l),["prevent"]))},[s("div",fs,[s("div",ps,[t[30]||(t[30]=s("label",{for:"category"},"Category:",-1)),U(s("select",{id:"category","onUpdate:modelValue":t[0]||(t[0]=l=>e.form.category=l),required:""},[...t[29]||(t[29]=[He('<option value="watchlist" data-v-b20ef9a7>Watchlist</option><option value="game" data-v-b20ef9a7>Game</option><option value="series" data-v-b20ef9a7>Series</option><option value="movie" data-v-b20ef9a7>Movie</option><option value="buecher" data-v-b20ef9a7>Bücher</option>',5)])],512),[[be,e.form.category]])]),s("div",hs,[t[31]||(t[31]=s("label",{for:"title"},"Title:",-1)),s("div",vs,[U(s("input",{type:"text",id:"title","onUpdate:modelValue":t[1]||(t[1]=l=>e.form.title=l),onInput:t[2]||(t[2]=(...l)=>e.searchApi&&e.searchApi(...l)),required:"",placeholder:e.isWatchlist?"Enter title (API search + manual input available)":"Enter title",disabled:e.loading},null,40,ys),[[V,e.form.title]]),e.apiResults.length>0?(u(),g("div",bs,[(u(!0),g(X,null,Y(e.apiResults,l=>(u(),g("div",{key:l.title,class:"search-result-item",onClick:a=>e.selectApiResult(l)},[s("div",ws,[l.imageUrl?(u(),g("img",{key:0,src:e.ensureHttpsUrl(l.imageUrl),alt:l.title},null,8,Ss)):(u(),g("div",_s,[s("span",null,f(l.title.charAt(0).toUpperCase()),1)]))]),s("div",Is,[s("div",Cs,f(l.title),1),s("div",As,[l.release?(u(),g("span",Ts,f(e.formatDate(l.release)),1)):h("",!0),l.genre?(u(),g("span",xs,f(l.genre),1)):h("",!0),l.rating?(u(),g("span",Ps,"⭐ "+f(l.rating),1)):h("",!0)])])],8,ks))),128))])):h("",!0)])])]),s("div",Ms,[s("div",Rs,[s("label",Bs,[ye(f(e.isWatchlist?"Release Date:":"Release:")+" ",1),e.isWatchlist?(u(),g("span",Us,"*")):h("",!0)]),U(s("input",{type:"date",id:"release","onUpdate:modelValue":t[3]||(t[3]=l=>e.form.release=l),required:e.isWatchlist},null,8,Ds),[[V,e.form.release]]),e.isWatchlist?(u(),g("div",Fs," 📅 Set the release date to track countdown or status ")):h("",!0),e.isWatchlist&&e.form.release?(u(),g("div",Es,[t[32]||(t[32]=s("strong",null,"Preview:",-1)),ye(" "+f(e.getReleasePreview()),1)])):h("",!0)]),s("div",Ls,[t[33]||(t[33]=s("label",{for:"apiRating"},"API Rating:",-1)),U(s("input",{type:"number",id:"apiRating","onUpdate:modelValue":t[4]||(t[4]=l=>e.form.apiRating=l),step:"0.1",min:"0",max:"10",placeholder:"0-10",readonly:""},null,512),[[V,e.form.apiRating]]),t[34]||(t[34]=s("div",{class:"field-hint"},"From API - read only",-1))]),s("div",Ns,[t[35]||(t[35]=s("label",{for:"personalRating"},"Personal Rating:",-1)),U(s("input",{type:"number",id:"personalRating","onUpdate:modelValue":t[5]||(t[5]=l=>e.form.personalRating=l),step:"0.1",min:"0",max:"10",placeholder:"0-10"},null,512),[[V,e.form.personalRating]]),t[36]||(t[36]=s("div",{class:"field-hint"},"Your personal rating",-1))])]),s("div",Gs,[s("div",Ws,[t[37]||(t[37]=s("label",{for:"views"},"Views:",-1)),U(s("input",{type:"number",id:"views","onUpdate:modelValue":t[6]||(t[6]=l=>e.form.count=l),min:"0",placeholder:"0"},null,512),[[V,e.form.count]])]),s("div",Vs,[t[38]||(t[38]=s("label",{for:"discovered"},"Discovered:",-1)),U(s("input",{type:"date",id:"discovered","onUpdate:modelValue":t[7]||(t[7]=l=>e.form.discovered=l)},null,512),[[V,e.form.discovered]])])]),s("div",zs,[s("div",js,[t[39]||(t[39]=s("label",{for:"platforms"},"Platforms:",-1)),U(s("input",{type:"text",id:"platforms","onUpdate:modelValue":t[8]||(t[8]=l=>e.form.platforms=l),placeholder:"PC, PS5, Xbox"},null,512),[[V,e.form.platforms]])]),s("div",Os,[t[40]||(t[40]=s("label",{for:"genre"},"Genre:",-1)),U(s("input",{type:"text",id:"genre","onUpdate:modelValue":t[9]||(t[9]=l=>e.form.genre=l),placeholder:"Action, Adventure, RPG"},null,512),[[V,e.form.genre]])])]),e.form.category==="watchlist"?(u(),g("div",Hs,[s("div",qs,[t[42]||(t[42]=s("label",{for:"watchlistType"},[ye("Type: "),s("span",{class:"required"},"*")],-1)),U(s("select",{id:"watchlistType","onUpdate:modelValue":t[10]||(t[10]=l=>e.form.watchlistType=l)},[...t[41]||(t[41]=[He('<option value="" data-v-b20ef9a7>Select Type</option><option value="game" data-v-b20ef9a7>Game</option><option value="series" data-v-b20ef9a7>Series</option><option value="movie" data-v-b20ef9a7>Movie</option><option value="buecher" data-v-b20ef9a7>Bücher</option>',5)])],512),[[be,e.form.watchlistType]]),e.form.category==="watchlist"&&!e.form.watchlistType?(u(),g("div",Js," Please select a type for watchlist items ")):h("",!0)])])):h("",!0),e.form.category==="buecher"||e.form.watchlistType==="buecher"?(u(),ve(n,{key:1,expanded:!1,onPreferencesChanged:e.handlePreferencesChanged},null,8,["onPreferencesChanged"])):h("",!0),s("div",Ks,[s("div",Qs,[t[43]||(t[43]=s("label",{for:"link"},"Link:",-1)),U(s("input",{type:"url",id:"link","onUpdate:modelValue":t[11]||(t[11]=l=>e.form.link=l),placeholder:"https://..."},null,512),[[V,e.form.link]])]),s("div",Zs,[t[44]||(t[44]=s("label",{for:"path"},"Image Path:",-1)),U(s("input",{type:"text",id:"path","onUpdate:modelValue":t[12]||(t[12]=l=>e.form.path=l),placeholder:"images/movies/filename.jpg"},null,512),[[V,e.form.path]])])]),e.isGame?(u(),g("div",Xs,[s("div",Ys,[t[45]||(t[45]=s("label",{for:"playtime"},"Playtime (Minutes):",-1)),U(s("input",{type:"number",id:"playtime","onUpdate:modelValue":t[13]||(t[13]=l=>e.form.spielzeit=l),min:"0",placeholder:"0"},null,512),[[V,e.form.spielzeit]])])])):h("",!0),e.isSeries?(u(),g("div",$s,[s("div",eo,[t[47]||(t[47]=s("label",{for:"isAiring"},"Status:",-1)),U(s("select",{id:"isAiring","onUpdate:modelValue":t[14]||(t[14]=l=>e.form.isAiring=l)},[...t[46]||(t[46]=[s("option",{value:!1},"Finished",-1),s("option",{value:!0},"Airing",-1)])],512),[[be,e.form.isAiring]])]),e.form.isAiring?(u(),g("div",to,[t[48]||(t[48]=s("label",{for:"nextSeason"},"Next Season:",-1)),U(s("input",{type:"number",id:"nextSeason","onUpdate:modelValue":t[15]||(t[15]=l=>e.form.nextSeason=l),min:"1",placeholder:"1"},null,512),[[V,e.form.nextSeason]])])):h("",!0)])):h("",!0),e.form.isAiring?(u(),g("div",so,[s("div",oo,[t[49]||(t[49]=s("label",{for:"nextSeasonRelease"},"Next Season Release:",-1)),U(s("input",{type:"date",id:"nextSeasonRelease","onUpdate:modelValue":t[16]||(t[16]=l=>e.form.nextSeasonRelease=l)},null,512),[[V,e.form.nextSeasonRelease]])])])):h("",!0),s("div",ao,[s("div",io,[t[50]||(t[50]=s("label",{for:"imageUrl"},"Image URL (optional):",-1)),U(s("input",{type:"text",id:"imageUrl","onUpdate:modelValue":t[17]||(t[17]=l=>e.form.imageUrl=l),placeholder:"https://... or leave empty for API images"},null,512),[[V,e.form.imageUrl]])]),s("div",no,[t[51]||(t[51]=s("label",{for:"imageUpload"},"Upload Image:",-1)),s("div",ro,[s("input",{type:"file",id:"imageUpload",ref:"imageUploadRef",onChange:t[18]||(t[18]=(...l)=>e.handleImageUpload&&e.handleImageUpload(...l)),accept:"image/*",style:{display:"none"}},null,544),s("button",{type:"button",onClick:t[19]||(t[19]=(...l)=>e.triggerImageUpload&&e.triggerImageUpload(...l)),class:"upload-btn",disabled:e.loading}," 📁 Choose Image ",8,lo),e.uploadedImagePath?(u(),g("div",co,[ye(" ✅ Image uploaded: "+f(e.uploadedImagePath)+" ",1),s("button",{type:"button",onClick:t[20]||(t[20]=(...l)=>e.removeUploadedImage&&e.removeUploadedImage(...l)),class:"remove-uploaded-btn",title:"Remove uploaded image to enable API search"}," ✕ Remove ")])):h("",!0)])])]),e.form.imageUrl||e.uploadedImagePath?(u(),g("div",uo,[s("div",go,[t[52]||(t[52]=s("label",null,"Image Preview:",-1)),s("div",mo,[s("img",{src:e.getImagePreviewUrl(),alt:e.form.title,onError:t[21]||(t[21]=(...l)=>e.handleImageError&&e.handleImageError(...l))},null,40,fo),s("button",{type:"button",onClick:t[22]||(t[22]=(...l)=>e.clearImage&&e.clearImage(...l)),class:"clear-image-btn",title:"Remove image"}," ✕ ")])])])):h("",!0),e.error?(u(),g("div",po,f(e.error),1)):h("",!0),s("div",ho,[s("button",{type:"submit",disabled:e.loading},f(e.loading?"Saving...":"Save"),9,vo),s("button",{type:"button",onClick:t[23]||(t[23]=(...l)=>e.closeModal&&e.closeModal(...l)),disabled:e.loading}," Cancel ",8,yo),e.isEditing?(u(),g("button",{key:0,type:"button",onClick:t[24]||(t[24]=(...l)=>e.deleteItem&&e.deleteItem(...l)),disabled:e.loading,class:"delete-btn"}," Delete ",8,bo)):h("",!0),s("button",{type:"button",onClick:t[25]||(t[25]=(...l)=>e.handleSave&&e.handleSave(...l)),disabled:e.loading,class:"check-btn",title:"Add to list"}," ✓ ",8,ko)])],32)])])}const So=$(ms,[["render",wo],["__scopeId","data-v-b20ef9a7"]]),_o={name:"BulkAddModal",props:{show:{type:Boolean,default:!1},currentCategory:{type:String,default:""}},emits:["close"],setup(r,{emit:t}){const o=Ze(),e=b(1),i=b(!1),c=b(!0),n=b(!1),l=b(0),a=b(0),k=b(0),C=b(0),_=b(null),S=b(""),A=b(""),K=b([]),Z=b([]),G=b({category:"",itemsText:"",defaultRating:null}),ee=W(()=>G.value.category&&G.value.itemsText.trim()&&!i.value),oe=W(()=>{const d=te().length;return d>0?Math.round(l.value/d*100):0}),te=()=>!G.value.itemsText||!G.value.itemsText.trim()?[]:G.value.itemsText.split(`
`).map(d=>d.trim()).filter(d=>d.length>0).map(d=>{const y=d.split("|").map(R=>R.trim());return{searchTerm:y[0]||"",additionalInfo:y[1]||null}}),v=()=>{l.value=0,a.value=0,k.value=0,C.value=0,_.value=null,S.value="",A.value="",K.value=[],Z.value=[]},E=(d,y,R)=>{_.value=d,S.value=y,A.value=R},se=(d,y,R="")=>{const m={searching:"Searching...",found:"Found",adding:"Adding...",added:"Added",skipped:"Skipped",error:"Error"}[y]||y;K.value.push({title:d,status:y,statusText:m,message:R})},q=async()=>{var R,m,T;if(!ee.value)return;e.value=2,i.value=!0,c.value=!0,v();const d=te();let y=0;try{for(let j=0;j<d.length;j++){const M=d[j];l.value=j+1,E({title:M.searchTerm,description:M.additionalInfo},"searching","Searching...");try{se(M.searchTerm,"searching","Searching API..."),console.log(`🔍 Searching for: "${M.searchTerm}" in category: ${G.value.category}`);const N=await qe.searchApi(M.searchTerm,G.value.category,1);if(console.log(`🔍 Search results for "${M.searchTerm}":`,N),N&&N.length>0&&N[0]&&N[0].api_source&&N[0].image){const B=N[0];console.log(`✅ Found real API data for "${M.searchTerm}":`,{title:B.title,api_source:B.api_source,has_image:!!B.image,has_genre:!!B.genre,has_release:!!B.release}),E({title:B.title,description:`Found: ${B.genre||"Unknown genre"} • ${B.release||"Unknown year"} • ${B.api_source}`},"found","Found in API with data"),se(M.searchTerm,"found",`Found: ${B.title} (${B.api_source})`),E({title:B.title},"adding","Adding to library...");const ke={title:B.title,category:G.value.category,release:B.release||null,rating:B.rating?Math.round(B.rating):G.value.defaultRating||null,platforms:B.platforms||null,genre:B.genre||null,link:B.link||null,path:B.image||null,external_id:B.id||null,count:1,is_airing:!1,spielzeit:0,description:M.additionalInfo||null};await o.addMediaItem(ke,!0),a.value++,E({title:B.title},"added","Successfully added with API data"),se(M.searchTerm,"added",`Added: ${B.title} with API data`)}else console.log(`❌ No real API data found for "${M.searchTerm}"`),E({title:M.searchTerm},"skipped","No API data found - will retry"),Z.value.push({searchTerm:M.searchTerm,additionalInfo:M.additionalInfo}),k.value++,se(M.searchTerm,"skipped","No API data found - ready for retry")}catch(N){console.error(`Error processing "${M.searchTerm}":`,N),N.isDuplicate||((R=N.response)==null?void 0:R.status)===409&&((T=(m=N.response)==null?void 0:m.data)!=null&&T.duplicate)?(E({title:M.searchTerm},"skipped","Already exists - skipped"),k.value++,se(M.searchTerm,"skipped","Item already exists in library")):(E({title:M.searchTerm},"error","Error occurred"),C.value++,se(M.searchTerm,"error",N.message||"Unknown error"))}if(y++,y>=5){console.log("🔄 Reloading media data after 5 items...");try{await o.loadMedia(),y=0}catch(N){console.warn("Failed to reload media data:",N)}}if(!i.value)break;for(;n.value&&i.value;)await new Promise(N=>setTimeout(N,100));await new Promise(N=>setTimeout(N,1e3))}console.log("🔄 Final media data reload...");try{await o.loadMedia()}catch(j){console.warn("Failed to reload media data at end:",j)}e.value=3,E(null,"","")}catch(j){console.error("Bulk processing error:",j),C.value++}finally{i.value=!1,c.value=!1}},ge=()=>{i.value=!1,c.value=!1,n.value=!1,e.value=1,v()},ne=()=>{n.value=!0},me=()=>{n.value=!1},fe=()=>{const d=Z.value.map(y=>y.additionalInfo?`${y.searchTerm} | ${y.additionalInfo}`:y.searchTerm).join(`
`);G.value.itemsText=d,l.value=0,a.value=0,C.value=0,_.value=null,S.value="",A.value="",K.value=[],e.value=1},re=()=>{e.value=1,i.value=!1,c.value=!0,v(),G.value={category:"",itemsText:"",defaultRating:null},t("close")};return Be(()=>r.show,d=>{d&&r.currentCategory?G.value.category=r.currentCategory:d||re()}),{currentStep:e,isProcessing:i,canCancel:c,isPaused:n,processedCount:l,addedCount:a,skippedCount:k,errorCount:C,currentItem:_,currentItemStatus:S,currentItemStatusText:A,processingResults:K,skippedItems:Z,bulkData:G,canStart:ee,progressPercentage:oe,startProcessing:q,cancelProcessing:ge,pauseProcessing:ne,resumeProcessing:me,retrySkippedItems:fe,closeModal:re}}},Io={class:"modal-header"},Co={class:"modal-body"},Ao={key:0,class:"step-container"},To={class:"bulk-add-form"},xo={class:"form-group"},Po={class:"form-group"},Mo={class:"form-group"},Ro={key:1,class:"step-container"},Bo={class:"processing-container"},Uo={class:"progress-overview"},Do={class:"progress-stats"},Fo={class:"stat"},Eo={class:"stat-number"},Lo={class:"stat"},No={class:"stat-number"},Go={class:"stat"},Wo={class:"stat-number"},Vo={class:"stat"},zo={class:"stat-number"},jo={class:"progress-bar"},Oo={class:"progress-text"},Ho={class:"current-item"},qo={class:"current-item-header"},Jo={class:"current-item-title"},Ko={key:0,class:"paused-indicator"},Qo={key:0,class:"current-item-description"},Zo={key:1,class:"api-data-indicator"},Xo={key:2,class:"no-api-indicator"},Yo={class:"results-list"},$o={class:"result-header"},ea={class:"result-title"},ta={class:"result-status"},sa={key:0,class:"result-message"},oa={key:2,class:"step-container"},aa={class:"results-summary"},ia={class:"summary-stats"},na={class:"summary-stat success"},ra={class:"stat-number"},la={class:"summary-stat warning"},da={class:"stat-number"},ca={class:"summary-stat error"},ua={class:"stat-number"},ga={key:0,class:"retry-section"},ma={class:"retry-list"},fa=["onUpdate:modelValue"],pa={key:0,class:"retry-additional"},ha={key:1,class:"detailed-results"},va={class:"results-list"},ya={class:"result-header"},ba={class:"result-title"},ka={class:"result-status"},wa={key:0,class:"result-message"},Sa={class:"modal-footer"},_a=["disabled"],Ia={key:2,class:"processing-controls"},Ca=["disabled"],Aa=["disabled"],Ta={key:3,class:"footer-buttons"};function xa(r,t,o,e,i,c){var n,l;return o.show?(u(),g("div",{key:0,class:"modal-overlay",onClick:t[12]||(t[12]=(...a)=>e.closeModal&&e.closeModal(...a))},[s("div",{class:"modal-content",onClick:t[11]||(t[11]=ie(()=>{},["stop"]))},[s("div",Io,[t[13]||(t[13]=s("h2",null,"Bulk Add Items",-1)),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...a)=>e.closeModal&&e.closeModal(...a))},"✕")]),s("div",Co,[e.currentStep===1?(u(),g("div",Ao,[t[19]||(t[19]=s("div",{class:"step-header"},[s("div",{class:"step-number"},"1"),s("h3",null,"Enter Your List")],-1)),s("div",To,[s("div",xo,[t[15]||(t[15]=s("label",{for:"category"},"Category *",-1)),U(s("select",{id:"category","onUpdate:modelValue":t[1]||(t[1]=a=>e.bulkData.category=a),required:""},[...t[14]||(t[14]=[He('<option value="" data-v-382b001b>Select Category</option><option value="game" data-v-382b001b>Game</option><option value="series" data-v-382b001b>Series</option><option value="movie" data-v-382b001b>Movie</option><option value="buecher" data-v-382b001b>Bücher</option><option value="watchlist" data-v-382b001b>Watchlist</option>',6)])],512),[[be,e.bulkData.category]])]),s("div",Po,[t[16]||(t[16]=s("label",{for:"items-text"},"Items (one per line) *",-1)),U(s("textarea",{id:"items-text","onUpdate:modelValue":t[2]||(t[2]=a=>e.bulkData.itemsText=a),placeholder:`Enter items one per line, for example:
The Witcher 3
Cyberpunk 2077
Red Dead Redemption 2`,rows:"10",required:""},null,512),[[V,e.bulkData.itemsText]]),t[17]||(t[17]=s("small",{class:"help-text"},"Enter one item per line. The system will automatically search and add each item individually.",-1))]),s("div",Mo,[t[18]||(t[18]=s("label",{for:"default-rating"},"Default Rating",-1)),U(s("input",{id:"default-rating","onUpdate:modelValue":t[3]||(t[3]=a=>e.bulkData.defaultRating=a),type:"number",min:"0",max:"10",step:"0.1",placeholder:"Optional rating for all items"},null,512),[[V,e.bulkData.defaultRating,void 0,{number:!0}]])])])])):h("",!0),e.currentStep===2?(u(),g("div",Ro,[t[24]||(t[24]=s("div",{class:"step-header"},[s("div",{class:"step-number"},"2"),s("h3",null,"Processing Items")],-1)),s("div",Bo,[s("div",Uo,[s("div",Do,[s("span",Fo,[s("span",Eo,f(e.processedCount),1),t[20]||(t[20]=s("span",{class:"stat-label"},"Processed",-1))]),s("span",Lo,[s("span",No,f(e.addedCount),1),t[21]||(t[21]=s("span",{class:"stat-label"},"Added",-1))]),s("span",Go,[s("span",Wo,f(e.skippedCount),1),t[22]||(t[22]=s("span",{class:"stat-label"},"Skipped",-1))]),s("span",Vo,[s("span",zo,f(e.errorCount),1),t[23]||(t[23]=s("span",{class:"stat-label"},"Errors",-1))])]),s("div",jo,[s("div",{class:"progress-fill",style:ue({width:e.progressPercentage+"%"})},null,4)]),s("div",Oo,f(e.progressPercentage)+"% Complete",1)]),s("div",Ho,[s("div",qo,[s("span",Jo,"Processing: "+f(((n=e.currentItem)==null?void 0:n.title)||"..."),1),s("span",{class:Q(["current-item-status",e.currentItemStatus])},[e.isPaused?(u(),g("span",Ko,"⏸️ PAUSED - ")):h("",!0),ye(f(e.currentItemStatusText),1)],2)]),(l=e.currentItem)!=null&&l.description?(u(),g("div",Qo,f(e.currentItem.description),1)):h("",!0),e.currentItemStatus==="found"?(u(),g("div",Zo," ✅ Real API data found with image and metadata ")):h("",!0),e.currentItemStatus==="skipped"?(u(),g("div",Xo," ❌ No API data found - will be retried ")):h("",!0)]),s("div",Yo,[(u(!0),g(X,null,Y(e.processingResults,(a,k)=>(u(),g("div",{key:k,class:Q(["result-item",a.status])},[s("div",$o,[s("span",ea,f(a.title),1),s("span",ta,f(a.statusText),1)]),a.message?(u(),g("div",sa,f(a.message),1)):h("",!0)],2))),128))])])])):h("",!0),e.currentStep===3?(u(),g("div",oa,[t[31]||(t[31]=s("div",{class:"step-header"},[s("div",{class:"step-number"},"3"),s("h3",null,"Results")],-1)),s("div",aa,[s("div",ia,[s("div",na,[s("span",ra,f(e.addedCount),1),t[25]||(t[25]=s("span",{class:"stat-label"},"Successfully Added",-1))]),s("div",la,[s("span",da,f(e.skippedCount),1),t[26]||(t[26]=s("span",{class:"stat-label"},"Not Found (Ready for Retry)",-1))]),s("div",ca,[s("span",ua,f(e.errorCount),1),t[27]||(t[27]=s("span",{class:"stat-label"},"Errors",-1))])]),e.skippedItems.length>0?(u(),g("div",ga,[t[28]||(t[28]=s("h4",null,"Items Not Found - Ready for Retry",-1)),t[29]||(t[29]=s("p",{class:"retry-description"}," The following items were not found in the API. You can edit them and try again: ",-1)),s("div",ma,[(u(!0),g(X,null,Y(e.skippedItems,(a,k)=>(u(),g("div",{key:k,class:"retry-item"},[U(s("input",{"onUpdate:modelValue":C=>a.searchTerm=C,class:"retry-input",placeholder:"Edit search term..."},null,8,fa),[[V,a.searchTerm]]),a.additionalInfo?(u(),g("span",pa," | "+f(a.additionalInfo),1)):h("",!0)]))),128))])])):h("",!0),e.processingResults.length>0?(u(),g("div",ha,[t[30]||(t[30]=s("h4",null,"Detailed Results",-1)),s("div",va,[(u(!0),g(X,null,Y(e.processingResults,(a,k)=>(u(),g("div",{key:k,class:Q(["result-item",a.status])},[s("div",ya,[s("span",ba,f(a.title),1),s("span",ka,f(a.statusText),1)]),a.message?(u(),g("div",wa,f(a.message),1)):h("",!0)],2))),128))])])):h("",!0)])])):h("",!0)]),s("div",Sa,[e.currentStep===1?(u(),g("button",{key:0,class:"btn btn-secondary",onClick:t[4]||(t[4]=(...a)=>e.closeModal&&e.closeModal(...a))}," Cancel ")):h("",!0),e.currentStep===1?(u(),g("button",{key:1,class:"btn btn-primary",onClick:t[5]||(t[5]=(...a)=>e.startProcessing&&e.startProcessing(...a)),disabled:!e.canStart}," Check All and Add ",8,_a)):h("",!0),e.currentStep===2?(u(),g("div",Ia,[s("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=(...a)=>e.cancelProcessing&&e.cancelProcessing(...a)),disabled:!e.canCancel}," Cancel ",8,Ca),e.isPaused?h("",!0):(u(),g("button",{key:0,class:"btn btn-warning",onClick:t[7]||(t[7]=(...a)=>e.pauseProcessing&&e.pauseProcessing(...a)),disabled:!e.isProcessing}," Pause ",8,Aa)),e.isPaused?(u(),g("button",{key:1,class:"btn btn-primary",onClick:t[8]||(t[8]=(...a)=>e.resumeProcessing&&e.resumeProcessing(...a))}," Resume ")):h("",!0)])):h("",!0),e.currentStep===3?(u(),g("div",Ta,[e.skippedItems.length>0?(u(),g("button",{key:0,class:"btn btn-warning",onClick:t[9]||(t[9]=(...a)=>e.retrySkippedItems&&e.retrySkippedItems(...a))}," Retry "+f(e.skippedItems.length)+" Items ",1)):h("",!0),s("button",{class:"btn btn-primary",onClick:t[10]||(t[10]=(...a)=>e.closeModal&&e.closeModal(...a))}," Done ")])):h("",!0)])])])):h("",!0)}const Pa=$(_o,[["render",xa],["__scopeId","data-v-382b001b"]]),Ma={name:"TxtImportModal",props:{show:{type:Boolean,default:!1}},emits:["close","fileProcessed"],methods:{handleFileUpload(r){const t=r.target.files[0];if(!t)return;if(!t.name.toLowerCase().endsWith(".txt")){alert("Bitte wählen Sie eine .txt Datei aus.");return}const o=new FileReader;o.onload=e=>{const i=e.target.result;this.$emit("fileProcessed",i)},o.readAsText(t,"UTF-8")}}},Ra={class:"file-upload-area"},Ba={class:"modal-buttons"};function Ua(r,t,o,e,i,c){return o.show?(u(),g("div",{key:0,class:"modal",onClick:t[3]||(t[3]=n=>r.$emit("close"))},[s("div",{class:"modal-content",onClick:t[2]||(t[2]=ie(()=>{},["stop"]))},[t[5]||(t[5]=s("h2",null,"📄 Import from TXT File",-1)),t[6]||(t[6]=s("p",null,"Wählen Sie eine .txt Datei mit einer Liste von Titeln aus, um zu prüfen, welche Items in der aktuellen Kategorie fehlen.",-1)),s("div",Ra,[s("input",{type:"file",id:"txtFileInput",accept:".txt",onChange:t[0]||(t[0]=(...n)=>c.handleFileUpload&&c.handleFileUpload(...n)),style:{display:"none"}},null,32),t[4]||(t[4]=s("label",{for:"txtFileInput",class:"file-upload-label"},[s("span",{class:"upload-icon"},"📁"),s("span",{class:"upload-text"},"TXT-Datei auswählen"),s("span",{class:"upload-hint"},"Eine .txt Datei mit einer Liste von Titeln")],-1))]),s("div",Ba,[s("button",{type:"button",onClick:t[1]||(t[1]=n=>r.$emit("close"))}," Cancel ")])])])):h("",!0)}const Da=$(Ma,[["render",Ua],["__scopeId","data-v-d761bd17"]]),Fa={name:"TxtImportResultsModal",props:{show:{type:Boolean,default:!1},results:{type:Object,default:null}},emits:["close"]},Ea={class:"results-summary"},La={class:"summary-item"},Na={class:"summary-value"},Ga={class:"summary-item"},Wa={class:"summary-value"},Va={class:"summary-item"},za={class:"summary-value existing"},ja={class:"summary-item"},Oa={class:"summary-value missing"},Ha={key:0,class:"missing-items"},qa={class:"items-list"},Ja={key:1,class:"existing-items"},Ka={class:"items-list"},Qa={class:"modal-buttons"};function Za(r,t,o,e,i,c){return o.show&&o.results?(u(),g("div",{key:0,class:"modal",onClick:t[2]||(t[2]=n=>r.$emit("close"))},[s("div",{class:"modal-content results-modal",onClick:t[1]||(t[1]=ie(()=>{},["stop"]))},[t[7]||(t[7]=s("h2",null,"📊 TXT Import Ergebnisse",-1)),s("div",Ea,[s("div",La,[t[3]||(t[3]=s("span",{class:"summary-label"},"Kategorie:",-1)),s("span",Na,f(o.results.categoryName),1)]),s("div",Ga,[t[4]||(t[4]=s("span",{class:"summary-label"},"Titel in Datei:",-1)),s("span",Wa,f(o.results.totalInFile),1)]),s("div",Va,[t[5]||(t[5]=s("span",{class:"summary-label"},"Bereits vorhanden:",-1)),s("span",za,f(o.results.existingItems.length),1)]),s("div",ja,[t[6]||(t[6]=s("span",{class:"summary-label"},"Fehlende Titel:",-1)),s("span",Oa,f(o.results.missingItems.length),1)])]),o.results.missingItems.length>0?(u(),g("div",Ha,[s("h3",null,"❌ Fehlende Titel ("+f(o.results.missingItems.length)+"):",1),s("div",qa,[(u(!0),g(X,null,Y(o.results.missingItems,(n,l)=>(u(),g("div",{key:l,class:"missing-item"},f(n),1))),128))])])):h("",!0),o.results.existingItems.length>0?(u(),g("div",Ja,[s("h3",null,"✅ Bereits vorhanden ("+f(o.results.existingItems.length)+"):",1),s("div",Ka,[(u(!0),g(X,null,Y(o.results.existingItems,(n,l)=>(u(),g("div",{key:l,class:"existing-item"},f(n),1))),128))])])):h("",!0),s("div",Qa,[s("button",{type:"button",onClick:t[0]||(t[0]=n=>r.$emit("close"))}," Schließen ")])])])):h("",!0)}const Xa=$(Fa,[["render",Za],["__scopeId","data-v-ec385b83"]]),Ya={name:"SimpleAddItem",setup(){const r=b(!1),t=b(null),o=Qe({title:"Test Game",category:"game",release:"2003-01-01",count:1});return{form:o,loading:r,result:t,addItem:async()=>{r.value=!0,t.value=null;try{const i=window.location.origin,c=await fetch(`${i}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:"admin@example.com",password:"admin123"})});if(!c.ok)throw new Error("Login failed");const l=(await c.json()).token,k=await(await fetch(`${i}/api/media`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(o)})).json();k.success?t.value={success:!0,message:`Success! Item added with ID: ${k.data.id}`}:t.value={success:!1,message:`Error: ${JSON.stringify(k)}`}}catch(i){t.value={success:!1,message:`Error: ${i.message}`}}finally{r.value=!1}}}}},$a={class:"simple-add-item"},ei=["disabled"];function ti(r,t,o,e,i,c){return u(),g("div",$a,[t[10]||(t[10]=s("h3",null,"Simple Add Item Test",-1)),s("form",{onSubmit:t[4]||(t[4]=ie((...n)=>e.addItem&&e.addItem(...n),["prevent"]))},[s("div",null,[t[5]||(t[5]=s("label",null,"Title:",-1)),U(s("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>e.form.title=n),type:"text",required:""},null,512),[[V,e.form.title]])]),s("div",null,[t[7]||(t[7]=s("label",null,"Category:",-1)),U(s("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.form.category=n)},[...t[6]||(t[6]=[s("option",{value:"game"},"Game",-1),s("option",{value:"movie"},"Movie",-1),s("option",{value:"series"},"Series",-1)])],512),[[be,e.form.category]])]),s("div",null,[t[8]||(t[8]=s("label",null,"Release:",-1)),U(s("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>e.form.release=n),type:"date"},null,512),[[V,e.form.release]])]),s("div",null,[t[9]||(t[9]=s("label",null,"Count:",-1)),U(s("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>e.form.count=n),type:"number",min:"0"},null,512),[[V,e.form.count]])]),s("button",{type:"submit",disabled:e.loading},f(e.loading?"Adding...":"Add Item"),9,ei)],32),e.result?(u(),g("div",{key:0,class:Q(["result",e.result.success?"success":"error"])},f(e.result.message),3)):h("",!0)])}const si=$(Ya,[["render",ti],["__scopeId","data-v-642b91e0"]]),oi={name:"LoadingSpinner",props:{loading:{type:Boolean,default:!0},message:{type:String,default:"Loading..."}}},ai={key:0,class:"loading-spinner"},ii={key:0};function ni(r,t,o,e,i,c){return o.loading?(u(),g("div",ai,[t[0]||(t[0]=s("div",{class:"spinner"},null,-1)),o.message?(u(),g("p",ii,f(o.message),1)):h("",!0)])):h("",!0)}const ri=$(oi,[["render",ni],["__scopeId","data-v-4221b645"]]),li={name:"MessageBox",props:{show:{type:Boolean,default:!1},type:{type:String,default:"info",validator:r=>["success","error","warning","info"].includes(r)},title:{type:String,default:""},message:{type:String,required:!0},details:{type:String,default:""}},emits:["close"],setup(r,{emit:t}){const o=()=>{t("close")},e=W(()=>{switch(r.type){case"success":return"✅";case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"ℹ️"}}),i=W(()=>`message-${r.type}`);return{closeMessage:o,icon:e,messageType:i}}},di={class:"message-header"},ci={class:"message-icon"},ui={class:"message-title"},gi={class:"message-body"},mi={key:0,class:"message-details"},fi={class:"message-footer"};function pi(r,t,o,e,i,c){return o.show?(u(),g("div",{key:0,class:"message-overlay",onClick:t[3]||(t[3]=(...n)=>e.closeMessage&&e.closeMessage(...n))},[s("div",{class:Q(["message-box",e.messageType]),onClick:t[2]||(t[2]=ie(()=>{},["stop"]))},[s("div",di,[s("span",ci,f(e.icon),1),s("h3",ui,f(o.title),1),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...n)=>e.closeMessage&&e.closeMessage(...n))},"✕")]),s("div",gi,[s("p",null,f(o.message),1),o.details?(u(),g("div",mi,[s("pre",null,f(o.details),1)])):h("",!0)]),s("div",fi,[s("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...n)=>e.closeMessage&&e.closeMessage(...n))},"OK")])],2)])):h("",!0)}const hi=$(li,[["render",pi],["__scopeId","data-v-8d49f52b"]]),vi={name:"ConfirmDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Confirm Action"},message:{type:String,required:!0}},emits:["confirm","close"],setup(r,{emit:t}){const o=()=>{t("close")};return{closeDialog:o,confirmAction:()=>{t("confirm"),o()}}}},yi={class:"confirm-header"},bi={class:"confirm-title"},ki={class:"confirm-body"},wi={class:"confirm-footer"};function Si(r,t,o,e,i,c){return o.show?(u(),g("div",{key:0,class:"confirm-overlay",onClick:t[4]||(t[4]=(...n)=>e.closeDialog&&e.closeDialog(...n))},[s("div",{class:"confirm-dialog",onClick:t[3]||(t[3]=ie(()=>{},["stop"]))},[s("div",yi,[s("h3",bi,f(o.title),1),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...n)=>e.closeDialog&&e.closeDialog(...n))},"✕")]),s("div",ki,[s("p",null,f(o.message),1)]),s("div",wi,[s("button",{class:"btn btn-secondary",onClick:t[1]||(t[1]=(...n)=>e.closeDialog&&e.closeDialog(...n))},"Cancel"),s("button",{class:"btn btn-danger",onClick:t[2]||(t[2]=(...n)=>e.confirmAction&&e.confirmAction(...n))},"Confirm")])])])):h("",!0)}const _i=$(vi,[["render",Si],["__scopeId","data-v-4e196e5e"]]),Ii={name:"InputDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Input Required"},message:{type:String,required:!0},placeholder:{type:String,default:""},inputType:{type:String,default:"text"},defaultValue:{type:String,default:""}},emits:["confirm","close"],setup(r,{emit:t}){const o=b(""),e=b(null),i=()=>{t("close")},c=()=>{t("confirm",o.value),i()};return Be(()=>r.show,async n=>{n&&(o.value=r.defaultValue,await gt(),e.value&&(e.value.focus(),e.value.select()))}),{inputValue:o,inputRef:e,closeDialog:i,confirmAction:c}}},Ci={class:"input-header"},Ai={class:"input-title"},Ti={class:"input-body"},xi={class:"input-message"},Pi=["type","placeholder"],Mi={class:"input-footer"};function Ri(r,t,o,e,i,c){return o.show?(u(),g("div",{key:0,class:"input-overlay",onClick:t[6]||(t[6]=(...n)=>e.closeDialog&&e.closeDialog(...n))},[s("div",{class:"input-dialog",onClick:t[5]||(t[5]=ie(()=>{},["stop"]))},[s("div",Ci,[s("h3",Ai,f(o.title),1),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...n)=>e.closeDialog&&e.closeDialog(...n))},"✕")]),s("div",Ti,[s("p",xi,f(o.message),1),U(s("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.inputValue=n),type:o.inputType,placeholder:o.placeholder,class:"input-field",onKeyup:t[2]||(t[2]=ut((...n)=>e.confirmAction&&e.confirmAction(...n),["enter"])),ref:"inputRef"},null,40,Pi),[[ct,e.inputValue]])]),s("div",Mi,[s("button",{class:"btn btn-secondary",onClick:t[3]||(t[3]=(...n)=>e.closeDialog&&e.closeDialog(...n))},"Cancel"),s("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...n)=>e.confirmAction&&e.confirmAction(...n))},"OK")])])])):h("",!0)}const Bi=$(Ii,[["render",Ri],["__scopeId","data-v-3713e615"]]),Ui={name:"MediaLibrary",components:{MediaItem:Nt,Sidebar:ft,MainHeader:vt,FloatingActionButton:Ot,LoginModal:ht,RegisterModal:pt,EditModal:So,BulkAddModal:Pa,TxtImportModal:Da,TxtImportResultsModal:Xa,SimpleAddItem:si,LoadingSpinner:ri,MessageBox:hi,ConfirmDialog:_i,InputDialog:Bi},setup(){const r=Ze(),t=at(),o=it(),e=nt(),i=tt(),c=ot(),n=b(!1),l=b(null),{showLoginModal:a,showRegisterModal:k,showEditModal:C,showFloatingMenu:_,showBulkAddModal:S,showTxtImportModal:A,showTxtImportResults:K,editingItem:Z,gridColumns:G,sortBy:ee,categories:oe,txtImportResults:te,isLoggedIn:v,isAdmin:E,userName:se,currentCategory:q,searchQuery:ge,categoryCounts:ne,loading:me,error:fe,paginatedMedia:re,platforms:d,genres:y,setCategory:R,clearSearch:m,togglePlatformFilter:T,toggleGenreFilter:j,toggleAiringFilter:M,editItem:N,closeEditModal:Ce,closeBulkAddModal:B,handleBulkAddItems:ke,handleSaveItem:Ue,handleDeleteItem:De,logout:Fe,loadMedia:le,toggleFloatingMenu:we,addNewItem:Ae,bulkAddItems:Ee,importFromTxt:Le,importFromAPI:Ne,createCollection:Ge,exportMediaCollection:We,exportAsCSV:Se,exportAsJSON:Ve,downloadFile:ze,deleteAllInCategory:je,getCategoryDisplayName:pe,navigateToCalendar:Te,navigateToProfile:xe,processTxtContent:_e,closeTxtImportResults:Xe,cleanup:Ye,router:Oe}=yt(),$e=W(()=>{try{return pe?pe(q.value):q.value}catch(P){return console.error("Error getting category display name:",P),q.value||"Unknown"}}),p=W(()=>{const P=r.mediaData||[],z={totalItems:P.length,totalCollections:0,totalPlaytime:0,avgRating:0,categoryDistribution:{},ratingDistribution:{},platformDistribution:{},genreDistribution:{},recentActivity:[],airingSeries:[]};let Pe=0,Ie=0;return P.forEach(D=>{const Me=D.category||"unknown";if(z.categoryDistribution[Me]=(z.categoryDistribution[Me]||0)+1,D.rating&&D.rating>0){const he=Math.floor(D.rating);z.ratingDistribution[he]=(z.ratingDistribution[he]||0)+1,Pe+=D.rating,Ie++}if(D.platforms&&D.category==="game"&&D.platforms.split(",").map(H=>H.trim()).filter(H=>H).forEach(H=>{z.platformDistribution[H]=(z.platformDistribution[H]||0)+1}),D.genre&&(D.category==="series"||D.category==="movie")&&D.genre.split(",").map(H=>H.trim()).filter(H=>H).forEach(H=>{z.genreDistribution[H]=(z.genreDistribution[H]||0)+1}),D.spielzeit&&D.spielzeit>0&&(z.totalPlaytime+=D.spielzeit),D.category==="series"&&D.isAiring===!0&&z.airingSeries.push({title:D.title,nextSeason:D.nextSeason,nextSeasonRelease:D.nextSeasonRelease}),D.discovered){const he=new Date(D.discovered),H=new Date;H.setDate(H.getDate()-30),he>=H&&z.recentActivity.push({title:D.title,category:D.category,discovered:D.discovered})}}),Ie>0&&(z.avgRating=(Pe/Ie).toFixed(1)),z.totalPlaytime=Math.round(z.totalPlaytime/60),z.recentActivity.sort((D,Me)=>new Date(Me.discovered)-new Date(D.discovered)),z}),w=P=>P?new Date(P).toLocaleDateString():"",L=P=>{const z=Math.max(0,Math.min(5,parseInt(P)||0)),Pe="★".repeat(z),Ie="☆".repeat(5-z);return Pe+Ie},I=P=>{R(P),Ae()},x=()=>{a.value=!1,k.value=!0},O=()=>{a.value=!0},F=P=>{a.value=!1,le()},de=()=>{k.value=!1,le()},ce=async()=>{n.value=!0,l.value=null;try{console.log("🔧 Starting admin setup...");const P=await i.adminSetup();P.success?(console.log("✅ Admin setup successful:",P),l.value={type:"success",text:`✅ Admin created and logged in! User: ${P.user.name} (${P.user.email})`},await le(),setTimeout(()=>{l.value=null},5e3)):(console.log("ℹ️ Admin already exists:",P),l.value={type:"info",text:`ℹ️ ${P.message} (${P.admin_count} admin(s) exist)`},setTimeout(()=>{l.value=null},3e3))}catch(P){console.error("❌ Admin setup failed:",P),l.value={type:"error",text:`❌ Admin setup failed: ${P.message||"Unknown error"}`},setTimeout(()=>{l.value=null},5e3)}finally{n.value=!1}},rt=()=>{console.log("🔥 DEBUG: Direct admin navigation called!"),console.log("🔥 DEBUG: Router object:",Oe);try{Oe.push("/admin"),console.log("🔥 DEBUG: Successfully navigated to /admin!")}catch(P){console.error("🔥 DEBUG: Error navigating to admin:",P)}};return st(async()=>{try{if(await le(),v.value)try{r.initializeRealtimeUpdates()}catch(P){console.error("Error initializing realtime updates:",P)}}catch(P){console.error("Error during initialization:",P)}}),mt(()=>{if(v.value)try{r.cleanupRealtimeUpdates()}catch(P){console.error("Error cleaning up realtime updates:",P)}Ye()}),{showLoginModal:a,showRegisterModal:k,showEditModal:C,showFloatingMenu:_,showBulkAddModal:S,showTxtImportModal:A,showTxtImportResults:K,editingItem:Z,gridColumns:G,sortBy:ee,categories:oe,txtImportResults:te,adminSetupLoading:n,adminSetupMessage:l,isLoggedIn:v,isAdmin:E,userName:se,currentCategory:q,currentCategoryDisplayName:$e,searchQuery:ge,categoryCounts:ne,loading:me,error:fe,paginatedMedia:re,platforms:d,genres:y,setCategory:R,clearSearch:m,navigateToCalendar:Te,navigateToProfile:xe,addItemFromSidebar:I,togglePlatformFilter:T,toggleGenreFilter:j,toggleAiringFilter:M,editItem:N,switchToRegister:x,showAdminLogin:O,handleLoginSuccess:F,handleRegisterSuccess:de,handleAdminSetup:ce,debugNavigateToAdmin:rt,closeEditModal:Ce,closeBulkAddModal:B,handleBulkAddItems:ke,handleSaveItem:Ue,handleDeleteItem:De,logout:Fe,loadMedia:le,toggleFloatingMenu:we,addNewItem:Ae,bulkAddItems:Ee,importFromTxt:Le,importFromAPI:Ne,createCollection:Ge,exportMediaCollection:We,exportAsCSV:Se,exportAsJSON:Ve,downloadFile:ze,deleteAllInCategory:je,getCategoryDisplayName:pe,processTxtContent:_e,closeTxtImportResults:Xe,messageStore:t,confirmStore:o,inputStore:e,statistics:p,formatDate:w,getRatingStars:L,sidebarStore:c}}},Di={class:"vue-app"},Fi={class:"main-content"},Ei={class:"content-area"},Li={key:1,class:"error"},Ni={key:2},Gi={key:0,class:"statistics-container"},Wi={class:"statistics-header"},Vi={class:"refresh-controls"},zi={class:"statistics-content"},ji={class:"stats-summary"},Oi={class:"summary-card"},Hi={class:"summary-number"},qi={class:"summary-card"},Ji={class:"summary-number"},Ki={class:"summary-card"},Qi={class:"summary-number"},Zi={class:"summary-card"},Xi={class:"summary-number"},Yi={class:"chart-container"},$i={class:"category-stats"},en={class:"category-name"},tn={class:"category-bar"},sn={class:"category-count"},on={class:"chart-container"},an={class:"rating-stats"},nn={class:"rating-stars"},rn={class:"rating-bar"},ln={class:"rating-count"},dn={class:"chart-container"},cn={class:"platform-stats"},un={class:"platform-name"},gn={class:"platform-bar"},mn={class:"platform-count"},fn={class:"chart-container"},pn={class:"genre-stats"},hn={class:"genre-name"},vn={class:"genre-bar"},yn={class:"genre-count"},bn={class:"chart-container"},kn={class:"recent-activity"},wn={class:"activity-title"},Sn={class:"activity-category"},_n={class:"activity-date"},In={class:"chart-container"},Cn={class:"airing-series"},An={class:"airing-title"},Tn={class:"airing-next"},xn={class:"airing-date"},Pn={key:0,class:"admin-setup-container"},Mn=["disabled"],Rn={key:0},Bn={key:1};function Un(r,t,o,e,i,c){const n=J("Sidebar"),l=J("MainHeader"),a=J("LoadingSpinner"),k=J("MediaItem"),C=J("LoginModal"),_=J("RegisterModal"),S=J("EditModal"),A=J("BulkAddModal"),K=J("TxtImportModal"),Z=J("TxtImportResultsModal"),G=J("FloatingActionButton"),ee=J("MessageBox"),oe=J("ConfirmDialog"),te=J("InputDialog");return u(),g("div",Di,[s("div",{class:Q(["mobile-overlay",{show:e.sidebarStore.mobileOpen}]),onClick:t[0]||(t[0]=(...v)=>e.sidebarStore.closeMobileSidebar&&e.sidebarStore.closeMobileSidebar(...v))},null,2),ae(n,{collapsed:e.sidebarStore.collapsed,"mobile-open":e.sidebarStore.mobileOpen,"is-logged-in":e.isLoggedIn,"is-admin":e.isAdmin,"user-name":e.userName,"current-category":e.currentCategory,"category-counts":e.categoryCounts,platforms:e.platforms,genres:e.genres,categories:e.categories,onToggle:e.sidebarStore.toggleSidebar,onSetCategory:e.setCategory,onNavigateToCalendar:e.navigateToCalendar,onNavigateToProfile:e.navigateToProfile,onNavigateToAdmin:e.debugNavigateToAdmin,onTogglePlatformFilter:e.togglePlatformFilter,onToggleGenreFilter:e.toggleGenreFilter,onToggleAiringFilter:e.toggleAiringFilter,onAddItem:e.addItemFromSidebar,onShowLogin:t[1]||(t[1]=v=>e.showLoginModal=!0),onShowRegister:t[2]||(t[2]=v=>e.showRegisterModal=!0),onShowAdminLogin:e.showAdminLogin,onLogout:e.logout},null,8,["collapsed","mobile-open","is-logged-in","is-admin","user-name","current-category","category-counts","platforms","genres","categories","onToggle","onSetCategory","onNavigateToCalendar","onNavigateToProfile","onNavigateToAdmin","onTogglePlatformFilter","onToggleGenreFilter","onToggleAiringFilter","onAddItem","onShowAdminLogin","onLogout"]),s("div",Fi,[ae(l,{"search-query":e.searchQuery,"onUpdate:searchQuery":t[3]||(t[3]=v=>e.searchQuery=v),"grid-columns":e.gridColumns,"onUpdate:gridColumns":t[4]||(t[4]=v=>e.gridColumns=v),"sort-by":e.sortBy,"onUpdate:sortBy":t[5]||(t[5]=v=>e.sortBy=v),onToggleMobileSidebar:e.sidebarStore.toggleMobileSidebar,onClearSearch:e.clearSearch},null,8,["search-query","grid-columns","sort-by","onToggleMobileSidebar","onClearSearch"]),s("main",Ei,[e.loading?(u(),ve(a,{key:0,message:"Loading media data..."})):e.error?(u(),g("div",Li,[s("p",null,f(e.error),1),s("button",{onClick:t[6]||(t[6]=(...v)=>e.loadMedia&&e.loadMedia(...v))},"Retry")])):(u(),g("div",Ni,[e.currentCategory==="statistics"?(u(),g("div",Gi,[s("div",Wi,[t[12]||(t[12]=s("h1",null,"📊 Media Library Statistics",-1)),t[13]||(t[13]=s("p",null,"Übersicht über deine Media Collection",-1)),s("div",Vi,[s("button",{class:"refresh-btn",onClick:t[7]||(t[7]=(...v)=>e.loadMedia&&e.loadMedia(...v))},"🔄 Refresh Statistics")])]),s("div",zi,[s("div",ji,[s("div",Oi,[s("div",Hi,f(e.statistics.totalItems),1),t[14]||(t[14]=s("div",{class:"summary-label"},"Total Items",-1))]),s("div",qi,[s("div",Ji,f(e.statistics.totalCollections),1),t[15]||(t[15]=s("div",{class:"summary-label"},"Collections",-1))]),s("div",Ki,[s("div",Qi,f(e.statistics.totalPlaytime)+"h",1),t[16]||(t[16]=s("div",{class:"summary-label"},"Total Playtime",-1))]),s("div",Zi,[s("div",Xi,f(e.statistics.avgRating),1),t[17]||(t[17]=s("div",{class:"summary-label"},"Avg Rating",-1))])]),s("div",Yi,[t[18]||(t[18]=s("h3",{class:"chart-title"},"📈 Category Distribution",-1)),s("div",$i,[(u(!0),g(X,null,Y(e.statistics.categoryDistribution,(v,E)=>(u(),g("div",{key:E,class:"category-stat"},[s("div",en,f(E),1),s("div",tn,[s("div",{class:"category-fill",style:ue({width:`${v/e.statistics.totalItems*100}%`})},null,4)]),s("div",sn,f(v)+" ("+f((v/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",on,[t[19]||(t[19]=s("h3",{class:"chart-title"},"⭐ Rating Distribution",-1)),s("div",an,[(u(!0),g(X,null,Y(e.statistics.ratingDistribution,(v,E)=>(u(),g("div",{key:E,class:"rating-stat"},[s("div",nn,f(e.getRatingStars(E)),1),s("div",rn,[s("div",{class:"rating-fill",style:ue({width:`${v/e.statistics.totalItems*100}%`})},null,4)]),s("div",ln,f(v)+" ("+f((v/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",dn,[t[20]||(t[20]=s("h3",{class:"chart-title"},"🎮 Platform Distribution",-1)),s("div",cn,[(u(!0),g(X,null,Y(e.statistics.platformDistribution,(v,E)=>(u(),g("div",{key:E,class:"platform-stat"},[s("div",un,f(E),1),s("div",gn,[s("div",{class:"platform-fill",style:ue({width:`${v/e.statistics.totalItems*100}%`})},null,4)]),s("div",mn,f(v)+" ("+f((v/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",fn,[t[21]||(t[21]=s("h3",{class:"chart-title"},"🎭 Top Genres",-1)),s("div",pn,[(u(!0),g(X,null,Y(e.statistics.genreDistribution,(v,E)=>(u(),g("div",{key:E,class:"genre-stat"},[s("div",hn,f(E),1),s("div",vn,[s("div",{class:"genre-fill",style:ue({width:`${v/e.statistics.totalItems*100}%`})},null,4)]),s("div",yn,f(v)+" ("+f((v/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",bn,[t[22]||(t[22]=s("h3",{class:"chart-title"},"📅 Recent Activity",-1)),s("div",kn,[(u(!0),g(X,null,Y(e.statistics.recentActivity,v=>(u(),g("div",{key:v.title,class:"activity-item"},[s("div",wn,f(v.title),1),s("div",Sn,f(v.category),1),s("div",_n,f(e.formatDate(v.discovered)),1)]))),128))])]),s("div",In,[t[23]||(t[23]=s("h3",{class:"chart-title"},"📺 Currently Airing Series",-1)),s("div",Cn,[(u(!0),g(X,null,Y(e.statistics.airingSeries,v=>(u(),g("div",{key:v.title,class:"airing-item"},[s("div",An,f(v.title),1),s("div",Tn,"Next: Season "+f(v.nextSeason),1),s("div",xn,f(v.nextSeasonRelease?e.formatDate(v.nextSeasonRelease):"TBA"),1)]))),128))])])])])):(u(),g("div",{key:1,class:"grid",style:ue({gridTemplateColumns:`repeat(${e.gridColumns}, 1fr)`})},[(u(!0),g(X,null,Y(e.paginatedMedia,v=>(u(),ve(k,{key:v.id,item:v,onEdit:e.editItem},null,8,["item","onEdit"]))),128))],4))]))])]),e.isLoggedIn?h("",!0):(u(),g("div",Pn,[s("button",{onClick:t[8]||(t[8]=(...v)=>e.handleAdminSetup&&e.handleAdminSetup(...v)),disabled:e.adminSetupLoading,class:"admin-setup-btn",title:"Setup Admin Account (Creates admin account with default password)"},[e.adminSetupLoading?(u(),g("span",Rn,"🔧 Setting up...")):(u(),g("span",Bn,"🔧 Admin Setup"))],8,Mn),e.adminSetupMessage?(u(),g("div",{key:0,class:Q(["admin-setup-message",e.adminSetupMessage.type])},f(e.adminSetupMessage.text),3)):h("",!0)])),e.showLoginModal?(u(),ve(C,{key:1,onClose:t[9]||(t[9]=v=>e.showLoginModal=!1),onSuccess:e.handleLoginSuccess,onSwitchToRegister:e.switchToRegister},null,8,["onSuccess","onSwitchToRegister"])):h("",!0),e.showRegisterModal?(u(),ve(_,{key:2,onClose:t[10]||(t[10]=v=>e.showRegisterModal=!1),onSuccess:e.handleRegisterSuccess},null,8,["onSuccess"])):h("",!0),e.showEditModal?(u(),ve(S,{key:3,item:e.editingItem,"current-category":e.currentCategory,onClose:e.closeEditModal,onSave:e.handleSaveItem,onDelete:e.handleDeleteItem},null,8,["item","current-category","onClose","onSave","onDelete"])):h("",!0),ae(A,{show:e.showBulkAddModal,"current-category":e.currentCategory,onClose:e.closeBulkAddModal},null,8,["show","current-category","onClose"]),ae(K,{show:e.showTxtImportModal,onClose:t[11]||(t[11]=v=>e.showTxtImportModal=!1),onFileProcessed:e.processTxtContent},null,8,["show","onFileProcessed"]),ae(Z,{show:e.showTxtImportResults,results:e.txtImportResults,onClose:e.closeTxtImportResults},null,8,["show","results","onClose"]),ae(G,{"show-menu":e.showFloatingMenu,"show-delete-all":e.isLoggedIn&&e.currentCategory!=="all"&&e.categoryCounts[e.currentCategory]>0,"category-name":e.currentCategoryDisplayName,"item-count":e.categoryCounts[e.currentCategory]||0,onToggleMenu:e.toggleFloatingMenu,onAddNewItem:e.addNewItem,onBulkAddItems:e.bulkAddItems,onImportFromTxt:e.importFromTxt,onImportFromApi:e.importFromAPI,onCreateCollection:e.createCollection,onDeleteAllInCategory:e.deleteAllInCategory},null,8,["show-menu","show-delete-all","category-name","item-count","onToggleMenu","onAddNewItem","onBulkAddItems","onImportFromTxt","onImportFromApi","onCreateCollection","onDeleteAllInCategory"]),ae(ee,{show:e.messageStore.show,type:e.messageStore.type,title:e.messageStore.title,message:e.messageStore.message,details:e.messageStore.details,onClose:e.messageStore.closeMessage},null,8,["show","type","title","message","details","onClose"]),ae(oe,{show:e.confirmStore.show,title:e.confirmStore.title,message:e.confirmStore.message,onConfirm:e.confirmStore.confirm,onClose:e.confirmStore.cancel},null,8,["show","title","message","onConfirm","onClose"]),ae(te,{show:e.inputStore.show,title:e.inputStore.title,message:e.inputStore.message,placeholder:e.inputStore.placeholder,"input-type":e.inputStore.inputType,"default-value":e.inputStore.defaultValue,onConfirm:e.inputStore.confirm,onClose:e.inputStore.cancel},null,8,["show","title","message","placeholder","input-type","default-value","onConfirm","onClose"])])}const Ln=$(Ui,[["render",Un],["__scopeId","data-v-bac26f2f"]]);export{Ln as default};
