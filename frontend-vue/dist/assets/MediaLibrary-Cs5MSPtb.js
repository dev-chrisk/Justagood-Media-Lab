import{d as Ne,r as w,u as ze,c as P,_ as K,a as d,b as o,e as p,t as m,n as Z,o as n,f as Ye,w as re,g as Y,h as L,v as ke,i as N,F as de,j as ce,k as Se,m as ie,l as Ze,p as Ge,q as $e,s as et,x as tt,y as Oe,z as qe,A as Q,B as ne,C as G,D as ot}from"./index-CvWOnAMC.js";import{u as Ve,r as be}from"./media-CP2wfeMc.js";import{R as st,L as at,M as lt,S as nt}from"./RegisterModal-CgCRDFnR.js";const je=Ne("message",()=>{const l=w(!1),e=w("info"),a=w(""),t=w(""),i=w("");function u(_){e.value=_.type||"info",a.value=_.title||"",t.value=_.message||"",i.value=_.details||"",l.value=!0}function s(_,F="Success",B=""){u({type:"success",title:F,message:_,details:B})}function c(_,F="Error",B=""){u({type:"error",title:F,message:_,details:B})}function r(_,F="Warning",B=""){u({type:"warning",title:F,message:_,details:B})}function A(_,F="Info",B=""){u({type:"info",title:F,message:_,details:B})}function S(){l.value=!1,setTimeout(()=>{e.value="info",a.value="",t.value="",i.value=""},300)}return{show:l,type:e,title:a,message:t,details:i,showMessage:u,showSuccess:s,showError:c,showWarning:r,showInfo:A,closeMessage:S}}),Ke=Ne("confirm",()=>{const l=w(!1),e=w("Confirm Action"),a=w(""),t=w(null);function i(c){return new Promise(r=>{e.value=c.title||"Confirm Action",a.value=c.message||"",l.value=!0,t.value=r})}function u(){t.value&&(t.value(!0),t.value=null),l.value=!1}function s(){t.value&&(t.value(!1),t.value=null),l.value=!1}return{show:l,title:e,message:a,showConfirm:i,confirm:u,cancel:s}}),He=Ne("input",()=>{const l=w(!1),e=w("Input Required"),a=w(""),t=w(""),i=w("text"),u=w(""),s=w(null);function c(S){return new Promise(_=>{e.value=S.title||"Input Required",a.value=S.message||"",t.value=S.placeholder||"",i.value=S.inputType||"text",u.value=S.defaultValue||"",l.value=!0,s.value=_})}function r(S){s.value&&(s.value(S),s.value=null),l.value=!1}function A(){s.value&&(s.value(null),s.value=null),l.value=!1}return{show:l,title:e,message:a,placeholder:t,inputType:i,defaultValue:u,showInput:c,confirm:r,cancel:A}});function it(){const l=ze(),e=Ve(),a=je(),t=Ke(),i=He(),u=w(!1),s=w(!1),c=w(!1),r=w(!1),A=w(!1),S=w(!1),_=w(!1),F=w(!1),B=w(!1),I=w(null),b=w(8),C=w("order_asc"),y=w(null),V=[{key:"game",name:"Games",icon:"🎮"},{key:"series",name:"Series",icon:"📺"},{key:"movie",name:"Movies",icon:"🎬"},{key:"watchlist",name:"Watchlist",icon:"❤️"}],D=P(()=>l.isLoggedIn),j=P(()=>l.userName),M=P(()=>e.currentCategory),ue=P({get:()=>e.searchQuery,set:v=>e.setSearchQuery(v)}),oe=P(()=>e.categoryCounts),me=P(()=>e.loading),ge=P(()=>e.error),g=P(()=>{const v=[...e.filteredMedia],[h,R]=C.value.split("_");return v.sort((k,T)=>{let z=k[h],U=T[h];return h==="order"&&(z=k.__order||0,U=T.__order||0),typeof z=="string"&&(z=z.toLowerCase(),U=U.toLowerCase()),R==="asc"?z>U?1:-1:z<U?1:-1})}),f=P(()=>g.value),x=P(()=>{if(!e||!e.mediaData)return[];const v=new Set;return e.mediaData.forEach(h=>{h.platforms&&h.platforms.split(",").forEach(R=>v.add(R.trim()))}),Array.from(v).sort()}),W=P(()=>{if(!e||!e.mediaData)return[];const v=new Set;return e.mediaData.forEach(h=>{h.genre&&h.genre.split(",").forEach(R=>v.add(R.trim()))}),Array.from(v).sort()}),H=()=>{u.value=!u.value},O=()=>{s.value=!s.value},q=()=>{s.value=!1},fe=v=>{e.setCategory(v),s.value=!1},$=()=>{e.setSearchQuery("")},Ce=(v,h)=>{h?e.addFilter({type:"platform",value:v}):e.removeFilter({type:"platform",value:v})},_e=(v,h)=>{h?e.addFilter({type:"genre",value:v}):e.removeFilter({type:"genre",value:v})},Te=v=>{I.value=v,A.value=!0},ve=()=>{A.value=!1,I.value=null},pe=()=>{_.value=!1},Me=async v=>{try{const h=await e.batchAddMediaItems(v);if(h.success){const{created:R,failed:k}=h.stats;let T=`Successfully added ${R} items`;k>0&&(T+=` (${k} failed)`),a.showSuccess(T,"Bulk Add Successful")}pe()}catch(h){console.error("Bulk add failed:",h),a.showError("Failed to add items: "+(h.message||"Unknown error"),"Bulk Add Failed")}},xe=async v=>{I.value?await e.updateMediaItem(I.value.id,v):await e.addMediaItem(v),ve()},Ae=async v=>{await e.deleteMediaItem(v.id)},ee=async()=>{await l.logout(),await se()},se=async()=>{await e.loadMedia()},ye=()=>{S.value=!S.value},De=()=>{if(S.value=!1,!D.value){a.showWarning("Bitte loggen Sie sich ein, um neue Items hinzuzufügen.","Login erforderlich");return}I.value=null,A.value=!0},Ue=()=>{if(S.value=!1,!D.value){a.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}_.value=!0},Re=()=>{if(S.value=!1,!D.value){a.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}F.value=!0},Le=()=>{if(S.value=!1,!D.value){a.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}a.showInfo("API Import feature coming soon!","Feature in Entwicklung")},Fe=()=>{if(S.value=!1,!D.value){a.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}he()},ae=v=>{const h=V.find(R=>R.key===v);return h?h.name:v},Pe=async()=>{const v=ae(M.value),h=oe.value[M.value]||0;if(h===0){a.showInfo("No items to delete in this category.","Nothing to Delete");return}const R=`Are you sure you want to delete ALL ${h} items in "${v}"?

This action cannot be undone!`;if(await t.showConfirm({title:"Delete All Items",message:R}))try{const z=((e==null?void 0:e.mediaData)||[]).filter(U=>M.value==="watchlist"?U.category==="watchlist"||U.isNew===!0:U.category===M.value).map(U=>U.id);await e.batchDeleteMediaItems(z),await se(),a.showSuccess(`Successfully deleted ${h} items from "${v}"`,"Items Deleted")}catch(T){console.error("Error deleting items:",T),a.showError("Error occurred while deleting items. Please try again.","Delete Failed")}},Be=v=>{const h=v.split(`
`).map(U=>U.trim()).filter(U=>U.length>0);if(h.length===0){a.showWarning("Die TXT-Datei ist leer oder enthält keine gültigen Einträge.","Leere Datei");return}const k=e.filteredMedia.map(U=>U.title.toLowerCase().trim()),T=h.filter(U=>{const X=U.toLowerCase().trim();return!k.some(E=>E.includes(X)||X.includes(E))}),z=h.filter(U=>{const X=U.toLowerCase().trim();return k.some(E=>E.includes(X)||X.includes(E))});y.value={totalInFile:h.length,missingItems:T,existingItems:z,currentCategory:M.value,categoryName:ae(M.value)},F.value=!1,B.value=!0},Ee=()=>{y.value=null,B.value=!1},he=async()=>{const v=(e==null?void 0:e.mediaData)||[];if(v.length===0){a.showInfo("Keine Media Items zum Exportieren gefunden.","Nichts zu exportieren");return}const h=await i.showInput({title:"Export Format wählen",message:`1 = CSV
2 = JSON
3 = Beide

Geben Sie die Nummer ein:`,placeholder:"1",defaultValue:"1"});if(!h||!["1","2","3"].includes(h))return;const R=new Date().toISOString().split("T")[0];(h==="1"||h==="3")&&we(v,R),(h==="2"||h==="3")&&Ie(v,R),a.showSuccess(`Collection mit ${v.length} Items wurde erfolgreich exportiert!`,"Export erfolgreich")},we=(v,h)=>{const k=[["Titel","Kategorie","Release","Rating","Platforms","Genre","Spielzeit","Status","Beschreibung"].join(","),...v.map(T=>[`"${(T.title||"").replace(/"/g,'""')}"`,`"${(T.category||T.category_name||"Unbekannt").replace(/"/g,'""')}"`,`"${T.release||""}"`,`"${T.rating||""}"`,`"${(T.platforms||"").replace(/"/g,'""')}"`,`"${(T.genre||"").replace(/"/g,'""')}"`,`"${T.spielzeit||""}"`,`"${T.isAiring?"Airing":"Abgeschlossen"}"`,`"${(T.description||"").replace(/"/g,'""')}"`].join(","))].join(`
`);le(k,`media_collection_${h}.csv`,"text/csv;charset=utf-8;")},Ie=(v,h)=>{const R={exportDate:new Date().toISOString(),totalItems:v.length,categories:[...new Set(v.map(k=>k.category||k.category_name||"Unbekannt"))],items:v.map(k=>({id:k.id,title:k.title||"",category:k.category||k.category_name||"Unbekannt",release:k.release||"",rating:k.rating||null,platforms:k.platforms||"",genre:k.genre||"",spielzeit:k.spielzeit||null,status:k.isAiring?"Airing":"Abgeschlossen",description:k.description||"",isNew:k.isNew||!1,nextSeason:k.nextSeason||null,discovered:k.discovered||null}))};le(JSON.stringify(R,null,2),`media_collection_${h}.json`,"application/json;charset=utf-8;")},le=(v,h,R)=>{const k=new Blob([v],{type:R}),T=document.createElement("a"),z=URL.createObjectURL(k);T.setAttribute("href",z),T.setAttribute("download",h),T.style.visibility="hidden",document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(z)};return{sidebarCollapsed:u,mobileSidebarOpen:s,showLoginModal:c,showRegisterModal:r,showEditModal:A,showFloatingMenu:S,showBulkAddModal:_,showTxtImportModal:F,showTxtImportResults:B,editingItem:I,gridColumns:b,sortBy:C,categories:V,txtImportResults:y,isLoggedIn:D,userName:j,currentCategory:M,searchQuery:ue,categoryCounts:oe,loading:me,error:ge,paginatedMedia:f,platforms:x,genres:W,toggleSidebar:H,toggleMobileSidebar:O,closeMobileSidebar:q,setCategory:fe,clearSearch:$,togglePlatformFilter:Ce,toggleGenreFilter:_e,editItem:Te,closeEditModal:ve,closeBulkAddModal:pe,handleBulkAddItems:Me,handleSaveItem:xe,handleDeleteItem:Ae,logout:ee,loadMedia:se,toggleFloatingMenu:ye,addNewItem:De,bulkAddItems:Ue,importFromTxt:Re,importFromAPI:Le,createCollection:Fe,exportMediaCollection:he,exportAsCSV:we,exportAsJSON:Ie,downloadFile:le,deleteAllInCategory:Pe,getCategoryDisplayName:ae,processTxtContent:Be,closeTxtImportResults:Ee}}const rt={name:"MediaItem",props:{item:{type:Object,required:!0}},emits:["edit"],computed:{showWatchlistTag(){return this.item.category==="watchlist"||this.item.isNew===!0},isWatchlistItem(){return this.item.category==="watchlist"||this.item.isNew===!0}},methods:{getImageUrl(l){return l.startsWith("http")||l.startsWith("/")?l:l.startsWith("images_downloads/")?`/storage/${l}`:`/storage/${l}`},handleImageError(l){var e;l.target.style.display="none",(e=l.target.nextElementSibling)==null||e.classList.add("show")},formatDate(l){return l?new Date(l).toLocaleDateString():""},editItem(){this.$emit("edit",this.item)},getWatchlistReleaseStatus(){if(!this.item.release)return"";const l=new Date(this.item.release),e=new Date;e.setHours(0,0,0,0),l.setHours(0,0,0,0);const a=l.getTime()-e.getTime(),t=Math.ceil(a/(1e3*3600*24));if(t>0)return t===1?"Tomorrow!":t<=7?`${t} days left`:t<=30?`${t} days left`:`${Math.ceil(t/30)} months left`;if(t===0)return"Released today!";{const i=this.getTypeTagText().toLowerCase();return i==="game"?"Unplayed yet":i==="series"||i==="movie"?"Unwatched yet":"Unconsumed yet"}},getWatchlistReleaseStatusClass(){if(!this.item.release)return"";const l=new Date(this.item.release),e=new Date;e.setHours(0,0,0,0),l.setHours(0,0,0,0);const a=l.getTime()-e.getTime(),t=Math.ceil(a/(1e3*3600*24));return t>0?"countdown":t===0?"released-today":"unconsumed"},getTypeTagText(){var e,a,t;const l=this.item.watchlistType||this.item.watchlist_type;if(l)return l.charAt(0).toUpperCase()+l.slice(1);if(this.item.genre){const i=this.item.genre.toLowerCase();if(i.includes("game")||i.includes("gaming")||(e=this.item.platforms)!=null&&e.toLowerCase().includes("steam")||(a=this.item.platforms)!=null&&a.toLowerCase().includes("ps")||(t=this.item.platforms)!=null&&t.toLowerCase().includes("xbox"))return"Game";if(i.includes("series")||i.includes("tv")||i.includes("episode")||this.item.isAiring)return"Series";if(i.includes("movie")||i.includes("film")||i.includes("cinema"))return"Movie"}if(this.item.platforms){const i=this.item.platforms.toLowerCase();if(i.includes("steam")||i.includes("ps")||i.includes("xbox")||i.includes("nintendo")||i.includes("pc"))return"Game";if(i.includes("netflix")||i.includes("hulu")||i.includes("disney")||i.includes("hbo"))return"Series";if(i.includes("cinema")||i.includes("theater"))return"Movie"}return"Media"},getTypeTagClass(){return`type-${this.getTypeTagText().toLowerCase()}`}}},dt={class:"media-image"},ct=["src","alt"],ut={key:1,class:"no-image"},mt={class:"media-info"},gt={class:"media-title"},ft={class:"media-meta"},vt={key:0,class:"media-release"},pt={key:1},yt={key:1,class:"media-rating"},ht={key:0,class:"media-platforms"},wt={key:1,class:"media-genre"},It={key:2,class:"media-airing"},bt={key:0},kt={key:3,class:"watchlist-type-tag"};function St(l,e,a,t,i,u){return n(),d("div",{class:"media-item",onClick:e[1]||(e[1]=(...s)=>u.editItem&&u.editItem(...s))},[o("div",dt,[a.item.path?(n(),d("img",{key:0,src:u.getImageUrl(a.item.path),alt:a.item.title,onError:e[0]||(e[0]=(...s)=>u.handleImageError&&u.handleImageError(...s))},null,40,ct)):(n(),d("div",ut,[...e[2]||(e[2]=[o("span",{class:"no-image-icon"},"📁",-1)])]))]),o("div",mt,[o("h3",gt,m(a.item.title),1),o("div",ft,[a.item.release?(n(),d("span",vt,[u.isWatchlistItem&&a.item.release?(n(),d("span",{key:0,class:Z(u.getWatchlistReleaseStatusClass())},m(u.getWatchlistReleaseStatus()),3)):(n(),d("span",pt,m(u.formatDate(a.item.release)),1))])):p("",!0),a.item.rating?(n(),d("span",yt,m("★".repeat(Math.max(0,Math.min(5,Math.floor(a.item.rating)))))+m("☆".repeat(Math.max(0,5-Math.max(0,Math.min(5,Math.floor(a.item.rating)))))),1)):p("",!0)]),a.item.platforms?(n(),d("div",ht,m(a.item.platforms),1)):p("",!0),a.item.genre?(n(),d("div",wt,m(a.item.genre),1)):p("",!0),a.item.isAiring?(n(),d("div",It,[e[3]||(e[3]=o("span",{class:"airing-badge"},"Airing",-1)),a.item.nextSeason?(n(),d("span",bt,"S"+m(a.item.nextSeason),1)):p("",!0)])):p("",!0),u.showWatchlistTag?(n(),d("div",kt,[o("span",{class:Z(["type-tag",u.getTypeTagClass()])},m(u.getTypeTagText()),3)])):p("",!0)]),e[4]||(e[4]=o("div",{class:"edit-indicator"},[o("span",{class:"edit-icon"},"✏️")],-1))])}const Ct=K(rt,[["render",St],["__scopeId","data-v-3e5773f6"]]),_t={name:"FloatingActionButton",props:{showMenu:{type:Boolean,default:!1},showDeleteAll:{type:Boolean,default:!1},categoryName:{type:String,default:""},itemCount:{type:Number,default:0}},emits:["toggleMenu","addNewItem","bulkAddItems","importFromTxt","importFromAPI","createCollection","deleteAllInCategory"]},Tt={class:"floating-actions"},Mt={class:"menu-text"},xt={class:"item-count-badge"};function At(l,e,a,t,i,u){return n(),d("div",Tt,[o("div",{class:Z(["floating-menu",{show:a.showMenu}])},[o("button",{class:"floating-menu-item",onClick:e[0]||(e[0]=s=>l.$emit("addNewItem"))},[...e[7]||(e[7]=[o("span",{class:"menu-icon"},"➕",-1),o("span",{class:"menu-text"},"Add Item",-1)])]),o("button",{class:"floating-menu-item",onClick:e[1]||(e[1]=s=>l.$emit("bulkAddItems"))},[...e[8]||(e[8]=[o("span",{class:"menu-icon"},"📦",-1),o("span",{class:"menu-text"},"Bulk Add",-1)])]),o("button",{class:"floating-menu-item",onClick:e[2]||(e[2]=s=>l.$emit("importFromTxt"))},[...e[9]||(e[9]=[o("span",{class:"menu-icon"},"📄",-1),o("span",{class:"menu-text"},"Import from TXT",-1)])]),o("button",{class:"floating-menu-item",onClick:e[3]||(e[3]=s=>l.$emit("importFromAPI"))},[...e[10]||(e[10]=[o("span",{class:"menu-icon"},"🌐",-1),o("span",{class:"menu-text"},"Import from API",-1)])]),o("button",{class:"floating-menu-item",onClick:e[4]||(e[4]=s=>l.$emit("createCollection"))},[...e[11]||(e[11]=[o("span",{class:"menu-icon"},"📚",-1),o("span",{class:"menu-text"},"Create Collection",-1)])]),a.showDeleteAll&&a.itemCount>0?(n(),d("button",{key:0,class:"floating-menu-item delete-all-item",onClick:e[5]||(e[5]=s=>l.$emit("deleteAllInCategory"))},[e[12]||(e[12]=o("span",{class:"menu-icon"},"🗑️",-1)),o("span",Mt,"Delete All "+m(a.categoryName),1),o("span",xt,"("+m(a.itemCount)+")",1)])):p("",!0)],2),o("button",{class:"floating-add-btn",onClick:e[6]||(e[6]=s=>l.$emit("toggleMenu"))},m(a.showMenu?"✕":"+"),1)])}const Dt=K(_t,[["render",At],["__scopeId","data-v-19731834"]]),Ut={name:"EditModal",props:{item:{type:Object,default:null},currentCategory:{type:String,default:"watchlist"}},emits:["close","save","delete"],setup(l,{emit:e}){const a=w(!1),t=w(""),i=w([]),u=w(null),s=w(null),c=w(""),r=Ye({category:"watchlist",title:"",release:"",rating:"",count:"",platforms:"",genre:"",link:"",path:"",discovered:"",spielzeit:"",isAiring:!1,nextSeason:"",nextSeasonRelease:"",imageUrl:"",watchlistType:""}),A=P(()=>!!l.item),S=P(()=>r.category==="game"),_=P(()=>r.category==="series"),F=P(()=>r.category==="watchlist");re(()=>l.item,g=>{g?Object.keys(r).forEach(f=>{r[f]=g[f]||""}):Object.keys(r).forEach(f=>{f==="category"?r[f]=l.currentCategory||"watchlist":r[f]=""})},{immediate:!0}),re(()=>l.currentCategory,g=>{!l.item&&g&&(r.category=g)});const B=async()=>{if(!r.title){t.value="Title is required";return}if(r.category==="watchlist"&&!r.watchlistType){t.value="Please select a type for watchlist items";return}if(r.category==="watchlist"&&!r.release){t.value="Release date is required for watchlist items";return}a.value=!0,t.value="";try{const g=await C(r.title,r.category);if(g&&g.isDuplicate){t.value=`Ein Eintrag mit dem Titel "${r.title}" und der Kategorie "${r.category}" existiert bereits.`,a.value=!1;return}const f={...r};f.imageUrl&&f.imageUrl.trim()?f.path=f.imageUrl:(f.imageUrl=null,f.path=null),Object.keys(f).forEach(x=>{f[x]===""&&x!=="watchlistType"&&(f[x]=null)}),f.rating&&(f.rating=parseFloat(f.rating)),f.count&&(f.count=parseInt(f.count)),f.spielzeit&&(f.spielzeit=parseInt(f.spielzeit)),f.nextSeason&&(f.nextSeason=parseInt(f.nextSeason)),e("save",f)}catch(g){t.value=g.message||"Failed to save item"}finally{a.value=!1}},I=()=>{e("close")},b=()=>{e("delete",l.item),I()},C=async(g,f)=>{try{const x=localStorage.getItem("authToken"),W=localStorage.getItem("currentUser");if(!x||!W)return{isDuplicate:!1};const H=l.item?l.item.id:null,O=await ie.checkCategoryDuplicates(f);if(O.success&&O.duplicates){const q=O.duplicates.flat();return{isDuplicate:q.some($=>$.title===g&&$.id!==H),duplicates:q}}return{isDuplicate:!1}}catch(x){return console.error("Duplicate check failed:",x),{isDuplicate:!1}}};return{form:r,loading:a,error:t,apiResults:i,isEditing:A,isGame:S,isSeries:_,isWatchlist:F,imageUploadRef:s,uploadedImagePath:c,handleSave:B,closeModal:I,deleteItem:b,searchApi:async()=>{if(u.value&&clearTimeout(u.value),!r.title||r.title.length<3){i.value=[];return}u.value=setTimeout(async()=>{try{const g=r.category==="watchlist"?r.watchlistType:r.category;if(r.category==="watchlist"&&!r.watchlistType){i.value=[];return}const f=await ie.searchApi(r.title,g,10);f&&f.length>0?i.value=f.map(x=>({title:x.title,release:x.release,genre:x.overview||"",platforms:x.platforms||"",link:x.link||"",imageUrl:x.image||"",rating:x.rating||"",apiSource:x.api_source||"",id:x.id||""})):i.value=[{title:`"${r.title}" - Keine Ergebnisse gefunden`,release:"",genre:"Bitte manuell ausfüllen",isPlaceholder:!0}]}catch(g){console.error("API search failed:",g),i.value=[{title:`"${r.title}" - API nicht verfügbar`,release:"",genre:"Bitte manuell ausfüllen",isPlaceholder:!0}]}},500)},selectApiResult:async g=>{if(g.isPlaceholder){i.value=[];return}r.title=g.title,g.release&&(r.release=g.release),g.platforms&&(r.platforms=g.platforms),g.genre&&(r.genre=g.genre),g.link&&(r.link=g.link),g.rating&&(r.rating=g.rating),g.imageUrl?(r.imageUrl=g.imageUrl,r.path=g.imageUrl):(r.imageUrl="",r.path=""),i.value=[]},formatDate:g=>g?new Date(g).toLocaleDateString():"",getReleasePreview:()=>{var H;if(!r.release)return"";const g=new Date(r.release),f=new Date;f.setHours(0,0,0,0),g.setHours(0,0,0,0);const x=g.getTime()-f.getTime(),W=Math.ceil(x/(1e3*3600*24));if(W>0)return W===1?"Tomorrow!":W<=7?`${W} days left`:W<=30?`${W} days left`:`${Math.ceil(W/30)} months left`;if(W===0)return"Released today!";{const O=((H=r.watchlistType)==null?void 0:H.toLowerCase())||"media";return O==="game"?"Unplayed yet":O==="series"||O==="movie"?"Unwatched yet":"Unconsumed yet"}},triggerImageUpload:()=>{var g;(g=s.value)==null||g.click()},handleImageUpload:async g=>{const f=g.target.files[0];if(f){if(!f.type.startsWith("image/")){t.value="Please select a valid image file";return}if(f.size>10*1024*1024){t.value="Image file too large. Maximum size is 10MB";return}a.value=!0,t.value="";try{const x=r.title.replace(/[^a-zA-Z0-9\s\-_\.]/g,"").trim()||"item",W=Date.now(),H=f.name.split(".").pop()||"jpg",O=`images_downloads/uploads/${x}_${W}.${H}`,q=await ie.uploadImage(f,O);q.success?(c.value=q.saved,r.path=q.saved,r.imageUrl=q.saved):t.value=q.error||"Failed to upload image"}catch(x){t.value=x.message||"Failed to upload image"}finally{a.value=!1}}},getImagePreviewUrl:()=>c.value?`/storage/${c.value}`:r.imageUrl?r.imageUrl:"",handleImageError:g=>{console.warn("Image preview failed:",g.target.src),g.target.style.display="none"},clearImage:()=>{r.imageUrl="",r.path="",c.value="",s.value&&(s.value.value="")}}}},Rt={class:"form-header"},Lt={class:"form-group category-group"},Ft={class:"form-group title-group"},Pt={class:"search-container"},Bt=["placeholder","disabled"],Et={key:0,class:"search-results"},Nt=["onClick"],Vt={class:"result-thumbnail"},Wt=["src","alt"],zt={key:1,class:"no-image"},Gt={class:"result-content"},Ot={class:"result-title"},qt={class:"result-meta"},jt={key:0},Kt={key:1},Ht={key:2,class:"rating"},Qt={class:"form-row"},Xt={class:"form-group"},Jt={for:"release"},Yt={key:0,class:"required"},Zt=["required"],$t={key:0,class:"field-hint"},eo={key:1,class:"release-preview"},to={class:"form-group"},oo={class:"form-row"},so={class:"form-group"},ao={class:"form-group"},lo={class:"form-row"},no={class:"form-group"},io={class:"form-group"},ro={key:0,class:"form-row"},co={class:"form-group"},uo={key:0,class:"field-error"},mo={class:"form-row"},go={class:"form-group"},fo={class:"form-group"},vo={key:1,class:"form-row"},po={class:"form-group"},yo={key:2,class:"form-row"},ho={class:"form-group"},wo={key:0,class:"form-group"},Io={key:3,class:"form-row"},bo={class:"form-group"},ko={class:"form-row"},So={class:"form-group"},Co={class:"form-group"},_o={class:"image-upload-container"},To=["disabled"],Mo={key:0,class:"upload-success"},xo={key:4,class:"form-row"},Ao={class:"form-group image-preview-group"},Do={class:"image-preview"},Uo=["src","alt"],Ro={key:5,class:"error-message"},Lo={class:"modal-buttons"},Fo=["disabled"],Po=["disabled"],Bo=["disabled"],Eo=["disabled"];function No(l,e,a,t,i,u){return n(),d("div",{class:"modal",onClick:e[26]||(e[26]=(...s)=>t.closeModal&&t.closeModal(...s))},[o("div",{class:"modal-content",onClick:e[25]||(e[25]=Y(()=>{},["stop"]))},[o("h2",null,m(t.isEditing?"Edit Item":"Add Item"),1),o("form",{onSubmit:e[24]||(e[24]=Y((...s)=>t.handleSave&&t.handleSave(...s),["prevent"]))},[o("div",Rt,[o("div",Lt,[e[28]||(e[28]=o("label",{for:"category"},"Category:",-1)),L(o("select",{id:"category","onUpdate:modelValue":e[0]||(e[0]=s=>t.form.category=s),required:""},[...e[27]||(e[27]=[o("option",{value:"watchlist"},"Watchlist",-1),o("option",{value:"game"},"Game",-1),o("option",{value:"series"},"Series",-1),o("option",{value:"movie"},"Movie",-1)])],512),[[ke,t.form.category]])]),o("div",Ft,[e[29]||(e[29]=o("label",{for:"title"},"Title:",-1)),o("div",Pt,[L(o("input",{type:"text",id:"title","onUpdate:modelValue":e[1]||(e[1]=s=>t.form.title=s),onInput:e[2]||(e[2]=(...s)=>t.searchApi&&t.searchApi(...s)),required:"",placeholder:t.isWatchlist?"Enter title (API search + manual input available)":"Enter title",disabled:t.loading},null,40,Bt),[[N,t.form.title]]),t.apiResults.length>0?(n(),d("div",Et,[(n(!0),d(de,null,ce(t.apiResults,s=>(n(),d("div",{key:s.title,class:"search-result-item",onClick:c=>t.selectApiResult(s)},[o("div",Vt,[s.imageUrl?(n(),d("img",{key:0,src:s.imageUrl,alt:s.title},null,8,Wt)):(n(),d("div",zt,[o("span",null,m(s.title.charAt(0).toUpperCase()),1)]))]),o("div",Gt,[o("div",Ot,m(s.title),1),o("div",qt,[s.release?(n(),d("span",jt,m(t.formatDate(s.release)),1)):p("",!0),s.genre?(n(),d("span",Kt,m(s.genre),1)):p("",!0),s.rating?(n(),d("span",Ht,"⭐ "+m(s.rating),1)):p("",!0)])])],8,Nt))),128))])):p("",!0)])])]),o("div",Qt,[o("div",Xt,[o("label",Jt,[Se(m(t.isWatchlist?"Release Date:":"Release:")+" ",1),t.isWatchlist?(n(),d("span",Yt,"*")):p("",!0)]),L(o("input",{type:"date",id:"release","onUpdate:modelValue":e[3]||(e[3]=s=>t.form.release=s),required:t.isWatchlist},null,8,Zt),[[N,t.form.release]]),t.isWatchlist?(n(),d("div",$t," 📅 Set the release date to track countdown or status ")):p("",!0),t.isWatchlist&&t.form.release?(n(),d("div",eo,[e[30]||(e[30]=o("strong",null,"Preview:",-1)),Se(" "+m(t.getReleasePreview()),1)])):p("",!0)]),o("div",to,[e[31]||(e[31]=o("label",{for:"rating"},"Rating:",-1)),L(o("input",{type:"number",id:"rating","onUpdate:modelValue":e[4]||(e[4]=s=>t.form.rating=s),step:"0.1",min:"0",max:"10",placeholder:"0-10"},null,512),[[N,t.form.rating]])])]),o("div",oo,[o("div",so,[e[32]||(e[32]=o("label",{for:"views"},"Views:",-1)),L(o("input",{type:"number",id:"views","onUpdate:modelValue":e[5]||(e[5]=s=>t.form.count=s),min:"0",placeholder:"0"},null,512),[[N,t.form.count]])]),o("div",ao,[e[33]||(e[33]=o("label",{for:"discovered"},"Discovered:",-1)),L(o("input",{type:"date",id:"discovered","onUpdate:modelValue":e[6]||(e[6]=s=>t.form.discovered=s)},null,512),[[N,t.form.discovered]])])]),o("div",lo,[o("div",no,[e[34]||(e[34]=o("label",{for:"platforms"},"Platforms:",-1)),L(o("input",{type:"text",id:"platforms","onUpdate:modelValue":e[7]||(e[7]=s=>t.form.platforms=s),placeholder:"PC, PS5, Xbox"},null,512),[[N,t.form.platforms]])]),o("div",io,[e[35]||(e[35]=o("label",{for:"genre"},"Genre:",-1)),L(o("input",{type:"text",id:"genre","onUpdate:modelValue":e[8]||(e[8]=s=>t.form.genre=s),placeholder:"Action, Adventure, RPG"},null,512),[[N,t.form.genre]])])]),t.form.category==="watchlist"?(n(),d("div",ro,[o("div",co,[e[37]||(e[37]=o("label",{for:"watchlistType"},[Se("Type: "),o("span",{class:"required"},"*")],-1)),L(o("select",{id:"watchlistType","onUpdate:modelValue":e[9]||(e[9]=s=>t.form.watchlistType=s)},[...e[36]||(e[36]=[o("option",{value:""},"Select Type",-1),o("option",{value:"game"},"Game",-1),o("option",{value:"series"},"Series",-1),o("option",{value:"movie"},"Movie",-1)])],512),[[ke,t.form.watchlistType]]),t.form.category==="watchlist"&&!t.form.watchlistType?(n(),d("div",uo," Please select a type for watchlist items ")):p("",!0)])])):p("",!0),o("div",mo,[o("div",go,[e[38]||(e[38]=o("label",{for:"link"},"Link:",-1)),L(o("input",{type:"url",id:"link","onUpdate:modelValue":e[10]||(e[10]=s=>t.form.link=s),placeholder:"https://..."},null,512),[[N,t.form.link]])]),o("div",fo,[e[39]||(e[39]=o("label",{for:"path"},"Image Path:",-1)),L(o("input",{type:"text",id:"path","onUpdate:modelValue":e[11]||(e[11]=s=>t.form.path=s),placeholder:"images/movies/filename.jpg"},null,512),[[N,t.form.path]])])]),t.isGame?(n(),d("div",vo,[o("div",po,[e[40]||(e[40]=o("label",{for:"playtime"},"Playtime (Minutes):",-1)),L(o("input",{type:"number",id:"playtime","onUpdate:modelValue":e[12]||(e[12]=s=>t.form.spielzeit=s),min:"0",placeholder:"0"},null,512),[[N,t.form.spielzeit]])])])):p("",!0),t.isSeries?(n(),d("div",yo,[o("div",ho,[e[42]||(e[42]=o("label",{for:"isAiring"},"Status:",-1)),L(o("select",{id:"isAiring","onUpdate:modelValue":e[13]||(e[13]=s=>t.form.isAiring=s)},[...e[41]||(e[41]=[o("option",{value:!1},"Finished",-1),o("option",{value:!0},"Airing",-1)])],512),[[ke,t.form.isAiring]])]),t.form.isAiring?(n(),d("div",wo,[e[43]||(e[43]=o("label",{for:"nextSeason"},"Next Season:",-1)),L(o("input",{type:"number",id:"nextSeason","onUpdate:modelValue":e[14]||(e[14]=s=>t.form.nextSeason=s),min:"1",placeholder:"1"},null,512),[[N,t.form.nextSeason]])])):p("",!0)])):p("",!0),t.form.isAiring?(n(),d("div",Io,[o("div",bo,[e[44]||(e[44]=o("label",{for:"nextSeasonRelease"},"Next Season Release:",-1)),L(o("input",{type:"date",id:"nextSeasonRelease","onUpdate:modelValue":e[15]||(e[15]=s=>t.form.nextSeasonRelease=s)},null,512),[[N,t.form.nextSeasonRelease]])])])):p("",!0),o("div",ko,[o("div",So,[e[45]||(e[45]=o("label",{for:"imageUrl"},"Image URL (optional):",-1)),L(o("input",{type:"text",id:"imageUrl","onUpdate:modelValue":e[16]||(e[16]=s=>t.form.imageUrl=s),placeholder:"https://... or leave empty for API images"},null,512),[[N,t.form.imageUrl]])]),o("div",Co,[e[46]||(e[46]=o("label",{for:"imageUpload"},"Upload Image:",-1)),o("div",_o,[o("input",{type:"file",id:"imageUpload",ref:"imageUploadRef",onChange:e[17]||(e[17]=(...s)=>t.handleImageUpload&&t.handleImageUpload(...s)),accept:"image/*",style:{display:"none"}},null,544),o("button",{type:"button",onClick:e[18]||(e[18]=(...s)=>t.triggerImageUpload&&t.triggerImageUpload(...s)),class:"upload-btn",disabled:t.loading}," 📁 Choose Image ",8,To),t.uploadedImagePath?(n(),d("div",Mo," ✅ Image uploaded: "+m(t.uploadedImagePath),1)):p("",!0)])])]),t.form.imageUrl||t.uploadedImagePath?(n(),d("div",xo,[o("div",Ao,[e[47]||(e[47]=o("label",null,"Image Preview:",-1)),o("div",Do,[o("img",{src:t.getImagePreviewUrl(),alt:t.form.title,onError:e[19]||(e[19]=(...s)=>t.handleImageError&&t.handleImageError(...s))},null,40,Uo),o("button",{type:"button",onClick:e[20]||(e[20]=(...s)=>t.clearImage&&t.clearImage(...s)),class:"clear-image-btn",title:"Remove image"}," ✕ ")])])])):p("",!0),t.error?(n(),d("div",Ro,m(t.error),1)):p("",!0),o("div",Lo,[o("button",{type:"submit",disabled:t.loading},m(t.loading?"Saving...":"Save"),9,Fo),o("button",{type:"button",onClick:e[21]||(e[21]=(...s)=>t.closeModal&&t.closeModal(...s)),disabled:t.loading}," Cancel ",8,Po),t.isEditing?(n(),d("button",{key:0,type:"button",onClick:e[22]||(e[22]=(...s)=>t.deleteItem&&t.deleteItem(...s)),disabled:t.loading,class:"delete-btn"}," Delete ",8,Bo)):p("",!0),o("button",{type:"button",onClick:e[23]||(e[23]=(...s)=>t.handleSave&&t.handleSave(...s)),disabled:t.loading,class:"check-btn",title:"Add to list"}," ✓ ",8,Eo)])],32)])])}const Vo=K(Ut,[["render",No],["__scopeId","data-v-503a7e54"]]),Wo={name:"BulkAddModal",props:{show:{type:Boolean,default:!1},currentCategory:{type:String,default:""}},emits:["close","save"],setup(l,{emit:e}){const a=w(!1),t=w(null),i=w(0),u=w([]),s=w(!1),c=w({category:"",itemsText:"",defaultRating:null,defaultPlatforms:"",defaultGenre:""}),r=P(()=>{if(!c.value.itemsText||!c.value.itemsText.trim())return[];const I=c.value.itemsText.split(`
`).map(b=>b.trim()).filter(b=>b.length>0).map(b=>{const C=b.split("|").map(y=>y.trim());return{searchTerm:C[0]||"",additionalInfo:C[1]||null}});return u.value&&u.value.length>0?I.map((b,C)=>{const y=u.value[C];return{searchTerm:b.searchTerm,additionalInfo:b.additionalInfo,title:(y==null?void 0:y.title)||b.searchTerm,apiData:y||null,hasApiData:!!y}}):I.map(b=>({searchTerm:b.searchTerm,additionalInfo:b.additionalInfo,title:b.searchTerm,apiData:null,hasApiData:!1}))}),A=P(()=>c.value.category&&c.value.itemsText.trim()&&r.value&&r.value.length>0&&!s.value),S=()=>{e("close")},_=async()=>{try{const I=localStorage.getItem("authToken"),b=localStorage.getItem("currentUser");if(!I||!b)return{hasDuplicates:!1,duplicates:[]};const C=await ie.checkCategoryDuplicates(c.value.category);if(C.success&&C.duplicates){const y=C.duplicates.flat().map(j=>j.title.toLowerCase()),D=r.value.map(j=>j.title.toLowerCase()).filter(j=>y.includes(j));return{hasDuplicates:D.length>0,duplicates:D}}return{hasDuplicates:!1,duplicates:[]}}catch(I){return console.error("Bulk duplicate check failed:",I),{hasDuplicates:!1,duplicates:[]}}},F=async()=>{if(!(!c.value.category||!c.value.itemsText||!c.value.itemsText.trim())){s.value=!0,i.value=0,u.value=[],t.value=null;try{const I=c.value.itemsText.split(`
`).map(C=>C.trim()).filter(C=>C.length>0).map(C=>C.split("|")[0].trim()),b=[];for(let C=0;C<I.length;C++){const y=I[C];i.value=Math.round((C+1)/I.length*100);try{const V=await ie.searchApi(y,c.value.category,1);if(V&&V.length>0){const D=V[0];b.push({title:D.title,release:D.release,rating:D.rating?Math.round(D.rating):null,platforms:D.platforms||c.value.defaultPlatforms,genre:D.genre||c.value.defaultGenre,link:D.link,path:D.image,external_id:D.id,api_source:D.api_source})}else b.push({title:y,release:null,rating:c.value.defaultRating,platforms:c.value.defaultPlatforms,genre:c.value.defaultGenre,link:null,path:null,external_id:null,api_source:null})}catch(V){console.warn(`Search failed for "${y}":`,V),b.push({title:y,release:null,rating:c.value.defaultRating,platforms:c.value.defaultPlatforms,genre:c.value.defaultGenre,link:null,path:null,external_id:null,api_source:null})}await new Promise(V=>setTimeout(V,200))}u.value=b||[]}catch(I){t.value="Failed to search API data: "+(I.message||"Unknown error"),console.error("API search error:",I)}finally{s.value=!1,i.value=100}}},B=async()=>{if(!(!A.value||!r.value)){a.value=!0,t.value=null;try{const I=await _();if(I.hasDuplicates){t.value=`Duplikate gefunden: ${I.duplicates.length} Einträge existieren bereits. Bitte überprüfen Sie die Liste.`,a.value=!1;return}const b=r.value.map(C=>{const y=C.apiData;return{title:C.title,category:c.value.category,release:(y==null?void 0:y.release)||null,rating:(y==null?void 0:y.rating)||c.value.defaultRating||null,platforms:(y==null?void 0:y.platforms)||c.value.defaultPlatforms||null,genre:(y==null?void 0:y.genre)||c.value.defaultGenre||null,link:(y==null?void 0:y.link)||null,path:(y==null?void 0:y.path)||null,external_id:(y==null?void 0:y.external_id)||null,count:0,is_airing:!1,spielzeit:0}});e("save",b),c.value={category:"",itemsText:"",defaultRating:null,defaultPlatforms:"",defaultGenre:""},u.value=[]}catch(I){t.value=I.message||"Failed to add items",console.error("Bulk add error:",I)}finally{a.value=!1}}};return re([()=>c.value.category,()=>c.value.itemsText],([I,b])=>{I&&b&&b.trim()&&!s.value&&setTimeout(()=>{c.value.category===I&&c.value.itemsText===b&&!s.value&&F()},1e3)}),re(()=>l.show,I=>{I&&l.currentCategory?c.value.category=l.currentCategory:I||(c.value={category:"",itemsText:"",defaultRating:null,defaultPlatforms:"",defaultGenre:""},u.value=[],t.value=null,s.value=!1,i.value=0)}),{loading:a,error:t,bulkData:c,previewItems:r,canSave:A,closeModal:S,searchApiData:F,saveBulkItems:B,isSearching:s,searchProgress:i}}},zo={class:"modal-header"},Go={class:"modal-body"},Oo={class:"bulk-add-form"},qo={class:"form-group"},jo={class:"form-group"},Ko={class:"form-group"},Ho={class:"form-group"},Qo={class:"form-group"},Xo={key:0,class:"search-progress"},Jo={class:"progress-bar"},Yo={class:"progress-text"},Zo={key:1,class:"preview-section"},$o={class:"preview-list"},es={class:"item-main"},ts={class:"item-title"},os={key:0,class:"api-badge"},ss={key:1,class:"manual-badge"},as={key:0,class:"item-info"},ls={key:1,class:"item-details"},ns={key:0,class:"item-release"},is={key:1,class:"item-rating"},rs={key:2,class:"item-genre"},ds={key:0,class:"preview-more"},cs={class:"modal-footer"},us=["disabled"],ms={key:0},gs={key:1},fs={key:2};function vs(l,e,a,t,i,u){return a.show?(n(),d("div",{key:0,class:"modal-overlay",onClick:e[9]||(e[9]=(...s)=>t.closeModal&&t.closeModal(...s))},[o("div",{class:"modal-content",onClick:e[8]||(e[8]=Y(()=>{},["stop"]))},[o("div",zo,[e[10]||(e[10]=o("h2",null,"Bulk Add Items",-1)),o("button",{class:"close-btn",onClick:e[0]||(e[0]=(...s)=>t.closeModal&&t.closeModal(...s))},"✕")]),o("div",Go,[o("div",Oo,[o("div",qo,[e[12]||(e[12]=o("label",{for:"category"},"Category *",-1)),L(o("select",{id:"category","onUpdate:modelValue":e[1]||(e[1]=s=>t.bulkData.category=s),required:""},[...e[11]||(e[11]=[Ze('<option value="" data-v-1719a4e6>Select Category</option><option value="game" data-v-1719a4e6>Game</option><option value="series" data-v-1719a4e6>Series</option><option value="movie" data-v-1719a4e6>Movie</option><option value="watchlist" data-v-1719a4e6>Watchlist</option>',5)])],512),[[ke,t.bulkData.category]])]),o("div",jo,[e[13]||(e[13]=o("label",{for:"items-text"},"Items (one per line) *",-1)),L(o("textarea",{id:"items-text","onUpdate:modelValue":e[2]||(e[2]=s=>t.bulkData.itemsText=s),placeholder:`Enter items one per line, for example:
The Witcher 3
Cyberpunk 2077
Red Dead Redemption 2`,rows:"10",required:""},null,512),[[N,t.bulkData.itemsText]]),e[14]||(e[14]=o("small",{class:"help-text"},"Enter one item per line. The system will automatically search the API for each title and use the official names, images, and details. You can add additional info using: Title | Additional Info",-1))]),o("div",Ko,[e[15]||(e[15]=o("label",{for:"default-rating"},"Default Rating",-1)),L(o("input",{id:"default-rating","onUpdate:modelValue":e[3]||(e[3]=s=>t.bulkData.defaultRating=s),type:"number",min:"0",max:"10",step:"0.1",placeholder:"Optional rating for all items"},null,512),[[N,t.bulkData.defaultRating,void 0,{number:!0}]])]),o("div",Ho,[e[16]||(e[16]=o("label",{for:"default-platforms"},"Default Platforms",-1)),L(o("input",{id:"default-platforms","onUpdate:modelValue":e[4]||(e[4]=s=>t.bulkData.defaultPlatforms=s),type:"text",placeholder:"e.g., PC, PS5, Xbox"},null,512),[[N,t.bulkData.defaultPlatforms]])]),o("div",Qo,[e[17]||(e[17]=o("label",{for:"default-genre"},"Default Genre",-1)),L(o("input",{id:"default-genre","onUpdate:modelValue":e[5]||(e[5]=s=>t.bulkData.defaultGenre=s),type:"text",placeholder:"e.g., Action, Adventure, RPG"},null,512),[[N,t.bulkData.defaultGenre]])])]),t.isSearching?(n(),d("div",Xo,[o("div",Jo,[o("div",{class:"progress-fill",style:Ge({width:t.searchProgress+"%"})},null,4)]),o("span",Yo,"Searching API for "+m(t.previewItems?t.previewItems.length:0)+" items... "+m(t.searchProgress)+"%",1)])):p("",!0),t.previewItems&&t.previewItems.length>0&&!t.isSearching?(n(),d("div",Zo,[o("h3",null,"Preview ("+m(t.previewItems.length)+" items)",1),o("div",$o,[(n(!0),d(de,null,ce(t.previewItems.slice(0,10),(s,c)=>(n(),d("div",{key:c,class:Z(["preview-item",{"has-api-data":s.hasApiData}])},[o("div",es,[o("span",ts,m(s.title),1),s.hasApiData?(n(),d("span",os,"✓ API")):(n(),d("span",ss,"Manual"))]),s.additionalInfo?(n(),d("div",as," | "+m(s.additionalInfo),1)):p("",!0),s.apiData?(n(),d("div",ls,[s.apiData.release?(n(),d("small",ns,m(s.apiData.release),1)):p("",!0),s.apiData.rating?(n(),d("small",is,"⭐ "+m(s.apiData.rating),1)):p("",!0),s.apiData.genre?(n(),d("small",rs,m(s.apiData.genre),1)):p("",!0)])):p("",!0)],2))),128)),t.previewItems&&t.previewItems.length>10?(n(),d("div",ds," ... and "+m(t.previewItems.length-10)+" more items ",1)):p("",!0)])])):p("",!0)]),o("div",cs,[o("button",{class:"btn btn-secondary",onClick:e[6]||(e[6]=(...s)=>t.closeModal&&t.closeModal(...s))},"Cancel"),o("button",{class:"btn btn-primary",onClick:e[7]||(e[7]=(...s)=>t.saveBulkItems&&t.saveBulkItems(...s)),disabled:!t.canSave||t.loading},[t.loading?(n(),d("span",ms,"Adding "+m(t.previewItems?t.previewItems.length:0)+" items...",1)):t.isSearching?(n(),d("span",gs,"Searching API...")):(n(),d("span",fs,"Add "+m(t.previewItems?t.previewItems.length:0)+" Items",1))],8,us)])])])):p("",!0)}const ps=K(Wo,[["render",vs],["__scopeId","data-v-1719a4e6"]]),ys={name:"TxtImportModal",props:{show:{type:Boolean,default:!1}},emits:["close","fileProcessed"],methods:{handleFileUpload(l){const e=l.target.files[0];if(!e)return;if(!e.name.toLowerCase().endsWith(".txt")){alert("Bitte wählen Sie eine .txt Datei aus.");return}const a=new FileReader;a.onload=t=>{const i=t.target.result;this.$emit("fileProcessed",i)},a.readAsText(e,"UTF-8")}}},hs={class:"file-upload-area"},ws={class:"modal-buttons"};function Is(l,e,a,t,i,u){return a.show?(n(),d("div",{key:0,class:"modal",onClick:e[3]||(e[3]=s=>l.$emit("close"))},[o("div",{class:"modal-content",onClick:e[2]||(e[2]=Y(()=>{},["stop"]))},[e[5]||(e[5]=o("h2",null,"📄 Import from TXT File",-1)),e[6]||(e[6]=o("p",null,"Wählen Sie eine .txt Datei mit einer Liste von Titeln aus, um zu prüfen, welche Items in der aktuellen Kategorie fehlen.",-1)),o("div",hs,[o("input",{type:"file",id:"txtFileInput",accept:".txt",onChange:e[0]||(e[0]=(...s)=>u.handleFileUpload&&u.handleFileUpload(...s)),style:{display:"none"}},null,32),e[4]||(e[4]=o("label",{for:"txtFileInput",class:"file-upload-label"},[o("span",{class:"upload-icon"},"📁"),o("span",{class:"upload-text"},"TXT-Datei auswählen"),o("span",{class:"upload-hint"},"Eine .txt Datei mit einer Liste von Titeln")],-1))]),o("div",ws,[o("button",{type:"button",onClick:e[1]||(e[1]=s=>l.$emit("close"))}," Cancel ")])])])):p("",!0)}const bs=K(ys,[["render",Is],["__scopeId","data-v-d761bd17"]]),ks={name:"TxtImportResultsModal",props:{show:{type:Boolean,default:!1},results:{type:Object,default:null}},emits:["close"]},Ss={class:"results-summary"},Cs={class:"summary-item"},_s={class:"summary-value"},Ts={class:"summary-item"},Ms={class:"summary-value"},xs={class:"summary-item"},As={class:"summary-value existing"},Ds={class:"summary-item"},Us={class:"summary-value missing"},Rs={key:0,class:"missing-items"},Ls={class:"items-list"},Fs={key:1,class:"existing-items"},Ps={class:"items-list"},Bs={class:"modal-buttons"};function Es(l,e,a,t,i,u){return a.show&&a.results?(n(),d("div",{key:0,class:"modal",onClick:e[2]||(e[2]=s=>l.$emit("close"))},[o("div",{class:"modal-content results-modal",onClick:e[1]||(e[1]=Y(()=>{},["stop"]))},[e[7]||(e[7]=o("h2",null,"📊 TXT Import Ergebnisse",-1)),o("div",Ss,[o("div",Cs,[e[3]||(e[3]=o("span",{class:"summary-label"},"Kategorie:",-1)),o("span",_s,m(a.results.categoryName),1)]),o("div",Ts,[e[4]||(e[4]=o("span",{class:"summary-label"},"Titel in Datei:",-1)),o("span",Ms,m(a.results.totalInFile),1)]),o("div",xs,[e[5]||(e[5]=o("span",{class:"summary-label"},"Bereits vorhanden:",-1)),o("span",As,m(a.results.existingItems.length),1)]),o("div",Ds,[e[6]||(e[6]=o("span",{class:"summary-label"},"Fehlende Titel:",-1)),o("span",Us,m(a.results.missingItems.length),1)])]),a.results.missingItems.length>0?(n(),d("div",Rs,[o("h3",null,"❌ Fehlende Titel ("+m(a.results.missingItems.length)+"):",1),o("div",Ls,[(n(!0),d(de,null,ce(a.results.missingItems,(s,c)=>(n(),d("div",{key:c,class:"missing-item"},m(s),1))),128))])])):p("",!0),a.results.existingItems.length>0?(n(),d("div",Fs,[o("h3",null,"✅ Bereits vorhanden ("+m(a.results.existingItems.length)+"):",1),o("div",Ps,[(n(!0),d(de,null,ce(a.results.existingItems,(s,c)=>(n(),d("div",{key:c,class:"existing-item"},m(s),1))),128))])])):p("",!0),o("div",Bs,[o("button",{type:"button",onClick:e[0]||(e[0]=s=>l.$emit("close"))}," Schließen ")])])])):p("",!0)}const Ns=K(ks,[["render",Es],["__scopeId","data-v-ec385b83"]]),Vs={name:"LoadingSpinner",props:{loading:{type:Boolean,default:!0},message:{type:String,default:"Loading..."}}},Ws={key:0,class:"loading-spinner"},zs={key:0};function Gs(l,e,a,t,i,u){return a.loading?(n(),d("div",Ws,[e[0]||(e[0]=o("div",{class:"spinner"},null,-1)),a.message?(n(),d("p",zs,m(a.message),1)):p("",!0)])):p("",!0)}const Os=K(Vs,[["render",Gs],["__scopeId","data-v-b6e4a334"]]),qs={name:"MessageBox",props:{show:{type:Boolean,default:!1},type:{type:String,default:"info",validator:l=>["success","error","warning","info"].includes(l)},title:{type:String,default:""},message:{type:String,required:!0},details:{type:String,default:""}},emits:["close"],setup(l,{emit:e}){const a=()=>{e("close")},t=P(()=>{switch(l.type){case"success":return"✅";case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"ℹ️"}}),i=P(()=>`message-${l.type}`);return{closeMessage:a,icon:t,messageType:i}}},js={class:"message-header"},Ks={class:"message-icon"},Hs={class:"message-title"},Qs={class:"message-body"},Xs={key:0,class:"message-details"},Js={class:"message-footer"};function Ys(l,e,a,t,i,u){return a.show?(n(),d("div",{key:0,class:"message-overlay",onClick:e[3]||(e[3]=(...s)=>t.closeMessage&&t.closeMessage(...s))},[o("div",{class:Z(["message-box",t.messageType]),onClick:e[2]||(e[2]=Y(()=>{},["stop"]))},[o("div",js,[o("span",Ks,m(t.icon),1),o("h3",Hs,m(a.title),1),o("button",{class:"close-btn",onClick:e[0]||(e[0]=(...s)=>t.closeMessage&&t.closeMessage(...s))},"✕")]),o("div",Qs,[o("p",null,m(a.message),1),a.details?(n(),d("div",Xs,[o("pre",null,m(a.details),1)])):p("",!0)]),o("div",Js,[o("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=(...s)=>t.closeMessage&&t.closeMessage(...s))},"OK")])],2)])):p("",!0)}const Zs=K(qs,[["render",Ys],["__scopeId","data-v-b9a64791"]]),$s={name:"ConfirmDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Confirm Action"},message:{type:String,required:!0}},emits:["confirm","close"],setup(l,{emit:e}){const a=()=>{e("close")};return{closeDialog:a,confirmAction:()=>{e("confirm"),a()}}}},ea={class:"confirm-header"},ta={class:"confirm-title"},oa={class:"confirm-body"},sa={class:"confirm-footer"};function aa(l,e,a,t,i,u){return a.show?(n(),d("div",{key:0,class:"confirm-overlay",onClick:e[4]||(e[4]=(...s)=>t.closeDialog&&t.closeDialog(...s))},[o("div",{class:"confirm-dialog",onClick:e[3]||(e[3]=Y(()=>{},["stop"]))},[o("div",ea,[o("h3",ta,m(a.title),1),o("button",{class:"close-btn",onClick:e[0]||(e[0]=(...s)=>t.closeDialog&&t.closeDialog(...s))},"✕")]),o("div",oa,[o("p",null,m(a.message),1)]),o("div",sa,[o("button",{class:"btn btn-secondary",onClick:e[1]||(e[1]=(...s)=>t.closeDialog&&t.closeDialog(...s))},"Cancel"),o("button",{class:"btn btn-danger",onClick:e[2]||(e[2]=(...s)=>t.confirmAction&&t.confirmAction(...s))},"Confirm")])])])):p("",!0)}const la=K($s,[["render",aa],["__scopeId","data-v-4e246554"]]),na={name:"InputDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Input Required"},message:{type:String,required:!0},placeholder:{type:String,default:""},inputType:{type:String,default:"text"},defaultValue:{type:String,default:""}},emits:["confirm","close"],setup(l,{emit:e}){const a=w(""),t=w(null),i=()=>{e("close")},u=()=>{e("confirm",a.value),i()};return re(()=>l.show,async s=>{s&&(a.value=l.defaultValue,await tt(),t.value&&(t.value.focus(),t.value.select()))}),{inputValue:a,inputRef:t,closeDialog:i,confirmAction:u}}},ia={class:"input-header"},ra={class:"input-title"},da={class:"input-body"},ca={class:"input-message"},ua=["type","placeholder"],ma={class:"input-footer"};function ga(l,e,a,t,i,u){return a.show?(n(),d("div",{key:0,class:"input-overlay",onClick:e[6]||(e[6]=(...s)=>t.closeDialog&&t.closeDialog(...s))},[o("div",{class:"input-dialog",onClick:e[5]||(e[5]=Y(()=>{},["stop"]))},[o("div",ia,[o("h3",ra,m(a.title),1),o("button",{class:"close-btn",onClick:e[0]||(e[0]=(...s)=>t.closeDialog&&t.closeDialog(...s))},"✕")]),o("div",da,[o("p",ca,m(a.message),1),L(o("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.inputValue=s),type:a.inputType,placeholder:a.placeholder,class:"input-field",onKeyup:e[2]||(e[2]=et((...s)=>t.confirmAction&&t.confirmAction(...s),["enter"])),ref:"inputRef"},null,40,ua),[[$e,t.inputValue]])]),o("div",ma,[o("button",{class:"btn btn-secondary",onClick:e[3]||(e[3]=(...s)=>t.closeDialog&&t.closeDialog(...s))},"Cancel"),o("button",{class:"btn btn-primary",onClick:e[4]||(e[4]=(...s)=>t.confirmAction&&t.confirmAction(...s))},"OK")])])])):p("",!0)}const fa=K(na,[["render",ga],["__scopeId","data-v-9afbdbc1"]]),va={name:"RealtimeTest",setup(){const l=ze(),e=Ve(),a=w(null),t=w(0),i=w(!1),u=P(()=>l.isLoggedIn),s=A=>{console.log("Test component received update:",A),a.value=new Date().toLocaleTimeString(),t.value++},c=async()=>{try{await e.addMediaItem({title:`Test Item ${Date.now()}`,category:"game",release:new Date().toISOString().split("T")[0],rating:8,platforms:"PC",genre:"Test",count:1,is_airing:!1,spielzeit:0})}catch(A){console.error("Error adding test item:",A)}},r=async()=>{try{const S=e.mediaData.filter(_=>_.title.startsWith("Test Item")).map(_=>_.id);S.length>0&&await e.batchDeleteMediaItems(S)}catch(A){console.error("Error clearing test items:",A)}};return Oe(()=>{be.addListener("test-component",s),i.value=be.isConnected.value;const A=be.isConnected.subscribe(S=>{i.value=S});qe(()=>{be.removeListener("test-component"),A()})}),{isLoggedIn:u,lastUpdate:a,updateCount:t,isConnected:i,addTestItem:c,clearTestItems:r}}},pa={class:"realtime-test"},ya={class:"status"},ha={class:"last-update"},wa={class:"update-count"},Ia={class:"test-actions"},ba=["disabled"],ka=["disabled"];function Sa(l,e,a,t,i,u){return n(),d("div",pa,[e[2]||(e[2]=o("h3",null,"Real-time Sync Test",-1)),o("div",ya,[o("span",{class:Z(["status-indicator",t.isConnected?"connected":"disconnected"])},null,2),Se(" "+m(t.isConnected?"Connected":"Disconnected"),1)]),o("div",ha," Last update: "+m(t.lastUpdate||"Never"),1),o("div",wa," Updates received: "+m(t.updateCount),1),o("div",Ia,[o("button",{onClick:e[0]||(e[0]=(...s)=>t.addTestItem&&t.addTestItem(...s)),disabled:!t.isLoggedIn},"Add Test Item",8,ba),o("button",{onClick:e[1]||(e[1]=(...s)=>t.clearTestItems&&t.clearTestItems(...s)),disabled:!t.isLoggedIn},"Clear Test Items",8,ka)])])}const Ca=K(va,[["render",Sa],["__scopeId","data-v-98fd7254"]]),_a={name:"MediaLibrary",components:{MediaItem:Ct,Sidebar:nt,MainHeader:lt,FloatingActionButton:Dt,LoginModal:at,RegisterModal:st,EditModal:Vo,BulkAddModal:ps,TxtImportModal:bs,TxtImportResultsModal:Ns,LoadingSpinner:Os,MessageBox:Zs,ConfirmDialog:la,InputDialog:fa,RealtimeTest:Ca},setup(){const l=ot(),e=Ve(),a=je(),t=Ke(),i=He(),{sidebarCollapsed:u,mobileSidebarOpen:s,showLoginModal:c,showRegisterModal:r,showEditModal:A,showFloatingMenu:S,showBulkAddModal:_,showTxtImportModal:F,showTxtImportResults:B,editingItem:I,gridColumns:b,sortBy:C,categories:y,txtImportResults:V,isLoggedIn:D,userName:j,currentCategory:M,searchQuery:ue,categoryCounts:oe,loading:me,error:ge,paginatedMedia:g,platforms:f,genres:x,toggleSidebar:W,toggleMobileSidebar:H,closeMobileSidebar:O,setCategory:q,clearSearch:fe,togglePlatformFilter:$,toggleGenreFilter:Ce,editItem:_e,closeEditModal:Te,closeBulkAddModal:ve,handleBulkAddItems:pe,handleSaveItem:Me,handleDeleteItem:xe,logout:Ae,loadMedia:ee,toggleFloatingMenu:se,addNewItem:ye,bulkAddItems:De,importFromTxt:Ue,importFromAPI:Re,createCollection:Le,exportMediaCollection:Fe,exportAsCSV:ae,exportAsJSON:Pe,downloadFile:Be,deleteAllInCategory:Ee,getCategoryDisplayName:he,processTxtContent:we,closeTxtImportResults:Ie}=it(),le=()=>{l.push("/statistics"),s.value=!1},v=()=>{l.push("/calendar"),s.value=!1},h=()=>{l.push("/profile"),s.value=!1},R=E=>{q(E),ye()},k=()=>{c.value=!1,r.value=!0},T=E=>{if(c.value=!1,E&&E.duplicate_check){const{categories:J,media_items:te}=E.duplicate_check;J.found>0&&a.showInfo(`${J.found} Kategorie-Duplikate wurden beim Login automatisch bereinigt.`,"Duplikate bereinigt"),te.found>0&&a.showWarning(`Es wurden ${te.found} Duplikat-Gruppen in Ihren Medien gefunden. Bitte überprüfen Sie die Einträge.`,"Duplikate gefunden")}ee()},z=()=>{r.value=!1,ee()},U=E=>{const{count:J,duplicates:te}=E.detail;a.showWarning(`Es wurden ${J} Duplikat-Gruppen in Ihren Medien gefunden. Bitte überprüfen Sie die Einträge.`,"Duplikate gefunden",{duplicates:te})},X=E=>{var We;const{category:J,count:te,duplicates:Qe}=E.detail,Xe=((We=y.find(Je=>Je.key===J))==null?void 0:We.name)||J;a.showWarning(`Es wurden ${te} Duplikat-Gruppen in der Kategorie "${Xe}" gefunden.`,"Duplikate in Kategorie",{category:J,duplicates:Qe})};return Oe(async()=>{try{await ee(),e.initializeRealtimeUpdates(),window.addEventListener("duplicates-found",U),window.addEventListener("category-duplicates-found",X)}catch(E){console.error("Error during initialization:",E)}}),qe(()=>{e.cleanupRealtimeUpdates(),window.removeEventListener("duplicates-found",U),window.removeEventListener("category-duplicates-found",X)}),{sidebarCollapsed:u,mobileSidebarOpen:s,showLoginModal:c,showRegisterModal:r,showEditModal:A,showFloatingMenu:S,showBulkAddModal:_,showTxtImportModal:F,showTxtImportResults:B,editingItem:I,gridColumns:b,sortBy:C,categories:y,txtImportResults:V,isLoggedIn:D,userName:j,currentCategory:M,searchQuery:ue,categoryCounts:oe,loading:me,error:ge,paginatedMedia:g,platforms:f,genres:x,toggleSidebar:W,toggleMobileSidebar:H,closeMobileSidebar:O,setCategory:q,clearSearch:fe,navigateToStatistics:le,navigateToCalendar:v,navigateToProfile:h,addItemFromSidebar:R,togglePlatformFilter:$,toggleGenreFilter:Ce,editItem:_e,switchToRegister:k,handleLoginSuccess:T,handleRegisterSuccess:z,closeEditModal:Te,closeBulkAddModal:ve,handleBulkAddItems:pe,handleSaveItem:Me,handleDeleteItem:xe,logout:Ae,loadMedia:ee,toggleFloatingMenu:se,addNewItem:ye,bulkAddItems:De,importFromTxt:Ue,importFromAPI:Re,createCollection:Le,exportMediaCollection:Fe,exportAsCSV:ae,exportAsJSON:Pe,downloadFile:Be,deleteAllInCategory:Ee,getCategoryDisplayName:he,processTxtContent:we,closeTxtImportResults:Ie,messageStore:a,confirmStore:t,inputStore:i}}},Ta={class:"vue-app"},Ma={class:"main-content"},xa={class:"content-area"},Aa={key:1,class:"error"},Da={key:2};function Ua(l,e,a,t,i,u){const s=G("Sidebar"),c=G("MainHeader"),r=G("LoadingSpinner"),A=G("RealtimeTest"),S=G("MediaItem"),_=G("LoginModal"),F=G("RegisterModal"),B=G("EditModal"),I=G("BulkAddModal"),b=G("TxtImportModal"),C=G("TxtImportResultsModal"),y=G("FloatingActionButton"),V=G("MessageBox"),D=G("ConfirmDialog"),j=G("InputDialog");return n(),d("div",Ta,[o("div",{class:Z(["mobile-overlay",{show:t.mobileSidebarOpen}]),onClick:e[0]||(e[0]=(...M)=>t.closeMobileSidebar&&t.closeMobileSidebar(...M))},null,2),Q(s,{collapsed:t.sidebarCollapsed,"mobile-open":t.mobileSidebarOpen,"is-logged-in":t.isLoggedIn,"user-name":t.userName,"current-category":t.currentCategory,"category-counts":t.categoryCounts,platforms:t.platforms,genres:t.genres,categories:t.categories,onToggle:t.toggleSidebar,onSetCategory:t.setCategory,onNavigateToStatistics:t.navigateToStatistics,onNavigateToCalendar:t.navigateToCalendar,onNavigateToProfile:t.navigateToProfile,onTogglePlatformFilter:t.togglePlatformFilter,onToggleGenreFilter:t.toggleGenreFilter,onAddItem:t.addItemFromSidebar,onShowLogin:e[1]||(e[1]=M=>t.showLoginModal=!0),onShowRegister:e[2]||(e[2]=M=>t.showRegisterModal=!0),onLogout:t.logout},null,8,["collapsed","mobile-open","is-logged-in","user-name","current-category","category-counts","platforms","genres","categories","onToggle","onSetCategory","onNavigateToStatistics","onNavigateToCalendar","onNavigateToProfile","onTogglePlatformFilter","onToggleGenreFilter","onAddItem","onLogout"]),o("div",Ma,[Q(c,{"search-query":t.searchQuery,"onUpdate:searchQuery":e[3]||(e[3]=M=>t.searchQuery=M),"grid-columns":t.gridColumns,"onUpdate:gridColumns":e[4]||(e[4]=M=>t.gridColumns=M),"sort-by":t.sortBy,"onUpdate:sortBy":e[5]||(e[5]=M=>t.sortBy=M),onToggleMobileSidebar:t.toggleMobileSidebar,onClearSearch:t.clearSearch},null,8,["search-query","grid-columns","sort-by","onToggleMobileSidebar","onClearSearch"]),o("main",xa,[t.loading?(n(),ne(r,{key:0,message:"Loading media data..."})):t.error?(n(),d("div",Aa,[o("p",null,m(t.error),1),o("button",{onClick:e[6]||(e[6]=(...M)=>t.loadMedia&&t.loadMedia(...M))},"Retry")])):(n(),d("div",Da,[Q(A),o("div",{class:"grid",style:Ge({gridTemplateColumns:`repeat(${t.gridColumns}, 1fr)`})},[(n(!0),d(de,null,ce(t.paginatedMedia,M=>(n(),ne(S,{key:M.id,item:M,onEdit:t.editItem},null,8,["item","onEdit"]))),128))],4)]))])]),t.showLoginModal?(n(),ne(_,{key:0,onClose:e[7]||(e[7]=M=>t.showLoginModal=!1),onSuccess:t.handleLoginSuccess,onSwitchToRegister:t.switchToRegister},null,8,["onSuccess","onSwitchToRegister"])):p("",!0),t.showRegisterModal?(n(),ne(F,{key:1,onClose:e[8]||(e[8]=M=>t.showRegisterModal=!1),onSuccess:t.handleRegisterSuccess},null,8,["onSuccess"])):p("",!0),t.showEditModal?(n(),ne(B,{key:2,item:t.editingItem,"current-category":t.currentCategory,onClose:t.closeEditModal,onSave:t.handleSaveItem,onDelete:t.handleDeleteItem},null,8,["item","current-category","onClose","onSave","onDelete"])):p("",!0),Q(I,{show:t.showBulkAddModal,"current-category":t.currentCategory,onClose:t.closeBulkAddModal,onSave:t.handleBulkAddItems},null,8,["show","current-category","onClose","onSave"]),Q(b,{show:t.showTxtImportModal,onClose:e[9]||(e[9]=M=>t.showTxtImportModal=!1),onFileProcessed:t.processTxtContent},null,8,["show","onFileProcessed"]),Q(C,{show:t.showTxtImportResults,results:t.txtImportResults,onClose:t.closeTxtImportResults},null,8,["show","results","onClose"]),Q(y,{"show-menu":t.showFloatingMenu,"show-delete-all":t.isLoggedIn&&t.currentCategory!=="all"&&t.categoryCounts[t.currentCategory]>0,"category-name":t.getCategoryDisplayName(t.currentCategory),"item-count":t.categoryCounts[t.currentCategory]||0,onToggleMenu:t.toggleFloatingMenu,onAddNewItem:t.addNewItem,onBulkAddItems:t.bulkAddItems,onImportFromTxt:t.importFromTxt,onImportFromApi:t.importFromAPI,onCreateCollection:t.createCollection,onDeleteAllInCategory:t.deleteAllInCategory},null,8,["show-menu","show-delete-all","category-name","item-count","onToggleMenu","onAddNewItem","onBulkAddItems","onImportFromTxt","onImportFromApi","onCreateCollection","onDeleteAllInCategory"]),Q(V,{show:t.messageStore.show,type:t.messageStore.type,title:t.messageStore.title,message:t.messageStore.message,details:t.messageStore.details,onClose:t.messageStore.closeMessage},null,8,["show","type","title","message","details","onClose"]),Q(D,{show:t.confirmStore.show,title:t.confirmStore.title,message:t.confirmStore.message,onConfirm:t.confirmStore.confirm,onClose:t.confirmStore.cancel},null,8,["show","title","message","onConfirm","onClose"]),Q(j,{show:t.inputStore.show,title:t.inputStore.title,message:t.inputStore.message,placeholder:t.inputStore.placeholder,"input-type":t.inputStore.inputType,"default-value":t.inputStore.defaultValue,onConfirm:t.inputStore.confirm,onClose:t.inputStore.cancel},null,8,["show","title","message","placeholder","input-type","default-value","onConfirm","onClose"])])}const Pa=K(_a,[["render",Ua],["__scopeId","data-v-1c13efb9"]]);export{Pa as default};
