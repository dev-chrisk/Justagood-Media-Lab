import{E as ie,G as le,_ as re,b as r,e,z as de,f as S,n as x,B as z,A as ce,t as n,k as V,m as ue,F as C,p as w,j as me,a as ge,r as u,c as D,C as ve,u as _e,o as l,H as be}from"./index-l1v_olV_.js";import{L as he}from"./LoadingSpinner-DbOLfIgM.js";import{S as pe}from"./Sidebar-DlQAg8HL.js";const ye=le.API_BASE_URL,v=ie.create({baseURL:ye,headers:{"Content-Type":"application/json",Accept:"application/json"}});v.interceptors.request.use(o=>{const s=localStorage.getItem("authToken");return console.log("🔧 Admin API Request Debug:"),console.log("🔧 URL:",o.baseURL+o.url),console.log("🔧 Token present:",!!s),console.log("🔧 Token value:",s?s.substring(0,20)+"...":"null"),s?(o.headers.Authorization=`Bearer ${s}`,console.log("🔧 Authorization header set:",o.headers.Authorization.substring(0,30)+"...")):console.log("❌ No token found in localStorage"),o},o=>Promise.reject(o));v.interceptors.response.use(o=>o,o=>{var s,_,t,U;return console.log("🔧 Admin API Response Error:",(s=o.response)==null?void 0:s.status,(_=o.response)==null?void 0:_.data),(((t=o.response)==null?void 0:t.status)===401||((U=o.response)==null?void 0:U.status)===403)&&console.log("🔧 Admin API got 401/403, but not logging out to preserve session"),Promise.reject(o)});const y={async getUsers(){return(await v.get("/admin/users")).data},async getUserDetails(o){return(await v.get(`/admin/users/${o}`)).data},async updateUser(o,s){return(await v.put(`/admin/users/${o}`,s)).data},async deleteUser(o){return(await v.delete(`/admin/users/${o}`)).data},async getStatistics(){return(await v.get("/admin/statistics")).data},async getUserActivity(o){return(await v.get(`/admin/user-activity/${o}`)).data},async getAllMediaItems(o={}){return(await v.get("/admin/media-items",{params:o})).data},async getAllCollections(o={}){return(await v.get("/admin/collections",{params:o})).data}},Ue={name:"AdminDashboard",components:{LoadingSpinner:he,Sidebar:pe},setup(){var B;const o=_e(),s=ge(),_=u(!1),t=u(null),U=u({}),p=u([]),f=u([]),A=u([]),a=u([]),d=u((B=s.user)==null?void 0:B.id),T=u(""),M=u(null),I=u(!1),L=u(!1),k=u(!1),j=D(()=>s.isLoggedIn),O=D(()=>s.isAdmin),q=D(()=>s.userName),F=async()=>{var i,c,b,m,h,R;_.value=!0,t.value=null;try{console.log("🔧 Loading admin data..."),console.log("🔧 Current user:",s.user),console.log("🔧 Is admin:",s.isAdmin),console.log("🔧 Auth token:",s.token?"Present":"Missing");const[g,E,N,P]=await Promise.all([y.getStatistics(),y.getUsers(),y.getAllMediaItems(),y.getAllCollections()]);console.log("✅ Admin data loaded successfully:",{statsData:g,usersData:E,mediaData:N,collectionsData:P}),U.value=g,p.value=E,f.value=N.data||N,A.value=P.data||P}catch(g){console.error("❌ Admin data load error:",g),console.error("❌ Error response:",g.response),console.error("❌ Error status:",(i=g.response)==null?void 0:i.status),console.error("❌ Error data:",(c=g.response)==null?void 0:c.data),((b=g.response)==null?void 0:b.status)===401?t.value="Nicht autorisiert. Bitte loggen Sie sich als Admin ein.":((m=g.response)==null?void 0:m.status)===403?t.value="Admin-Berechtigung erforderlich. Sie sind kein Admin.":t.value=((R=(h=g.response)==null?void 0:h.data)==null?void 0:R.message)||g.message||"Fehler beim Laden der Admin-Daten"}finally{_.value=!1}},Q=async i=>{a.value.push(i.id);try{await y.updateUser(i.id,{is_admin:i.is_admin}),console.log(`User ${i.name} admin status updated`)}catch(c){console.error("Failed to update user:",c),i.is_admin=!i.is_admin}finally{a.value=a.value.filter(c=>c!==i.id)}},G=()=>{o.push("/")},J=()=>{o.push("/statistics")},H=()=>{o.push("/calendar")},Y=()=>{o.push("/features")},K=()=>{o.push("/profile")},W=async()=>{await s.logout(),o.push("/")},X=()=>{L.value=!L.value},Z=()=>{k.value=!k.value},$=()=>{k.value=!1},ee=i=>i?new Date(i).toLocaleDateString():"N/A",se=D(()=>{if(!T.value)return p.value;const i=T.value.toLowerCase();return p.value.filter(c=>c.name.toLowerCase().includes(i)||c.email.toLowerCase().includes(i))}),te=()=>{},ae=async i=>{var b,m;if(i.id===d.value){alert("You cannot delete your own account!");return}if(confirm(`Are you sure you want to delete user "${i.name}"?

This will permanently delete:
- All their media items
- All their collections
- Their account

This action cannot be undone!`))try{await y.deleteUser(i.id),p.value=p.value.filter(h=>h.id!==i.id),alert("User deleted successfully")}catch(h){console.error("Failed to delete user:",h),alert("Failed to delete user: "+(((m=(b=h.response)==null?void 0:b.data)==null?void 0:m.error)||h.message))}},oe=async i=>{var c,b;try{const m=await y.getUserDetails(i);M.value=m,I.value=!0}catch(m){console.error("Failed to load user details:",m),alert("Failed to load user details: "+(((b=(c=m.response)==null?void 0:c.data)==null?void 0:b.error)||m.message))}},ne=()=>{I.value=!1,M.value=null};return ve(()=>{if(!s.isLoggedIn){t.value="Bitte loggen Sie sich ein, um das Admin-Panel zu verwenden.";return}if(!s.isAdmin){t.value="Sie haben keine Admin-Berechtigung. Nur Administratoren können auf dieses Panel zugreifen.";return}F()}),{loading:_,error:t,statistics:U,users:p,allMediaItems:f,allCollections:A,updatingUsers:a,currentUserId:d,userSearchQuery:T,selectedUser:M,showUserModal:I,sidebarCollapsed:L,mobileSidebarOpen:k,isLoggedIn:j,isAdmin:O,userName:q,filteredUsers:se,loadData:F,updateUser:Q,viewUserDetails:oe,confirmDeleteUser:ae,closeUserModal:ne,searchUsers:te,navigateToLibrary:G,navigateToStatistics:J,navigateToCalendar:H,navigateToFeatures:Y,navigateToProfile:K,logout:W,toggleSidebar:X,toggleMobileSidebar:Z,closeMobileSidebar:$,formatDate:ee}}},fe={class:"vue-app"},Ae={class:"main-content"},ke={class:"main-header"},Se={class:"header-left"},Ce={class:"header-right"},we={class:"content-area"},De={key:1,class:"error"},Te={key:2},Me={class:"stats-grid"},Ie={class:"stat-card"},Le={class:"stat-content"},Ne={class:"stat-number"},Pe={class:"stat-subtitle"},Fe={class:"stat-card"},Be={class:"stat-content"},Re={class:"stat-number"},Ee={class:"stat-card"},xe={class:"stat-content"},ze={class:"stat-number"},Ve={class:"stat-card"},je={class:"stat-content"},Oe={class:"stat-number"},qe={class:"admin-section"},Qe={class:"section-header"},Ge={class:"section-actions"},Je={class:"table-container"},He={class:"admin-table"},Ye={class:"user-info"},Ke={class:"user-name"},We={key:0,class:"admin-badge"},Xe={class:"checkbox-container"},Ze=["onUpdate:modelValue","onChange","disabled"],$e={class:"action-buttons"},es=["onClick","disabled"],ss=["onClick","disabled"],ts={class:"admin-section"},as={class:"media-grid"},os={class:"media-info"},ns={class:"media-category"},is={class:"media-user"},ls={class:"media-date"},rs={class:"admin-section"},ds={class:"collections-grid"},cs={class:"collection-description"},us={class:"collection-user"},ms={class:"collection-count"},gs={class:"modal-header"},vs={key:0,class:"modal-body"},_s={class:"user-details"},bs={class:"detail-row"},hs={class:"detail-row"},ps={class:"detail-row"},ys={class:"detail-row"},Us={class:"detail-row"},fs={class:"detail-row"},As={key:0,class:"recent-activity"},ks={class:"activity-list"},Ss={class:"activity-title"},Cs={class:"activity-category"},ws={class:"activity-date"};function Ds(o,s,_,t,U,p){const f=z("Sidebar"),A=z("LoadingSpinner");return l(),r("div",fe,[e("div",{class:x(["mobile-overlay",{show:t.mobileSidebarOpen}]),onClick:s[0]||(s[0]=(...a)=>t.closeMobileSidebar&&t.closeMobileSidebar(...a))},null,2),de(f,{collapsed:t.sidebarCollapsed,"mobile-open":t.mobileSidebarOpen,"is-logged-in":t.isLoggedIn,"is-admin":t.isAdmin,"user-name":t.userName,"current-category":"admin","category-counts":{},platforms:[],genres:[],categories:[],onToggle:t.toggleSidebar,onNavigateToLibrary:t.navigateToLibrary,onNavigateToStatistics:t.navigateToStatistics,onNavigateToCalendar:t.navigateToCalendar,onNavigateToFeatures:t.navigateToFeatures,onNavigateToProfile:t.navigateToProfile,onLogout:t.logout},null,8,["collapsed","mobile-open","is-logged-in","is-admin","user-name","onToggle","onNavigateToLibrary","onNavigateToStatistics","onNavigateToCalendar","onNavigateToFeatures","onNavigateToProfile","onLogout"]),e("div",Ae,[e("header",ke,[e("div",Se,[e("button",{class:"mobile-sidebar-toggle",onClick:s[1]||(s[1]=(...a)=>t.toggleMobileSidebar&&t.toggleMobileSidebar(...a))},"☰"),s[9]||(s[9]=e("h1",{class:"page-title"},"Admin Dashboard",-1))]),e("div",Ce,[e("button",{class:"refresh-btn",onClick:s[2]||(s[2]=(...a)=>t.loadData&&t.loadData(...a)),title:"Refresh data"},[...s[10]||(s[10]=[e("span",{class:"refresh-icon"},"🔄",-1)])])])]),e("main",we,[t.loading?(l(),ce(A,{key:0,message:"Loading admin data..."})):t.error?(l(),r("div",De,[e("p",null,n(t.error),1),e("button",{onClick:s[3]||(s[3]=(...a)=>t.loadData&&t.loadData(...a))},"Retry")])):(l(),r("div",Te,[e("div",Me,[e("div",Ie,[s[12]||(s[12]=e("div",{class:"stat-icon"},"👥",-1)),e("div",Le,[s[11]||(s[11]=e("h3",null,"Total Users",-1)),e("p",Ne,n(t.statistics.total_users||0),1),e("p",Pe,n(t.statistics.admin_users||0)+" admins",1)])]),e("div",Fe,[s[15]||(s[15]=e("div",{class:"stat-icon"},"📚",-1)),e("div",Be,[s[13]||(s[13]=e("h3",null,"Media Items",-1)),e("p",Re,n(t.statistics.total_media_items||0),1),s[14]||(s[14]=e("p",{class:"stat-subtitle"},"across all users",-1))])]),e("div",Ee,[s[18]||(s[18]=e("div",{class:"stat-icon"},"📁",-1)),e("div",xe,[s[16]||(s[16]=e("h3",null,"Collections",-1)),e("p",ze,n(t.statistics.total_collections||0),1),s[17]||(s[17]=e("p",{class:"stat-subtitle"},"user collections",-1))])]),e("div",Ve,[s[21]||(s[21]=e("div",{class:"stat-icon"},"📈",-1)),e("div",je,[s[19]||(s[19]=e("h3",null,"Recent Activity",-1)),e("p",Oe,n(t.statistics.recent_registrations||0),1),s[20]||(s[20]=e("p",{class:"stat-subtitle"},"new users (30 days)",-1))])])]),e("div",qe,[e("div",Qe,[s[22]||(s[22]=e("h2",null,"User Management",-1)),e("div",Ge,[V(e("input",{type:"text","onUpdate:modelValue":s[4]||(s[4]=a=>t.userSearchQuery=a),placeholder:"Search users...",class:"search-input",onInput:s[5]||(s[5]=(...a)=>t.searchUsers&&t.searchUsers(...a))},null,544),[[ue,t.userSearchQuery]])])]),e("div",Je,[e("table",He,[s[24]||(s[24]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Email"),e("th",null,"Admin"),e("th",null,"Media Items"),e("th",null,"Collections"),e("th",null,"Joined"),e("th",null,"Actions")])],-1)),e("tbody",null,[(l(!0),r(C,null,w(t.filteredUsers,a=>(l(),r("tr",{key:a.id},[e("td",null,[e("div",Ye,[e("span",Ke,n(a.name),1),a.is_admin?(l(),r("span",We,"👑")):S("",!0)])]),e("td",null,n(a.email),1),e("td",null,[e("label",Xe,[V(e("input",{type:"checkbox","onUpdate:modelValue":d=>a.is_admin=d,onChange:d=>t.updateUser(a),disabled:t.updatingUsers.includes(a.id)||a.id===t.currentUserId},null,40,Ze),[[be,a.is_admin]]),s[23]||(s[23]=e("span",{class:"checkmark"},null,-1))])]),e("td",null,n(a.media_items_count||0),1),e("td",null,n(a.collections_count||0),1),e("td",null,n(t.formatDate(a.created_at)),1),e("td",null,[e("div",$e,[e("button",{class:"btn-small btn-primary",onClick:d=>t.viewUserDetails(a.id),disabled:t.loading,title:"View Details"}," 👁️ ",8,es),e("button",{class:"btn-small btn-danger",onClick:d=>t.confirmDeleteUser(a),disabled:t.loading||a.id===t.currentUserId,title:"Delete User"}," 🗑️ ",8,ss)])])]))),128))])])])]),e("div",ts,[s[25]||(s[25]=e("div",{class:"section-header"},[e("h2",null,"All Media Items")],-1)),e("div",as,[(l(!0),r(C,null,w(t.allMediaItems,a=>{var d;return l(),r("div",{key:a.id,class:"media-item-card"},[e("div",os,[e("h4",null,n(a.title),1),e("p",ns,n(a.category),1),e("p",is,"User: "+n(((d=a.user)==null?void 0:d.name)||"Unknown"),1),e("p",ls,n(t.formatDate(a.created_at)),1)])])}),128))])]),e("div",rs,[s[26]||(s[26]=e("div",{class:"section-header"},[e("h2",null,"All Collections")],-1)),e("div",ds,[(l(!0),r(C,null,w(t.allCollections,a=>{var d;return l(),r("div",{key:a.id,class:"collection-card"},[e("h4",null,n(a.name),1),e("p",cs,n(a.description||"No description"),1),e("p",us,"User: "+n(((d=a.user)==null?void 0:d.name)||"Unknown"),1),e("p",ms,n(a.media_items_count||0)+" items",1)])}),128))])])]))])]),t.showUserModal?(l(),r("div",{key:0,class:"modal-overlay",onClick:s[8]||(s[8]=(...a)=>t.closeUserModal&&t.closeUserModal(...a))},[e("div",{class:"modal-content",onClick:s[7]||(s[7]=me(()=>{},["stop"]))},[e("div",gs,[s[27]||(s[27]=e("h3",null,"User Details",-1)),e("button",{class:"close-btn",onClick:s[6]||(s[6]=(...a)=>t.closeUserModal&&t.closeUserModal(...a))},"×")]),t.selectedUser?(l(),r("div",vs,[e("div",_s,[e("div",bs,[s[28]||(s[28]=e("label",null,"Name:",-1)),e("span",null,n(t.selectedUser.name),1)]),e("div",hs,[s[29]||(s[29]=e("label",null,"Email:",-1)),e("span",null,n(t.selectedUser.email),1)]),e("div",ps,[s[30]||(s[30]=e("label",null,"Admin Status:",-1)),e("span",{class:x(["admin-status",{admin:t.selectedUser.is_admin}])},n(t.selectedUser.is_admin?"👑 Admin":"👤 User"),3)]),e("div",ys,[s[31]||(s[31]=e("label",null,"Joined:",-1)),e("span",null,n(t.formatDate(t.selectedUser.created_at)),1)]),e("div",Us,[s[32]||(s[32]=e("label",null,"Media Items:",-1)),e("span",null,n(t.selectedUser.media_items_count||0),1)]),e("div",fs,[s[33]||(s[33]=e("label",null,"Collections:",-1)),e("span",null,n(t.selectedUser.collections_count||0),1)])]),t.selectedUser.media_items&&t.selectedUser.media_items.length>0?(l(),r("div",As,[s[34]||(s[34]=e("h4",null,"Recent Media Items",-1)),e("div",ks,[(l(!0),r(C,null,w(t.selectedUser.media_items.slice(0,5),a=>(l(),r("div",{key:a.id,class:"activity-item"},[e("span",Ss,n(a.title),1),e("span",Cs,n(a.category),1),e("span",ws,n(t.formatDate(a.created_at)),1)]))),128))])])):S("",!0)])):S("",!0)])])):S("",!0)])}const Ls=re(Ue,[["render",Ds],["__scopeId","data-v-9127a2cb"]]);export{Ls as default};
