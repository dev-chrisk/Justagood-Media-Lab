import{E as ce,G as ue,_ as me,b as r,e,z as ge,f as p,n as x,B as z,A as ve,t as l,j as V,l as be,F as C,m as S,i as _e,a as he,r as d,c as D,w as j,C as ye,u as pe,o as i,H as fe}from"./index-C5w8hEZI.js";import{L as Ue}from"./LoadingSpinner-DuVSRIIX.js";import{S as Ae}from"./Sidebar-D07rg6mS.js";const we=ue.API_BASE_URL,v=ce.create({baseURL:we,headers:{"Content-Type":"application/json",Accept:"application/json"}});v.interceptors.request.use(n=>{const s=localStorage.getItem("authToken");return console.log("🔧 Admin API Request Debug:"),console.log("🔧 URL:",n.baseURL+n.url),console.log("🔧 Token present:",!!s),console.log("🔧 Token value:",s?s.substring(0,20)+"...":"null"),s?(n.headers.Authorization=`Bearer ${s}`,console.log("🔧 Authorization header set:",n.headers.Authorization.substring(0,30)+"...")):console.log("❌ No token found in localStorage"),n},n=>Promise.reject(n));v.interceptors.response.use(n=>n,n=>{var s,b,t,U;return console.log("🔧 Admin API Response Error:",(s=n.response)==null?void 0:s.status,(b=n.response)==null?void 0:b.data),(((t=n.response)==null?void 0:t.status)===401||((U=n.response)==null?void 0:U.status)===403)&&console.log("🔧 Admin API got 401/403, but not logging out to preserve session"),Promise.reject(n)});const f={async getUsers(){return(await v.get("/admin/users")).data},async getUserDetails(n){return(await v.get(`/admin/users/${n}`)).data},async updateUser(n,s){return(await v.put(`/admin/users/${n}`,s)).data},async deleteUser(n){return(await v.delete(`/admin/users/${n}`)).data},async getStatistics(){return(await v.get("/admin/statistics")).data},async getUserActivity(n){return(await v.get(`/admin/user-activity/${n}`)).data},async getAllMediaItems(n={}){return(await v.get("/admin/media-items",{params:n})).data},async getAllCollections(n={}){return(await v.get("/admin/collections",{params:n})).data}},ke={name:"AdminDashboard",components:{LoadingSpinner:Ue,Sidebar:Ae},setup(){var B;const n=pe(),s=he(),b=d(!1),t=d(null),U=d({}),y=d([]),A=d([]),w=d([]),o=d([]),c=d((B=s.user)==null?void 0:B.id),O=d(!1),N=d(!1),P=d(!1),M=d(""),T=d(null),L=d(!1),I=d(!1),k=d(!1),q=D(()=>s.isLoggedIn),Q=D(()=>s.isAdmin),G=D(()=>s.userName),F=async()=>{var a,u,_,m,h,E;b.value=!0,t.value=null;try{console.log("🔧 Loading admin data..."),console.log("🔧 Current user:",s.user),console.log("🔧 Is admin:",s.isAdmin),console.log("🔧 Auth token:",s.token?"Present":"Missing");const[g,R]=await Promise.all([f.getStatistics(),f.getUsers()]);console.log("✅ Admin data loaded successfully:",{statsData:g,usersData:R}),U.value=g,y.value=R}catch(g){console.error("❌ Admin data load error:",g),console.error("❌ Error response:",g.response),console.error("❌ Error status:",(a=g.response)==null?void 0:a.status),console.error("❌ Error data:",(u=g.response)==null?void 0:u.data),((_=g.response)==null?void 0:_.status)===401?t.value="Nicht autorisiert. Bitte loggen Sie sich als Admin ein.":((m=g.response)==null?void 0:m.status)===403?t.value="Admin-Berechtigung erforderlich. Sie sind kein Admin.":t.value=((E=(h=g.response)==null?void 0:h.data)==null?void 0:E.message)||g.message||"Fehler beim Laden der Admin-Daten"}finally{b.value=!1}},J=async a=>{o.value.push(a.id);try{await f.updateUser(a.id,{is_admin:a.is_admin}),console.log(`User ${a.name} admin status updated`)}catch(u){console.error("Failed to update user:",u),a.is_admin=!a.is_admin}finally{o.value=o.value.filter(u=>u!==a.id)}},H=async()=>{try{console.log("🔧 Loading all media items...");const a=await f.getAllMediaItems();console.log("✅ Media items loaded:",a),A.value=a.data||a}catch(a){console.error("❌ Failed to load media items:",a),console.error("❌ Error response:",a.response)}},Y=async()=>{try{console.log("🔧 Loading all collections...");const a=await f.getAllCollections();console.log("✅ Collections loaded:",a),w.value=a.data||a}catch(a){console.error("❌ Failed to load collections:",a),console.error("❌ Error response:",a.response)}},K=()=>{n.push("/")},W=()=>{n.push("/statistics")},X=()=>{n.push("/calendar")},Z=()=>{n.push("/features")},$=()=>{n.push("/profile")},ee=async()=>{await s.logout(),n.push("/")},se=()=>{I.value=!I.value},te=()=>{k.value=!k.value},oe=()=>{k.value=!1},ae=a=>a?new Date(a).toLocaleDateString():"N/A",ne=D(()=>{if(!M.value)return y.value;const a=M.value.toLowerCase();return y.value.filter(u=>u.name.toLowerCase().includes(a)||u.email.toLowerCase().includes(a))}),le=()=>{},ie=async a=>{var _,m;if(a.id===c.value){alert("You cannot delete your own account!");return}if(confirm(`Are you sure you want to delete user "${a.name}"?

This will permanently delete:
- All their media items
- All their collections
- Their account

This action cannot be undone!`))try{await f.deleteUser(a.id),y.value=y.value.filter(h=>h.id!==a.id),alert("User deleted successfully")}catch(h){console.error("Failed to delete user:",h),alert("Failed to delete user: "+(((m=(_=h.response)==null?void 0:_.data)==null?void 0:m.error)||h.message))}},re=async a=>{var u,_;try{const m=await f.getUserDetails(a);T.value=m,L.value=!0}catch(m){console.error("Failed to load user details:",m),alert("Failed to load user details: "+(((_=(u=m.response)==null?void 0:u.data)==null?void 0:_.error)||m.message))}},de=()=>{L.value=!1,T.value=null};return j(N,a=>{a&&A.value.length===0&&H()}),j(P,a=>{a&&w.value.length===0&&Y()}),ye(()=>{if(!s.isLoggedIn){t.value="Bitte loggen Sie sich ein, um das Admin-Panel zu verwenden.";return}if(!s.isAdmin){t.value="Sie haben keine Admin-Berechtigung. Nur Administratoren können auf dieses Panel zugreifen.";return}F()}),{loading:b,error:t,statistics:U,users:y,allMediaItems:A,allCollections:w,updatingUsers:o,currentUserId:c,showUsers:O,showMedia:N,showCollections:P,userSearchQuery:M,selectedUser:T,showUserModal:L,sidebarCollapsed:I,mobileSidebarOpen:k,isLoggedIn:q,isAdmin:Q,userName:G,filteredUsers:ne,loadData:F,updateUser:J,viewUserDetails:re,confirmDeleteUser:ie,closeUserModal:de,searchUsers:le,navigateToLibrary:K,navigateToStatistics:W,navigateToCalendar:X,navigateToFeatures:Z,navigateToProfile:$,logout:ee,toggleSidebar:se,toggleMobileSidebar:te,closeMobileSidebar:oe,formatDate:ae}}},Ce={class:"vue-app"},Se={class:"main-content"},De={class:"main-header"},Me={class:"header-left"},Te={class:"header-right"},Le={class:"content-area"},Ie={key:1,class:"error"},Ne={key:2},Pe={class:"stats-grid"},Fe={class:"stat-card"},Be={class:"stat-content"},Ee={class:"stat-number"},Re={class:"stat-subtitle"},xe={class:"stat-card"},ze={class:"stat-content"},Ve={class:"stat-number"},je={class:"stat-card"},Oe={class:"stat-content"},qe={class:"stat-number"},Qe={class:"stat-card"},Ge={class:"stat-content"},Je={class:"stat-number"},He={key:0,class:"admin-section"},Ye={class:"section-header"},Ke={class:"section-actions"},We={class:"table-container"},Xe={class:"admin-table"},Ze={class:"user-info"},$e={class:"user-name"},es={key:0,class:"admin-badge"},ss={class:"checkbox-container"},ts=["onUpdate:modelValue","onChange","disabled"],os={class:"action-buttons"},as=["onClick","disabled"],ns=["onClick","disabled"],ls={key:1,class:"admin-section"},is={class:"section-header"},rs={class:"media-grid"},ds={class:"media-info"},cs={class:"media-category"},us={class:"media-user"},ms={class:"media-date"},gs={key:2,class:"admin-section"},vs={class:"section-header"},bs={class:"collections-grid"},_s={class:"collection-description"},hs={class:"collection-user"},ys={class:"collection-count"},ps={class:"modal-header"},fs={key:0,class:"modal-body"},Us={class:"user-details"},As={class:"detail-row"},ws={class:"detail-row"},ks={class:"detail-row"},Cs={class:"detail-row"},Ss={class:"detail-row"},Ds={class:"detail-row"},Ms={key:0,class:"recent-activity"},Ts={class:"activity-list"},Ls={class:"activity-title"},Is={class:"activity-category"},Ns={class:"activity-date"};function Ps(n,s,b,t,U,y){const A=z("Sidebar"),w=z("LoadingSpinner");return i(),r("div",Ce,[e("div",{class:x(["mobile-overlay",{show:t.mobileSidebarOpen}]),onClick:s[0]||(s[0]=(...o)=>t.closeMobileSidebar&&t.closeMobileSidebar(...o))},null,2),ge(A,{collapsed:t.sidebarCollapsed,"mobile-open":t.mobileSidebarOpen,"is-logged-in":t.isLoggedIn,"is-admin":t.isAdmin,"user-name":t.userName,"current-category":"admin","category-counts":{},platforms:[],genres:[],categories:[],onToggle:t.toggleSidebar,onNavigateToLibrary:t.navigateToLibrary,onNavigateToStatistics:t.navigateToStatistics,onNavigateToCalendar:t.navigateToCalendar,onNavigateToFeatures:t.navigateToFeatures,onNavigateToProfile:t.navigateToProfile,onLogout:t.logout},null,8,["collapsed","mobile-open","is-logged-in","is-admin","user-name","onToggle","onNavigateToLibrary","onNavigateToStatistics","onNavigateToCalendar","onNavigateToFeatures","onNavigateToProfile","onLogout"]),e("div",Se,[e("header",De,[e("div",Me,[e("button",{class:"mobile-sidebar-toggle",onClick:s[1]||(s[1]=(...o)=>t.toggleMobileSidebar&&t.toggleMobileSidebar(...o))},"☰"),s[12]||(s[12]=e("h1",{class:"page-title"},"Admin Dashboard",-1))]),e("div",Te,[e("button",{class:"refresh-btn",onClick:s[2]||(s[2]=(...o)=>t.loadData&&t.loadData(...o)),title:"Refresh data"},[...s[13]||(s[13]=[e("span",{class:"refresh-icon"},"🔄",-1)])])])]),e("main",Le,[t.loading?(i(),ve(w,{key:0,message:"Loading admin data..."})):t.error?(i(),r("div",Ie,[e("p",null,l(t.error),1),e("button",{onClick:s[3]||(s[3]=(...o)=>t.loadData&&t.loadData(...o))},"Retry")])):(i(),r("div",Ne,[e("div",Pe,[e("div",Fe,[s[15]||(s[15]=e("div",{class:"stat-icon"},"👥",-1)),e("div",Be,[s[14]||(s[14]=e("h3",null,"Total Users",-1)),e("p",Ee,l(t.statistics.total_users||0),1),e("p",Re,l(t.statistics.admin_users||0)+" admins",1)])]),e("div",xe,[s[18]||(s[18]=e("div",{class:"stat-icon"},"📚",-1)),e("div",ze,[s[16]||(s[16]=e("h3",null,"Media Items",-1)),e("p",Ve,l(t.statistics.total_media_items||0),1),s[17]||(s[17]=e("p",{class:"stat-subtitle"},"across all users",-1))])]),e("div",je,[s[21]||(s[21]=e("div",{class:"stat-icon"},"📁",-1)),e("div",Oe,[s[19]||(s[19]=e("h3",null,"Collections",-1)),e("p",qe,l(t.statistics.total_collections||0),1),s[20]||(s[20]=e("p",{class:"stat-subtitle"},"user collections",-1))])]),e("div",Qe,[s[24]||(s[24]=e("div",{class:"stat-icon"},"📈",-1)),e("div",Ge,[s[22]||(s[22]=e("h3",null,"Recent Activity",-1)),e("p",Je,l(t.statistics.recent_registrations||0),1),s[23]||(s[23]=e("p",{class:"stat-subtitle"},"new users (30 days)",-1))])])]),t.showUsers?(i(),r("div",He,[e("div",Ye,[s[25]||(s[25]=e("h2",null,"User Management",-1)),e("div",Ke,[V(e("input",{type:"text","onUpdate:modelValue":s[4]||(s[4]=o=>t.userSearchQuery=o),placeholder:"Search users...",class:"search-input",onInput:s[5]||(s[5]=(...o)=>t.searchUsers&&t.searchUsers(...o))},null,544),[[be,t.userSearchQuery]]),e("button",{class:"close-btn",onClick:s[6]||(s[6]=o=>t.showUsers=!1)},"×")])]),e("div",We,[e("table",Xe,[s[27]||(s[27]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Email"),e("th",null,"Admin"),e("th",null,"Media Items"),e("th",null,"Collections"),e("th",null,"Joined"),e("th",null,"Actions")])],-1)),e("tbody",null,[(i(!0),r(C,null,S(t.filteredUsers,o=>(i(),r("tr",{key:o.id},[e("td",null,[e("div",Ze,[e("span",$e,l(o.name),1),o.is_admin?(i(),r("span",es,"👑")):p("",!0)])]),e("td",null,l(o.email),1),e("td",null,[e("label",ss,[V(e("input",{type:"checkbox","onUpdate:modelValue":c=>o.is_admin=c,onChange:c=>t.updateUser(o),disabled:t.updatingUsers.includes(o.id)||o.id===t.currentUserId},null,40,ts),[[fe,o.is_admin]]),s[26]||(s[26]=e("span",{class:"checkmark"},null,-1))])]),e("td",null,l(o.media_items_count||0),1),e("td",null,l(o.collections_count||0),1),e("td",null,l(t.formatDate(o.created_at)),1),e("td",null,[e("div",os,[e("button",{class:"btn-small btn-primary",onClick:c=>t.viewUserDetails(o.id),disabled:t.loading,title:"View Details"}," 👁️ ",8,as),e("button",{class:"btn-small btn-danger",onClick:c=>t.confirmDeleteUser(o),disabled:t.loading||o.id===t.currentUserId,title:"Delete User"}," 🗑️ ",8,ns)])])]))),128))])])])])):p("",!0),t.showMedia?(i(),r("div",ls,[e("div",is,[s[28]||(s[28]=e("h2",null,"All Media Items",-1)),e("button",{class:"close-btn",onClick:s[7]||(s[7]=o=>t.showMedia=!1)},"×")]),e("div",rs,[(i(!0),r(C,null,S(t.allMediaItems,o=>{var c;return i(),r("div",{key:o.id,class:"media-item-card"},[e("div",ds,[e("h4",null,l(o.title),1),e("p",cs,l(o.category),1),e("p",us,"User: "+l(((c=o.user)==null?void 0:c.name)||"Unknown"),1),e("p",ms,l(t.formatDate(o.created_at)),1)])])}),128))])])):p("",!0),t.showCollections?(i(),r("div",gs,[e("div",vs,[s[29]||(s[29]=e("h2",null,"All Collections",-1)),e("button",{class:"close-btn",onClick:s[8]||(s[8]=o=>t.showCollections=!1)},"×")]),e("div",bs,[(i(!0),r(C,null,S(t.allCollections,o=>{var c;return i(),r("div",{key:o.id,class:"collection-card"},[e("h4",null,l(o.name),1),e("p",_s,l(o.description||"No description"),1),e("p",hs,"User: "+l(((c=o.user)==null?void 0:c.name)||"Unknown"),1),e("p",ys,l(o.media_items_count||0)+" items",1)])}),128))])])):p("",!0)]))])]),t.showUserModal?(i(),r("div",{key:0,class:"modal-overlay",onClick:s[11]||(s[11]=(...o)=>t.closeUserModal&&t.closeUserModal(...o))},[e("div",{class:"modal-content",onClick:s[10]||(s[10]=_e(()=>{},["stop"]))},[e("div",ps,[s[30]||(s[30]=e("h3",null,"User Details",-1)),e("button",{class:"close-btn",onClick:s[9]||(s[9]=(...o)=>t.closeUserModal&&t.closeUserModal(...o))},"×")]),t.selectedUser?(i(),r("div",fs,[e("div",Us,[e("div",As,[s[31]||(s[31]=e("label",null,"Name:",-1)),e("span",null,l(t.selectedUser.name),1)]),e("div",ws,[s[32]||(s[32]=e("label",null,"Email:",-1)),e("span",null,l(t.selectedUser.email),1)]),e("div",ks,[s[33]||(s[33]=e("label",null,"Admin Status:",-1)),e("span",{class:x(["admin-status",{admin:t.selectedUser.is_admin}])},l(t.selectedUser.is_admin?"👑 Admin":"👤 User"),3)]),e("div",Cs,[s[34]||(s[34]=e("label",null,"Joined:",-1)),e("span",null,l(t.formatDate(t.selectedUser.created_at)),1)]),e("div",Ss,[s[35]||(s[35]=e("label",null,"Media Items:",-1)),e("span",null,l(t.selectedUser.media_items_count||0),1)]),e("div",Ds,[s[36]||(s[36]=e("label",null,"Collections:",-1)),e("span",null,l(t.selectedUser.collections_count||0),1)])]),t.selectedUser.media_items&&t.selectedUser.media_items.length>0?(i(),r("div",Ms,[s[37]||(s[37]=e("h4",null,"Recent Media Items",-1)),e("div",Ts,[(i(!0),r(C,null,S(t.selectedUser.media_items.slice(0,5),o=>(i(),r("div",{key:o.id,class:"activity-item"},[e("span",Ls,l(o.title),1),e("span",Is,l(o.category),1),e("span",Ns,l(t.formatDate(o.created_at)),1)]))),128))])])):p("",!0)])):p("",!0)])])):p("",!0)])}const Rs=me(ke,[["render",Ps],["__scopeId","data-v-bbab30b6"]]);export{Rs as default};
