import{d as He,r as p,u as nt,a as Ze,c as G,_ as te,b as d,e as s,t as u,f,n as oe,g as pe,h as ue,o as l,i as $e,w as De,j as ie,k as U,v as ke,l as Oe,m as z,F as X,p as Y,q as qe,s as it,x as rt,y as lt,z as ne,A as _e,B as J,C as dt,D as ct}from"./index-CU0X_eU4.js";import{u as Qe,a as et,S as ut}from"./Sidebar-D6k-xW9t.js";import{R as mt,L as gt,M as ft}from"./RegisterModal-CJhJPnok.js";const tt=He("message",()=>{const n=p(!1),t=p("info"),a=p(""),e=p(""),c=p("");function y(T){t.value=T.type||"info",a.value=T.title||"",e.value=T.message||"",c.value=T.details||"",n.value=!0}function o(T,N="Success",P=""){y({type:"success",title:N,message:T,details:P})}function b(T,N="Error",P=""){y({type:"error",title:N,message:T,details:P})}function i(T,N="Warning",P=""){y({type:"warning",title:N,message:T,details:P})}function S(T,N="Info",P=""){y({type:"info",title:N,message:T,details:P})}function M(){n.value=!1,setTimeout(()=>{t.value="info",a.value="",e.value="",c.value=""},300)}return{show:n,type:t,title:a,message:e,details:c,showMessage:y,showSuccess:o,showError:b,showWarning:i,showInfo:S,closeMessage:M}}),st=He("confirm",()=>{const n=p(!1),t=p("Confirm Action"),a=p(""),e=p(null);function c(b){return new Promise(i=>{t.value=b.title||"Confirm Action",a.value=b.message||"",n.value=!0,e.value=i})}function y(){e.value&&(e.value(!0),e.value=null),n.value=!1}function o(){e.value&&(e.value(!1),e.value=null),n.value=!1}return{show:n,title:t,message:a,showConfirm:c,confirm:y,cancel:o}}),ot=He("input",()=>{const n=p(!1),t=p("Input Required"),a=p(""),e=p(""),c=p("text"),y=p(""),o=p(null);function b(M){return new Promise(T=>{t.value=M.title||"Input Required",a.value=M.message||"",e.value=M.placeholder||"",c.value=M.inputType||"text",y.value=M.defaultValue||"",n.value=!0,o.value=T})}function i(M){o.value&&(o.value(M),o.value=null),n.value=!1}function S(){o.value&&(o.value(null),o.value=null),n.value=!1}return{show:n,title:t,message:a,placeholder:e,inputType:c,defaultValue:y,showInput:b,confirm:i,cancel:S}});function vt(){const n=nt(),t=Ze(),a=Qe(),e=tt(),c=st(),y=ot(),o=p(!1),b=p(!1),i=p(!1),S=p(!1),M=p(!1),T=p(!1),N=p(!1),P=p(null),Q=()=>typeof window<"u"?window.innerWidth>768?8:3:8,K=p(Q()),V=p("order_asc"),Z=p(null),ae=()=>{K.value=Q()};typeof window<"u"&&window.addEventListener("resize",ae);const $=[{key:"game",name:"Games",icon:"🎮"},{key:"series",name:"Series",icon:"📺"},{key:"movie",name:"Movies",icon:"🎬"},{key:"buecher",name:"Bücher",icon:"📚"},{key:"watchlist",name:"Watchlist",icon:"❤️"}],g=G(()=>{try{return t.isLoggedIn}catch(m){return console.error("Error accessing authStore.isLoggedIn:",m),!1}}),E=G(()=>{try{return t.userName}catch(m){return console.error("Error accessing authStore.userName:",m),""}}),se=G(()=>{try{return t.isAdmin}catch(m){return console.error("Error accessing authStore.isAdmin:",m),!1}}),H=G(()=>{try{return a.currentCategory}catch(m){return console.error("Error accessing mediaStore.currentCategory:",m),"game"}}),me=G({get:()=>{try{return a.searchQuery}catch(m){return console.error("Error accessing mediaStore.searchQuery:",m),""}},set:m=>{try{a.setSearchQuery(m)}catch(h){console.error("Error setting mediaStore.searchQuery:",h)}}}),re=G(()=>{try{return a.categoryCounts}catch(m){return console.error("Error accessing mediaStore.categoryCounts:",m),{}}}),ge=G(()=>{try{return a.loading}catch(m){return console.error("Error accessing mediaStore.loading:",m),!1}}),fe=G(()=>{try{return a.error}catch(m){return console.error("Error accessing mediaStore.error:",m),null}}),r=G(()=>{try{const m=[...a.filteredMedia||[]],[h,F]=V.value.split("_");return m.sort((_,k)=>{let O=_[h],D=k[h];return h==="order"?(O=_.__order||0,D=k.__order||0):h==="airing"?(O=_.isAiring?1:0,D=k.isAiring?1:0):h==="api_rating"?(O=_.api_rating||_.rating||0,D=k.api_rating||k.rating||0):h==="personal_rating"&&(O=_.personal_rating||0,D=k.personal_rating||0),typeof O=="string"&&(O=O.toLowerCase(),D=D.toLowerCase()),F==="asc"?O>D?1:-1:O<D?1:-1})}catch(m){return console.error("Error in sortedMedia computed:",m),[]}}),v=G(()=>r.value),I=G(()=>{try{if(!a||!a.mediaData)return[];const m=new Set;return a.mediaData.forEach(h=>{h.platforms&&h.platforms.split(",").forEach(F=>m.add(F.trim()))}),Array.from(m).sort()}catch(m){return console.error("Error in platforms computed:",m),[]}}),w=G(()=>{try{if(!a||!a.mediaData)return[];const m=new Set;return a.mediaData.forEach(h=>{h.genre&&h.genre.split(",").forEach(F=>m.add(F.trim()))}),Array.from(m).sort()}catch(m){return console.error("Error in genres computed:",m),[]}}),A=m=>{a.setCategory(m),et().closeMobileSidebar()},ee=()=>{a.setSearchQuery("")},j=(m,h)=>{h?a.addFilter({type:"platform",value:m}):a.removeFilter({type:"platform",value:m})},B=(m,h)=>{h?a.addFilter({type:"genre",value:m}):a.removeFilter({type:"genre",value:m})},L=(m,h)=>{h?a.addFilter({type:"airing",value:m}):a.removeFilter({type:"airing",value:m})},Ce=m=>{P.value=m,i.value=!0},x=()=>{i.value=!1,P.value=null},he=()=>{M.value=!1},Ue=async m=>{console.log("handleBulkAddItems called but not used in new workflow")},Pe=async m=>{P.value?await a.updateMediaItem(P.value.id,m):await a.addMediaItem(m),x()},Ee=async m=>{var h;try{await a.deleteMediaItem(m.id)}catch(F){((h=F.response)==null?void 0:h.status)!==404&&!F.silent&&(console.error("Delete failed:",F),e.showError("Failed to delete item: "+(F.message||"Unknown error"),"Delete Failed"))}},le=async()=>{await t.logout(),await be()},be=async()=>{try{await a.loadMedia()}catch(m){console.error("Error loading media:",m)}},Te=()=>{S.value=!S.value},Fe=()=>{if(S.value=!1,!g.value){e.showWarning("Bitte loggen Sie sich ein, um neue Items hinzuzufügen.","Login erforderlich");return}P.value=null,i.value=!0},Be=()=>{if(S.value=!1,!g.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}M.value=!0},Le=()=>{if(S.value=!1,!g.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}T.value=!0},Ne=()=>{if(S.value=!1,!g.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}e.showInfo("API Import feature coming soon!","Feature in Entwicklung")},Ve=()=>{if(S.value=!1,!g.value){e.showWarning("Bitte loggen Sie sich ein, um diese Funktion zu nutzen.","Login erforderlich");return}ve()},we=m=>{if(!m)return"Unknown";const h=$.find(F=>F.key===m);return h?h.name:m},Ge=async()=>{const m=we(H.value),h=re.value[H.value]||0;if(h===0){e.showInfo("No items to delete in this category.","Nothing to Delete");return}const F=`Are you sure you want to delete ALL ${h} items in "${m}"?

This action cannot be undone!`;if(await c.showConfirm({title:"Delete All Items",message:F}))try{const O=((a==null?void 0:a.mediaData)||[]).filter(D=>H.value==="watchlist"?D.category==="watchlist"||D.isNew===!0:D.category===H.value).map(D=>D.id);await a.batchDeleteMediaItems(O),await be(),e.showSuccess(`Successfully deleted ${h} items from "${m}"`,"Items Deleted")}catch(k){console.error("Error deleting items:",k),e.showError("Error occurred while deleting items. Please try again.","Delete Failed")}},ze=m=>{const h=m.split(`
`).map(D=>D.trim()).filter(D=>D.length>0);if(h.length===0){e.showWarning("Die TXT-Datei ist leer oder enthält keine gültigen Einträge.","Leere Datei");return}const _=a.filteredMedia.map(D=>D.title.toLowerCase().trim()),k=h.filter(D=>{const de=D.toLowerCase().trim();return!_.some(ce=>ce.includes(de)||de.includes(ce))}),O=h.filter(D=>{const de=D.toLowerCase().trim();return _.some(ce=>ce.includes(de)||de.includes(ce))});Z.value={totalInFile:h.length,missingItems:k,existingItems:O,currentCategory:H.value,categoryName:we(H.value)},T.value=!1,N.value=!0},We=()=>{Z.value=null,N.value=!1},ve=async()=>{const m=(a==null?void 0:a.mediaData)||[];if(m.length===0){e.showInfo("Keine Media Items zum Exportieren gefunden.","Nichts zu exportieren");return}const h=await y.showInput({title:"Export Format wählen",message:`1 = CSV
2 = JSON
3 = Beide

Geben Sie die Nummer ein:`,placeholder:"1",defaultValue:"1"});if(!h||!["1","2","3"].includes(h))return;const F=new Date().toISOString().split("T")[0];(h==="1"||h==="3")&&Ae(m,F),(h==="2"||h==="3")&&xe(m,F),e.showSuccess(`Collection mit ${m.length} Items wurde erfolgreich exportiert!`,"Export erfolgreich")},Ae=(m,h)=>{const _=[["Titel","Kategorie","Release","Rating","Platforms","Genre","Spielzeit","Status","Beschreibung"].join(","),...m.map(k=>[`"${(k.title||"").replace(/"/g,'""')}"`,`"${(k.category||k.category_name||"Unbekannt").replace(/"/g,'""')}"`,`"${k.release||""}"`,`"${k.rating||""}"`,`"${(k.platforms||"").replace(/"/g,'""')}"`,`"${(k.genre||"").replace(/"/g,'""')}"`,`"${k.spielzeit||""}"`,`"${k.isAiring?"Airing":"Abgeschlossen"}"`,`"${(k.description||"").replace(/"/g,'""')}"`].join(","))].join(`
`);Se(_,`media_collection_${h}.csv`,"text/csv;charset=utf-8;")},xe=(m,h)=>{const F={exportDate:new Date().toISOString(),totalItems:m.length,categories:[...new Set(m.map(_=>_.category||_.category_name||"Unbekannt"))],items:m.map(_=>({id:_.id,title:_.title||"",category:_.category||_.category_name||"Unbekannt",release:_.release||"",rating:_.rating||null,platforms:_.platforms||"",genre:_.genre||"",spielzeit:_.spielzeit||null,status:_.isAiring?"Airing":"Abgeschlossen",description:_.description||"",isNew:_.isNew||!1,nextSeason:_.nextSeason||null,discovered:_.discovered||null}))};Se(JSON.stringify(F,null,2),`media_collection_${h}.json`,"application/json;charset=utf-8;")},Se=(m,h,F)=>{const _=new Blob([m],{type:F}),k=document.createElement("a"),O=URL.createObjectURL(_);k.setAttribute("href",O),k.setAttribute("download",h),k.style.visibility="hidden",document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(O)};return{showLoginModal:o,showRegisterModal:b,showEditModal:i,showFloatingMenu:S,showBulkAddModal:M,showTxtImportModal:T,showTxtImportResults:N,editingItem:P,gridColumns:K,sortBy:V,categories:$,txtImportResults:Z,isLoggedIn:g,isAdmin:se,userName:E,currentCategory:H,searchQuery:me,categoryCounts:re,loading:ge,error:fe,paginatedMedia:v,platforms:I,genres:w,setCategory:A,clearSearch:ee,togglePlatformFilter:j,toggleGenreFilter:B,toggleAiringFilter:L,editItem:Ce,closeEditModal:x,closeBulkAddModal:he,handleBulkAddItems:Ue,handleSaveItem:Pe,handleDeleteItem:Ee,logout:le,loadMedia:be,toggleFloatingMenu:Te,addNewItem:Fe,bulkAddItems:Be,importFromTxt:Le,importFromAPI:Ne,createCollection:Ve,exportMediaCollection:ve,exportAsCSV:Ae,exportAsJSON:xe,downloadFile:Se,deleteAllInCategory:Ge,getCategoryDisplayName:we,navigateToCalendar:()=>{n.push("/calendar")},navigateToProfile:()=>{n.push("/profile")},navigateToAdmin:()=>{console.log("🔥 navigateToAdmin function called!"),console.log("🔥 Router object:",n),console.log("🔥 Pushing to /admin...");try{n.push("/admin"),console.log("🔥 Successfully navigated to /admin!")}catch(m){console.error("🔥 Error navigating to admin:",m)}},processTxtContent:ze,closeTxtImportResults:We,cleanup:()=>{typeof window<"u"&&window.removeEventListener("resize",ae)},router:n}}const yt={name:"MediaItem",props:{item:{type:Object,required:!0}},emits:["edit"],computed:{showWatchlistTag(){return this.item.category==="watchlist"||this.item.isNew===!0},isWatchlistItem(){return this.item.category==="watchlist"||this.item.isNew===!0}},methods:{getImageUrl(n){return n?n.startsWith("http")?n.startsWith("http://")?n.replace("http://","https://"):n:n.startsWith("/")?n:`/storage/${n}`:""},handleImageError(n){var t;n.target.style.display="none",(t=n.target.nextElementSibling)==null||t.classList.add("show")},formatDate(n){return n?new Date(n).toLocaleDateString():""},editItem(){this.$emit("edit",this.item)},getWatchlistReleaseStatus(){if(!this.item.release)return"";const n=new Date(this.item.release),t=new Date;t.setHours(0,0,0,0),n.setHours(0,0,0,0);const a=n.getTime()-t.getTime(),e=Math.ceil(a/(1e3*3600*24));if(e>0)return e===1?"Tomorrow!":e<=7?`${e} days left`:e<=30?`${e} days left`:`${Math.ceil(e/30)} months left`;if(e===0)return"Released today!";{const c=this.getTypeTagText().toLowerCase();return c==="game"?"Unplayed yet":c==="series"||c==="movie"?"Unwatched yet":c==="buecher"?"Unread yet":"Unconsumed yet"}},getWatchlistReleaseStatusClass(){if(!this.item.release)return"";const n=new Date(this.item.release),t=new Date;t.setHours(0,0,0,0),n.setHours(0,0,0,0);const a=n.getTime()-t.getTime(),e=Math.ceil(a/(1e3*3600*24));return e>0?"countdown":e===0?"released-today":"unconsumed"},getTypeTagText(){var t,a,e;const n=this.item.watchlistType||this.item.watchlist_type;if(n)return n.charAt(0).toUpperCase()+n.slice(1);if(this.item.genre){const c=this.item.genre.toLowerCase();if(c.includes("game")||c.includes("gaming")||(t=this.item.platforms)!=null&&t.toLowerCase().includes("steam")||(a=this.item.platforms)!=null&&a.toLowerCase().includes("ps")||(e=this.item.platforms)!=null&&e.toLowerCase().includes("xbox"))return"Game";if(c.includes("series")||c.includes("tv")||c.includes("episode")||this.item.isAiring)return"Series";if(c.includes("movie")||c.includes("film")||c.includes("cinema"))return"Movie";if(c.includes("book")||c.includes("literature")||c.includes("novel")||c.includes("author"))return"Bücher"}if(this.item.platforms){const c=this.item.platforms.toLowerCase();if(c.includes("steam")||c.includes("ps")||c.includes("xbox")||c.includes("nintendo")||c.includes("pc"))return"Game";if(c.includes("netflix")||c.includes("hulu")||c.includes("disney")||c.includes("hbo"))return"Series";if(c.includes("cinema")||c.includes("theater"))return"Movie";if(c.includes("book")||c.includes("kindle")||c.includes("audible")||c.includes("author"))return"Bücher"}return"Media"},getTypeTagClass(){return`type-${this.getTypeTagText().toLowerCase()}`},getNextSeasonCountdown(){if(!this.item.nextSeasonRelease)return"";const n=new Date(this.item.nextSeasonRelease),t=new Date;t.setHours(0,0,0,0),n.setHours(0,0,0,0);const a=n.getTime()-t.getTime(),e=Math.ceil(a/(1e3*3600*24));return e>0?e===1?"Tomorrow!":e<=7?`${e} days`:e<=30?`${e} days`:`${Math.ceil(e/30)} months`:e===0?"Today!":"Released"},getCategoryClass(){var t;const n=(t=this.item.category)==null?void 0:t.toLowerCase();return n==="movies"||n==="movie"?"category-movies":n==="books"||n==="buecher"?"category-books":n==="series"||n==="tv"?"category-series":n==="games"||n==="game"?"category-games":"category-default"},getCategoryIcon(){var t;const n=(t=this.item.category)==null?void 0:t.toLowerCase();return n==="movies"||n==="movie"?"🎬":n==="books"||n==="buecher"?"📚":n==="series"||n==="tv"?"📺":n==="games"||n==="game"?"🎮":"📁"},getCategoryStyle(){var t;const n=(t=this.item.category)==null?void 0:t.toLowerCase();if(n==="games"||n==="game"){const a=this.item.rating||0;return this.getGameStyleByRating(a)}return{}},getGameStyleByRating(n){return n>=4.5?{"--game-primary":"#ffd700","--game-secondary":"#ffed4e","--game-accent":"#ff6b35","--game-glow":"0 0 20px rgba(255, 215, 0, 0.6)","--game-border":"3px solid #ffd700"}:n>=4?{"--game-primary":"#00d4ff","--game-secondary":"#4a9eff","--game-accent":"#00ff88","--game-glow":"0 0 15px rgba(0, 212, 255, 0.5)","--game-border":"3px solid #00d4ff"}:n>=3.5?{"--game-primary":"#00ff88","--game-secondary":"#4caf50","--game-accent":"#8bc34a","--game-glow":"0 0 12px rgba(0, 255, 136, 0.4)","--game-border":"3px solid #00ff88"}:n>=3?{"--game-primary":"#ff9800","--game-secondary":"#ffc107","--game-accent":"#ff5722","--game-glow":"0 0 10px rgba(255, 152, 0, 0.3)","--game-border":"3px solid #ff9800"}:n>=2?{"--game-primary":"#ff5722","--game-secondary":"#f44336","--game-accent":"#d32f2f","--game-glow":"0 0 8px rgba(255, 87, 34, 0.3)","--game-border":"3px solid #ff5722"}:{"--game-primary":"#9e9e9e","--game-secondary":"#757575","--game-accent":"#616161","--game-glow":"0 0 5px rgba(158, 158, 158, 0.2)","--game-border":"3px solid #9e9e9e"}}}},pt={class:"media-image"},ht=["src","alt"],bt={key:1,class:"no-image"},wt={class:"no-image-icon"},St={class:"media-info"},It={class:"media-title"},_t={class:"media-meta"},kt={key:0,class:"media-release"},Ct={key:1},Tt={key:1,class:"media-rating"},At={key:0,class:"media-platforms"},xt={key:1,class:"media-genre"},Mt={key:2,class:"media-description"},Rt={key:3,class:"media-airing"},Dt={key:0,class:"next-season"},Ut={key:1,class:"countdown"},Pt={key:4,class:"watchlist-type-tag"};function Et(n,t,a,e,c,y){return l(),d("div",{class:oe(["media-item",y.getCategoryClass()]),style:ue(y.getCategoryStyle()),onClick:t[1]||(t[1]=(...o)=>y.editItem&&y.editItem(...o))},[s("div",pt,[a.item.path?(l(),d("img",{key:0,src:y.getImageUrl(a.item.path),alt:a.item.title,onError:t[0]||(t[0]=(...o)=>y.handleImageError&&y.handleImageError(...o))},null,40,ht)):(l(),d("div",bt,[s("span",wt,u(y.getCategoryIcon()),1)]))]),s("div",St,[s("h3",It,u(a.item.title),1),s("div",_t,[a.item.release?(l(),d("span",kt,[y.isWatchlistItem&&a.item.release?(l(),d("span",{key:0,class:oe(y.getWatchlistReleaseStatusClass())},u(y.getWatchlistReleaseStatus()),3)):(l(),d("span",Ct,u(y.formatDate(a.item.release)),1))])):f("",!0),a.item.rating?(l(),d("span",Tt,u("★".repeat(Math.max(0,Math.min(5,Math.floor(a.item.rating)))))+u("☆".repeat(Math.max(0,5-Math.max(0,Math.min(5,Math.floor(a.item.rating)))))),1)):f("",!0)]),a.item.platforms?(l(),d("div",At,u(a.item.platforms),1)):f("",!0),a.item.genre?(l(),d("div",xt,u(a.item.genre),1)):f("",!0),a.item.description?(l(),d("div",Mt,u(a.item.description),1)):f("",!0),a.item.isAiring?(l(),d("div",Rt,[t[2]||(t[2]=s("span",{class:"airing-badge"},[s("span",{class:"airing-dot"}),pe(" Airing ")],-1)),a.item.nextSeason?(l(),d("span",Dt,"S"+u(a.item.nextSeason),1)):f("",!0),a.item.nextSeasonRelease?(l(),d("span",Ut,u(y.getNextSeasonCountdown()),1)):f("",!0)])):f("",!0),y.showWatchlistTag?(l(),d("div",Pt,[s("span",{class:oe(["type-tag",y.getTypeTagClass()])},u(y.getTypeTagText()),3)])):f("",!0)]),t[3]||(t[3]=s("div",{class:"edit-indicator"},[s("span",{class:"edit-icon"},"✏️")],-1))],6)}const Ft=te(yt,[["render",Et],["__scopeId","data-v-a0d9c4df"]]),Bt={name:"FloatingActionButton",props:{showMenu:{type:Boolean,default:!1},showDeleteAll:{type:Boolean,default:!1},categoryName:{type:String,default:""},itemCount:{type:Number,default:0}},emits:["toggleMenu","addNewItem","bulkAddItems","importFromTxt","importFromAPI","createCollection","deleteAllInCategory"]},Lt={class:"floating-actions"},Nt={class:"menu-text"},Vt={class:"item-count-badge"};function Gt(n,t,a,e,c,y){return l(),d("div",Lt,[s("div",{class:oe(["floating-menu",{show:a.showMenu}])},[s("button",{class:"floating-menu-item",onClick:t[0]||(t[0]=o=>n.$emit("addNewItem"))},[...t[7]||(t[7]=[s("span",{class:"menu-icon"},"➕",-1),s("span",{class:"menu-text"},"Add Item",-1)])]),s("button",{class:"floating-menu-item",onClick:t[1]||(t[1]=o=>n.$emit("bulkAddItems"))},[...t[8]||(t[8]=[s("span",{class:"menu-icon"},"📦",-1),s("span",{class:"menu-text"},"Bulk Add",-1)])]),s("button",{class:"floating-menu-item",onClick:t[2]||(t[2]=o=>n.$emit("importFromTxt"))},[...t[9]||(t[9]=[s("span",{class:"menu-icon"},"📄",-1),s("span",{class:"menu-text"},"Import from TXT",-1)])]),s("button",{class:"floating-menu-item",onClick:t[3]||(t[3]=o=>n.$emit("importFromAPI"))},[...t[10]||(t[10]=[s("span",{class:"menu-icon"},"🌐",-1),s("span",{class:"menu-text"},"Import from API",-1)])]),s("button",{class:"floating-menu-item",onClick:t[4]||(t[4]=o=>n.$emit("createCollection"))},[...t[11]||(t[11]=[s("span",{class:"menu-icon"},"📚",-1),s("span",{class:"menu-text"},"Create Collection",-1)])]),a.showDeleteAll&&a.itemCount>0?(l(),d("button",{key:0,class:"floating-menu-item delete-all-item",onClick:t[5]||(t[5]=o=>n.$emit("deleteAllInCategory"))},[t[12]||(t[12]=s("span",{class:"menu-icon"},"🗑️",-1)),s("span",Nt,"Delete All "+u(a.categoryName),1),s("span",Vt,"("+u(a.itemCount)+")",1)])):f("",!0)],2),s("button",{class:"floating-add-btn",onClick:t[6]||(t[6]=o=>n.$emit("toggleMenu"))},u(a.showMenu?"✕":"+"),1)])}const zt=te(Bt,[["render",Gt],["__scopeId","data-v-19731834"]]),Ye="http://127.0.0.1:8000/api",Wt={async getConfig(){try{console.log("📚 Simple Google Books - Getting config...");const n=await fetch(`${Ye}/google-books-config`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const t=await n.json();return console.log("📚 Simple Google Books - Config loaded:",t),t}catch(n){throw console.error("📚 Simple Google Books - Config failed:",n),n}},async searchBooks(n,t=10){try{console.log("📚 Simple Google Books - Searching:",n);const a=await fetch(`${Ye}/google-books/search?q=${encodeURIComponent(n)}&maxResults=${t}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const e=await a.json();return console.log("📚 Simple Google Books - Search success:",e),e}catch(a){throw console.error("📚 Simple Google Books - Search failed:",a),a}}},jt={name:"EditModal",props:{item:{type:Object,default:null},currentCategory:{type:String,default:"watchlist"}},emits:["close","save","delete"],setup(n,{emit:t}){const a=p(!1),e=p(""),c=p([]),y=p(null),o=p(null),b=p(""),i=$e({category:"watchlist",title:"",release:"",apiRating:"",personalRating:"",count:"",platforms:"",genre:"",link:"",path:"",discovered:"",spielzeit:"",isAiring:!1,nextSeason:"",nextSeasonRelease:"",imageUrl:"",watchlistType:"",imageCleared:!1}),S=G(()=>!!n.item),M=G(()=>i.category==="game"),T=G(()=>i.category==="series"),N=G(()=>i.category==="watchlist");De(()=>n.item,r=>{r?(Object.keys(i).forEach(v=>{i[v]=r[v]||""}),r.api_rating!==void 0&&(i.apiRating=r.api_rating),r.personal_rating!==void 0&&(i.personalRating=r.personal_rating),r.rating!==void 0&&!i.apiRating&&(i.apiRating=r.rating)):Object.keys(i).forEach(v=>{v==="category"?i[v]=n.currentCategory||"watchlist":v==="release"?i[v]=new Date().toISOString().split("T")[0]:i[v]=""})},{immediate:!0}),De(()=>n.currentCategory,r=>{!n.item&&r&&(i.category=r)});const P=async()=>{if(!i.title){e.value="Title is required";return}if(i.category==="watchlist"&&!i.watchlistType){e.value="Please select a type for watchlist items";return}if(i.category==="watchlist"&&!i.release){e.value="Release date is required for watchlist items";return}a.value=!0,e.value="";try{const r={...i};b.value?(r.path=b.value,r.imageUrl=b.value):r.imageUrl&&r.imageUrl.trim()?r.path=r.imageUrl:(r.imageUrl=null,r.path=null),Object.keys(r).forEach(v=>{r[v]===""&&v!=="watchlistType"&&(r[v]=null)}),r.apiRating&&(r.apiRating=parseFloat(r.apiRating)),r.personalRating&&(r.personalRating=parseFloat(r.personalRating)),r.count&&(r.count=parseInt(r.count)),r.spielzeit&&(r.spielzeit=parseInt(r.spielzeit)),r.nextSeason&&(r.nextSeason=parseInt(r.nextSeason)),t("save",r)}catch(r){e.value=r.message||"Failed to save item"}finally{a.value=!1}},Q=()=>{e.value="",t("close")},K=()=>{t("delete",n.item),Q()},V=async()=>{if(b.value){c.value=[];return}if(y.value&&clearTimeout(y.value),!i.title||i.title.length<3){c.value=[];return}y.value=setTimeout(async()=>{try{console.log("🔍 EditModal API Search:",{title:i.title,category:i.category,watchlistType:i.watchlistType});const r=i.category==="watchlist"?i.watchlistType:i.category;if(i.category==="watchlist"&&!i.watchlistType){c.value=[];return}let v=[],I=[];if(r==="buecher"){console.log("📚 Searching Google Books API for:",i.title);const w=await Wt.searchBooks(i.title,10);w.success&&w.data?(console.log("📚 Google Books API Success:",w.data.length,"results"),I=w.data.map(A=>({title:A.title,release:A.publishedDate?$(A.publishedDate):"",genre:A.categories?A.categories.join(", "):"",platforms:"",link:A.infoLink||A.previewLink||"",imageUrl:A.imageUrl||"",rating:"",apiSource:"google_books",id:A.id,author:A.author,description:A.description,publisher:A.publisher,isbn10:A.isbn10,isbn13:A.isbn13})),console.log("📚 Formatted Google Books results:",I)):console.warn("📚 Google Books API failed:",w.error)}else console.log("🎬 Searching Media API for:",i.title,"category:",r),v=await qe.searchApi(i.title,r,10),v&&v.length>0&&(I=v.map(w=>({title:w.title,release:w.release,genre:w.overview||"",platforms:w.platforms||"",link:w.link||"",imageUrl:w.image||"",rating:w.rating||"",apiSource:w.api_source||"",id:w.id||""})));I.length>0?(console.log("✅ API Search Results:",I.length,"items found"),c.value=I):(console.log("❌ No API results found"),c.value=[{title:`"${i.title}" - Keine Ergebnisse gefunden`,release:"",genre:"Bitte manuell ausfüllen",isPlaceholder:!0}])}catch(r){console.error("❌ API search failed:",r),c.value=[{title:`"${i.title}" - API nicht verfügbar`,release:"",genre:"Bitte manuell ausfüllen",isPlaceholder:!0}]}},500)},Z=async r=>{if(r.isPlaceholder){c.value=[];return}if(console.log("📚 Selecting API result:",{title:r.title,apiSource:r.apiSource,author:r.author}),i.title=r.title,r.release&&(i.release=r.release),r.platforms&&(i.platforms=r.platforms),r.genre&&(i.genre=r.genre),r.link&&(i.link=r.link),r.rating&&(i.apiRating=r.rating),r.apiSource==="google_books"){if(console.log("📚 Filling Google Books data:",{author:r.author,description:r.description,publisher:r.publisher,isbn10:r.isbn10,isbn13:r.isbn13}),r.author&&(i.platforms=r.author),r.description){const v=i.genre||"";i.genre=v?`${v} | ${r.description.substring(0,100)}...`:r.description.substring(0,200)}if(r.publisher){const v=i.link||"";i.link=v||`Publisher: ${r.publisher}`}}r.imageUrl?(i.imageUrl=r.imageUrl,i.path=r.imageUrl):(i.imageUrl="",i.path=""),c.value=[]},ae=r=>r?new Date(r).toLocaleDateString():"",$=r=>{if(!r)return"";let v;if(typeof r=="string"){if(/^\d{4}$/.test(r))return`${r}-01-01`;if(/^\d{4}-\d{2}$/.test(r))return`${r}-01`;if(/^\d{4}-\d{2}-\d{2}$/.test(r))return r;v=new Date(r)}else v=new Date(r);return isNaN(v.getTime())?(console.warn("📚 Invalid date format:",r),""):v.toISOString().split("T")[0]};return{form:i,loading:a,error:e,apiResults:c,isEditing:S,isGame:M,isSeries:T,isWatchlist:N,imageUploadRef:o,uploadedImagePath:b,handleSave:P,closeModal:Q,deleteItem:K,searchApi:V,selectApiResult:Z,formatDate:ae,formatDateForInput:$,ensureHttpsUrl:r=>r&&(r.startsWith("http://")?r.replace("http://","https://"):r),getReleasePreview:()=>{var A;if(!i.release)return"";const r=new Date(i.release),v=new Date;v.setHours(0,0,0,0),r.setHours(0,0,0,0);const I=r.getTime()-v.getTime(),w=Math.ceil(I/(1e3*3600*24));if(w>0)return w===1?"Tomorrow!":w<=7?`${w} days left`:w<=30?`${w} days left`:`${Math.ceil(w/30)} months left`;if(w===0)return"Released today!";{const ee=((A=i.watchlistType)==null?void 0:A.toLowerCase())||"media";return ee==="game"?"Unplayed yet":ee==="series"||ee==="movie"?"Unwatched yet":"Unconsumed yet"}},triggerImageUpload:()=>{var r;(r=o.value)==null||r.click()},handleImageUpload:async r=>{const v=r.target.files[0];if(v){if(!v.type.startsWith("image/")){e.value="Please select a valid image file";return}if(v.size>10*1024*1024){e.value="Image file too large. Maximum size is 10MB";return}a.value=!0,e.value="";try{const I=i.title.replace(/[^a-zA-Z0-9\s\-_\.]/g,"").trim()||"item",w=Date.now(),A=v.name.split(".").pop()||"jpg",ee=`images_downloads/uploads/${I}_${w}.${A}`,j=await qe.uploadImage(v,ee);j.success?(b.value=j.saved,i.path=j.saved,i.imageUrl=j.saved):e.value=j.error||"Failed to upload image"}catch(I){e.value=I.message||"Failed to upload image"}finally{a.value=!1}}},getImagePreviewUrl:()=>b.value?`/storage/${b.value}`:i.imageUrl?i.imageUrl.startsWith("http")?i.imageUrl:`/storage/${i.imageUrl}`:"",handleImageError:r=>{console.warn("Image preview failed:",r.target.src),r.target.style.display="none"},clearImage:()=>{i.imageUrl="",i.path="",b.value="",o.value&&(o.value.value="")},removeUploadedImage:()=>{b.value="",i.imageUrl===b.value&&(i.imageUrl=""),i.path===b.value&&(i.path=""),o.value&&(o.value.value="")}}}},Ot={class:"form-header"},qt={class:"form-group category-group"},Ht={class:"form-group title-group"},Qt={class:"search-container"},Jt=["placeholder","disabled"],Kt={key:0,class:"search-results"},Xt=["onClick"],Yt={class:"result-thumbnail"},Zt=["src","alt"],$t={key:1,class:"no-image"},es={class:"result-content"},ts={class:"result-title"},ss={class:"result-meta"},os={key:0},as={key:1},ns={key:2,class:"rating"},is={class:"form-row"},rs={class:"form-group"},ls={for:"release"},ds={key:0,class:"required"},cs=["required"],us={key:0,class:"field-hint"},ms={key:1,class:"release-preview"},gs={class:"form-group"},fs={class:"form-group"},vs={class:"form-row"},ys={class:"form-group"},ps={class:"form-group"},hs={class:"form-row"},bs={class:"form-group"},ws={class:"form-group"},Ss={key:0,class:"form-row"},Is={class:"form-group"},_s={key:0,class:"field-error"},ks={class:"form-row"},Cs={class:"form-group"},Ts={class:"form-group"},As={key:1,class:"form-row"},xs={class:"form-group"},Ms={key:2,class:"form-row"},Rs={class:"form-group"},Ds={key:0,class:"form-group"},Us={key:3,class:"form-row"},Ps={class:"form-group"},Es={class:"form-row"},Fs={class:"form-group"},Bs={class:"form-group"},Ls={class:"image-upload-container"},Ns=["disabled"],Vs={key:0,class:"upload-success"},Gs={key:4,class:"form-row"},zs={class:"form-group image-preview-group"},Ws={class:"image-preview"},js=["src","alt"],Os={key:5,class:"error-message"},qs={class:"modal-buttons"},Hs=["disabled"],Qs=["disabled"],Js=["disabled"],Ks=["disabled"];function Xs(n,t,a,e,c,y){return l(),d("div",{class:"modal",onClick:t[28]||(t[28]=(...o)=>e.closeModal&&e.closeModal(...o))},[s("div",{class:"modal-content",onClick:t[27]||(t[27]=ie(()=>{},["stop"]))},[s("h2",null,u(e.isEditing?"Edit Item":"Add Item"),1),s("form",{onSubmit:t[26]||(t[26]=ie((...o)=>e.handleSave&&e.handleSave(...o),["prevent"]))},[s("div",Ot,[s("div",qt,[t[30]||(t[30]=s("label",{for:"category"},"Category:",-1)),U(s("select",{id:"category","onUpdate:modelValue":t[0]||(t[0]=o=>e.form.category=o),required:""},[...t[29]||(t[29]=[Oe('<option value="watchlist" data-v-f8ef7c37>Watchlist</option><option value="game" data-v-f8ef7c37>Game</option><option value="series" data-v-f8ef7c37>Series</option><option value="movie" data-v-f8ef7c37>Movie</option><option value="buecher" data-v-f8ef7c37>Bücher</option>',5)])],512),[[ke,e.form.category]])]),s("div",Ht,[t[31]||(t[31]=s("label",{for:"title"},"Title:",-1)),s("div",Qt,[U(s("input",{type:"text",id:"title","onUpdate:modelValue":t[1]||(t[1]=o=>e.form.title=o),onInput:t[2]||(t[2]=(...o)=>e.searchApi&&e.searchApi(...o)),required:"",placeholder:e.isWatchlist?"Enter title (API search + manual input available)":"Enter title",disabled:e.loading},null,40,Jt),[[z,e.form.title]]),e.apiResults.length>0?(l(),d("div",Kt,[(l(!0),d(X,null,Y(e.apiResults,o=>(l(),d("div",{key:o.title,class:"search-result-item",onClick:b=>e.selectApiResult(o)},[s("div",Yt,[o.imageUrl?(l(),d("img",{key:0,src:e.ensureHttpsUrl(o.imageUrl),alt:o.title},null,8,Zt)):(l(),d("div",$t,[s("span",null,u(o.title.charAt(0).toUpperCase()),1)]))]),s("div",es,[s("div",ts,u(o.title),1),s("div",ss,[o.release?(l(),d("span",os,u(e.formatDate(o.release)),1)):f("",!0),o.genre?(l(),d("span",as,u(o.genre),1)):f("",!0),o.rating?(l(),d("span",ns,"⭐ "+u(o.rating),1)):f("",!0)])])],8,Xt))),128))])):f("",!0)])])]),s("div",is,[s("div",rs,[s("label",ls,[pe(u(e.isWatchlist?"Release Date:":"Release:")+" ",1),e.isWatchlist?(l(),d("span",ds,"*")):f("",!0)]),U(s("input",{type:"date",id:"release","onUpdate:modelValue":t[3]||(t[3]=o=>e.form.release=o),required:e.isWatchlist},null,8,cs),[[z,e.form.release]]),e.isWatchlist?(l(),d("div",us," 📅 Set the release date to track countdown or status ")):f("",!0),e.isWatchlist&&e.form.release?(l(),d("div",ms,[t[32]||(t[32]=s("strong",null,"Preview:",-1)),pe(" "+u(e.getReleasePreview()),1)])):f("",!0)]),s("div",gs,[t[33]||(t[33]=s("label",{for:"apiRating"},"API Rating:",-1)),U(s("input",{type:"number",id:"apiRating","onUpdate:modelValue":t[4]||(t[4]=o=>e.form.apiRating=o),step:"0.1",min:"0",max:"10",placeholder:"0-10",readonly:""},null,512),[[z,e.form.apiRating]]),t[34]||(t[34]=s("div",{class:"field-hint"},"From API - read only",-1))]),s("div",fs,[t[35]||(t[35]=s("label",{for:"personalRating"},"Personal Rating:",-1)),U(s("input",{type:"number",id:"personalRating","onUpdate:modelValue":t[5]||(t[5]=o=>e.form.personalRating=o),step:"0.1",min:"0",max:"10",placeholder:"0-10"},null,512),[[z,e.form.personalRating]]),t[36]||(t[36]=s("div",{class:"field-hint"},"Your personal rating",-1))])]),s("div",vs,[s("div",ys,[t[37]||(t[37]=s("label",{for:"views"},"Views:",-1)),U(s("input",{type:"number",id:"views","onUpdate:modelValue":t[6]||(t[6]=o=>e.form.count=o),min:"0",placeholder:"0"},null,512),[[z,e.form.count]])]),s("div",ps,[t[38]||(t[38]=s("label",{for:"discovered"},"Discovered:",-1)),U(s("input",{type:"date",id:"discovered","onUpdate:modelValue":t[7]||(t[7]=o=>e.form.discovered=o)},null,512),[[z,e.form.discovered]])])]),s("div",hs,[s("div",bs,[t[39]||(t[39]=s("label",{for:"platforms"},"Platforms:",-1)),U(s("input",{type:"text",id:"platforms","onUpdate:modelValue":t[8]||(t[8]=o=>e.form.platforms=o),placeholder:"PC, PS5, Xbox"},null,512),[[z,e.form.platforms]])]),s("div",ws,[t[40]||(t[40]=s("label",{for:"genre"},"Genre:",-1)),U(s("input",{type:"text",id:"genre","onUpdate:modelValue":t[9]||(t[9]=o=>e.form.genre=o),placeholder:"Action, Adventure, RPG"},null,512),[[z,e.form.genre]])])]),e.form.category==="watchlist"?(l(),d("div",Ss,[s("div",Is,[t[42]||(t[42]=s("label",{for:"watchlistType"},[pe("Type: "),s("span",{class:"required"},"*")],-1)),U(s("select",{id:"watchlistType","onUpdate:modelValue":t[10]||(t[10]=o=>e.form.watchlistType=o)},[...t[41]||(t[41]=[Oe('<option value="" data-v-f8ef7c37>Select Type</option><option value="game" data-v-f8ef7c37>Game</option><option value="series" data-v-f8ef7c37>Series</option><option value="movie" data-v-f8ef7c37>Movie</option><option value="buecher" data-v-f8ef7c37>Bücher</option>',5)])],512),[[ke,e.form.watchlistType]]),e.form.category==="watchlist"&&!e.form.watchlistType?(l(),d("div",_s," Please select a type for watchlist items ")):f("",!0)])])):f("",!0),s("div",ks,[s("div",Cs,[t[43]||(t[43]=s("label",{for:"link"},"Link:",-1)),U(s("input",{type:"url",id:"link","onUpdate:modelValue":t[11]||(t[11]=o=>e.form.link=o),placeholder:"https://..."},null,512),[[z,e.form.link]])]),s("div",Ts,[t[44]||(t[44]=s("label",{for:"path"},"Image Path:",-1)),U(s("input",{type:"text",id:"path","onUpdate:modelValue":t[12]||(t[12]=o=>e.form.path=o),placeholder:"images/movies/filename.jpg"},null,512),[[z,e.form.path]])])]),e.isGame?(l(),d("div",As,[s("div",xs,[t[45]||(t[45]=s("label",{for:"playtime"},"Playtime (Minutes):",-1)),U(s("input",{type:"number",id:"playtime","onUpdate:modelValue":t[13]||(t[13]=o=>e.form.spielzeit=o),min:"0",placeholder:"0"},null,512),[[z,e.form.spielzeit]])])])):f("",!0),e.isSeries?(l(),d("div",Ms,[s("div",Rs,[t[47]||(t[47]=s("label",{for:"isAiring"},"Status:",-1)),U(s("select",{id:"isAiring","onUpdate:modelValue":t[14]||(t[14]=o=>e.form.isAiring=o)},[...t[46]||(t[46]=[s("option",{value:!1},"Finished",-1),s("option",{value:!0},"Airing",-1)])],512),[[ke,e.form.isAiring]])]),e.form.isAiring?(l(),d("div",Ds,[t[48]||(t[48]=s("label",{for:"nextSeason"},"Next Season:",-1)),U(s("input",{type:"number",id:"nextSeason","onUpdate:modelValue":t[15]||(t[15]=o=>e.form.nextSeason=o),min:"1",placeholder:"1"},null,512),[[z,e.form.nextSeason]])])):f("",!0)])):f("",!0),e.form.isAiring?(l(),d("div",Us,[s("div",Ps,[t[49]||(t[49]=s("label",{for:"nextSeasonRelease"},"Next Season Release:",-1)),U(s("input",{type:"date",id:"nextSeasonRelease","onUpdate:modelValue":t[16]||(t[16]=o=>e.form.nextSeasonRelease=o)},null,512),[[z,e.form.nextSeasonRelease]])])])):f("",!0),s("div",Es,[s("div",Fs,[t[50]||(t[50]=s("label",{for:"imageUrl"},"Image URL (optional):",-1)),U(s("input",{type:"text",id:"imageUrl","onUpdate:modelValue":t[17]||(t[17]=o=>e.form.imageUrl=o),placeholder:"https://... or leave empty for API images"},null,512),[[z,e.form.imageUrl]])]),s("div",Bs,[t[51]||(t[51]=s("label",{for:"imageUpload"},"Upload Image:",-1)),s("div",Ls,[s("input",{type:"file",id:"imageUpload",ref:"imageUploadRef",onChange:t[18]||(t[18]=(...o)=>e.handleImageUpload&&e.handleImageUpload(...o)),accept:"image/*",style:{display:"none"}},null,544),s("button",{type:"button",onClick:t[19]||(t[19]=(...o)=>e.triggerImageUpload&&e.triggerImageUpload(...o)),class:"upload-btn",disabled:e.loading}," 📁 Choose Image ",8,Ns),e.uploadedImagePath?(l(),d("div",Vs,[pe(" ✅ Image uploaded: "+u(e.uploadedImagePath)+" ",1),s("button",{type:"button",onClick:t[20]||(t[20]=(...o)=>e.removeUploadedImage&&e.removeUploadedImage(...o)),class:"remove-uploaded-btn",title:"Remove uploaded image to enable API search"}," ✕ Remove ")])):f("",!0)])])]),e.form.imageUrl||e.uploadedImagePath?(l(),d("div",Gs,[s("div",zs,[t[52]||(t[52]=s("label",null,"Image Preview:",-1)),s("div",Ws,[s("img",{src:e.getImagePreviewUrl(),alt:e.form.title,onError:t[21]||(t[21]=(...o)=>e.handleImageError&&e.handleImageError(...o))},null,40,js),s("button",{type:"button",onClick:t[22]||(t[22]=(...o)=>e.clearImage&&e.clearImage(...o)),class:"clear-image-btn",title:"Remove image"}," ✕ ")])])])):f("",!0),e.error?(l(),d("div",Os,u(e.error),1)):f("",!0),s("div",qs,[s("button",{type:"submit",disabled:e.loading},u(e.loading?"Saving...":"Save"),9,Hs),s("button",{type:"button",onClick:t[23]||(t[23]=(...o)=>e.closeModal&&e.closeModal(...o)),disabled:e.loading}," Cancel ",8,Qs),e.isEditing?(l(),d("button",{key:0,type:"button",onClick:t[24]||(t[24]=(...o)=>e.deleteItem&&e.deleteItem(...o)),disabled:e.loading,class:"delete-btn"}," Delete ",8,Js)):f("",!0),s("button",{type:"button",onClick:t[25]||(t[25]=(...o)=>e.handleSave&&e.handleSave(...o)),disabled:e.loading,class:"check-btn",title:"Add to list"}," ✓ ",8,Ks)])],32)])])}const Ys=te(jt,[["render",Xs],["__scopeId","data-v-f8ef7c37"]]),Zs={name:"BulkAddModal",props:{show:{type:Boolean,default:!1},currentCategory:{type:String,default:""}},emits:["close"],setup(n,{emit:t}){const a=Qe(),e=p(1),c=p(!1),y=p(!0),o=p(!1),b=p(0),i=p(0),S=p(0),M=p(0),T=p(null),N=p(""),P=p(""),Q=p([]),K=p([]),V=p({category:"",itemsText:"",defaultRating:null}),Z=G(()=>V.value.category&&V.value.itemsText.trim()&&!c.value),ae=G(()=>{const v=$().length;return v>0?Math.round(b.value/v*100):0}),$=()=>!V.value.itemsText||!V.value.itemsText.trim()?[]:V.value.itemsText.split(`
`).map(v=>v.trim()).filter(v=>v.length>0).map(v=>{const I=v.split("|").map(w=>w.trim());return{searchTerm:I[0]||"",additionalInfo:I[1]||null}}),g=()=>{b.value=0,i.value=0,S.value=0,M.value=0,T.value=null,N.value="",P.value="",Q.value=[],K.value=[]},E=(v,I,w)=>{T.value=v,N.value=I,P.value=w},se=(v,I,w="")=>{const A={searching:"Searching...",found:"Found",adding:"Adding...",added:"Added",skipped:"Skipped",error:"Error"}[I]||I;Q.value.push({title:v,status:I,statusText:A,message:w})},H=async()=>{var w,A,ee;if(!Z.value)return;e.value=2,c.value=!0,y.value=!0,g();const v=$();let I=0;try{for(let j=0;j<v.length;j++){const B=v[j];b.value=j+1,E({title:B.searchTerm,description:B.additionalInfo},"searching","Searching...");try{se(B.searchTerm,"searching","Searching API..."),console.log(`🔍 Searching for: "${B.searchTerm}" in category: ${V.value.category}`);const L=await qe.searchApi(B.searchTerm,V.value.category,1);if(console.log(`🔍 Search results for "${B.searchTerm}":`,L),L&&L.length>0&&L[0]&&L[0].api_source&&L[0].image){const x=L[0];console.log(`✅ Found real API data for "${B.searchTerm}":`,{title:x.title,api_source:x.api_source,has_image:!!x.image,has_genre:!!x.genre,has_release:!!x.release}),E({title:x.title,description:`Found: ${x.genre||"Unknown genre"} • ${x.release||"Unknown year"} • ${x.api_source}`},"found","Found in API with data"),se(B.searchTerm,"found",`Found: ${x.title} (${x.api_source})`),E({title:x.title},"adding","Adding to library...");const he={title:x.title,category:V.value.category,release:x.release||null,rating:x.rating?Math.round(x.rating):V.value.defaultRating||null,platforms:x.platforms||null,genre:x.genre||null,link:x.link||null,path:x.image||null,external_id:x.id||null,count:1,is_airing:!1,spielzeit:0,description:B.additionalInfo||null};await a.addMediaItem(he,!0),i.value++,E({title:x.title},"added","Successfully added with API data"),se(B.searchTerm,"added",`Added: ${x.title} with API data`)}else console.log(`❌ No real API data found for "${B.searchTerm}"`),E({title:B.searchTerm},"skipped","No API data found - will retry"),K.value.push({searchTerm:B.searchTerm,additionalInfo:B.additionalInfo}),S.value++,se(B.searchTerm,"skipped","No API data found - ready for retry")}catch(L){console.error(`Error processing "${B.searchTerm}":`,L),L.isDuplicate||((w=L.response)==null?void 0:w.status)===409&&((ee=(A=L.response)==null?void 0:A.data)!=null&&ee.duplicate)?(E({title:B.searchTerm},"skipped","Already exists - skipped"),S.value++,se(B.searchTerm,"skipped","Item already exists in library")):(E({title:B.searchTerm},"error","Error occurred"),M.value++,se(B.searchTerm,"error",L.message||"Unknown error"))}if(I++,I>=5){console.log("🔄 Reloading media data after 5 items...");try{await a.loadMedia(),I=0}catch(L){console.warn("Failed to reload media data:",L)}}if(!c.value)break;for(;o.value&&c.value;)await new Promise(L=>setTimeout(L,100));await new Promise(L=>setTimeout(L,1e3))}console.log("🔄 Final media data reload...");try{await a.loadMedia()}catch(j){console.warn("Failed to reload media data at end:",j)}e.value=3,E(null,"","")}catch(j){console.error("Bulk processing error:",j),M.value++}finally{c.value=!1,y.value=!1}},me=()=>{c.value=!1,y.value=!1,o.value=!1,e.value=1,g()},re=()=>{o.value=!0},ge=()=>{o.value=!1},fe=()=>{const v=K.value.map(I=>I.additionalInfo?`${I.searchTerm} | ${I.additionalInfo}`:I.searchTerm).join(`
`);V.value.itemsText=v,b.value=0,i.value=0,M.value=0,T.value=null,N.value="",P.value="",Q.value=[],e.value=1},r=()=>{e.value=1,c.value=!1,y.value=!0,g(),V.value={category:"",itemsText:"",defaultRating:null},t("close")};return De(()=>n.show,v=>{v&&n.currentCategory?V.value.category=n.currentCategory:v||r()}),{currentStep:e,isProcessing:c,canCancel:y,isPaused:o,processedCount:b,addedCount:i,skippedCount:S,errorCount:M,currentItem:T,currentItemStatus:N,currentItemStatusText:P,processingResults:Q,skippedItems:K,bulkData:V,canStart:Z,progressPercentage:ae,startProcessing:H,cancelProcessing:me,pauseProcessing:re,resumeProcessing:ge,retrySkippedItems:fe,closeModal:r}}},$s={class:"modal-header"},eo={class:"modal-body"},to={key:0,class:"step-container"},so={class:"bulk-add-form"},oo={class:"form-group"},ao={class:"form-group"},no={class:"form-group"},io={key:1,class:"step-container"},ro={class:"processing-container"},lo={class:"progress-overview"},co={class:"progress-stats"},uo={class:"stat"},mo={class:"stat-number"},go={class:"stat"},fo={class:"stat-number"},vo={class:"stat"},yo={class:"stat-number"},po={class:"stat"},ho={class:"stat-number"},bo={class:"progress-bar"},wo={class:"progress-text"},So={class:"current-item"},Io={class:"current-item-header"},_o={class:"current-item-title"},ko={key:0,class:"paused-indicator"},Co={key:0,class:"current-item-description"},To={key:1,class:"api-data-indicator"},Ao={key:2,class:"no-api-indicator"},xo={class:"results-list"},Mo={class:"result-header"},Ro={class:"result-title"},Do={class:"result-status"},Uo={key:0,class:"result-message"},Po={key:2,class:"step-container"},Eo={class:"results-summary"},Fo={class:"summary-stats"},Bo={class:"summary-stat success"},Lo={class:"stat-number"},No={class:"summary-stat warning"},Vo={class:"stat-number"},Go={class:"summary-stat error"},zo={class:"stat-number"},Wo={key:0,class:"retry-section"},jo={class:"retry-list"},Oo=["onUpdate:modelValue"],qo={key:0,class:"retry-additional"},Ho={key:1,class:"detailed-results"},Qo={class:"results-list"},Jo={class:"result-header"},Ko={class:"result-title"},Xo={class:"result-status"},Yo={key:0,class:"result-message"},Zo={class:"modal-footer"},$o=["disabled"],ea={key:2,class:"processing-controls"},ta=["disabled"],sa=["disabled"],oa={key:3,class:"footer-buttons"};function aa(n,t,a,e,c,y){var o,b;return a.show?(l(),d("div",{key:0,class:"modal-overlay",onClick:t[12]||(t[12]=(...i)=>e.closeModal&&e.closeModal(...i))},[s("div",{class:"modal-content",onClick:t[11]||(t[11]=ie(()=>{},["stop"]))},[s("div",$s,[t[13]||(t[13]=s("h2",null,"Bulk Add Items",-1)),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...i)=>e.closeModal&&e.closeModal(...i))},"✕")]),s("div",eo,[e.currentStep===1?(l(),d("div",to,[t[19]||(t[19]=s("div",{class:"step-header"},[s("div",{class:"step-number"},"1"),s("h3",null,"Enter Your List")],-1)),s("div",so,[s("div",oo,[t[15]||(t[15]=s("label",{for:"category"},"Category *",-1)),U(s("select",{id:"category","onUpdate:modelValue":t[1]||(t[1]=i=>e.bulkData.category=i),required:""},[...t[14]||(t[14]=[Oe('<option value="" data-v-382b001b>Select Category</option><option value="game" data-v-382b001b>Game</option><option value="series" data-v-382b001b>Series</option><option value="movie" data-v-382b001b>Movie</option><option value="buecher" data-v-382b001b>Bücher</option><option value="watchlist" data-v-382b001b>Watchlist</option>',6)])],512),[[ke,e.bulkData.category]])]),s("div",ao,[t[16]||(t[16]=s("label",{for:"items-text"},"Items (one per line) *",-1)),U(s("textarea",{id:"items-text","onUpdate:modelValue":t[2]||(t[2]=i=>e.bulkData.itemsText=i),placeholder:`Enter items one per line, for example:
The Witcher 3
Cyberpunk 2077
Red Dead Redemption 2`,rows:"10",required:""},null,512),[[z,e.bulkData.itemsText]]),t[17]||(t[17]=s("small",{class:"help-text"},"Enter one item per line. The system will automatically search and add each item individually.",-1))]),s("div",no,[t[18]||(t[18]=s("label",{for:"default-rating"},"Default Rating",-1)),U(s("input",{id:"default-rating","onUpdate:modelValue":t[3]||(t[3]=i=>e.bulkData.defaultRating=i),type:"number",min:"0",max:"10",step:"0.1",placeholder:"Optional rating for all items"},null,512),[[z,e.bulkData.defaultRating,void 0,{number:!0}]])])])])):f("",!0),e.currentStep===2?(l(),d("div",io,[t[24]||(t[24]=s("div",{class:"step-header"},[s("div",{class:"step-number"},"2"),s("h3",null,"Processing Items")],-1)),s("div",ro,[s("div",lo,[s("div",co,[s("span",uo,[s("span",mo,u(e.processedCount),1),t[20]||(t[20]=s("span",{class:"stat-label"},"Processed",-1))]),s("span",go,[s("span",fo,u(e.addedCount),1),t[21]||(t[21]=s("span",{class:"stat-label"},"Added",-1))]),s("span",vo,[s("span",yo,u(e.skippedCount),1),t[22]||(t[22]=s("span",{class:"stat-label"},"Skipped",-1))]),s("span",po,[s("span",ho,u(e.errorCount),1),t[23]||(t[23]=s("span",{class:"stat-label"},"Errors",-1))])]),s("div",bo,[s("div",{class:"progress-fill",style:ue({width:e.progressPercentage+"%"})},null,4)]),s("div",wo,u(e.progressPercentage)+"% Complete",1)]),s("div",So,[s("div",Io,[s("span",_o,"Processing: "+u(((o=e.currentItem)==null?void 0:o.title)||"..."),1),s("span",{class:oe(["current-item-status",e.currentItemStatus])},[e.isPaused?(l(),d("span",ko,"⏸️ PAUSED - ")):f("",!0),pe(u(e.currentItemStatusText),1)],2)]),(b=e.currentItem)!=null&&b.description?(l(),d("div",Co,u(e.currentItem.description),1)):f("",!0),e.currentItemStatus==="found"?(l(),d("div",To," ✅ Real API data found with image and metadata ")):f("",!0),e.currentItemStatus==="skipped"?(l(),d("div",Ao," ❌ No API data found - will be retried ")):f("",!0)]),s("div",xo,[(l(!0),d(X,null,Y(e.processingResults,(i,S)=>(l(),d("div",{key:S,class:oe(["result-item",i.status])},[s("div",Mo,[s("span",Ro,u(i.title),1),s("span",Do,u(i.statusText),1)]),i.message?(l(),d("div",Uo,u(i.message),1)):f("",!0)],2))),128))])])])):f("",!0),e.currentStep===3?(l(),d("div",Po,[t[31]||(t[31]=s("div",{class:"step-header"},[s("div",{class:"step-number"},"3"),s("h3",null,"Results")],-1)),s("div",Eo,[s("div",Fo,[s("div",Bo,[s("span",Lo,u(e.addedCount),1),t[25]||(t[25]=s("span",{class:"stat-label"},"Successfully Added",-1))]),s("div",No,[s("span",Vo,u(e.skippedCount),1),t[26]||(t[26]=s("span",{class:"stat-label"},"Not Found (Ready for Retry)",-1))]),s("div",Go,[s("span",zo,u(e.errorCount),1),t[27]||(t[27]=s("span",{class:"stat-label"},"Errors",-1))])]),e.skippedItems.length>0?(l(),d("div",Wo,[t[28]||(t[28]=s("h4",null,"Items Not Found - Ready for Retry",-1)),t[29]||(t[29]=s("p",{class:"retry-description"}," The following items were not found in the API. You can edit them and try again: ",-1)),s("div",jo,[(l(!0),d(X,null,Y(e.skippedItems,(i,S)=>(l(),d("div",{key:S,class:"retry-item"},[U(s("input",{"onUpdate:modelValue":M=>i.searchTerm=M,class:"retry-input",placeholder:"Edit search term..."},null,8,Oo),[[z,i.searchTerm]]),i.additionalInfo?(l(),d("span",qo," | "+u(i.additionalInfo),1)):f("",!0)]))),128))])])):f("",!0),e.processingResults.length>0?(l(),d("div",Ho,[t[30]||(t[30]=s("h4",null,"Detailed Results",-1)),s("div",Qo,[(l(!0),d(X,null,Y(e.processingResults,(i,S)=>(l(),d("div",{key:S,class:oe(["result-item",i.status])},[s("div",Jo,[s("span",Ko,u(i.title),1),s("span",Xo,u(i.statusText),1)]),i.message?(l(),d("div",Yo,u(i.message),1)):f("",!0)],2))),128))])])):f("",!0)])])):f("",!0)]),s("div",Zo,[e.currentStep===1?(l(),d("button",{key:0,class:"btn btn-secondary",onClick:t[4]||(t[4]=(...i)=>e.closeModal&&e.closeModal(...i))}," Cancel ")):f("",!0),e.currentStep===1?(l(),d("button",{key:1,class:"btn btn-primary",onClick:t[5]||(t[5]=(...i)=>e.startProcessing&&e.startProcessing(...i)),disabled:!e.canStart}," Check All and Add ",8,$o)):f("",!0),e.currentStep===2?(l(),d("div",ea,[s("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=(...i)=>e.cancelProcessing&&e.cancelProcessing(...i)),disabled:!e.canCancel}," Cancel ",8,ta),e.isPaused?f("",!0):(l(),d("button",{key:0,class:"btn btn-warning",onClick:t[7]||(t[7]=(...i)=>e.pauseProcessing&&e.pauseProcessing(...i)),disabled:!e.isProcessing}," Pause ",8,sa)),e.isPaused?(l(),d("button",{key:1,class:"btn btn-primary",onClick:t[8]||(t[8]=(...i)=>e.resumeProcessing&&e.resumeProcessing(...i))}," Resume ")):f("",!0)])):f("",!0),e.currentStep===3?(l(),d("div",oa,[e.skippedItems.length>0?(l(),d("button",{key:0,class:"btn btn-warning",onClick:t[9]||(t[9]=(...i)=>e.retrySkippedItems&&e.retrySkippedItems(...i))}," Retry "+u(e.skippedItems.length)+" Items ",1)):f("",!0),s("button",{class:"btn btn-primary",onClick:t[10]||(t[10]=(...i)=>e.closeModal&&e.closeModal(...i))}," Done ")])):f("",!0)])])])):f("",!0)}const na=te(Zs,[["render",aa],["__scopeId","data-v-382b001b"]]),ia={name:"TxtImportModal",props:{show:{type:Boolean,default:!1}},emits:["close","fileProcessed"],methods:{handleFileUpload(n){const t=n.target.files[0];if(!t)return;if(!t.name.toLowerCase().endsWith(".txt")){alert("Bitte wählen Sie eine .txt Datei aus.");return}const a=new FileReader;a.onload=e=>{const c=e.target.result;this.$emit("fileProcessed",c)},a.readAsText(t,"UTF-8")}}},ra={class:"file-upload-area"},la={class:"modal-buttons"};function da(n,t,a,e,c,y){return a.show?(l(),d("div",{key:0,class:"modal",onClick:t[3]||(t[3]=o=>n.$emit("close"))},[s("div",{class:"modal-content",onClick:t[2]||(t[2]=ie(()=>{},["stop"]))},[t[5]||(t[5]=s("h2",null,"📄 Import from TXT File",-1)),t[6]||(t[6]=s("p",null,"Wählen Sie eine .txt Datei mit einer Liste von Titeln aus, um zu prüfen, welche Items in der aktuellen Kategorie fehlen.",-1)),s("div",ra,[s("input",{type:"file",id:"txtFileInput",accept:".txt",onChange:t[0]||(t[0]=(...o)=>y.handleFileUpload&&y.handleFileUpload(...o)),style:{display:"none"}},null,32),t[4]||(t[4]=s("label",{for:"txtFileInput",class:"file-upload-label"},[s("span",{class:"upload-icon"},"📁"),s("span",{class:"upload-text"},"TXT-Datei auswählen"),s("span",{class:"upload-hint"},"Eine .txt Datei mit einer Liste von Titeln")],-1))]),s("div",la,[s("button",{type:"button",onClick:t[1]||(t[1]=o=>n.$emit("close"))}," Cancel ")])])])):f("",!0)}const ca=te(ia,[["render",da],["__scopeId","data-v-d761bd17"]]),ua={name:"TxtImportResultsModal",props:{show:{type:Boolean,default:!1},results:{type:Object,default:null}},emits:["close"]},ma={class:"results-summary"},ga={class:"summary-item"},fa={class:"summary-value"},va={class:"summary-item"},ya={class:"summary-value"},pa={class:"summary-item"},ha={class:"summary-value existing"},ba={class:"summary-item"},wa={class:"summary-value missing"},Sa={key:0,class:"missing-items"},Ia={class:"items-list"},_a={key:1,class:"existing-items"},ka={class:"items-list"},Ca={class:"modal-buttons"};function Ta(n,t,a,e,c,y){return a.show&&a.results?(l(),d("div",{key:0,class:"modal",onClick:t[2]||(t[2]=o=>n.$emit("close"))},[s("div",{class:"modal-content results-modal",onClick:t[1]||(t[1]=ie(()=>{},["stop"]))},[t[7]||(t[7]=s("h2",null,"📊 TXT Import Ergebnisse",-1)),s("div",ma,[s("div",ga,[t[3]||(t[3]=s("span",{class:"summary-label"},"Kategorie:",-1)),s("span",fa,u(a.results.categoryName),1)]),s("div",va,[t[4]||(t[4]=s("span",{class:"summary-label"},"Titel in Datei:",-1)),s("span",ya,u(a.results.totalInFile),1)]),s("div",pa,[t[5]||(t[5]=s("span",{class:"summary-label"},"Bereits vorhanden:",-1)),s("span",ha,u(a.results.existingItems.length),1)]),s("div",ba,[t[6]||(t[6]=s("span",{class:"summary-label"},"Fehlende Titel:",-1)),s("span",wa,u(a.results.missingItems.length),1)])]),a.results.missingItems.length>0?(l(),d("div",Sa,[s("h3",null,"❌ Fehlende Titel ("+u(a.results.missingItems.length)+"):",1),s("div",Ia,[(l(!0),d(X,null,Y(a.results.missingItems,(o,b)=>(l(),d("div",{key:b,class:"missing-item"},u(o),1))),128))])])):f("",!0),a.results.existingItems.length>0?(l(),d("div",_a,[s("h3",null,"✅ Bereits vorhanden ("+u(a.results.existingItems.length)+"):",1),s("div",ka,[(l(!0),d(X,null,Y(a.results.existingItems,(o,b)=>(l(),d("div",{key:b,class:"existing-item"},u(o),1))),128))])])):f("",!0),s("div",Ca,[s("button",{type:"button",onClick:t[0]||(t[0]=o=>n.$emit("close"))}," Schließen ")])])])):f("",!0)}const Aa=te(ua,[["render",Ta],["__scopeId","data-v-ec385b83"]]),xa={name:"SimpleAddItem",setup(){const n=p(!1),t=p(null),a=$e({title:"Test Game",category:"game",release:"2003-01-01",count:1});return{form:a,loading:n,result:t,addItem:async()=>{n.value=!0,t.value=null;try{const c=window.location.origin,y=await fetch(`${c}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:"admin@example.com",password:"admin123"})});if(!y.ok)throw new Error("Login failed");const b=(await y.json()).token,S=await(await fetch(`${c}/api/media`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify(a)})).json();S.success?t.value={success:!0,message:`Success! Item added with ID: ${S.data.id}`}:t.value={success:!1,message:`Error: ${JSON.stringify(S)}`}}catch(c){t.value={success:!1,message:`Error: ${c.message}`}}finally{n.value=!1}}}}},Ma={class:"simple-add-item"},Ra=["disabled"];function Da(n,t,a,e,c,y){return l(),d("div",Ma,[t[10]||(t[10]=s("h3",null,"Simple Add Item Test",-1)),s("form",{onSubmit:t[4]||(t[4]=ie((...o)=>e.addItem&&e.addItem(...o),["prevent"]))},[s("div",null,[t[5]||(t[5]=s("label",null,"Title:",-1)),U(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>e.form.title=o),type:"text",required:""},null,512),[[z,e.form.title]])]),s("div",null,[t[7]||(t[7]=s("label",null,"Category:",-1)),U(s("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>e.form.category=o)},[...t[6]||(t[6]=[s("option",{value:"game"},"Game",-1),s("option",{value:"movie"},"Movie",-1),s("option",{value:"series"},"Series",-1)])],512),[[ke,e.form.category]])]),s("div",null,[t[8]||(t[8]=s("label",null,"Release:",-1)),U(s("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>e.form.release=o),type:"date"},null,512),[[z,e.form.release]])]),s("div",null,[t[9]||(t[9]=s("label",null,"Count:",-1)),U(s("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>e.form.count=o),type:"number",min:"0"},null,512),[[z,e.form.count]])]),s("button",{type:"submit",disabled:e.loading},u(e.loading?"Adding...":"Add Item"),9,Ra)],32),e.result?(l(),d("div",{key:0,class:oe(["result",e.result.success?"success":"error"])},u(e.result.message),3)):f("",!0)])}const Ua=te(xa,[["render",Da],["__scopeId","data-v-642b91e0"]]),Pa={name:"LoadingSpinner",props:{loading:{type:Boolean,default:!0},message:{type:String,default:"Loading..."}}},Ea={key:0,class:"loading-spinner"},Fa={key:0};function Ba(n,t,a,e,c,y){return a.loading?(l(),d("div",Ea,[t[0]||(t[0]=s("div",{class:"spinner"},null,-1)),a.message?(l(),d("p",Fa,u(a.message),1)):f("",!0)])):f("",!0)}const La=te(Pa,[["render",Ba],["__scopeId","data-v-4221b645"]]),Na={name:"MessageBox",props:{show:{type:Boolean,default:!1},type:{type:String,default:"info",validator:n=>["success","error","warning","info"].includes(n)},title:{type:String,default:""},message:{type:String,required:!0},details:{type:String,default:""}},emits:["close"],setup(n,{emit:t}){const a=()=>{t("close")},e=G(()=>{switch(n.type){case"success":return"✅";case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"ℹ️"}}),c=G(()=>`message-${n.type}`);return{closeMessage:a,icon:e,messageType:c}}},Va={class:"message-header"},Ga={class:"message-icon"},za={class:"message-title"},Wa={class:"message-body"},ja={key:0,class:"message-details"},Oa={class:"message-footer"};function qa(n,t,a,e,c,y){return a.show?(l(),d("div",{key:0,class:"message-overlay",onClick:t[3]||(t[3]=(...o)=>e.closeMessage&&e.closeMessage(...o))},[s("div",{class:oe(["message-box",e.messageType]),onClick:t[2]||(t[2]=ie(()=>{},["stop"]))},[s("div",Va,[s("span",Ga,u(e.icon),1),s("h3",za,u(a.title),1),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...o)=>e.closeMessage&&e.closeMessage(...o))},"✕")]),s("div",Wa,[s("p",null,u(a.message),1),a.details?(l(),d("div",ja,[s("pre",null,u(a.details),1)])):f("",!0)]),s("div",Oa,[s("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...o)=>e.closeMessage&&e.closeMessage(...o))},"OK")])],2)])):f("",!0)}const Ha=te(Na,[["render",qa],["__scopeId","data-v-8d49f52b"]]),Qa={name:"ConfirmDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Confirm Action"},message:{type:String,required:!0}},emits:["confirm","close"],setup(n,{emit:t}){const a=()=>{t("close")};return{closeDialog:a,confirmAction:()=>{t("confirm"),a()}}}},Ja={class:"confirm-header"},Ka={class:"confirm-title"},Xa={class:"confirm-body"},Ya={class:"confirm-footer"};function Za(n,t,a,e,c,y){return a.show?(l(),d("div",{key:0,class:"confirm-overlay",onClick:t[4]||(t[4]=(...o)=>e.closeDialog&&e.closeDialog(...o))},[s("div",{class:"confirm-dialog",onClick:t[3]||(t[3]=ie(()=>{},["stop"]))},[s("div",Ja,[s("h3",Ka,u(a.title),1),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...o)=>e.closeDialog&&e.closeDialog(...o))},"✕")]),s("div",Xa,[s("p",null,u(a.message),1)]),s("div",Ya,[s("button",{class:"btn btn-secondary",onClick:t[1]||(t[1]=(...o)=>e.closeDialog&&e.closeDialog(...o))},"Cancel"),s("button",{class:"btn btn-danger",onClick:t[2]||(t[2]=(...o)=>e.confirmAction&&e.confirmAction(...o))},"Confirm")])])])):f("",!0)}const $a=te(Qa,[["render",Za],["__scopeId","data-v-4e196e5e"]]),en={name:"InputDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Input Required"},message:{type:String,required:!0},placeholder:{type:String,default:""},inputType:{type:String,default:"text"},defaultValue:{type:String,default:""}},emits:["confirm","close"],setup(n,{emit:t}){const a=p(""),e=p(null),c=()=>{t("close")},y=()=>{t("confirm",a.value),c()};return De(()=>n.show,async o=>{o&&(a.value=n.defaultValue,await lt(),e.value&&(e.value.focus(),e.value.select()))}),{inputValue:a,inputRef:e,closeDialog:c,confirmAction:y}}},tn={class:"input-header"},sn={class:"input-title"},on={class:"input-body"},an={class:"input-message"},nn=["type","placeholder"],rn={class:"input-footer"};function ln(n,t,a,e,c,y){return a.show?(l(),d("div",{key:0,class:"input-overlay",onClick:t[6]||(t[6]=(...o)=>e.closeDialog&&e.closeDialog(...o))},[s("div",{class:"input-dialog",onClick:t[5]||(t[5]=ie(()=>{},["stop"]))},[s("div",tn,[s("h3",sn,u(a.title),1),s("button",{class:"close-btn",onClick:t[0]||(t[0]=(...o)=>e.closeDialog&&e.closeDialog(...o))},"✕")]),s("div",on,[s("p",an,u(a.message),1),U(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>e.inputValue=o),type:a.inputType,placeholder:a.placeholder,class:"input-field",onKeyup:t[2]||(t[2]=rt((...o)=>e.confirmAction&&e.confirmAction(...o),["enter"])),ref:"inputRef"},null,40,nn),[[it,e.inputValue]])]),s("div",rn,[s("button",{class:"btn btn-secondary",onClick:t[3]||(t[3]=(...o)=>e.closeDialog&&e.closeDialog(...o))},"Cancel"),s("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...o)=>e.confirmAction&&e.confirmAction(...o))},"OK")])])])):f("",!0)}const dn=te(en,[["render",ln],["__scopeId","data-v-3713e615"]]),cn={name:"MediaLibrary",components:{MediaItem:Ft,Sidebar:ut,MainHeader:ft,FloatingActionButton:zt,LoginModal:gt,RegisterModal:mt,EditModal:Ys,BulkAddModal:na,TxtImportModal:ca,TxtImportResultsModal:Aa,SimpleAddItem:Ua,LoadingSpinner:La,MessageBox:Ha,ConfirmDialog:$a,InputDialog:dn},setup(){const n=Qe(),t=tt(),a=st(),e=ot(),c=Ze(),y=et(),o=p(!1),b=p(null),{showLoginModal:i,showRegisterModal:S,showEditModal:M,showFloatingMenu:T,showBulkAddModal:N,showTxtImportModal:P,showTxtImportResults:Q,editingItem:K,gridColumns:V,sortBy:Z,categories:ae,txtImportResults:$,isLoggedIn:g,isAdmin:E,userName:se,currentCategory:H,searchQuery:me,categoryCounts:re,loading:ge,error:fe,paginatedMedia:r,platforms:v,genres:I,setCategory:w,clearSearch:A,togglePlatformFilter:ee,toggleGenreFilter:j,toggleAiringFilter:B,editItem:L,closeEditModal:Ce,closeBulkAddModal:x,handleBulkAddItems:he,handleSaveItem:Ue,handleDeleteItem:Pe,logout:Ee,loadMedia:le,toggleFloatingMenu:be,addNewItem:Te,bulkAddItems:Fe,importFromTxt:Be,importFromAPI:Le,createCollection:Ne,exportMediaCollection:Ve,exportAsCSV:we,exportAsJSON:Ge,downloadFile:ze,deleteAllInCategory:We,getCategoryDisplayName:ve,navigateToCalendar:Ae,navigateToProfile:xe,processTxtContent:Se,closeTxtImportResults:Je,cleanup:Ke,router:je}=vt(),Xe=G(()=>{try{return ve?ve(H.value):H.value}catch(C){return console.error("Error getting category display name:",C),H.value||"Unknown"}}),m=G(()=>{const C=n.mediaData||[],W={totalItems:C.length,totalCollections:0,totalPlaytime:0,avgRating:0,categoryDistribution:{},ratingDistribution:{},platformDistribution:{},genreDistribution:{},recentActivity:[],airingSeries:[]};let Me=0,Ie=0;return C.forEach(R=>{const Re=R.category||"unknown";if(W.categoryDistribution[Re]=(W.categoryDistribution[Re]||0)+1,R.rating&&R.rating>0){const ye=Math.floor(R.rating);W.ratingDistribution[ye]=(W.ratingDistribution[ye]||0)+1,Me+=R.rating,Ie++}if(R.platforms&&R.category==="game"&&R.platforms.split(",").map(q=>q.trim()).filter(q=>q).forEach(q=>{W.platformDistribution[q]=(W.platformDistribution[q]||0)+1}),R.genre&&(R.category==="series"||R.category==="movie")&&R.genre.split(",").map(q=>q.trim()).filter(q=>q).forEach(q=>{W.genreDistribution[q]=(W.genreDistribution[q]||0)+1}),R.spielzeit&&R.spielzeit>0&&(W.totalPlaytime+=R.spielzeit),R.category==="series"&&R.isAiring===!0&&W.airingSeries.push({title:R.title,nextSeason:R.nextSeason,nextSeasonRelease:R.nextSeasonRelease}),R.discovered){const ye=new Date(R.discovered),q=new Date;q.setDate(q.getDate()-30),ye>=q&&W.recentActivity.push({title:R.title,category:R.category,discovered:R.discovered})}}),Ie>0&&(W.avgRating=(Me/Ie).toFixed(1)),W.totalPlaytime=Math.round(W.totalPlaytime/60),W.recentActivity.sort((R,Re)=>new Date(Re.discovered)-new Date(R.discovered)),W}),h=C=>C?new Date(C).toLocaleDateString():"",F=C=>{const W=Math.max(0,Math.min(5,parseInt(C)||0)),Me="★".repeat(W),Ie="☆".repeat(5-W);return Me+Ie},_=C=>{w(C),Te()},k=()=>{i.value=!1,S.value=!0},O=()=>{i.value=!0},D=C=>{i.value=!1,le()},de=()=>{S.value=!1,le()},ce=async()=>{o.value=!0,b.value=null;try{console.log("🔧 Starting admin setup...");const C=await c.adminSetup();C.success?(console.log("✅ Admin setup successful:",C),b.value={type:"success",text:`✅ Admin created and logged in! User: ${C.user.name} (${C.user.email})`},await le(),setTimeout(()=>{b.value=null},5e3)):(console.log("ℹ️ Admin already exists:",C),b.value={type:"info",text:`ℹ️ ${C.message} (${C.admin_count} admin(s) exist)`},setTimeout(()=>{b.value=null},3e3))}catch(C){console.error("❌ Admin setup failed:",C),b.value={type:"error",text:`❌ Admin setup failed: ${C.message||"Unknown error"}`},setTimeout(()=>{b.value=null},5e3)}finally{o.value=!1}},at=()=>{console.log("🔥 DEBUG: Direct admin navigation called!"),console.log("🔥 DEBUG: Router object:",je);try{je.push("/admin"),console.log("🔥 DEBUG: Successfully navigated to /admin!")}catch(C){console.error("🔥 DEBUG: Error navigating to admin:",C)}};return dt(async()=>{try{if(await le(),g.value)try{n.initializeRealtimeUpdates()}catch(C){console.error("Error initializing realtime updates:",C)}}catch(C){console.error("Error during initialization:",C)}}),ct(()=>{if(g.value)try{n.cleanupRealtimeUpdates()}catch(C){console.error("Error cleaning up realtime updates:",C)}Ke()}),{showLoginModal:i,showRegisterModal:S,showEditModal:M,showFloatingMenu:T,showBulkAddModal:N,showTxtImportModal:P,showTxtImportResults:Q,editingItem:K,gridColumns:V,sortBy:Z,categories:ae,txtImportResults:$,adminSetupLoading:o,adminSetupMessage:b,isLoggedIn:g,isAdmin:E,userName:se,currentCategory:H,currentCategoryDisplayName:Xe,searchQuery:me,categoryCounts:re,loading:ge,error:fe,paginatedMedia:r,platforms:v,genres:I,setCategory:w,clearSearch:A,navigateToCalendar:Ae,navigateToProfile:xe,addItemFromSidebar:_,togglePlatformFilter:ee,toggleGenreFilter:j,toggleAiringFilter:B,editItem:L,switchToRegister:k,showAdminLogin:O,handleLoginSuccess:D,handleRegisterSuccess:de,handleAdminSetup:ce,debugNavigateToAdmin:at,closeEditModal:Ce,closeBulkAddModal:x,handleBulkAddItems:he,handleSaveItem:Ue,handleDeleteItem:Pe,logout:Ee,loadMedia:le,toggleFloatingMenu:be,addNewItem:Te,bulkAddItems:Fe,importFromTxt:Be,importFromAPI:Le,createCollection:Ne,exportMediaCollection:Ve,exportAsCSV:we,exportAsJSON:Ge,downloadFile:ze,deleteAllInCategory:We,getCategoryDisplayName:ve,processTxtContent:Se,closeTxtImportResults:Je,messageStore:t,confirmStore:a,inputStore:e,statistics:m,formatDate:h,getRatingStars:F,sidebarStore:y}}},un={class:"vue-app"},mn={class:"main-content"},gn={class:"content-area"},fn={key:1,class:"error"},vn={key:2},yn={key:0,class:"statistics-container"},pn={class:"statistics-header"},hn={class:"refresh-controls"},bn={class:"statistics-content"},wn={class:"stats-summary"},Sn={class:"summary-card"},In={class:"summary-number"},_n={class:"summary-card"},kn={class:"summary-number"},Cn={class:"summary-card"},Tn={class:"summary-number"},An={class:"summary-card"},xn={class:"summary-number"},Mn={class:"chart-container"},Rn={class:"category-stats"},Dn={class:"category-name"},Un={class:"category-bar"},Pn={class:"category-count"},En={class:"chart-container"},Fn={class:"rating-stats"},Bn={class:"rating-stars"},Ln={class:"rating-bar"},Nn={class:"rating-count"},Vn={class:"chart-container"},Gn={class:"platform-stats"},zn={class:"platform-name"},Wn={class:"platform-bar"},jn={class:"platform-count"},On={class:"chart-container"},qn={class:"genre-stats"},Hn={class:"genre-name"},Qn={class:"genre-bar"},Jn={class:"genre-count"},Kn={class:"chart-container"},Xn={class:"recent-activity"},Yn={class:"activity-title"},Zn={class:"activity-category"},$n={class:"activity-date"},ei={class:"chart-container"},ti={class:"airing-series"},si={class:"airing-title"},oi={class:"airing-next"},ai={class:"airing-date"},ni={key:0,class:"admin-setup-container"},ii=["disabled"],ri={key:0},li={key:1};function di(n,t,a,e,c,y){const o=J("Sidebar"),b=J("MainHeader"),i=J("LoadingSpinner"),S=J("MediaItem"),M=J("LoginModal"),T=J("RegisterModal"),N=J("EditModal"),P=J("BulkAddModal"),Q=J("TxtImportModal"),K=J("TxtImportResultsModal"),V=J("FloatingActionButton"),Z=J("MessageBox"),ae=J("ConfirmDialog"),$=J("InputDialog");return l(),d("div",un,[s("div",{class:oe(["mobile-overlay",{show:e.sidebarStore.mobileOpen}]),onClick:t[0]||(t[0]=(...g)=>e.sidebarStore.closeMobileSidebar&&e.sidebarStore.closeMobileSidebar(...g))},null,2),ne(o,{collapsed:e.sidebarStore.collapsed,"mobile-open":e.sidebarStore.mobileOpen,"is-logged-in":e.isLoggedIn,"is-admin":e.isAdmin,"user-name":e.userName,"current-category":e.currentCategory,"category-counts":e.categoryCounts,platforms:e.platforms,genres:e.genres,categories:e.categories,onToggle:e.sidebarStore.toggleSidebar,onSetCategory:e.setCategory,onNavigateToCalendar:e.navigateToCalendar,onNavigateToProfile:e.navigateToProfile,onNavigateToAdmin:e.debugNavigateToAdmin,onTogglePlatformFilter:e.togglePlatformFilter,onToggleGenreFilter:e.toggleGenreFilter,onToggleAiringFilter:e.toggleAiringFilter,onAddItem:e.addItemFromSidebar,onShowLogin:t[1]||(t[1]=g=>e.showLoginModal=!0),onShowRegister:t[2]||(t[2]=g=>e.showRegisterModal=!0),onShowAdminLogin:e.showAdminLogin,onLogout:e.logout},null,8,["collapsed","mobile-open","is-logged-in","is-admin","user-name","current-category","category-counts","platforms","genres","categories","onToggle","onSetCategory","onNavigateToCalendar","onNavigateToProfile","onNavigateToAdmin","onTogglePlatformFilter","onToggleGenreFilter","onToggleAiringFilter","onAddItem","onShowAdminLogin","onLogout"]),s("div",mn,[ne(b,{"search-query":e.searchQuery,"onUpdate:searchQuery":t[3]||(t[3]=g=>e.searchQuery=g),"grid-columns":e.gridColumns,"onUpdate:gridColumns":t[4]||(t[4]=g=>e.gridColumns=g),"sort-by":e.sortBy,"onUpdate:sortBy":t[5]||(t[5]=g=>e.sortBy=g),onToggleMobileSidebar:e.sidebarStore.toggleMobileSidebar,onClearSearch:e.clearSearch},null,8,["search-query","grid-columns","sort-by","onToggleMobileSidebar","onClearSearch"]),s("main",gn,[e.loading?(l(),_e(i,{key:0,message:"Loading media data..."})):e.error?(l(),d("div",fn,[s("p",null,u(e.error),1),s("button",{onClick:t[6]||(t[6]=(...g)=>e.loadMedia&&e.loadMedia(...g))},"Retry")])):(l(),d("div",vn,[e.currentCategory==="statistics"?(l(),d("div",yn,[s("div",pn,[t[12]||(t[12]=s("h1",null,"📊 Media Library Statistics",-1)),t[13]||(t[13]=s("p",null,"Übersicht über deine Media Collection",-1)),s("div",hn,[s("button",{class:"refresh-btn",onClick:t[7]||(t[7]=(...g)=>e.loadMedia&&e.loadMedia(...g))},"🔄 Refresh Statistics")])]),s("div",bn,[s("div",wn,[s("div",Sn,[s("div",In,u(e.statistics.totalItems),1),t[14]||(t[14]=s("div",{class:"summary-label"},"Total Items",-1))]),s("div",_n,[s("div",kn,u(e.statistics.totalCollections),1),t[15]||(t[15]=s("div",{class:"summary-label"},"Collections",-1))]),s("div",Cn,[s("div",Tn,u(e.statistics.totalPlaytime)+"h",1),t[16]||(t[16]=s("div",{class:"summary-label"},"Total Playtime",-1))]),s("div",An,[s("div",xn,u(e.statistics.avgRating),1),t[17]||(t[17]=s("div",{class:"summary-label"},"Avg Rating",-1))])]),s("div",Mn,[t[18]||(t[18]=s("h3",{class:"chart-title"},"📈 Category Distribution",-1)),s("div",Rn,[(l(!0),d(X,null,Y(e.statistics.categoryDistribution,(g,E)=>(l(),d("div",{key:E,class:"category-stat"},[s("div",Dn,u(E),1),s("div",Un,[s("div",{class:"category-fill",style:ue({width:`${g/e.statistics.totalItems*100}%`})},null,4)]),s("div",Pn,u(g)+" ("+u((g/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",En,[t[19]||(t[19]=s("h3",{class:"chart-title"},"⭐ Rating Distribution",-1)),s("div",Fn,[(l(!0),d(X,null,Y(e.statistics.ratingDistribution,(g,E)=>(l(),d("div",{key:E,class:"rating-stat"},[s("div",Bn,u(e.getRatingStars(E)),1),s("div",Ln,[s("div",{class:"rating-fill",style:ue({width:`${g/e.statistics.totalItems*100}%`})},null,4)]),s("div",Nn,u(g)+" ("+u((g/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",Vn,[t[20]||(t[20]=s("h3",{class:"chart-title"},"🎮 Platform Distribution",-1)),s("div",Gn,[(l(!0),d(X,null,Y(e.statistics.platformDistribution,(g,E)=>(l(),d("div",{key:E,class:"platform-stat"},[s("div",zn,u(E),1),s("div",Wn,[s("div",{class:"platform-fill",style:ue({width:`${g/e.statistics.totalItems*100}%`})},null,4)]),s("div",jn,u(g)+" ("+u((g/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",On,[t[21]||(t[21]=s("h3",{class:"chart-title"},"🎭 Top Genres",-1)),s("div",qn,[(l(!0),d(X,null,Y(e.statistics.genreDistribution,(g,E)=>(l(),d("div",{key:E,class:"genre-stat"},[s("div",Hn,u(E),1),s("div",Qn,[s("div",{class:"genre-fill",style:ue({width:`${g/e.statistics.totalItems*100}%`})},null,4)]),s("div",Jn,u(g)+" ("+u((g/e.statistics.totalItems*100).toFixed(1))+"%)",1)]))),128))])]),s("div",Kn,[t[22]||(t[22]=s("h3",{class:"chart-title"},"📅 Recent Activity",-1)),s("div",Xn,[(l(!0),d(X,null,Y(e.statistics.recentActivity,g=>(l(),d("div",{key:g.title,class:"activity-item"},[s("div",Yn,u(g.title),1),s("div",Zn,u(g.category),1),s("div",$n,u(e.formatDate(g.discovered)),1)]))),128))])]),s("div",ei,[t[23]||(t[23]=s("h3",{class:"chart-title"},"📺 Currently Airing Series",-1)),s("div",ti,[(l(!0),d(X,null,Y(e.statistics.airingSeries,g=>(l(),d("div",{key:g.title,class:"airing-item"},[s("div",si,u(g.title),1),s("div",oi,"Next: Season "+u(g.nextSeason),1),s("div",ai,u(g.nextSeasonRelease?e.formatDate(g.nextSeasonRelease):"TBA"),1)]))),128))])])])])):(l(),d("div",{key:1,class:"grid",style:ue({gridTemplateColumns:`repeat(${e.gridColumns}, 1fr)`})},[(l(!0),d(X,null,Y(e.paginatedMedia,g=>(l(),_e(S,{key:g.id,item:g,onEdit:e.editItem},null,8,["item","onEdit"]))),128))],4))]))])]),e.isLoggedIn?f("",!0):(l(),d("div",ni,[s("button",{onClick:t[8]||(t[8]=(...g)=>e.handleAdminSetup&&e.handleAdminSetup(...g)),disabled:e.adminSetupLoading,class:"admin-setup-btn",title:"Setup Admin Account (Creates admin account with default password)"},[e.adminSetupLoading?(l(),d("span",ri,"🔧 Setting up...")):(l(),d("span",li,"🔧 Admin Setup"))],8,ii),e.adminSetupMessage?(l(),d("div",{key:0,class:oe(["admin-setup-message",e.adminSetupMessage.type])},u(e.adminSetupMessage.text),3)):f("",!0)])),e.showLoginModal?(l(),_e(M,{key:1,onClose:t[9]||(t[9]=g=>e.showLoginModal=!1),onSuccess:e.handleLoginSuccess,onSwitchToRegister:e.switchToRegister},null,8,["onSuccess","onSwitchToRegister"])):f("",!0),e.showRegisterModal?(l(),_e(T,{key:2,onClose:t[10]||(t[10]=g=>e.showRegisterModal=!1),onSuccess:e.handleRegisterSuccess},null,8,["onSuccess"])):f("",!0),e.showEditModal?(l(),_e(N,{key:3,item:e.editingItem,"current-category":e.currentCategory,onClose:e.closeEditModal,onSave:e.handleSaveItem,onDelete:e.handleDeleteItem},null,8,["item","current-category","onClose","onSave","onDelete"])):f("",!0),ne(P,{show:e.showBulkAddModal,"current-category":e.currentCategory,onClose:e.closeBulkAddModal},null,8,["show","current-category","onClose"]),ne(Q,{show:e.showTxtImportModal,onClose:t[11]||(t[11]=g=>e.showTxtImportModal=!1),onFileProcessed:e.processTxtContent},null,8,["show","onFileProcessed"]),ne(K,{show:e.showTxtImportResults,results:e.txtImportResults,onClose:e.closeTxtImportResults},null,8,["show","results","onClose"]),ne(V,{"show-menu":e.showFloatingMenu,"show-delete-all":e.isLoggedIn&&e.currentCategory!=="all"&&e.categoryCounts[e.currentCategory]>0,"category-name":e.currentCategoryDisplayName,"item-count":e.categoryCounts[e.currentCategory]||0,onToggleMenu:e.toggleFloatingMenu,onAddNewItem:e.addNewItem,onBulkAddItems:e.bulkAddItems,onImportFromTxt:e.importFromTxt,onImportFromApi:e.importFromAPI,onCreateCollection:e.createCollection,onDeleteAllInCategory:e.deleteAllInCategory},null,8,["show-menu","show-delete-all","category-name","item-count","onToggleMenu","onAddNewItem","onBulkAddItems","onImportFromTxt","onImportFromApi","onCreateCollection","onDeleteAllInCategory"]),ne(Z,{show:e.messageStore.show,type:e.messageStore.type,title:e.messageStore.title,message:e.messageStore.message,details:e.messageStore.details,onClose:e.messageStore.closeMessage},null,8,["show","type","title","message","details","onClose"]),ne(ae,{show:e.confirmStore.show,title:e.confirmStore.title,message:e.confirmStore.message,onConfirm:e.confirmStore.confirm,onClose:e.confirmStore.cancel},null,8,["show","title","message","onConfirm","onClose"]),ne($,{show:e.inputStore.show,title:e.inputStore.title,message:e.inputStore.message,placeholder:e.inputStore.placeholder,"input-type":e.inputStore.inputType,"default-value":e.inputStore.defaultValue,onConfirm:e.inputStore.confirm,onClose:e.inputStore.cancel},null,8,["show","title","message","placeholder","input-type","default-value","onConfirm","onClose"])])}const gi=te(cn,[["render",di],["__scopeId","data-v-bac26f2f"]]);export{gi as default};
