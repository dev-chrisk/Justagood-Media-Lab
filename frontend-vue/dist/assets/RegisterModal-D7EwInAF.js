import{_ as h,a as k,i as v,r as g,b as u,e as s,j as b,f as D,k as d,m as i,t as f,o as p,c as y}from"./index-b8bv1XZ_.js";const B={name:"LoginModal",emits:["close","success"],setup(w,{emit:e}){const c=k(),o=v({email:"",password:""}),t=g(!1),n=g("");return{form:o,loading:t,error:n,handleLogin:async()=>{var a;console.log("🔐 LOGIN DEBUG: Starting login process"),console.log("🔐 LOGIN DEBUG: Environment check:",{isDev:!1,mode:"production",viteApiUrl:"https://teabubble.attrebi.ch",currentUrl:window.location.href,userAgent:navigator.userAgent}),t.value=!0,n.value="",console.log("🔐 LOGIN DEBUG: Form data:",{email:o.email,passwordLength:o.password.length,timestamp:new Date().toISOString()});try{console.log("🔐 LOGIN DEBUG: Calling authStore.login...");const r=await c.login(o.email,o.password);console.log("🔐 LOGIN DEBUG: Login result:",{success:r.success,hasUser:!!r.user,hasToken:!!r.token,error:r.error}),r.success?(console.log("🔐 LOGIN DEBUG: Login successful, emitting success event"),e("success",r)):(console.log("🔐 LOGIN DEBUG: Login failed, setting error:",r.error),n.value=r.error)}catch(r){console.log("🔐 LOGIN DEBUG: Login exception caught:",{message:r.message,name:r.name,code:r.code,stack:r.stack,response:(a=r.response)==null?void 0:a.data}),n.value=r.message||"Login failed"}finally{console.log("🔐 LOGIN DEBUG: Login process completed, setting loading to false"),t.value=!1}},closeModal:()=>{e("close")},checkLocalDB:async()=>{try{console.log("🔍 Checking local database...");const r=await(await fetch("http://127.0.0.1:8000/api/check-db")).json();console.log("🔍 Local DB Check Result:",r),alert(`Local DB: ${r.success?"✅ Connected":"❌ Error"}
Users: ${r.user_count}
Error: ${r.error||"None"}`)}catch(a){console.error("🔍 Local DB Check Failed:",a),alert(`Local DB Check Failed: ${a.message}`)}},checkProdDB:async()=>{try{console.log("🔍 Checking production database...");const r=await(await fetch("https://teabubble.attrebi.ch/api/check-db")).json();console.log("🔍 Prod DB Check Result:",r),alert(`Prod DB: ${r.success?"✅ Connected":"❌ Error"}
Users: ${r.user_count}
Error: ${r.error||"None"}`)}catch(a){console.error("🔍 Prod DB Check Failed:",a),alert(`Prod DB Check Failed: ${a.message}`)}},deleteAllUsers:async()=>{if(confirm("⚠️ WARNING: This will delete ALL users! Are you sure?"))try{console.log("🗑️ Deleting all users...");const r=await(await fetch("https://teabubble.attrebi.ch/api/delete-all-users",{method:"POST",headers:{"Content-Type":"application/json"}})).json();console.log("🗑️ Delete Result:",r),alert(`Delete Result: ${r.success?"✅ Success":"❌ Error"}
Deleted: ${r.deleted_count} users
Error: ${r.error||"None"}`)}catch(a){console.error("🗑️ Delete Failed:",a),alert(`Delete Failed: ${a.message}`)}}}}},U={class:"form-group"},_=["disabled"],E={class:"form-group"},G=["disabled"],M={key:0,class:"error-message"},N={class:"modal-buttons"},R=["disabled"],P=["disabled"],I={class:"debug-buttons"},A=["disabled"],S=["disabled"],O=["disabled"];function V(w,e,c,o,t,n){return p(),u("div",{class:"modal",onClick:e[8]||(e[8]=(...l)=>o.closeModal&&o.closeModal(...l))},[s("div",{class:"modal-content auth-modal",onClick:e[7]||(e[7]=b(()=>{},["stop"]))},[e[11]||(e[11]=s("h2",null,"Login",-1)),s("form",{onSubmit:e[6]||(e[6]=b((...l)=>o.handleLogin&&o.handleLogin(...l),["prevent"]))},[s("div",U,[e[9]||(e[9]=s("label",{for:"email"},"Email:",-1)),d(s("input",{type:"email",id:"email","onUpdate:modelValue":e[0]||(e[0]=l=>o.form.email=l),required:"",disabled:o.loading},null,8,_),[[i,o.form.email]])]),s("div",E,[e[10]||(e[10]=s("label",{for:"password"},"Password:",-1)),d(s("input",{type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=l=>o.form.password=l),required:"",disabled:o.loading},null,8,G),[[i,o.form.password]])]),o.error?(p(),u("div",M,f(o.error),1)):D("",!0),s("div",N,[s("button",{type:"submit",disabled:o.loading},f(o.loading?"Logging in...":"Login"),9,R),s("button",{type:"button",onClick:e[2]||(e[2]=(...l)=>o.closeModal&&o.closeModal(...l)),disabled:o.loading}," Cancel ",8,P)]),s("div",I,[s("button",{type:"button",onClick:e[3]||(e[3]=(...l)=>o.checkLocalDB&&o.checkLocalDB(...l)),disabled:o.loading,class:"debug-btn"}," Check Local DB ",8,A),s("button",{type:"button",onClick:e[4]||(e[4]=(...l)=>o.checkProdDB&&o.checkProdDB(...l)),disabled:o.loading,class:"debug-btn"}," Check Prod DB ",8,S),s("button",{type:"button",onClick:e[5]||(e[5]=(...l)=>o.deleteAllUsers&&o.deleteAllUsers(...l)),disabled:o.loading,class:"debug-btn danger"}," Delete All Users ",8,O)])],32)])])}const eo=h(B,[["render",V],["__scopeId","data-v-c33bc6e7"]]),F={name:"RegisterModal",emits:["close","success"],setup(w,{emit:e}){const c=k(),o=v({name:"",email:"",password:"",passwordConfirm:""}),t=g(!1),n=g(""),l=y(()=>o.name&&o.email&&o.password&&o.passwordConfirm&&o.password===o.passwordConfirm&&o.password.length>=8);return{form:o,loading:t,error:n,isFormValid:l,handleRegister:async()=>{if(!l.value){n.value="Please fill in all fields and ensure passwords match";return}t.value=!0,n.value="";try{const m=await c.register(o.name,o.email,o.password,o.passwordConfirm);m.success?e("success"):n.value=m.error}catch(m){n.value=m.message||"Registration failed"}finally{t.value=!1}},closeModal:()=>{e("close")}}}},x={class:"form-group"},q=["disabled"],j={class:"form-group"},T=["disabled"],W={class:"form-group"},z=["disabled"],H={class:"form-group"},J=["disabled"],K={key:0,class:"error-message"},Q={class:"modal-buttons"},X=["disabled"],Y=["disabled"];function Z(w,e,c,o,t,n){return p(),u("div",{class:"modal",onClick:e[7]||(e[7]=(...l)=>o.closeModal&&o.closeModal(...l))},[s("div",{class:"modal-content auth-modal",onClick:e[6]||(e[6]=b(()=>{},["stop"]))},[e[12]||(e[12]=s("h2",null,"Register",-1)),s("form",{onSubmit:e[5]||(e[5]=b((...l)=>o.handleRegister&&o.handleRegister(...l),["prevent"]))},[s("div",x,[e[8]||(e[8]=s("label",{for:"name"},"Name:",-1)),d(s("input",{type:"text",id:"name","onUpdate:modelValue":e[0]||(e[0]=l=>o.form.name=l),required:"",disabled:o.loading},null,8,q),[[i,o.form.name]])]),s("div",j,[e[9]||(e[9]=s("label",{for:"email"},"Email:",-1)),d(s("input",{type:"email",id:"email","onUpdate:modelValue":e[1]||(e[1]=l=>o.form.email=l),required:"",disabled:o.loading},null,8,T),[[i,o.form.email]])]),s("div",W,[e[10]||(e[10]=s("label",{for:"password"},"Password:",-1)),d(s("input",{type:"password",id:"password","onUpdate:modelValue":e[2]||(e[2]=l=>o.form.password=l),required:"",minlength:"8",disabled:o.loading},null,8,z),[[i,o.form.password]])]),s("div",H,[e[11]||(e[11]=s("label",{for:"passwordConfirm"},"Confirm Password:",-1)),d(s("input",{type:"password",id:"passwordConfirm","onUpdate:modelValue":e[3]||(e[3]=l=>o.form.passwordConfirm=l),required:"",minlength:"8",disabled:o.loading},null,8,J),[[i,o.form.passwordConfirm]])]),o.error?(p(),u("div",K,f(o.error),1)):D("",!0),s("div",Q,[s("button",{type:"submit",disabled:o.loading||!o.isFormValid},f(o.loading?"Registering...":"Register"),9,X),s("button",{type:"button",onClick:e[4]||(e[4]=(...l)=>o.closeModal&&o.closeModal(...l)),disabled:o.loading}," Cancel ",8,Y)])],32)])])}const so=h(F,[["render",Z],["__scopeId","data-v-d5de55ea"]]);export{eo as L,so as R};
