import{d as X,r as b,c as S,q as y,_ as T,b as v,e as s,t as I,o as m,z as C,f as Y,F as _,p as A,E as F,B as U,g as Z,n as $}from"./index-QPSUo5TR.js";class ee{constructor(){this.isConnected={value:!1},this.listeners=new Map,this.pollingInterval=null,this.lastUpdate=null,this.pollingIntervalMs=2e4}getApiBaseUrl(){return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"http://127.0.0.1:8000":"https://teabubble.attrebi.ch"}connect(){if(this.pollingInterval)return;const a=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");!a||!c||(this.isConnected.value=!0,this.lastUpdate=new Date,this.pollingInterval=setInterval(()=>{this.checkForUpdates()},this.pollingIntervalMs))}async checkForUpdates(){try{const a=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");if(!a||!c)return;const d=this.getApiBaseUrl(),g=await fetch(`${d}/api/media`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!g.ok){if(g.status===401){this.disconnect();return}throw new Error(`HTTP error! status: ${g.status}`)}const u=await g.json();u&&u.length>0&&this.listeners.forEach((p,f)=>{try{p({type:"media_updated",items:u,count:u.length,timestamp:new Date().toISOString()})}catch{}}),this.lastUpdate=new Date}catch{}}addListener(a,c){this.listeners.set(a,c)}removeListener(a){this.listeners.delete(a)}disconnect(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null),this.isConnected.value=!1}destroy(){this.disconnect(),this.listeners.clear()}}const L=new ee,De=X("media",()=>{const r=b(p()),a=b("game"),c=b(""),d=b([]),g=b(!1),u=b(null);function p(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");if(!e||!t){const n=localStorage.getItem("mediaData");return n?JSON.parse(n):[]}return[]}catch(e){return console.error("Failed to load media from storage:",e),[]}}function f(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");(!e||!t)&&localStorage.setItem("mediaData",JSON.stringify(r.value))}catch(e){console.error("Failed to save media to storage:",e)}}const i=S(()=>r.value.length),k=S(()=>{const e={};return r.value.forEach(t=>{const n=t.category||"unknown";e[n]=(e[n]||0)+1}),e}),E=S(()=>{let e=[...r.value];if(a.value&&a.value!=="all"&&(e=e.filter(t=>a.value==="watchlist"?t.category==="watchlist"||t.isNew===!0:t.category===a.value)),c.value){const t=c.value.toLowerCase();e=e.filter(n=>{var o,l,h,x;return((o=n.title)==null?void 0:o.toLowerCase().includes(t))||((l=n.description)==null?void 0:l.toLowerCase().includes(t))||((h=n.genre)==null?void 0:h.toLowerCase().includes(t))||((x=n.platforms)==null?void 0:x.toLowerCase().includes(t))})}return d.value.forEach(t=>{t.type==="platform"?e=e.filter(n=>{var o;return(o=n.platforms)==null?void 0:o.toLowerCase().includes(t.value.toLowerCase())}):t.type==="genre"?e=e.filter(n=>{var o;return(o=n.genre)==null?void 0:o.toLowerCase().includes(t.value.toLowerCase())}):t.type==="airing"&&(t.value==="airing"?e=e.filter(n=>n.isAiring===!0):t.value==="finished"&&(e=e.filter(n=>n.isAiring===!1||n.isAiring===null)))}),e}),B=S(()=>{const e=new Set;return r.value.forEach(t=>{t.platforms&&t.platforms.split(/[,;|&]/).map(o=>o.trim()).filter(o=>o.length>0).forEach(o=>e.add(o))}),Array.from(e).sort()}),P=S(()=>{const e=new Set;return r.value.forEach(t=>{t.genre&&t.genre.split(/[,;|&]/).map(o=>o.trim()).filter(o=>o.length>0).forEach(o=>e.add(o))}),Array.from(e).sort()});async function w(){var e,t;g.value=!0,u.value=null;try{const n=localStorage.getItem("authToken"),o=localStorage.getItem("currentUser");if(n&&o)try{const l=await y.getMedia();r.value=l||[]}catch(l){console.warn("API load failed for logged in user:",l),r.value=[]}else{const l=p();if(l.length>0)r.value=l;else{const h=await y.getMedia();r.value=h||[],f()}}}catch(n){u.value=((t=(e=n.response)==null?void 0:e.data)==null?void 0:t.message)||n.message||"Failed to load media data",console.error("Failed to load media:",n)}finally{g.value=!1}}function D(e){a.value=e}function N(e){c.value=e}function V(e){d.value.some(n=>n.type===e.type&&n.value===e.value)||d.value.push(e)}function R(e){d.value=d.value.filter(t=>!(t.type===e.type&&t.value===e.value))}function z(){d.value=[]}async function O(e){try{const t=localStorage.getItem("authToken"),n=localStorage.getItem("currentUser");if(t&&n)try{const o=await y.addMediaItem(e);return await w(),o}catch(o){throw console.error("API save failed for logged in user:",o),o}else{const o={id:Date.now(),...e,__order:r.value.length};return r.value.push(o),f(),o}}catch(t){throw u.value=t.message||"Failed to add media item",t}}async function G(e,t){try{const n=localStorage.getItem("authToken"),o=localStorage.getItem("currentUser");if(n&&o)try{const l=await y.updateMediaItem(e,t);return await w(),l}catch(l){throw console.error("API update failed for logged in user:",l),l}else{const l=r.value.findIndex(h=>h.id===e);if(l!==-1)return r.value[l]={...r.value[l],...t},f(),r.value[l];throw new Error("Media item not found")}}catch(n){throw u.value=n.message||"Failed to update media item",n}}async function j(e){try{const t=localStorage.getItem("authToken"),n=localStorage.getItem("currentUser");if(t&&n)try{return await y.deleteMediaItem(e),await w(),!0}catch(o){throw console.error("API delete failed for logged in user:",o),o}else{const o=r.value.findIndex(l=>l.id===e);if(o!==-1)return r.value.splice(o,1),f(),!0;throw new Error("Media item not found")}}catch(t){throw u.value=t.message||"Failed to delete media item",t}}async function q(e){try{const t=localStorage.getItem("authToken"),n=localStorage.getItem("currentUser");if(t&&n)try{const o=await y.batchAddMediaItems(e);return await w(),o}catch(o){throw console.error("API batch add failed for logged in user:",o),o}else{const o=e.map((l,h)=>({id:Date.now()+h,...l,__order:r.value.length+h}));return r.value.push(...o),f(),{success:!0,stats:{created:o.length,failed:0,errors:[]}}}}catch(t){throw u.value=t.message||"Failed to add media items",t}}async function J(e){try{const t=localStorage.getItem("authToken"),n=localStorage.getItem("currentUser");if(t&&n)try{return await y.batchDeleteMediaItems(e),await w(),!0}catch(o){throw console.error("API batch delete failed for logged in user:",o),o}else return r.value=r.value.filter(o=>!e.includes(o.id)),f(),!0}catch(t){throw u.value=t.message||"Failed to delete media items",t}}async function Q(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");e&&t?await y.saveMedia(r.value):f()}catch(e){console.error("Failed to save media:",e)}}function M(){u.value=null}function H(e){if(console.log("Processing real-time update:",e),e.type==="media_updated"&&e.items)e.items.forEach(t=>{const n=r.value.findIndex(o=>o.id===t.id);n!==-1?r.value[n]={...r.value[n],...t}:r.value.push(t)});else if(e.action==="created"||e.action==="updated"){const t=e.item,n=r.value.findIndex(o=>o.id===t.id);n!==-1?r.value[n]={...r.value[n],...t}:r.value.push(t)}else if(e.action==="deleted"){const t=r.value.findIndex(n=>n.id===e.id);t!==-1&&r.value.splice(t,1)}f()}function W(){const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");if(!e||!t){console.log("Skipping realtime initialization - user not authenticated");return}try{L.addListener("media-store",H),L.connect()}catch(n){console.error("Failed to initialize realtime updates:",n)}}function K(){L.removeListener("media-store")}return{mediaData:r,currentCategory:a,searchQuery:c,activeFilters:d,loading:g,error:u,totalItems:i,categoryCounts:k,filteredMedia:E,platforms:B,genres:P,loadMedia:w,setCategory:D,setSearchQuery:N,addFilter:V,removeFilter:R,clearFilters:z,addMediaItem:O,updateMediaItem:G,deleteMediaItem:j,batchAddMediaItems:q,batchDeleteMediaItems:J,saveMedia:Q,clearError:M,initializeRealtimeUpdates:W,cleanupRealtimeUpdates:K}}),te={name:"VersionInfo",data(){return{version:"1.0.0"}}},ae={class:"version-info"},se={class:"version-label"};function ne(r,a,c,d,g,u){return m(),v("div",ae,[s("span",se,"Build #"+I(g.version),1)])}const oe=T(te,[["render",ne],["__scopeId","data-v-2d54e3c7"]]),re={name:"Sidebar",components:{VersionInfo:oe},props:{collapsed:{type:Boolean,default:!1},mobileOpen:{type:Boolean,default:!1},isLoggedIn:{type:Boolean,default:!1},userName:{type:String,default:""},currentCategory:{type:String,default:"watchlist"},categoryCounts:{type:Object,default:()=>({})},platforms:{type:Array,default:()=>[]},genres:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[{key:"game",name:"Games",icon:"🎮"},{key:"series",name:"Series",icon:"📺"},{key:"movie",name:"Movies",icon:"🎬"},{key:"buecher",name:"Bücher",icon:"📚"},{key:"watchlist",name:"Watchlist",icon:"❤️"}]}},emits:["toggle","setCategory","addItem","navigateToStatistics","navigateToCalendar","navigateToFeatures","navigateToProfile","togglePlatformFilter","toggleGenreFilter","toggleAiringFilter","showLogin","showRegister","logout"],methods:{}},ie={class:"sidebar-content"},le={class:"sidebar-section"},ce={class:"sidebar-nav"},ue=["onClick"],de={class:"nav-icon"},ge={class:"nav-text"},fe={class:"nav-count"},ve=["onClick","title"],me={key:0,class:"sidebar-section"},pe={class:"filter-section"},he={class:"filter-group"},ye={class:"filter-checkboxes"},ke=["value","onChange"],Ie={class:"option-text"},we={class:"filter-group"},be={class:"filter-checkboxes"},Se=["value","onChange"],Ce={class:"option-text"},Fe={class:"filter-group"},_e={class:"filter-checkboxes"},Ae={class:"filter-option"},Le={class:"filter-option"},Me={class:"sidebar-section"},xe={key:0,class:"auth-buttons"},Ue={key:1,class:"user-info"},$e={class:"user-profile"},Te={class:"profile-details"},Ee={class:"user-name"};function Be(r,a,c,d,g,u){const p=U("router-link"),f=U("VersionInfo");return m(),v("aside",{id:"sidebar",class:$(["sidebar",{collapsed:c.collapsed,open:c.mobileOpen}])},[s("div",{class:"sidebar-header",onClick:a[0]||(a[0]=i=>r.$emit("toggle"))},[...a[7]||(a[7]=[s("h2",null,"Media Library",-1),s("button",{class:"sidebar-toggle"},"☰",-1)])]),s("div",ie,[s("div",le,[a[13]||(a[13]=s("h3",null,"Browse",-1)),s("nav",ce,[(m(!0),v(_,null,A(c.categories,i=>(m(),v("div",{key:i.key,class:"nav-item"},[s("button",{class:$(["nav-btn",{active:c.currentCategory===i.key}]),onClick:k=>r.$emit("setCategory",i.key)},[s("span",de,I(i.icon),1),s("span",ge,I(i.name),1),s("span",fe,I(c.categoryCounts[i.key]||0),1)],10,ue),s("button",{class:"add-btn",onClick:k=>r.$emit("addItem",i.key),title:`Add ${i.name}`},[...a[8]||(a[8]=[s("span",{class:"add-icon"},"+",-1)])],8,ve)]))),128)),C(p,{to:"/statistics",class:"nav-btn"},{default:F(()=>[...a[9]||(a[9]=[s("span",{class:"nav-icon"},"📊",-1),s("span",{class:"nav-text"},"Statistics",-1)])]),_:1}),C(p,{to:"/calendar",class:"nav-btn"},{default:F(()=>[...a[10]||(a[10]=[s("span",{class:"nav-icon"},"📅",-1),s("span",{class:"nav-text"},"Calendar",-1)])]),_:1}),C(p,{to:"/features",class:"nav-btn"},{default:F(()=>[...a[11]||(a[11]=[s("span",{class:"nav-icon"},"⚡",-1),s("span",{class:"nav-text"},"Features",-1)])]),_:1}),C(p,{to:"/profile",class:"nav-btn"},{default:F(()=>[...a[12]||(a[12]=[s("span",{class:"nav-icon"},"👤",-1),s("span",{class:"nav-text"},"Profile",-1)])]),_:1})])]),c.isLoggedIn?(m(),v("div",me,[a[23]||(a[23]=s("h3",null,"Filters",-1)),s("div",pe,[s("div",he,[a[15]||(a[15]=s("h4",null,"Platforms",-1)),s("div",ye,[(m(!0),v(_,null,A(c.platforms,i=>(m(),v("label",{key:i,class:"filter-option"},[s("input",{type:"checkbox",value:i,onChange:k=>r.$emit("togglePlatformFilter",i,k.target.checked)},null,40,ke),a[14]||(a[14]=s("span",{class:"checkmark"},null,-1)),s("span",Ie,I(i),1)]))),128))])]),s("div",we,[a[17]||(a[17]=s("h4",null,"Genres",-1)),s("div",be,[(m(!0),v(_,null,A(c.genres,i=>(m(),v("label",{key:i,class:"filter-option"},[s("input",{type:"checkbox",value:i,onChange:k=>r.$emit("toggleGenreFilter",i,k.target.checked)},null,40,Se),a[16]||(a[16]=s("span",{class:"checkmark"},null,-1)),s("span",Ce,I(i),1)]))),128))])]),s("div",Fe,[a[22]||(a[22]=s("h4",null,"Series Status",-1)),s("div",_e,[s("label",Ae,[s("input",{type:"checkbox",value:"airing",onChange:a[1]||(a[1]=i=>r.$emit("toggleAiringFilter","airing",i.target.checked))},null,32),a[18]||(a[18]=s("span",{class:"checkmark"},null,-1)),a[19]||(a[19]=s("span",{class:"option-text"},[s("span",{class:"airing-indicator"},"●"),Z(" Airing ")],-1))]),s("label",Le,[s("input",{type:"checkbox",value:"finished",onChange:a[2]||(a[2]=i=>r.$emit("toggleAiringFilter","finished",i.target.checked))},null,32),a[20]||(a[20]=s("span",{class:"checkmark"},null,-1)),a[21]||(a[21]=s("span",{class:"option-text"},"Finished",-1))])])])])])):Y("",!0),s("div",Me,[a[25]||(a[25]=s("h3",null,"Account",-1)),c.isLoggedIn?(m(),v("div",Ue,[s("div",$e,[a[24]||(a[24]=s("div",{class:"profile-avatar"},[s("span",{class:"avatar-text"},"👤")],-1)),s("div",Te,[s("span",Ee,I(c.userName),1)]),s("button",{class:"account-btn",onClick:a[5]||(a[5]=i=>r.$emit("navigateToProfile"))},"⚙️")]),s("button",{class:"auth-btn",onClick:a[6]||(a[6]=i=>r.$emit("logout"))},"Logout")])):(m(),v("div",xe,[s("button",{class:"auth-btn",onClick:a[3]||(a[3]=i=>r.$emit("showLogin"))},"Login"),s("button",{class:"auth-btn",onClick:a[4]||(a[4]=i=>r.$emit("showRegister"))},"Register")]))])]),C(f)],2)}const Ne=T(re,[["render",Be],["__scopeId","data-v-0edb0d6d"]]);export{Ne as S,De as u};
