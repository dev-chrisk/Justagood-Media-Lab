import{E as ee,d as B,r as w,c as C,q as I,_ as P,b as h,e as o,t as S,o as y,z as M,f as te,F as A,p as L,n as E,G as $,B as T,g as se}from"./index-CU0X_eU4.js";class ae{constructor(){this.isConnected={value:!1},this.listeners=new Map,this.pollingInterval=null,this.lastUpdate=null,this.pollingIntervalMs=2e4}getApiBaseUrl(){return ee.BASE_URL}connect(){if(this.pollingInterval)return;const e=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");!e||!c||(this.isConnected.value=!0,this.lastUpdate=new Date,this.pollingInterval=setInterval(()=>{this.checkForUpdates()},this.pollingIntervalMs))}async checkForUpdates(){try{const e=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");if(!e||!c)return;const g=this.getApiBaseUrl(),v=await fetch(`${g}/api/media`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!v.ok){if(v.status===401){this.disconnect();return}throw new Error(`HTTP error! status: ${v.status}`)}const u=await v.json();u&&u.length>0&&this.listeners.forEach((k,f)=>{try{k({type:"media_updated",items:u,count:u.length,timestamp:new Date().toISOString()})}catch{}}),this.lastUpdate=new Date}catch{}}addListener(e,c){this.listeners.set(e,c)}removeListener(e){this.listeners.delete(e)}disconnect(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null),this.isConnected.value=!1}destroy(){this.disconnect(),this.listeners.clear()}}const x=new ae,Re=B("media",()=>{const n=w(k()),e=w("game"),c=w(""),g=w([]),v=w(!1),u=w(null);function k(){try{const t=localStorage.getItem("authToken"),s=localStorage.getItem("currentUser");if(!t||!s){const a=localStorage.getItem("mediaData");return a?JSON.parse(a):[]}return[]}catch(t){return console.error("Failed to load media from storage:",t),[]}}function f(){try{const t=localStorage.getItem("authToken"),s=localStorage.getItem("currentUser");(!t||!s)&&localStorage.setItem("mediaData",JSON.stringify(n.value))}catch(t){console.error("Failed to save media to storage:",t)}}const l=C(()=>n.value.length),p=C(()=>{const t={};return n.value.forEach(s=>{const a=s.category||"unknown";t[a]=(t[a]||0)+1}),t}),D=C(()=>{let t=[...n.value];if(e.value&&e.value!=="all"&&(t=t.filter(s=>e.value==="watchlist"?s.category==="watchlist"||s.isNew===!0:s.category===e.value)),c.value){const s=c.value.toLowerCase();t=t.filter(a=>{var r,i,d,_;return((r=a.title)==null?void 0:r.toLowerCase().includes(s))||((i=a.description)==null?void 0:i.toLowerCase().includes(s))||((d=a.genre)==null?void 0:d.toLowerCase().includes(s))||((_=a.platforms)==null?void 0:_.toLowerCase().includes(s))})}return g.value.forEach(s=>{s.type==="platform"?t=t.filter(a=>{var r;return(r=a.platforms)==null?void 0:r.toLowerCase().includes(s.value.toLowerCase())}):s.type==="genre"?t=t.filter(a=>{var r;return(r=a.genre)==null?void 0:r.toLowerCase().includes(s.value.toLowerCase())}):s.type==="airing"&&(s.value==="airing"?t=t.filter(a=>a.isAiring===!0):s.value==="finished"&&(t=t.filter(a=>a.isAiring===!1||a.isAiring===null)))}),t}),N=C(()=>{const t=new Set;return n.value.forEach(s=>{s.platforms&&s.platforms.split(/[,;|&]/).map(r=>r.trim()).filter(r=>r.length>0).forEach(r=>t.add(r))}),Array.from(t).sort()}),O=C(()=>{const t=new Set;return n.value.forEach(s=>{s.genre&&s.genre.split(/[,;|&]/).map(r=>r.trim()).filter(r=>r.length>0).forEach(r=>t.add(r))}),Array.from(t).sort()});async function b(){var t,s;v.value=!0,u.value=null;try{const a=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(a&&r)try{const i=await I.getMedia();n.value=i||[]}catch(i){console.warn("API load failed for logged in user:",i),n.value=[]}else{const i=k();if(i.length>0)n.value=i;else{const d=await I.getMedia();n.value=d||[],f()}}}catch(a){u.value=((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||a.message||"Failed to load media data",console.error("Failed to load media:",a)}finally{v.value=!1}}function R(t){e.value=t}function V(t){c.value=t}function z(t){g.value.some(a=>a.type===t.type&&a.value===t.value)||g.value.push(t)}function G(t){g.value=g.value.filter(s=>!(s.type===t.type&&s.value===t.value))}function j(){g.value=[]}async function q(t,s=!1){var a,r,i;u.value=null;try{const d=localStorage.getItem("authToken"),_=localStorage.getItem("currentUser");if(d&&_)try{const m=await I.addMediaItem(t);if(!s)await b();else{const F={...m,__order:n.value.length};n.value.push(F)}return m}catch(m){if(((a=m.response)==null?void 0:a.status)===409&&((i=(r=m.response)==null?void 0:r.data)!=null&&i.duplicate)){const F=new Error(m.response.data.error||"Ein Eintrag mit diesem Titel und dieser Kategorie existiert bereits.");throw F.isDuplicate=!0,F}throw u.value=m.message||"Failed to add media item",console.error("API save failed for logged in user:",m),m}else{const m={id:Date.now(),...t,__order:n.value.length};return n.value.push(m),f(),m}}catch(d){throw d}}async function J(t,s){u.value=null;try{const a=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(a&&r)try{const i=await I.updateMediaItem(t,s);return await b(),i}catch(i){throw console.error("API update failed for logged in user:",i),i}else{const i=n.value.findIndex(d=>d.id===t);if(i!==-1)return n.value[i]={...n.value[i],...s},f(),n.value[i];throw new Error("Media item not found")}}catch(a){throw a.isDuplicate||(u.value=a.message||"Failed to update media item"),a}}async function Q(t){var s;try{const a=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(a&&r)try{return await I.deleteMediaItem(t),await b(),!0}catch(i){if(((s=i.response)==null?void 0:s.status)===404||i.isNotFound)return await b(),!0;throw console.error("API delete failed for logged in user:",i),i}else{const i=n.value.findIndex(d=>d.id===t);if(i!==-1)return n.value.splice(i,1),f(),!0;throw new Error("Media item not found")}}catch(a){throw u.value=a.message||"Failed to delete media item",a}}async function W(t){try{const s=localStorage.getItem("authToken"),a=localStorage.getItem("currentUser");if(s&&a)try{const r=await I.batchAddMediaItems(t);return await b(),r}catch(r){throw console.error("API batch add failed for logged in user:",r),r}else{const r=t.map((i,d)=>({id:Date.now()+d,...i,__order:n.value.length+d}));return n.value.push(...r),f(),{success:!0,stats:{created:r.length,failed:0,errors:[]}}}}catch(s){throw u.value=s.message||"Failed to add media items",s}}async function H(t){try{const s=localStorage.getItem("authToken"),a=localStorage.getItem("currentUser");if(s&&a)try{return await I.batchDeleteMediaItems(t),await b(),!0}catch(r){throw console.error("API batch delete failed for logged in user:",r),r}else return n.value=n.value.filter(r=>!t.includes(r.id)),f(),!0}catch(s){throw u.value=s.message||"Failed to delete media items",s}}async function K(){try{const t=localStorage.getItem("authToken"),s=localStorage.getItem("currentUser");t&&s?await I.saveMedia(n.value):f()}catch(t){console.error("Failed to save media:",t)}}function U(){u.value=null}function X(t){if(console.log("Processing real-time update:",t),t.type==="media_updated"&&t.items)t.items.forEach(s=>{const a=n.value.findIndex(r=>r.id===s.id);a!==-1?n.value[a]={...n.value[a],...s}:n.value.push(s)});else if(t.action==="created"||t.action==="updated"){const s=t.item,a=n.value.findIndex(r=>r.id===s.id);a!==-1?n.value[a]={...n.value[a],...s}:n.value.push(s)}else if(t.action==="deleted"){const s=n.value.findIndex(a=>a.id===t.id);s!==-1&&n.value.splice(s,1)}f()}function Y(){const t=localStorage.getItem("authToken"),s=localStorage.getItem("currentUser");if(!t||!s){console.log("Skipping realtime initialization - user not authenticated");return}try{x.addListener("media-store",X),x.connect()}catch(a){console.error("Failed to initialize realtime updates:",a)}}function Z(){x.removeListener("media-store")}return{mediaData:n,currentCategory:e,searchQuery:c,activeFilters:g,loading:v,error:u,totalItems:l,categoryCounts:p,filteredMedia:D,platforms:N,genres:O,loadMedia:b,setCategory:R,setSearchQuery:V,addFilter:z,removeFilter:G,clearFilters:j,addMediaItem:q,updateMediaItem:J,deleteMediaItem:Q,batchAddMediaItems:W,batchDeleteMediaItems:H,saveMedia:K,clearError:U,initializeRealtimeUpdates:Y,cleanupRealtimeUpdates:Z}}),Ve=B("sidebar",()=>{const n=w(!1),e=w(!1),c=()=>{n.value=!n.value},g=()=>{e.value=!e.value},v=()=>{e.value=!1},u=p=>{n.value=p},k=p=>{e.value=p},f=C(()=>n.value),l=C(()=>e.value);return{collapsed:n,mobileOpen:e,toggleSidebar:c,toggleMobileSidebar:g,closeMobileSidebar:v,setCollapsed:u,setMobileOpen:k,isCollapsed:f,isMobileOpen:l}}),oe={name:"VersionInfo",data(){return{version:"1.0.0"}}},ne={class:"version-info"},re={class:"version-label"};function le(n,e,c,g,v,u){return y(),h("div",ne,[o("span",re,"Build #"+S(v.version),1)])}const ie=P(oe,[["render",le],["__scopeId","data-v-2d54e3c7"]]),ce={name:"Sidebar",components:{VersionInfo:ie},props:{collapsed:{type:Boolean,default:!1},mobileOpen:{type:Boolean,default:!1},isLoggedIn:{type:Boolean,default:!1},userName:{type:String,default:""},currentCategory:{type:String,default:"watchlist"},categoryCounts:{type:Object,default:()=>({})},platforms:{type:Array,default:()=>[]},genres:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[{key:"game",name:"Games",icon:"🎮"},{key:"series",name:"Series",icon:"📺"},{key:"movie",name:"Movies",icon:"🎬"},{key:"buecher",name:"Bücher",icon:"📚"},{key:"watchlist",name:"Watchlist",icon:"❤️"}]}},emits:["toggle","setCategory","addItem","navigateToCalendar","navigateToProfile","togglePlatformFilter","toggleGenreFilter","toggleAiringFilter","showLogin","showRegister","logout"],methods:{}},ue={class:"sidebar-content"},de={class:"sidebar-section"},ge={class:"sidebar-nav"},ve=["onClick"],fe={class:"nav-icon"},me={class:"nav-text"},pe={class:"nav-count"},he=["onClick","title"],ye={key:0,class:"sidebar-section"},ke={class:"filter-section"},Ie={class:"filter-group"},we={class:"filter-checkboxes"},be=["value","onChange"],Se={class:"option-text"},Ce={class:"filter-group"},_e={class:"filter-checkboxes"},Fe=["value","onChange"],Me={class:"option-text"},Ae={class:"filter-group"},Le={class:"filter-checkboxes"},Ee={class:"filter-option"},xe={class:"filter-option"},Ue={class:"sidebar-section"},$e={key:0,class:"auth-buttons"},Te={key:1,class:"user-info"},Be={class:"user-profile"},Pe={class:"profile-details"},De={class:"user-name"};function Ne(n,e,c,g,v,u){const k=T("router-link"),f=T("VersionInfo");return y(),h("aside",{id:"sidebar",class:E(["sidebar",{collapsed:c.collapsed,open:c.mobileOpen}])},[o("div",{class:"sidebar-header",onClick:e[0]||(e[0]=l=>n.$emit("toggle"))},[...e[8]||(e[8]=[o("h2",null,"Media Library",-1),o("button",{class:"sidebar-toggle"},"☰",-1)])]),o("div",ue,[o("div",de,[e[13]||(e[13]=o("h3",null,"Browse",-1)),o("nav",ge,[(y(!0),h(A,null,L(c.categories,l=>(y(),h("div",{key:l.key,class:"nav-item"},[o("button",{class:E(["nav-btn",{active:c.currentCategory===l.key}]),onClick:p=>n.$emit("setCategory",l.key)},[o("span",fe,S(l.icon),1),o("span",me,S(l.name),1),o("span",pe,S(c.categoryCounts[l.key]||0),1)],10,ve),o("button",{class:"add-btn",onClick:p=>n.$emit("addItem",l.key),title:`Add ${l.name}`},[...e[9]||(e[9]=[o("span",{class:"add-icon"},"+",-1)])],8,he)]))),128)),o("button",{class:E(["nav-btn",{active:c.currentCategory==="statistics"}]),onClick:e[1]||(e[1]=l=>n.$emit("setCategory","statistics"))},[...e[10]||(e[10]=[o("span",{class:"nav-icon"},"📊",-1),o("span",{class:"nav-text"},"Statistics",-1)])],2),M(k,{to:"/calendar",class:"nav-btn"},{default:$(()=>[...e[11]||(e[11]=[o("span",{class:"nav-icon"},"📅",-1),o("span",{class:"nav-text"},"Calendar",-1)])]),_:1}),M(k,{to:"/profile",class:"nav-btn"},{default:$(()=>[...e[12]||(e[12]=[o("span",{class:"nav-icon"},"👤",-1),o("span",{class:"nav-text"},"Profile",-1)])]),_:1})])]),c.isLoggedIn?(y(),h("div",ye,[e[23]||(e[23]=o("h3",null,"Filters",-1)),o("div",ke,[o("div",Ie,[e[15]||(e[15]=o("h4",null,"Platforms",-1)),o("div",we,[(y(!0),h(A,null,L(c.platforms,l=>(y(),h("label",{key:l,class:"filter-option"},[o("input",{type:"checkbox",value:l,onChange:p=>n.$emit("togglePlatformFilter",l,p.target.checked)},null,40,be),e[14]||(e[14]=o("span",{class:"checkmark"},null,-1)),o("span",Se,S(l),1)]))),128))])]),o("div",Ce,[e[17]||(e[17]=o("h4",null,"Genres",-1)),o("div",_e,[(y(!0),h(A,null,L(c.genres,l=>(y(),h("label",{key:l,class:"filter-option"},[o("input",{type:"checkbox",value:l,onChange:p=>n.$emit("toggleGenreFilter",l,p.target.checked)},null,40,Fe),e[16]||(e[16]=o("span",{class:"checkmark"},null,-1)),o("span",Me,S(l),1)]))),128))])]),o("div",Ae,[e[22]||(e[22]=o("h4",null,"Series Status",-1)),o("div",Le,[o("label",Ee,[o("input",{type:"checkbox",value:"airing",onChange:e[2]||(e[2]=l=>n.$emit("toggleAiringFilter","airing",l.target.checked))},null,32),e[18]||(e[18]=o("span",{class:"checkmark"},null,-1)),e[19]||(e[19]=o("span",{class:"option-text"},[o("span",{class:"airing-indicator"},"●"),se(" Airing ")],-1))]),o("label",xe,[o("input",{type:"checkbox",value:"finished",onChange:e[3]||(e[3]=l=>n.$emit("toggleAiringFilter","finished",l.target.checked))},null,32),e[20]||(e[20]=o("span",{class:"checkmark"},null,-1)),e[21]||(e[21]=o("span",{class:"option-text"},"Finished",-1))])])])])])):te("",!0),o("div",Ue,[e[25]||(e[25]=o("h3",null,"Account",-1)),c.isLoggedIn?(y(),h("div",Te,[o("div",Be,[e[24]||(e[24]=o("div",{class:"profile-avatar"},[o("span",{class:"avatar-text"},"👤")],-1)),o("div",Pe,[o("span",De,S(c.userName),1)]),o("button",{class:"account-btn",onClick:e[6]||(e[6]=l=>n.$emit("navigateToProfile"))},"⚙️")]),o("button",{class:"auth-btn",onClick:e[7]||(e[7]=l=>n.$emit("logout"))},"Logout")])):(y(),h("div",$e,[o("button",{class:"auth-btn",onClick:e[4]||(e[4]=l=>n.$emit("showLogin"))},"Login"),o("button",{class:"auth-btn",onClick:e[5]||(e[5]=l=>n.$emit("showRegister"))},"Register")]))])]),M(f)],2)}const ze=P(ce,[["render",Ne],["__scopeId","data-v-924a488d"]]);export{ze as S,Ve as a,Re as u};
