import{x as T,d as i,f as g}from"./index-CIlU58Bg.js";import{a as v}from"./media-B6mVtcKx.js";const N=T("auth",()=>{const a=i(localStorage.getItem("authToken")||null),r=i(null),s=i(!1),t=i(null),y=g(()=>!!a.value&&!!r.value),h=g(()=>{var e;return((e=r.value)==null?void 0:e.name)||""}),S=g(()=>{var e;return((e=r.value)==null?void 0:e.email)||""});async function p(e,u){var n,c;s.value=!0,t.value=null;try{const l=await v.login(e,u);return a.value=l.token,r.value=l.user,localStorage.setItem("authToken",a.value),localStorage.setItem("currentUser",JSON.stringify(r.value)),{success:!0}}catch(l){return t.value=((c=(n=l.response)==null?void 0:n.data)==null?void 0:c.message)||l.message||"Login failed",{success:!1,error:t.value}}finally{s.value=!1}}async function k(e,u,n,c){var l,d;s.value=!0,t.value=null;try{const o=await v.register(e,u,n,c);return a.value=o.token,r.value=o.user,localStorage.setItem("authToken",a.value),localStorage.setItem("currentUser",JSON.stringify(r.value)),{success:!0}}catch(o){return t.value=((d=(l=o.response)==null?void 0:l.data)==null?void 0:d.message)||o.message||"Registration failed",{success:!1,error:t.value}}finally{s.value=!1}}async function f(){try{a.value&&await v.logout(a.value)}catch(e){console.error("Logout API call failed:",e)}finally{a.value=null,r.value=null,localStorage.removeItem("authToken"),localStorage.removeItem("currentUser")}}async function m(){if(!a.value)return!1;try{const e=await v.validateToken(a.value);return r.value=e,!0}catch(e){return console.error("Token validation failed:",e),await f(),!1}}async function I(){const e=localStorage.getItem("currentUser");if(e)try{r.value=JSON.parse(e)}catch(u){console.error("Failed to parse saved user data:",u),await f();return}a.value&&await m()}function w(){t.value=null}return{token:a,user:r,loading:s,error:t,isLoggedIn:y,userName:h,userEmail:S,login:p,register:k,logout:f,validateToken:m,initializeAuth:I,clearError:w}});export{N as u};
