import{d as T,r as b,c as C,q as I,_ as B,b as h,e as o,t as S,o as y,z as F,f as Z,F as M,p as _,n as A,E as $,B as U,g as ee}from"./index-Cc_nDPSL.js";class te{constructor(){this.isConnected={value:!1},this.listeners=new Map,this.pollingInterval=null,this.lastUpdate=null,this.pollingIntervalMs=2e4}getApiBaseUrl(){return"https://teabubble.attrebi.ch"}connect(){if(this.pollingInterval)return;const e=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");!e||!c||(this.isConnected.value=!0,this.lastUpdate=new Date,this.pollingInterval=setInterval(()=>{this.checkForUpdates()},this.pollingIntervalMs))}async checkForUpdates(){try{const e=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");if(!e||!c)return;const g=this.getApiBaseUrl(),v=await fetch(`${g}/api/media`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!v.ok){if(v.status===401){this.disconnect();return}throw new Error(`HTTP error! status: ${v.status}`)}const u=await v.json();u&&u.length>0&&this.listeners.forEach((k,f)=>{try{k({type:"media_updated",items:u,count:u.length,timestamp:new Date().toISOString()})}catch{}}),this.lastUpdate=new Date}catch{}}addListener(e,c){this.listeners.set(e,c)}removeListener(e){this.listeners.delete(e)}disconnect(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null),this.isConnected.value=!1}destroy(){this.disconnect(),this.listeners.clear()}}const L=new te,Ne=T("media",()=>{const n=b(k()),e=b("game"),c=b(""),g=b([]),v=b(!1),u=b(null);function k(){try{const t=localStorage.getItem("authToken"),s=localStorage.getItem("currentUser");if(!t||!s){const a=localStorage.getItem("mediaData");return a?JSON.parse(a):[]}return[]}catch(t){return console.error("Failed to load media from storage:",t),[]}}function f(){try{const t=localStorage.getItem("authToken"),s=localStorage.getItem("currentUser");(!t||!s)&&localStorage.setItem("mediaData",JSON.stringify(n.value))}catch(t){console.error("Failed to save media to storage:",t)}}const i=C(()=>n.value.length),p=C(()=>{const t={};return n.value.forEach(s=>{const a=s.category||"unknown";t[a]=(t[a]||0)+1}),t}),P=C(()=>{let t=[...n.value];if(e.value&&e.value!=="all"&&(t=t.filter(s=>e.value==="watchlist"?s.category==="watchlist"||s.isNew===!0:s.category===e.value)),c.value){const s=c.value.toLowerCase();t=t.filter(a=>{var r,l,m,d;return((r=a.title)==null?void 0:r.toLowerCase().includes(s))||((l=a.description)==null?void 0:l.toLowerCase().includes(s))||((m=a.genre)==null?void 0:m.toLowerCase().includes(s))||((d=a.platforms)==null?void 0:d.toLowerCase().includes(s))})}return g.value.forEach(s=>{s.type==="platform"?t=t.filter(a=>{var r;return(r=a.platforms)==null?void 0:r.toLowerCase().includes(s.value.toLowerCase())}):s.type==="genre"?t=t.filter(a=>{var r;return(r=a.genre)==null?void 0:r.toLowerCase().includes(s.value.toLowerCase())}):s.type==="airing"&&(s.value==="airing"?t=t.filter(a=>a.isAiring===!0):s.value==="finished"&&(t=t.filter(a=>a.isAiring===!1||a.isAiring===null)))}),t}),D=C(()=>{const t=new Set;return n.value.forEach(s=>{s.platforms&&s.platforms.split(/[,;|&]/).map(r=>r.trim()).filter(r=>r.length>0).forEach(r=>t.add(r))}),Array.from(t).sort()}),N=C(()=>{const t=new Set;return n.value.forEach(s=>{s.genre&&s.genre.split(/[,;|&]/).map(r=>r.trim()).filter(r=>r.length>0).forEach(r=>t.add(r))}),Array.from(t).sort()});async function w(){var t,s;v.value=!0,u.value=null;try{const a=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(a&&r)try{const l=await I.getMedia();n.value=l||[]}catch(l){console.warn("API load failed for logged in user:",l),n.value=[]}else{const l=k();if(l.length>0)n.value=l;else{const m=await I.getMedia();n.value=m||[],f()}}}catch(a){u.value=((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||a.message||"Failed to load media data",console.error("Failed to load media:",a)}finally{v.value=!1}}function O(t){e.value=t}function V(t){c.value=t}function R(t){g.value.some(a=>a.type===t.type&&a.value===t.value)||g.value.push(t)}function z(t){g.value=g.value.filter(s=>!(s.type===t.type&&s.value===t.value))}function G(){g.value=[]}async function j(t){var s,a,r;u.value=null;try{const l=localStorage.getItem("authToken"),m=localStorage.getItem("currentUser");if(l&&m)try{const d=await I.addMediaItem(t);return await w(),d}catch(d){if(((s=d.response)==null?void 0:s.status)===409&&((r=(a=d.response)==null?void 0:a.data)!=null&&r.duplicate)){const x=new Error(d.response.data.error||"Ein Eintrag mit diesem Titel und dieser Kategorie existiert bereits.");throw x.isDuplicate=!0,x}throw u.value=d.message||"Failed to add media item",console.error("API save failed for logged in user:",d),d}else{const d={id:Date.now(),...t,__order:n.value.length};return n.value.push(d),f(),d}}catch(l){throw l}}async function q(t,s){u.value=null;try{const a=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(a&&r)try{const l=await I.updateMediaItem(t,s);return await w(),l}catch(l){throw console.error("API update failed for logged in user:",l),l}else{const l=n.value.findIndex(m=>m.id===t);if(l!==-1)return n.value[l]={...n.value[l],...s},f(),n.value[l];throw new Error("Media item not found")}}catch(a){throw a.isDuplicate||(u.value=a.message||"Failed to update media item"),a}}async function J(t){var s;try{const a=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(a&&r)try{return await I.deleteMediaItem(t),await w(),!0}catch(l){if(((s=l.response)==null?void 0:s.status)===404||l.isNotFound)return await w(),!0;throw console.error("API delete failed for logged in user:",l),l}else{const l=n.value.findIndex(m=>m.id===t);if(l!==-1)return n.value.splice(l,1),f(),!0;throw new Error("Media item not found")}}catch(a){throw u.value=a.message||"Failed to delete media item",a}}async function Q(t){try{const s=localStorage.getItem("authToken"),a=localStorage.getItem("currentUser");if(s&&a)try{const r=await I.batchAddMediaItems(t);return await w(),r}catch(r){throw console.error("API batch add failed for logged in user:",r),r}else{const r=t.map((l,m)=>({id:Date.now()+m,...l,__order:n.value.length+m}));return n.value.push(...r),f(),{success:!0,stats:{created:r.length,failed:0,errors:[]}}}}catch(s){throw u.value=s.message||"Failed to add media items",s}}async function H(t){try{const s=localStorage.getItem("authToken"),a=localStorage.getItem("currentUser");if(s&&a)try{return await I.batchDeleteMediaItems(t),await w(),!0}catch(r){throw console.error("API batch delete failed for logged in user:",r),r}else return n.value=n.value.filter(r=>!t.includes(r.id)),f(),!0}catch(s){throw u.value=s.message||"Failed to delete media items",s}}async function K(){try{const t=localStorage.getItem("authToken"),s=localStorage.getItem("currentUser");t&&s?await I.saveMedia(n.value):f()}catch(t){console.error("Failed to save media:",t)}}function E(){u.value=null}function W(t){if(console.log("Processing real-time update:",t),t.type==="media_updated"&&t.items)t.items.forEach(s=>{const a=n.value.findIndex(r=>r.id===s.id);a!==-1?n.value[a]={...n.value[a],...s}:n.value.push(s)});else if(t.action==="created"||t.action==="updated"){const s=t.item,a=n.value.findIndex(r=>r.id===s.id);a!==-1?n.value[a]={...n.value[a],...s}:n.value.push(s)}else if(t.action==="deleted"){const s=n.value.findIndex(a=>a.id===t.id);s!==-1&&n.value.splice(s,1)}f()}function X(){const t=localStorage.getItem("authToken"),s=localStorage.getItem("currentUser");if(!t||!s){console.log("Skipping realtime initialization - user not authenticated");return}try{L.addListener("media-store",W),L.connect()}catch(a){console.error("Failed to initialize realtime updates:",a)}}function Y(){L.removeListener("media-store")}return{mediaData:n,currentCategory:e,searchQuery:c,activeFilters:g,loading:v,error:u,totalItems:i,categoryCounts:p,filteredMedia:P,platforms:D,genres:N,loadMedia:w,setCategory:O,setSearchQuery:V,addFilter:R,removeFilter:z,clearFilters:G,addMediaItem:j,updateMediaItem:q,deleteMediaItem:J,batchAddMediaItems:Q,batchDeleteMediaItems:H,saveMedia:K,clearError:E,initializeRealtimeUpdates:X,cleanupRealtimeUpdates:Y}}),Oe=T("sidebar",()=>{const n=b(!1),e=b(!1),c=()=>{n.value=!n.value},g=()=>{e.value=!e.value},v=()=>{e.value=!1},u=p=>{n.value=p},k=p=>{e.value=p},f=C(()=>n.value),i=C(()=>e.value);return{collapsed:n,mobileOpen:e,toggleSidebar:c,toggleMobileSidebar:g,closeMobileSidebar:v,setCollapsed:u,setMobileOpen:k,isCollapsed:f,isMobileOpen:i}}),se={name:"VersionInfo",data(){return{version:"1.0.0"}}},ae={class:"version-info"},oe={class:"version-label"};function ne(n,e,c,g,v,u){return y(),h("div",ae,[o("span",oe,"Build #"+S(v.version),1)])}const re=B(se,[["render",ne],["__scopeId","data-v-2d54e3c7"]]),ie={name:"Sidebar",components:{VersionInfo:re},props:{collapsed:{type:Boolean,default:!1},mobileOpen:{type:Boolean,default:!1},isLoggedIn:{type:Boolean,default:!1},userName:{type:String,default:""},currentCategory:{type:String,default:"watchlist"},categoryCounts:{type:Object,default:()=>({})},platforms:{type:Array,default:()=>[]},genres:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[{key:"game",name:"Games",icon:"ðŸŽ®"},{key:"series",name:"Series",icon:"ðŸ“º"},{key:"movie",name:"Movies",icon:"ðŸŽ¬"},{key:"buecher",name:"BÃ¼cher",icon:"ðŸ“š"},{key:"watchlist",name:"Watchlist",icon:"â¤ï¸"}]}},emits:["toggle","setCategory","addItem","navigateToCalendar","navigateToProfile","togglePlatformFilter","toggleGenreFilter","toggleAiringFilter","showLogin","showRegister","logout"],methods:{}},le={class:"sidebar-content"},ce={class:"sidebar-section"},ue={class:"sidebar-nav"},de=["onClick"],ge={class:"nav-icon"},ve={class:"nav-text"},fe={class:"nav-count"},me=["onClick","title"],pe={key:0,class:"sidebar-section"},he={class:"filter-section"},ye={class:"filter-group"},ke={class:"filter-checkboxes"},Ie=["value","onChange"],be={class:"option-text"},we={class:"filter-group"},Se={class:"filter-checkboxes"},Ce=["value","onChange"],Fe={class:"option-text"},Me={class:"filter-group"},_e={class:"filter-checkboxes"},Ae={class:"filter-option"},Le={class:"filter-option"},Ee={class:"sidebar-section"},xe={key:0,class:"auth-buttons"},$e={key:1,class:"user-info"},Ue={class:"user-profile"},Te={class:"profile-details"},Be={class:"user-name"};function Pe(n,e,c,g,v,u){const k=U("router-link"),f=U("VersionInfo");return y(),h("aside",{id:"sidebar",class:A(["sidebar",{collapsed:c.collapsed,open:c.mobileOpen}])},[o("div",{class:"sidebar-header",onClick:e[0]||(e[0]=i=>n.$emit("toggle"))},[...e[8]||(e[8]=[o("h2",null,"Media Library",-1),o("button",{class:"sidebar-toggle"},"â˜°",-1)])]),o("div",le,[o("div",ce,[e[13]||(e[13]=o("h3",null,"Browse",-1)),o("nav",ue,[(y(!0),h(M,null,_(c.categories,i=>(y(),h("div",{key:i.key,class:"nav-item"},[o("button",{class:A(["nav-btn",{active:c.currentCategory===i.key}]),onClick:p=>n.$emit("setCategory",i.key)},[o("span",ge,S(i.icon),1),o("span",ve,S(i.name),1),o("span",fe,S(c.categoryCounts[i.key]||0),1)],10,de),o("button",{class:"add-btn",onClick:p=>n.$emit("addItem",i.key),title:`Add ${i.name}`},[...e[9]||(e[9]=[o("span",{class:"add-icon"},"+",-1)])],8,me)]))),128)),o("button",{class:A(["nav-btn",{active:c.currentCategory==="statistics"}]),onClick:e[1]||(e[1]=i=>n.$emit("setCategory","statistics"))},[...e[10]||(e[10]=[o("span",{class:"nav-icon"},"ðŸ“Š",-1),o("span",{class:"nav-text"},"Statistics",-1)])],2),F(k,{to:"/calendar",class:"nav-btn"},{default:$(()=>[...e[11]||(e[11]=[o("span",{class:"nav-icon"},"ðŸ“…",-1),o("span",{class:"nav-text"},"Calendar",-1)])]),_:1}),F(k,{to:"/profile",class:"nav-btn"},{default:$(()=>[...e[12]||(e[12]=[o("span",{class:"nav-icon"},"ðŸ‘¤",-1),o("span",{class:"nav-text"},"Profile",-1)])]),_:1})])]),c.isLoggedIn?(y(),h("div",pe,[e[23]||(e[23]=o("h3",null,"Filters",-1)),o("div",he,[o("div",ye,[e[15]||(e[15]=o("h4",null,"Platforms",-1)),o("div",ke,[(y(!0),h(M,null,_(c.platforms,i=>(y(),h("label",{key:i,class:"filter-option"},[o("input",{type:"checkbox",value:i,onChange:p=>n.$emit("togglePlatformFilter",i,p.target.checked)},null,40,Ie),e[14]||(e[14]=o("span",{class:"checkmark"},null,-1)),o("span",be,S(i),1)]))),128))])]),o("div",we,[e[17]||(e[17]=o("h4",null,"Genres",-1)),o("div",Se,[(y(!0),h(M,null,_(c.genres,i=>(y(),h("label",{key:i,class:"filter-option"},[o("input",{type:"checkbox",value:i,onChange:p=>n.$emit("toggleGenreFilter",i,p.target.checked)},null,40,Ce),e[16]||(e[16]=o("span",{class:"checkmark"},null,-1)),o("span",Fe,S(i),1)]))),128))])]),o("div",Me,[e[22]||(e[22]=o("h4",null,"Series Status",-1)),o("div",_e,[o("label",Ae,[o("input",{type:"checkbox",value:"airing",onChange:e[2]||(e[2]=i=>n.$emit("toggleAiringFilter","airing",i.target.checked))},null,32),e[18]||(e[18]=o("span",{class:"checkmark"},null,-1)),e[19]||(e[19]=o("span",{class:"option-text"},[o("span",{class:"airing-indicator"},"â—"),ee(" Airing ")],-1))]),o("label",Le,[o("input",{type:"checkbox",value:"finished",onChange:e[3]||(e[3]=i=>n.$emit("toggleAiringFilter","finished",i.target.checked))},null,32),e[20]||(e[20]=o("span",{class:"checkmark"},null,-1)),e[21]||(e[21]=o("span",{class:"option-text"},"Finished",-1))])])])])])):Z("",!0),o("div",Ee,[e[25]||(e[25]=o("h3",null,"Account",-1)),c.isLoggedIn?(y(),h("div",$e,[o("div",Ue,[e[24]||(e[24]=o("div",{class:"profile-avatar"},[o("span",{class:"avatar-text"},"ðŸ‘¤")],-1)),o("div",Te,[o("span",Be,S(c.userName),1)]),o("button",{class:"account-btn",onClick:e[6]||(e[6]=i=>n.$emit("navigateToProfile"))},"âš™ï¸")]),o("button",{class:"auth-btn",onClick:e[7]||(e[7]=i=>n.$emit("logout"))},"Logout")])):(y(),h("div",xe,[o("button",{class:"auth-btn",onClick:e[4]||(e[4]=i=>n.$emit("showLogin"))},"Login"),o("button",{class:"auth-btn",onClick:e[5]||(e[5]=i=>n.$emit("showRegister"))},"Register")]))])]),F(f)],2)}const Ve=B(ie,[["render",Pe],["__scopeId","data-v-924a488d"]]);export{Ve as S,Oe as a,Ne as u};
