import{G as ne,d as P,r as C,l as T,c as E,y as w,_ as V,b as I,e as s,t as F,o as S,D as B,f as ie,F as _,x,n as $,H as R,z as N,g as ce}from"./index-B5mJPAlK.js";class ue{constructor(){this.isConnected={value:!1},this.listeners=new Map,this.pollingInterval=null,this.lastUpdate=null,this.pollingIntervalMs=2e4}getApiBaseUrl(){return ne.BASE_URL}connect(){if(this.pollingInterval)return;const a=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");!a||!c||(this.isConnected.value=!0,this.lastUpdate=new Date,this.pollingInterval=setInterval(()=>{this.checkForUpdates()},this.pollingIntervalMs))}async checkForUpdates(){try{const a=localStorage.getItem("authToken"),c=localStorage.getItem("currentUser");if(!a||!c)return;const h=this.getApiBaseUrl(),g=await fetch(`${h}/api/media`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!g.ok){if(g.status===401){this.disconnect();return}throw new Error(`HTTP error! status: ${g.status}`)}const b=await g.json();b&&b.length>0&&this.listeners.forEach((l,m)=>{try{l({type:"media_updated",items:b,count:b.length,timestamp:new Date().toISOString()})}catch{}}),this.lastUpdate=new Date}catch{}}addListener(a,c){this.listeners.set(a,c)}removeListener(a){this.listeners.delete(a)}disconnect(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null),this.isConnected.value=!1}destroy(){this.disconnect(),this.listeners.clear()}}const O=new ue,Ke=P("media",()=>{const d=()=>{try{return localStorage.getItem("currentCategory")||"game"}catch(e){return console.error("Failed to load current category from localStorage:",e),"game"}},a=e=>{try{localStorage.setItem("currentCategory",e)}catch(t){console.error("Failed to save current category to localStorage:",t)}},c=()=>{try{return localStorage.getItem("searchQuery")||""}catch(e){return console.error("Failed to load search query from localStorage:",e),""}},h=e=>{try{localStorage.setItem("searchQuery",e)}catch(t){console.error("Failed to save search query to localStorage:",t)}},g=()=>{try{const e=localStorage.getItem("activeFilters");return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load active filters from localStorage:",e),[]}},b=e=>{try{localStorage.setItem("activeFilters",JSON.stringify(e))}catch(t){console.error("Failed to save active filters to localStorage:",t)}},l=C(A()),m=C(d()),n=C(c()),v=C(g()),L=C(!1),p=C(null);T(m,e=>{a(e)},{immediate:!1}),T(n,e=>{h(e)},{immediate:!1}),T(v,e=>{b(e)},{immediate:!1,deep:!0});function A(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");if(!e||!t){const o=localStorage.getItem("mediaData");return o?JSON.parse(o):[]}return[]}catch(e){return console.error("Failed to load media from storage:",e),[]}}function u(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");(!e||!t)&&localStorage.setItem("mediaData",JSON.stringify(l.value))}catch(e){console.error("Failed to save media to storage:",e)}}const U=E(()=>l.value.length),Q=E(()=>{const e={};return l.value.forEach(t=>{const o=t.category||"unknown";e[o]=(e[o]||0)+1}),e}),z=E(()=>{let e=[...l.value];if(console.log("ðŸ” FILTER DEBUG: Total media items:",l.value.length),console.log("ðŸ” FILTER DEBUG: Current category:",m.value),console.log("ðŸ” FILTER DEBUG: Search query:",n.value),console.log("ðŸ” FILTER DEBUG: Active filters:",v.value),console.log("ðŸ” FILTER DEBUG: Raw media data:",l.value),m.value&&m.value!=="all"){const t=e.length;e=e.filter(o=>m.value==="watchlist"?o.category==="watchlist"||o.isNew===!0:(console.log("ðŸ” CATEGORY DEBUG: Item title:",o.title,"Item category:",o.category,"Current category:",m.value,"Match:",o.category===m.value),o.category===m.value)),console.log("ðŸ” FILTER DEBUG: After category filter:",e.length,"items (was",t,")"),e.length===0&&t>0&&(console.log("ðŸ” FALLBACK: No items match category, showing all items"),e=[...l.value])}if(n.value){const t=n.value.toLowerCase();e=e.filter(o=>{var r,i,f,D;return((r=o.title)==null?void 0:r.toLowerCase().includes(t))||((i=o.description)==null?void 0:i.toLowerCase().includes(t))||((f=o.genre)==null?void 0:f.toLowerCase().includes(t))||((D=o.platforms)==null?void 0:D.toLowerCase().includes(t))}),console.log("ðŸ” FILTER DEBUG: After search filter:",e.length,"items")}return v.value.forEach(t=>{t.type==="platform"?e=e.filter(o=>{var r;return(r=o.platforms)==null?void 0:r.toLowerCase().includes(t.value.toLowerCase())}):t.type==="genre"?e=e.filter(o=>{var r;return(r=o.genre)==null?void 0:r.toLowerCase().includes(t.value.toLowerCase())}):t.type==="airing"&&(t.value==="airing"?e=e.filter(o=>o.isAiring===!0):t.value==="finished"&&(e=e.filter(o=>o.isAiring===!1||o.isAiring===null)))}),console.log("ðŸ” FILTER DEBUG: Final filtered result:",e.length,"items"),console.log("ðŸ” FILTER DEBUG: Final filtered items:",e),e}),J=E(()=>{const e=new Set;return l.value.forEach(t=>{t.platforms&&t.platforms.split(/[,;|&]/).map(r=>r.trim()).filter(r=>r.length>0).forEach(r=>e.add(r))}),Array.from(e).sort()}),q=E(()=>{const e=new Set;return l.value.forEach(t=>{t.genre&&t.genre.split(/[,;|&]/).map(r=>r.trim()).filter(r=>r.length>0).forEach(r=>e.add(r))}),Array.from(e).sort()});async function k(){var e,t;L.value=!0,p.value=null;try{const o=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(o&&r)try{const i=await w.getMedia();console.log("ðŸ” LOAD DEBUG: API returned data:",i),console.log("ðŸ” LOAD DEBUG: Data length:",i==null?void 0:i.length),console.log("ðŸ” LOAD DEBUG: First item:",i==null?void 0:i[0]),l.value=i||[],console.log("ðŸ” LOAD DEBUG: mediaData.value set to:",l.value)}catch(i){console.warn("API load failed for logged in user:",i),l.value=[]}else{const i=A();if(i.length>0)l.value=i;else{const f=await w.getMedia();l.value=f||[],u()}}}catch(o){p.value=((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.message)||o.message||"Failed to load media data",console.error("Failed to load media:",o)}finally{L.value=!1}}function j(e){m.value=e}function H(e){n.value=e}function K(e){v.value.some(o=>o.type===e.type&&o.value===e.value)||v.value.push(e)}function W(e){v.value=v.value.filter(t=>!(t.type===e.type&&t.value===e.value))}function Y(){v.value=[]}async function X(e,t=!1){var o,r,i;p.value=null;try{const f=localStorage.getItem("authToken"),D=localStorage.getItem("currentUser");if(f&&D)try{const y=await w.addMediaItem(e);if(!t)await k();else{const M={...y,__order:l.value.length};l.value.push(M)}return y}catch(y){if(((o=y.response)==null?void 0:o.status)===409&&((i=(r=y.response)==null?void 0:r.data)!=null&&i.duplicate)){const M=new Error(y.response.data.error||"Ein Eintrag mit diesem Titel und dieser Kategorie existiert bereits.");throw M.isDuplicate=!0,M}throw p.value=y.message||"Failed to add media item",console.error("API save failed for logged in user:",y),y}else{const y={id:Date.now(),...e,__order:l.value.length};return l.value.push(y),u(),y}}catch(f){throw f}}async function Z(e,t){p.value=null;try{const o=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(o&&r)try{const i=await w.updateMediaItem(e,t);return await k(),i}catch(i){throw console.error("API update failed for logged in user:",i),i}else{const i=l.value.findIndex(f=>f.id===e);if(i!==-1)return l.value[i]={...l.value[i],...t},u(),l.value[i];throw new Error("Media item not found")}}catch(o){throw o.isDuplicate||(p.value=o.message||"Failed to update media item"),o}}async function ee(e){var t;try{const o=localStorage.getItem("authToken"),r=localStorage.getItem("currentUser");if(o&&r)try{return await w.deleteMediaItem(e),await k(),!0}catch(i){if(((t=i.response)==null?void 0:t.status)===404||i.isNotFound)return await k(),!0;throw console.error("API delete failed for logged in user:",i),i}else{const i=l.value.findIndex(f=>f.id===e);if(i!==-1)return l.value.splice(i,1),u(),!0;throw new Error("Media item not found")}}catch(o){throw p.value=o.message||"Failed to delete media item",o}}async function te(e){try{const t=localStorage.getItem("authToken"),o=localStorage.getItem("currentUser");if(t&&o)try{const r=await w.batchAddMediaItems(e);return await k(),r}catch(r){throw console.error("API batch add failed for logged in user:",r),r}else{const r=e.map((i,f)=>({id:Date.now()+f,...i,__order:l.value.length+f}));return l.value.push(...r),u(),{success:!0,stats:{created:r.length,failed:0,errors:[]}}}}catch(t){throw p.value=t.message||"Failed to add media items",t}}async function ae(e){try{const t=localStorage.getItem("authToken"),o=localStorage.getItem("currentUser");if(t&&o)try{return await w.batchDeleteMediaItems(e),await k(),!0}catch(r){if(r.silent)return console.log("Silent batch delete error (some items may not exist):",r.message),await k(),!0;throw console.error("API batch delete failed for logged in user:",r),r}else return l.value=l.value.filter(r=>!e.includes(r.id)),u(),!0}catch(t){throw t.silent||(p.value=t.message||"Failed to delete media items"),t}}async function oe(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");e&&t?await w.saveMedia(l.value):u()}catch(e){console.error("Failed to save media:",e)}}function G(){p.value=null}function se(e){if(console.log("Processing real-time update:",e),e.type==="media_updated"&&e.items)e.items.forEach(t=>{const o=l.value.findIndex(r=>r.id===t.id);o!==-1?l.value[o]={...l.value[o],...t}:l.value.push(t)});else if(e.action==="created"||e.action==="updated"){const t=e.item,o=l.value.findIndex(r=>r.id===t.id);o!==-1?l.value[o]={...l.value[o],...t}:l.value.push(t)}else if(e.action==="deleted"){const t=l.value.findIndex(o=>o.id===e.id);t!==-1&&l.value.splice(t,1)}u()}function re(){const e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");if(!e||!t){console.log("Skipping realtime initialization - user not authenticated");return}try{O.addListener("media-store",se),O.connect()}catch(o){console.error("Failed to initialize realtime updates:",o)}}function le(){O.removeListener("media-store")}return{mediaData:l,currentCategory:m,searchQuery:n,activeFilters:v,loading:L,error:p,totalItems:U,categoryCounts:Q,filteredMedia:z,platforms:J,genres:q,loadMedia:k,setCategory:j,setSearchQuery:H,addFilter:K,removeFilter:W,clearFilters:Y,addMediaItem:X,updateMediaItem:Z,deleteMediaItem:ee,batchAddMediaItems:te,batchDeleteMediaItems:ae,saveMedia:oe,clearError:G,initializeRealtimeUpdates:re,cleanupRealtimeUpdates:le,resetMediaState:()=>{m.value="game",n.value="",v.value=[],localStorage.removeItem("currentCategory"),localStorage.removeItem("searchQuery"),localStorage.removeItem("activeFilters")}}}),We=P("sidebar",()=>{const d=()=>{try{const u=localStorage.getItem("sidebarState");if(u)return{collapsed:JSON.parse(u).collapsed||!1,mobileOpen:!1}}catch(u){console.error("Failed to load sidebar state from localStorage:",u)}return{collapsed:!1,mobileOpen:!1}},a=u=>{try{localStorage.setItem("sidebarState",JSON.stringify({collapsed:u.collapsed}))}catch(U){console.error("Failed to save sidebar state to localStorage:",U)}},c=d(),h=C(c.collapsed),g=C(c.mobileOpen);T(h,u=>{a({collapsed:u,mobileOpen:g.value})},{immediate:!1});const b=()=>{h.value=!h.value},l=()=>{g.value=!g.value},m=()=>{g.value=!1},n=u=>{h.value=u},v=u=>{g.value=u},L=()=>{h.value=!1,g.value=!1,localStorage.removeItem("sidebarState")},p=E(()=>h.value),A=E(()=>g.value);return{collapsed:h,mobileOpen:g,toggleSidebar:b,toggleMobileSidebar:l,closeMobileSidebar:m,setCollapsed:n,setMobileOpen:v,resetSidebarState:L,isCollapsed:p,isMobileOpen:A}}),de={name:"VersionInfo",data(){return{version:"1.0.0"}}},ge={class:"version-info"},ve={class:"version-label"};function me(d,a,c,h,g,b){return S(),I("div",ge,[s("span",ve,"Build #"+F(g.version),1)])}const fe=V(de,[["render",me],["__scopeId","data-v-2d54e3c7"]]),pe={name:"Sidebar",components:{VersionInfo:fe},props:{collapsed:{type:Boolean,default:!1},mobileOpen:{type:Boolean,default:!1},isLoggedIn:{type:Boolean,default:!1},userName:{type:String,default:""},currentCategory:{type:String,default:"watchlist"},categoryCounts:{type:Object,default:()=>({})},platforms:{type:Array,default:()=>[]},genres:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[{key:"game",name:"Games",icon:"ðŸŽ®"},{key:"series",name:"Series",icon:"ðŸ“º"},{key:"movie",name:"Movies",icon:"ðŸŽ¬"},{key:"buecher",name:"BÃ¼cher",icon:"ðŸ“š"},{key:"watchlist",name:"Watchlist",icon:"â¤ï¸"}]}},emits:["toggle","setCategory","addItem","navigateToCalendar","navigateToProfile","togglePlatformFilter","toggleGenreFilter","toggleAiringFilter","clearFilters","showLogin","showRegister","logout"],methods:{}},he={class:"sidebar-content"},ye={class:"sidebar-section"},Ie={class:"sidebar-nav"},Se=["onClick"],be={class:"nav-icon"},ke={class:"nav-text"},we={class:"nav-count"},Ce=["onClick","title"],Fe={key:0,class:"sidebar-section"},Ee={class:"filters-header"},Le={class:"filter-section"},Ae={class:"filter-group"},Ue={class:"filter-checkboxes"},De=["value","onChange"],Me={class:"option-text"},Te={class:"filter-group"},Be={class:"filter-checkboxes"},_e=["value","onChange"],xe={class:"option-text"},$e={class:"filter-group"},Oe={class:"filter-checkboxes"},Ge={class:"filter-option"},Re={class:"filter-option"},Ne={class:"sidebar-section"},Pe={key:0,class:"auth-buttons"},Ve={key:1,class:"user-info"},Qe={class:"user-profile"},ze={class:"profile-details"},Je={class:"user-name"};function qe(d,a,c,h,g,b){const l=N("router-link"),m=N("VersionInfo");return S(),I("aside",{id:"sidebar",class:$(["sidebar",{collapsed:c.collapsed,open:c.mobileOpen}])},[s("div",{class:"sidebar-header",onClick:a[0]||(a[0]=n=>d.$emit("toggle"))},[...a[9]||(a[9]=[s("h2",null,"Media Library",-1),s("button",{class:"sidebar-toggle"},"â˜°",-1)])]),s("div",he,[s("div",ye,[a[14]||(a[14]=s("h3",null,"Browse",-1)),s("nav",Ie,[(S(!0),I(_,null,x(c.categories,n=>(S(),I("div",{key:n.key,class:"nav-item"},[s("button",{class:$(["nav-btn",{active:c.currentCategory===n.key}]),onClick:v=>d.$emit("setCategory",n.key)},[s("span",be,F(n.icon),1),s("span",ke,F(n.name),1),s("span",we,F(c.categoryCounts[n.key]||0),1)],10,Se),s("button",{class:"add-btn",onClick:v=>d.$emit("addItem",n.key),title:`Add ${n.name}`},[...a[10]||(a[10]=[s("span",{class:"add-icon"},"+",-1)])],8,Ce)]))),128)),s("button",{class:$(["nav-btn",{active:c.currentCategory==="statistics"}]),onClick:a[1]||(a[1]=n=>d.$emit("setCategory","statistics"))},[...a[11]||(a[11]=[s("span",{class:"nav-icon"},"ðŸ“Š",-1),s("span",{class:"nav-text"},"Statistics",-1)])],2),B(l,{to:"/calendar",class:"nav-btn"},{default:R(()=>[...a[12]||(a[12]=[s("span",{class:"nav-icon"},"ðŸ“…",-1),s("span",{class:"nav-text"},"Calendar",-1)])]),_:1}),B(l,{to:"/profile",class:"nav-btn"},{default:R(()=>[...a[13]||(a[13]=[s("span",{class:"nav-icon"},"ðŸ‘¤",-1),s("span",{class:"nav-text"},"Profile",-1)])]),_:1})])]),c.isLoggedIn?(S(),I("div",Fe,[s("div",Ee,[a[16]||(a[16]=s("h3",null,"Filters",-1)),s("button",{class:"refresh-btn",onClick:a[2]||(a[2]=n=>d.$emit("clearFilters")),title:"Clear all filters"},[...a[15]||(a[15]=[s("span",{class:"refresh-icon"},"ðŸ”„",-1),s("span",{class:"refresh-text"},"Refresh",-1)])])]),s("div",Le,[s("div",Ae,[a[18]||(a[18]=s("h4",null,"Platforms",-1)),s("div",Ue,[(S(!0),I(_,null,x(c.platforms,n=>(S(),I("label",{key:n,class:"filter-option"},[s("input",{type:"checkbox",value:n,onChange:v=>d.$emit("togglePlatformFilter",n,v.target.checked)},null,40,De),a[17]||(a[17]=s("span",{class:"checkmark"},null,-1)),s("span",Me,F(n),1)]))),128))])]),s("div",Te,[a[20]||(a[20]=s("h4",null,"Genres",-1)),s("div",Be,[(S(!0),I(_,null,x(c.genres,n=>(S(),I("label",{key:n,class:"filter-option"},[s("input",{type:"checkbox",value:n,onChange:v=>d.$emit("toggleGenreFilter",n,v.target.checked)},null,40,_e),a[19]||(a[19]=s("span",{class:"checkmark"},null,-1)),s("span",xe,F(n),1)]))),128))])]),s("div",$e,[a[25]||(a[25]=s("h4",null,"Series Status",-1)),s("div",Oe,[s("label",Ge,[s("input",{type:"checkbox",value:"airing",onChange:a[3]||(a[3]=n=>d.$emit("toggleAiringFilter","airing",n.target.checked))},null,32),a[21]||(a[21]=s("span",{class:"checkmark"},null,-1)),a[22]||(a[22]=s("span",{class:"option-text"},[s("span",{class:"airing-indicator"},"â—"),ce(" Airing ")],-1))]),s("label",Re,[s("input",{type:"checkbox",value:"finished",onChange:a[4]||(a[4]=n=>d.$emit("toggleAiringFilter","finished",n.target.checked))},null,32),a[23]||(a[23]=s("span",{class:"checkmark"},null,-1)),a[24]||(a[24]=s("span",{class:"option-text"},"Finished",-1))])])])])])):ie("",!0),s("div",Ne,[a[27]||(a[27]=s("h3",null,"Account",-1)),c.isLoggedIn?(S(),I("div",Ve,[s("div",Qe,[a[26]||(a[26]=s("div",{class:"profile-avatar"},[s("span",{class:"avatar-text"},"ðŸ‘¤")],-1)),s("div",ze,[s("span",Je,F(c.userName),1)]),s("button",{class:"account-btn",onClick:a[7]||(a[7]=n=>d.$emit("navigateToProfile"))},"âš™ï¸")]),s("button",{class:"auth-btn",onClick:a[8]||(a[8]=n=>d.$emit("logout"))},"Logout")])):(S(),I("div",Pe,[s("button",{class:"auth-btn",onClick:a[5]||(a[5]=n=>d.$emit("showLogin"))},"Login"),s("button",{class:"auth-btn",onClick:a[6]||(a[6]=n=>d.$emit("showRegister"))},"Register")]))])]),B(m)],2)}const Ye=V(pe,[["render",qe],["__scopeId","data-v-39b2a04a"]]);export{Ye as S,We as a,Ke as u};
